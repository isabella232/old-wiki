<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/EricsBroadcastingDoc by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:24:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="index,nofollow">

<title>EricsBroadcastingDoc - SciPy</title>
<script type="text/javascript" src="moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: EricsBroadcastingDoc" href="../external.html?link=http://localhost:8080/EricsBroadcastingDoc?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=EricsBroadcastingDoc&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../external.html?link=http://localhost:8080/EricsBroadcastingDoc?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../external.html?link=http://localhost:8080/EricsBroadcastingDoc?action=print">
<link rel="Appendix" title="EricsBroadcastingDocSI2.png" href="EricsBroadcastingDoc4eab.html?action=AttachFile&amp;do=view&amp;target=EricsBroadcastingDocSI2.png">
<link rel="Appendix" title="image001.gif" href="EricsBroadcastingDoc94a6.html?action=AttachFile&amp;do=view&amp;target=image001.gif">
<link rel="Appendix" title="image002.gif" href="EricsBroadcastingDoc2976.html?action=AttachFile&amp;do=view&amp;target=image002.gif">
<link rel="Appendix" title="image003.gif" href="EricsBroadcastingDoc6497.html?action=AttachFile&amp;do=view&amp;target=image003.gif">
<link rel="Appendix" title="image004.gif" href="EricsBroadcastingDoc0a57.html?action=AttachFile&amp;do=view&amp;target=image004.gif">
<link rel="Appendix" title="image005.gif" href="EricsBroadcastingDocde4c.html?action=AttachFile&amp;do=view&amp;target=image005.gif">
<link rel="Appendix" title="image005.png" href="EricsBroadcastingDoc8af6.html?action=AttachFile&amp;do=view&amp;target=image005.png">
<link rel="Appendix" title="image006.gif" href="EricsBroadcastingDoc7e4f.html?action=AttachFile&amp;do=view&amp;target=image006.gif">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">


<form id="searchform" method="get" action="../external.html?link=http://localhost:8080/EricsBroadcastingDoc">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="EricsBroadcastingDoc456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a class="backlink" href="EricsBroadcastingDoc21e2.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22EricsBroadcastingDoc%22" rel="nofollow" title="Click to do a full-text search for this title">EricsBroadcastingDoc</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="HelpContents.html">HelpContents</a></li><li class="current"><a href="EricsBroadcastingDoc.html">EricsBroadcastingDoc</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="EricsBroadcastingDoc37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/EricsBroadcastingDoc">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="Array_Broadcasting_in_numpy">Array Broadcasting in numpy</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line862">Last quarter's column introduced numpy and the concept of array arithmetic.  This time, we'll explore a more advanced concept in numpy called <em>broadcasting</em>. The term broadcasting describes how numpy treats arrays with different shapes during arithmetic operations.  Subject to certain constraints, the smaller array is &quot;broadcast&quot; across the larger array so that they have compatible shapes.  Broadcasting provides a means of vectorizing array operations so that looping occurs in C instead of Python.  It does this without making needless copies of data and usually leads to efficient algorithm implementations.  There are also cases where broadcasting is a bad idea because it leads to inefficient use of memory that slows computation.  This article provides a gentle introduction to broadcasting with numerous examples ranging from simple to involved.  It also provides hints on when and when not to use broadcasting. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">numpy operations are usually done element-by-element which requires two arrays to have exactly the same shape: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line867"><strong>Example 1</strong> <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-74711c6b1bf243f6d3a7950c53eb50ff144ef9a8" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span> </span>
<span class="line"><span class="anchor" id="line-2-1"></span>&gt;&gt;&gt; <span class="ID">a</span> = <span class="ID">array</span>([<span class="Number">1.0</span>,<span class="Number">2.0</span>,<span class="Number">3.0</span>])</span>
<span class="line"><span class="anchor" id="line-3-1"></span>&gt;&gt;&gt; <span class="ID">b</span> = <span class="ID">array</span>([<span class="Number">2.0</span>,<span class="Number">2.0</span>,<span class="Number">2.0</span>])</span>
<span class="line"><span class="anchor" id="line-4-1"></span>&gt;&gt;&gt; <span class="ID">a</span> * <span class="ID">b</span></span>
<span class="line"><span class="anchor" id="line-5-1"></span><span class="ID">array</span>([ <span class="Number">2.</span>,  <span class="Number">4.</span>,  <span class="Number">6.</span>])</span>
</pre></div></div><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line874">numpy's broadcasting rule relaxes this constraint when the arrays' shapes meet certain constraints.  The simplest broadcasting example occurs when an array and a scalar value are combined in an operation: <span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867"><strong>Example 2</strong> <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-48e706a237d634559ea0e67b5cd10ff6d45ade65" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span></span>
<span class="line"><span class="anchor" id="line-2-2"></span>&gt;&gt;&gt; <span class="ID">a</span> = <span class="ID">array</span>([<span class="Number">1.0</span>,<span class="Number">2.0</span>,<span class="Number">3.0</span>])</span>
<span class="line"><span class="anchor" id="line-3-2"></span>&gt;&gt;&gt; <span class="ID">b</span> = <span class="Number">2.0</span></span>
<span class="line"><span class="anchor" id="line-4-2"></span>&gt;&gt;&gt; <span class="ID">a</span> * <span class="ID">b</span></span>
<span class="line"><span class="anchor" id="line-5-2"></span><span class="ID">array</span>([ <span class="Number">2.</span>,  <span class="Number">4.</span>,  <span class="Number">6.</span>])</span>
</pre></div></div><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line862">The result is equivalent to the previous example where <tt>b</tt> was an array.  We can think of the scalar <tt>b</tt> being <em>stretched</em> during the arithmetic operation into an array with the same shape as <tt>a</tt>.  The new elements in <tt>b</tt>, as shown in <strong>Figure 1</strong>, are simply copies of the original scalar.  The stretching analogy is only conceptual.  numpy is smart enough to use the original scalar value without actually making copies so that broadcasting operations are as memory and computationally efficient as possible.  Because <strong>Example 2</strong> moves less memory, (<tt>b</tt> is a scalar, not an array) around during the multiplication, it is about 10% faster than <strong>Example 1</strong> using the standard numpy on Windows 2000 with one million element arrays. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><img alt="image001.gif" class="attachment" src="image0013830.gif?action=AttachFile&amp;do=get&amp;target=image001.gif" title="image001.gif" /> <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line867"><strong>Figure 1: In the simplest example of broadcasting, the scalar <tt>b</tt> is <em>stretched</em> to become an array of with the same shape as <tt>a</tt> so the shapes are compatible for element-by-element multiplication.</strong> <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><p class="line874">The rule governing whether two arrays have compatible shapes for broadcasting can be expressed in a single sentence: <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line867">
<h2 id="The_Broadcasting_Rule">The Broadcasting Rule</h2>
<span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><ul><li style="list-style-type:none"><p class="line862">In order to broadcast, the size of the <em>trailing</em> axes for both arrays in an operation must either be the same size or one of them must be one.   <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></li></ul><p class="line862">If this condition is not met, a <tt class="backtick">ValueError:&nbsp;frames&nbsp;are&nbsp;not&nbsp;aligned</tt> exception is thrown indicating that the arrays have incompatible shapes.   The size of the result array created by broadcast operations is the maximum size along each dimension from the input arrays.  Note that the rule does not say anything about the two arrays needing to have the same number of dimensions.  So, for example, if you have a 256x256x3 array of RGB values, and you want to scale each color in the image by a different value, you can multiply the image by a one-dimensional array with 3 values.  Lining up the sizes of the trailing axes of these arrays according to the broadcast rule shows that they are compatible: <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line867"><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><pre><span class="anchor" id="line-1"></span>      Image  (3d array): 256 x 256 x 3
<span class="anchor" id="line-2"></span>      Scale  (1d array):             3
<span class="anchor" id="line-3"></span>      Result (3d array): 256 x 256 x 3</pre><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line862">In the following example, both the <tt>A</tt> and <tt>B</tt> arrays have axes with length one that are expanded to a larger size in a broadcast operation. <span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line867"><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><pre><span class="anchor" id="line-1-1"></span>      A      (4d array):  8 x 1 x 6 x 1
<span class="anchor" id="line-2-1"></span>      B      (3d array):      7 x 1 x 5
<span class="anchor" id="line-3-1"></span>      Result (4d array):  8 x 7 x 6 x 5</pre><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line862">Below, are several code examples and graphical representations that help make the broadcast rule visually obvious.  <strong>Example 3</strong> adds a one-dimensional array to a two-dimensional array: <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line867"><strong>Example 3</strong> <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-d2aa5e977fbb71ff443f89ed4d11d59f3044f28f" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span></span>
<span class="line"><span class="anchor" id="line-2-3"></span>&gt;&gt;&gt; <span class="ID">a</span> = <span class="ID">array</span>([[ <span class="Number">0.0</span>, <span class="Number">0.0</span>, <span class="Number">0.0</span>],</span>
<span class="line"><span class="anchor" id="line-3-3"></span>...            [<span class="Number">10.0</span>,<span class="Number">10.0</span>,<span class="Number">10.0</span>],</span>
<span class="line"><span class="anchor" id="line-4-3"></span>...            [<span class="Number">20.0</span>,<span class="Number">20.0</span>,<span class="Number">20.0</span>],</span>
<span class="line"><span class="anchor" id="line-5-3"></span>...            [<span class="Number">30.0</span>,<span class="Number">30.0</span>,<span class="Number">30.0</span>]])</span>
<span class="line"><span class="anchor" id="line-6-1"></span>&gt;&gt;&gt; <span class="ID">b</span> = <span class="ID">array</span>([<span class="Number">1.0</span>,<span class="Number">2.0</span>,<span class="Number">3.0</span>])</span>
<span class="line"><span class="anchor" id="line-7-1"></span>&gt;&gt;&gt; <span class="ID">a</span> + <span class="ID">b</span></span>
<span class="line"><span class="anchor" id="line-8-1"></span><span class="ID">array</span>([[  <span class="Number">1.</span>,   <span class="Number">2.</span>,   <span class="Number">3.</span>],</span>
<span class="line"><span class="anchor" id="line-9-1"></span>       [ <span class="Number">11.</span>,  <span class="Number">12.</span>,  <span class="Number">13.</span>],</span>
<span class="line"><span class="anchor" id="line-10-1"></span>       [ <span class="Number">21.</span>,  <span class="Number">22.</span>,  <span class="Number">23.</span>],</span>
<span class="line"><span class="anchor" id="line-11-1"></span>       [ <span class="Number">31.</span>,  <span class="Number">32.</span>,  <span class="Number">33.</span>]])</span>
</pre></div></div><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line862">As shown in <strong>Figure 2</strong>, <tt>b</tt> is added to each row of <tt>a</tt>.  When <tt>b</tt> is longer than the rows of <tt>a</tt>, as in <strong>Figure 3</strong>, an exception is raised because of the incompatible shapes. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><p class="line867"><img alt="image002.gif" class="attachment" src="image0020619.gif?action=AttachFile&amp;do=get&amp;target=image002.gif" title="image002.gif" /> <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><p class="line867"><strong>Figure 2: A two dimensional array multiplied by a one dimensional array results in broadcasting if number of 1-d array elements matches the number of 2-d array columns.</strong> <span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><p class="line867"><img alt="image003.gif" class="attachment" src="image00309d8.gif?action=AttachFile&amp;do=get&amp;target=image003.gif" title="image003.gif" /> <span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><p class="line867"><strong>Figure 3: When the trailing dimensions of the arrays are unequal, broadcasting fails because it is impossible to align the values in the rows of the 1<sup>st</sup> array with the elements of the 2<sup>nd</sup> arrays for element-by-element addition. </strong> <span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line862">Broadcasting provides a convenient way of taking the outer product (or any other outer operation) of two arrays.  The following example shows an outer addition operation of two 1-d arrays that produces the same result as <strong>Example 3</strong>. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><p class="line867"><strong>Example 4</strong> <span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-3bcfb17f97d305391883c98ea05b1870acc39e64" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span>, <span class="ID">newaxis</span></span>
<span class="line"><span class="anchor" id="line-2-4"></span>&gt;&gt;&gt; <span class="ID">a</span> = <span class="ID">array</span>([<span class="Number">0.0</span>,<span class="Number">10.0</span>,<span class="Number">20.0</span>,<span class="Number">30.0</span>])</span>
<span class="line"><span class="anchor" id="line-3-4"></span>&gt;&gt;&gt; <span class="ID">b</span> = <span class="ID">array</span>([<span class="Number">1.0</span>,<span class="Number">2.0</span>,<span class="Number">3.0</span>])</span>
<span class="line"><span class="anchor" id="line-4-4"></span>&gt;&gt;&gt; <span class="ID">a</span>[:,<span class="ID">newaxis</span>] + <span class="ID">b</span></span>
<span class="line"><span class="anchor" id="line-5-4"></span><span class="ID">array</span>([[  <span class="Number">1.</span>,   <span class="Number">2.</span>,   <span class="Number">3.</span>],</span>
<span class="line"><span class="anchor" id="line-6-2"></span>       [ <span class="Number">11.</span>,  <span class="Number">12.</span>,  <span class="Number">13.</span>],</span>
<span class="line"><span class="anchor" id="line-7-2"></span>       [ <span class="Number">21.</span>,  <span class="Number">22.</span>,  <span class="Number">23.</span>],</span>
<span class="line"><span class="anchor" id="line-8-2"></span>       [ <span class="Number">31.</span>,  <span class="Number">32.</span>,  <span class="Number">33.</span>]])</span>
</pre></div></div><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line862">Here the <tt>newaxis</tt> index operator inserts a new axis into <tt>a</tt>, making it a two-dimensional 4x1 array.  <strong>Figure 4</strong> illustrates the stretching of both arrays to produce the desired 4x3 output array. <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><p class="line867"><img alt="image004.gif" class="attachment" src="image004de9e.gif?action=AttachFile&amp;do=get&amp;target=image004.gif" title="image004.gif" /> <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line867"><strong>Figure 4: In some cases, broadcasting stretches both arrays to form an output array larger than either of the initial arrays. </strong> <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line867">
<h2 id="A_Practical_Example:_Vector_Quantization.">A Practical Example: Vector Quantization.</h2>
<span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><p class="line862">Broadcasting comes up quite often in real world problems.  A typical example occurs in the vector quantization (VQ) algorithm used in information theory, classification, and other related areas.  The basic operation in VQ finds the closest point in a set of points, called <tt>codes</tt> in VQ jargon, to a given point, called the <tt>observation</tt>.  In the very simple two-dimensional case shown in <strong>Figure 5</strong>, the values in <tt>observation</tt> describe the weight and height of an athlete to be classified.  The codes represent different classes of athletes.<sup><a href="#fnref-0eeb07eddac72a7a45012515b0971a11f1fe5e28" id="fndef-0eeb07eddac72a7a45012515b0971a11f1fe5e28-0">1</a></sup>  Finding the closest point requires calculating the distance between <tt>observation</tt> and each of the <tt>codes</tt>.  The shortest distance provides the best match.  In this example, <tt>codes[0]</tt> is the closest class indicating that the athlete is likely a basketball player.  <span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><p class="line867"><img alt="image005.png" class="attachment" src="image005e76f.png?action=AttachFile&amp;do=get&amp;target=image005.png" title="image005.png" /> <span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><p class="line867"><strong>Figure 5: The basic operation of vector quantization calculates the distance between an object to be classified, the dark square, and multiple known codes, the gray circles.  In this simple case, the codes represent individual classes.  More complex cases use multiple codes per class.</strong> <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line867"><strong>Example 5</strong> <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-cbfec90472fe7b602c611507c089c7517375e64d" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span>, <span class="ID">argmin</span>, <span class="ID">sqrt</span>, <span class="ResWord">sum</span></span>
<span class="line"><span class="anchor" id="line-2-5"></span>&gt;&gt;&gt; <span class="ID">observation</span> = <span class="ID">array</span>([<span class="Number">111.0</span>,<span class="Number">188.0</span>])</span>
<span class="line"><span class="anchor" id="line-3-5"></span>&gt;&gt;&gt; <span class="ID">codes</span> = <span class="ID">array</span>([[<span class="Number">102.0</span>, <span class="Number">203.0</span>],</span>
<span class="line"><span class="anchor" id="line-4-5"></span>...                [<span class="Number">132.0</span>, <span class="Number">193.0</span>],</span>
<span class="line"><span class="anchor" id="line-5-5"></span>...                [<span class="Number">45.0</span>, <span class="Number">155.0</span>],</span>
<span class="line"><span class="anchor" id="line-6-3"></span>...                [<span class="Number">57.0</span>, <span class="Number">173.0</span>]])</span>
<span class="line"><span class="anchor" id="line-7-3"></span>&gt;&gt;&gt; <span class="Comment"># here is the broadcast</span></span>
<span class="line"><span class="anchor" id="line-8-3"></span>&gt;&gt;&gt; <span class="ID">diff</span> = <span class="ID">codes</span> - <span class="ID">observation</span></span>
<span class="line"><span class="anchor" id="line-9-2"></span>&gt;&gt;&gt; <span class="ID">dist</span> = <span class="ID">sqrt</span>(<span class="ResWord">sum</span>(<span class="ID">diff</span>**<span class="Number">2</span>,<span class="ID">axis</span>=-<span class="Number">1</span>))</span>
<span class="line"><span class="anchor" id="line-10-2"></span>&gt;&gt;&gt; <span class="ID">nearest</span> = <span class="ID">argmin</span>(<span class="ID">dist</span>)</span>
<span class="line"><span class="anchor" id="line-11-2"></span><span class="Number">0</span></span>
</pre></div></div><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line862">Typically, a large number of observations, perhaps read from a database, are compared to a set of codes.  <strong>Figure 6</strong> illustrates how to handle this calculation with a small amount of code and without looping in Python.  While this is very efficient in terms of lines of code, it may or may not be computationally efficient.  The issue is the three-dimensional <tt>diff</tt> array calculated in an intermediate step of the algorithm.  For small data sets, creating and operating on the array is likely to be very fast.  However, large data sets will generate a large intermediate array that is computationally inefficient.  The three dimensional array is a consequence of broadcasting, not a necessity for the calculation.  If, instead, each observation is calculated individually using a Python loop around the code in <strong>Example 5</strong>, a much smaller two-dimensional array is used.  This is sometimes more efficient.  As an example, <strong>Table 1</strong> shows that computation time for a data set of 4000 observations with 16 features (i.e., weight, height, and 14 more) categorized into 40 codes.  <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line867"><img alt="image006.gif" class="attachment" src="image006dd73.gif?action=AttachFile&amp;do=get&amp;target=image006.gif" title="image006.gif" /> <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><p class="line867"><strong>Figure 6: Here, VQ with multiple observation points is done using broadcasting during the difference calculation by flipping the <tt>obs</tt> and <tt>book</tt> arrays on their edges.  The resulting difference array is 3-dimensional.  This is certainly efficient in terms of lines of code, and, for small data sets, it can also be computationally efficient.  For large data sets, however, the creation of the large 3-d array may result in sluggish performance.</strong> <span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><div><table><tbody><tr>  <td style="text-align: center; vertical-align: top"><p class="line862">Algorithm </td>
  <td style="text-align: center; vertical-align: top"><p class="line862">seconds</td>
</tr>
<tr>  <td style="vertical-align: top"><span class="anchor" id="line-160"></span><p class="line862">3-d broadcasting </td>
  <td style="text-align: center; vertical-align: top"><p class="line862">2.245</td>
</tr>
<tr>  <td style="vertical-align: top"><span class="anchor" id="line-161"></span><p class="line862">2-d broadcasting with outer loop in Python </td>
  <td style="text-align: center; vertical-align: top"><p class="line862">1.637</td>
</tr>
</tbody></table></div><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><p class="line867"><strong>Table 1: This table compares the run time of a pure broadcasting approach and a hybrid broadcasting/python looping algorithm for VQ calculations on a large data set with 4000 observations and 16 features categorized into 40 codes.  Using the Python loop provides a speedup of 1.36 over the pure broadcasting approach.</strong> <span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><p class="line874">Broadcasting is a powerful tool for writing short and usually intuitive code that does its computations very efficiently in C.  However, there are cases when broadcasting uses unnecessarily large amounts of memory for a particular algorithm.  In these cases, it is better to write the algorithm's outer loop in Python.   This may also produce more readable code, as algorithms that use broadcasting tend to become more difficult to interpret as the number of dimensions in the broadcast increases. <span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><p class="line867">
<h2 id="Resources">Resources</h2>
<span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><ul><li><p class="line862">numpy: <a class="http" href="../external.html?link=http://numpy.scipy.org/">http://numpy.scipy.org</a> <span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span>The home page has links to the download site as well as more comprehensive documentation of numpy's capabilities. <span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span></li><li class="gap">Vector Quantization <span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span>J. Makhoul, S. Roucos, and H. Gish, &quot;Vector Quantization in Speech Coding,&quot; Proc. IEEE, vol. 73, pp. 1551-1587, Nov. 1985. <span class="anchor" id="line-178"></span></li></ul><div class="footnotes"><ol><li><p><a id="fnref-0eeb07eddac72a7a45012515b0971a11f1fe5e28"></a><span class="anchor" id="line-1-11"></span>In this example, weight has more impact on the distance calculation than height because of the larger values.  In practice, it is important to normalize the height and weight, often by their standard deviation across the data set, so that both have equal influence on the distance calculation.  (<a href="#fndef-0eeb07eddac72a7a45012515b0971a11f1fe5e28-0">1</a>)</li></ol></div><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: EricsBroadcastingDoc  (last edited 2015-10-24 17:48:23 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="EricsBroadcastingDoc37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/EricsBroadcastingDoc">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/EricsBroadcastingDoc by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:25:03 GMT -->
</html>

