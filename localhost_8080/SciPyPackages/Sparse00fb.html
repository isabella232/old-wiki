<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/SciPyPackages/Sparse?highlight=%28%28Developer_Zone%29%29 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="noindex,nofollow">

<title>SciPyPackages/Sparse - SciPy</title>
<script type="text/javascript" src="../moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: SciPyPackages/Sparse" href="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=SciPyPackages%2FSparse&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="../AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse?action=print">
<link rel="Up" href="../SciPyPackages.html">
<link rel="Search" href="../FindPage.html">
<link rel="Index" href="../TitleIndex.html">
<link rel="Glossary" href="../WordIndex.html">
<link rel="Help" href="../HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">


<form id="searchform" method="get" action="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="Sparse456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="../AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a href="../SciPyPackages.html">SciPyPackages</a></li><li><a class="backlink" href="Sparse7086.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22SciPyPackages%2FSparse%22" rel="nofollow" title="Click to do a full-text search for this title">Sparse</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="../RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="../FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="../HelpContents.html">HelpContents</a></li><li class="current"><a href="Sparse.html">SciPyPackages/Sparse</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Sparse37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Introduction">Introduction</a><ol><li>
<a href="#What_is_a_sparse_matrix.3F">What is a sparse matrix?</a></li><li>
<a href="#Where_do_sparse_matrices_arise.3F">Where do sparse matrices arise?</a></li></ol></li><li>
<a href="#Sparsity_Patterns">Sparsity Patterns</a></li><li>
<a href="#Sparse_Formats">Sparse Formats</a><ol><li>
<a href="#Constructing_Sparse_Matrices">Constructing Sparse Matrices</a></li><li>
<a href="#constructing_from_scratch">constructing from scratch</a></li><li>
<a href="#constructing_from_scratch_faster.2C_with_coo_matrix">constructing from scratch faster, with coo_matrix</a></li><li>
<a href="#construction_utilities">construction utilities</a></li></ol></li><li>
<a href="#Handling_Sparse_Matrices">Handling Sparse Matrices</a></li><li>
<a href="#Solving_Sparse_Linear_Systems">Solving Sparse Linear Systems</a><ol><li>
<a href="#Direct_Factorization_Methods">Direct Factorization Methods</a></li><li>
<a href="#Iterative_Methods">Iterative Methods</a></li></ol></li><li>
<a href="#Solving_Sparse_Eigenvalue_Problems">Solving Sparse Eigenvalue Problems</a></li><li>
<a href="#Sparse_Matrix_File_Input.2FOutput">Sparse Matrix File Input/Output</a><ol><li>
<a href="#MatrixMarket">MatrixMarket</a></li><li>
<a href="#MATLAB">MATLAB</a></li></ol></li><li>
<a href="#Additional_Resources">Additional Resources</a><ol><li>
<a href="#Python">Python</a></li><li>
<a href="#Books">Books</a></li><li>
<a href="#Other_Packages_and_Libraries">Other Packages and Libraries</a></li></ol></li><li>
<a href="#TODO:_update_and_integrate_this_information_where_possible">TODO: update and integrate this information where possible</a></li><li>
<a href="#Examples_.28TODO:_update.29">Examples (TODO: update)</a></li></ol></div><p class="line874"> <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><ul><li style="list-style-type:none"><p class="line862">This guide provides an overview of the sparse matrix support in <a href="../SciPy.html">SciPy</a> version 0.7.  The following topics are covered: <span class="anchor" id="line-6"></span></li><li>Constructing sparse matrices <span class="anchor" id="line-7"></span></li><li>Handling sparse matrices efficiently <span class="anchor" id="line-8"></span></li><li><p class="line862">Solving sparse linear systems and eigenproblems with <strong><tt class="backtick">scipy.sparse.linalg</tt></strong> <span class="anchor" id="line-9"></span></li><li><p class="line862">Using <strong><tt class="backtick">scipy.io</tt></strong> to read and write sparse matrices <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></li></ul><p class="line867">
<h2 id="What_is_a_sparse_matrix.3F">What is a sparse matrix?</h2>
<span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><ul><li style="list-style-type:none"><p class="line862">A <strong>sparse matrix</strong> is simply a matrix with a large number of zero values.  In contrast, a matrix where many or most entries are non-zero is said to be <strong>dense</strong>.  There are no strict rules for what constitutes a sparse matrix, so we'll say that a matrix is sparse if there is some benefit to exploiting its sparsity.  Additionally, there are a variety of <strong>sparse matrix formats</strong> which are designed to exploit different <strong>sparsity patterns</strong> (the structure of non-zero values in a sparse matrix) and different methods for accessing and manipulating matrix entries. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></li></ul><p class="line867">
<h2 id="Where_do_sparse_matrices_arise.3F">Where do sparse matrices arise?</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><ul><li>briefly mention FD and FEM methods <span class="anchor" id="line-20"></span></li><li>show a 2D triangle mesh and associated graph Laplacian (nonzeros only exist when two vertices share and edge, typically 6-7 neighbors, therefore sparse) <span class="anchor" id="line-21"></span></li><li><p class="line862">briefly mention existence of non-physical examples (<a class="nonexistent" href="../PageRank.html">PageRank</a>, <a class="nonexistent" href="../LinearProgramming.html">LinearProgramming</a>) <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></li></ul><p class="line867">
<h1 id="Sparsity_Patterns">Sparsity Patterns</h1>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><ol type="1"><li>Diagonal <span class="anchor" id="line-26"></span></li><li>Block <span class="anchor" id="line-27"></span></li><li>Unstructured <span class="anchor" id="line-28"></span></li><li>Sensitivity of pattern to ordering, and use of reordering for locality (e.g. direct solvers) <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span></li></ol><p class="line867">
<h1 id="Sparse_Formats">Sparse Formats</h1>
<span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><ul><li style="list-style-type:none"><p class="line862">The <strong><tt class="backtick">scipy.sparse</tt></strong> module provides data structures for 2D sparse matrices. There are seven available sparse matrix formats: <span class="anchor" id="line-33"></span></li><li><p class="line891"><strong><tt class="backtick">csc_matrix</tt></strong>: <strong>C</strong>ompressed <strong>S</strong>parse <strong>C</strong>olumn <span class="anchor" id="line-34"></span></li><li><p class="line891"><strong><tt class="backtick">csr_matrix</tt></strong>: <strong>C</strong>ompressed <strong>S</strong>parse <strong>R</strong>ow <span class="anchor" id="line-35"></span></li><li><p class="line891"><strong><tt class="backtick">bsr_matrix</tt></strong>: <strong>B</strong>lock <strong>S</strong>parse <strong>R</strong>ow <span class="anchor" id="line-36"></span></li><li><p class="line891"><strong><tt class="backtick">lil_matrix</tt></strong>: <strong>Li</strong>st of <strong>L</strong>ists <span class="anchor" id="line-37"></span></li><li><p class="line891"><strong><tt class="backtick">dok_matrix</tt></strong>: <strong>D</strong>ictionary <strong>o</strong>f <strong>K</strong>eys <span class="anchor" id="line-38"></span></li><li><p class="line891"><strong><tt class="backtick">coo_matrix</tt></strong>: <strong>Coo</strong>rdinate <span class="anchor" id="line-39"></span></li><li><p class="line891"><strong><tt class="backtick">dia_matrix</tt></strong>: <strong>Dia</strong>gonal <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></li></ul><p class="line874">If you've handled sparse matrices before, then some of these formats will be familiar to you.  If not, don't be overwhelmed by the abundance of sparse matrix formats! <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><ul><li style="list-style-type:none"><p class="line862">Each sparse format has certain advantages and disadvantages.  For instance, adding new non-zero entries to a <tt class="backtick">lil_matrix</tt> is fast, however changing the sparsity pattern of a <tt class="backtick">csr_matrix</tt> requires a significant amount of work.  On the other hand, operations such as matrix-vector multiplication and matrix-matrix arithmetic are much faster with <tt class="backtick">csr_matrix</tt> than <tt class="backtick">lil_matrix</tt>.  A good strategy is to construct matrices using one format and then convert them to another that is better suited for efficient computation. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></li></ul><p class="line867">
<h2 id="Constructing_Sparse_Matrices">Constructing Sparse Matrices</h2>
<span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><p class="line867">
<h3 id="sparse_from_dense">sparse from dense</h3>
<span class="anchor" id="line-49"></span><ul><li style="list-style-type:none"><p class="line862">There are several ways to construct a sparse matrices in <a href="../SciPy.html">SciPy</a>.  The simplest method is to pass a dense <a class="nonexistent" href="../NumPy.html">NumPy</a> <tt class="backtick">matrix</tt> or two-dimensional <tt class="backtick">ndarray</tt> to the desired sparse matrix constructor: <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-63d917bfc575f5f164e0027d169823dbd63fa46c" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span>, <span class="ID">matrix</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span>, <span class="ID">lil_matrix</span></span>
<span class="line"><span class="anchor" id="line-3-1"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">array</span>([[<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">2</span>],[<span class="Number">0</span>,<span class="Number">3</span>,<span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-4-1"></span>&gt;&gt;&gt; <span class="ID">csr_matrix</span>(<span class="ID">A</span>)</span>
<span class="line"><span class="anchor" id="line-5-1"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-6-1"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-7-1"></span>&gt;&gt;&gt; <span class="ID">M</span> = <span class="ID">matrix</span>([[<span class="Number">1.0</span>,<span class="Number">0.0</span>],[<span class="Number">0.0</span>,<span class="Number">2.0</span>]])</span>
<span class="line"><span class="anchor" id="line-8-1"></span>&gt;&gt;&gt; <span class="ID">lil_matrix</span>(<span class="ID">M</span>)</span>
<span class="line"><span class="anchor" id="line-9-1"></span>&lt;<span class="Number">2</span><span class="ID">x2</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-10-1"></span>        <span class="ResWord">with</span> <span class="Number">2</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">LInked</span> <span class="ID">List</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-62"></span>You can also construct matrices directly from lists, <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-9b187b48dc3158edc03f5de7517d056b54b3850e" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span>&gt;&gt;&gt; <span class="ID">csr_matrix</span>([[<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">2</span>],[<span class="Number">0</span>,<span class="Number">3</span>,<span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-2-2"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-3-2"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-68"></span>and empty matrices are created as follows <span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-04608d2aad43c266f1bca38c06266e95b82b6340" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span>&gt;&gt;&gt; <span class="ID">lil_matrix</span>((<span class="Number">3</span>,<span class="Number">4</span>))</span>
<span class="line"><span class="anchor" id="line-2-3"></span>&lt;<span class="Number">3</span><span class="ID">x4</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-3-3"></span>        <span class="ResWord">with</span> <span class="Number">0</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">LInked</span> <span class="ID">List</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-4-2"></span>&gt;&gt;&gt; <span class="ID">csr_matrix</span>((<span class="Number">3</span>,<span class="Number">4</span>), <span class="ID">dtype</span>=<span class="String">'</span><span class="String">int8</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-5-2"></span>&lt;<span class="Number">3</span><span class="ID">x4</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int8</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-6-2"></span>        <span class="ResWord">with</span> <span class="Number">0</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-77"></span><p class="line862">As you can see, the sparse formats store only the non-zero entries of a matrix.  This value is stored in the <tt class="backtick">nnz</tt> attribute, <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f049d8cf7c8570c45529bf1d3a078ce2876e1e09" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="anchor" id="line-2-4"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>([[<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">2</span>],[<span class="Number">0</span>,<span class="Number">3</span>,<span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-3-4"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">nnz</span></span>
<span class="line"><span class="anchor" id="line-4-3"></span><span class="Number">3</span></span>
</pre></div></div><span class="anchor" id="line-84"></span><p class="line862">However, some sparse formats (e.g. <tt class="backtick">dia_matrix</tt>, <tt class="backtick">csr_matrix</tt>) can contain explicit zero entries. In this situation <tt class="backtick">A.nnz</tt> overestimates the true number of non-zero values in the matrix. <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line891"><img alt="/!\" height="15" src="../moin_static197/modern/img/alert.png" title="/!\" width="15" /> <tt class="backtick">scipy.sparse</tt> now supports most <a class="nonexistent" href="../NumPy.html">NumPy</a> data types (e.g. <tt class="backtick">unit8</tt>, <tt class="backtick">int32</tt>, <tt class="backtick">complex128</tt>, etc.) with the exception of the <tt class="backtick">object</tt> and <tt class="backtick">bool</tt> dtypes. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span></li></ul><p class="line867">
<h3 id="sparse_to_dense">sparse to dense</h3>
<span class="anchor" id="line-89"></span><ul><li style="list-style-type:none">As you might expect, you can also convert sparse matrices to the dense format. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-5650a79c135de75e0cf41fa4bb271cee6472d875" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-5"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>([[<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">2</span>],[<span class="Number">0</span>,<span class="Number">3</span>,<span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-3-5"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-4-4"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-5-3"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-6-3"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">todense</span>()</span>
<span class="line"><span class="anchor" id="line-7-2"></span><span class="ID">matrix</span>([[<span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">2</span>],</span>
<span class="line"><span class="anchor" id="line-8-2"></span>        [<span class="Number">0</span>, <span class="Number">3</span>, <span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-9-2"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">toarray</span>()</span>
<span class="line"><span class="anchor" id="line-10-2"></span><span class="ID">array</span>([[<span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">2</span>],</span>
<span class="line"><span class="anchor" id="line-11-1"></span>       [<span class="Number">0</span>, <span class="Number">3</span>, <span class="Number">0</span>]])</span>
</pre></div></div><span class="anchor" id="line-103"></span><p class="line862">This feature is useful for debugging and for using functions in <a class="nonexistent" href="../NumPy.html">NumPy</a> and <a href="../SciPy.html">SciPy</a> that don't support sparse matrices directly. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></li></ul><p class="line867">
<h3 id="sparse_to_sparse_conversions">sparse to sparse conversions</h3>
<span class="anchor" id="line-106"></span><ul><li style="list-style-type:none">Since the whole purpose of sparse matrices is to avoid the dense format, there are several other methods.  Another way is to convert one sparse format to another: <span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-1-11"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-2637f09a9a89a1a4e961c718c53ea37b647c55d6" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span>, <span class="ID">coo_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-6"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>([[<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">2</span>],[<span class="Number">0</span>,<span class="Number">3</span>,<span class="Number">0</span>]])</span>
<span class="line"><span class="anchor" id="line-3-6"></span>&gt;&gt;&gt; <span class="ID">coo_matrix</span>(<span class="ID">A</span>)</span>
<span class="line"><span class="anchor" id="line-4-5"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-5-4"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">COOrdinate</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-6-4"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">tolil</span>()</span>
<span class="line"><span class="anchor" id="line-7-3"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-8-3"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">LInked</span> <span class="ID">List</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-9-3"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">asformat</span>(<span class="String">'</span><span class="String">dok</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-10-3"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">int64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-11-2"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Dictionary</span> <span class="ID">Of</span> <span class="ID">Keys</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-120"></span><p class="line862">Any sparse format in <tt class="backtick">scipy.sparse</tt> can be converted to any other using any of the previous methods.  Since formats like <tt class="backtick">dia_matrix</tt> are inappropriate for certain sparsity patterns, some caution must be exercised.  However, in general conversions among sparse formats are implemented efficiently so that you choose the best format for your application. <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></li></ul><p class="line867">
<h2 id="constructing_from_scratch">constructing from scratch</h2>
<span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><ul><li style="list-style-type:none"><p class="line862">So far, we've shown how to construct sparse matrices from dense matrices and from other sparse matrices.  Clearly we also need a way to construct matrices from scratch.  Since the <tt class="backtick">lil_matrix</tt> (recommended) and <tt class="backtick">dok_matrix</tt> allow new entries to be entered into the matrix, they are a convenient way to build sparse matrices. <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-1-13"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-3f2405d3216e5d700e1fcba042db90b74c788936" lang="en"><span class="line"><span class="anchor" id="line-1-14"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">lil_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-7"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">lil_matrix</span>((<span class="Number">4</span>,<span class="Number">3</span>), <span class="ID">dtype</span>=<span class="String">'</span><span class="String">float32</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-7"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">1</span>,<span class="Number">0</span>] = <span class="Number">3.0</span></span>
<span class="line"><span class="anchor" id="line-4-6"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">2</span>,<span class="Number">2</span>] = <span class="Number">7.0</span></span>
<span class="line"><span class="anchor" id="line-5-5"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">3</span>,<span class="Number">1</span>] = -<span class="Number">2.0</span></span>
<span class="line"><span class="anchor" id="line-6-5"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-7-4"></span>&lt;<span class="Number">4</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float32</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-8-4"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">LInked</span> <span class="ID">List</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-9-4"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">todense</span>()</span>
<span class="line"><span class="anchor" id="line-10-4"></span><span class="ID">matrix</span>([[ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-11-3"></span>        [ <span class="Number">3.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-12-1"></span>        [ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">7.</span>],</span>
<span class="line"><span class="anchor" id="line-13-1"></span>        [ <span class="Number">0.</span>, -<span class="Number">2.</span>,  <span class="Number">0.</span>]], <span class="ID">dtype</span>=<span class="ID">float32</span>)</span>
</pre></div></div><span class="anchor" id="line-140"></span>As expected, explicitly setting an entry to zero removes it from the matrix structure: <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-1-15"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-e98e8d1d4073e97b17a39b33fb34883163ee420a" lang="en"><span class="line"><span class="anchor" id="line-1-16"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">2</span>,<span class="Number">2</span>] = <span class="Number">0</span></span>
<span class="line"><span class="anchor" id="line-2-8"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-3-8"></span>&lt;<span class="Number">4</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float32</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-4-7"></span>        <span class="ResWord">with</span> <span class="Number">2</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">LInked</span> <span class="ID">List</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-5-6"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">todense</span>()</span>
<span class="line"><span class="anchor" id="line-6-6"></span><span class="ID">matrix</span>([[ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-7-5"></span>        [ <span class="Number">3.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-8-5"></span>        [ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-9-5"></span>        [ <span class="Number">0.</span>, -<span class="Number">2.</span>,  <span class="Number">0.</span>]], <span class="ID">dtype</span>=<span class="ID">float32</span>)</span>
</pre></div></div><span class="anchor" id="line-152"></span><p class="line891"><img alt="/!\" height="15" src="../moin_static197/modern/img/alert.png" title="/!\" width="15" /> For the sake of efficiency, this same behavior does not hold for other formats (e.g. <tt class="backtick">csr_matrix</tt>). <span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span></li></ul><p class="line867">
<h3 id="implementation_considerations">implementation considerations</h3>
<span class="anchor" id="line-155"></span><ul><li style="list-style-type:none"><p class="line862">As the name suggests, the underlying data structure of <tt class="backtick">lil_matrix</tt> is a list (actually an <tt class="backtick">ndarray</tt>) of Python lists.  Each row of the matrix is stored in a separate (sorted) list, so adding new elements requires a relatively small number of operations.  Similarly, <tt class="backtick">dok_matrix</tt> is a Python dictionary that maps (row,column) keys to their nonzero values.  While the precise details of these data structures are subject to change, you can rely on the fact that changes to the sparsity structure of these formats will be handled efficiently. <span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span></li></ul><p class="line867">
<h3 id="sparsity_structure_changes_can_be_expensive">sparsity structure changes can be expensive</h3>
<span class="anchor" id="line-158"></span><ul><li style="list-style-type:none"><p class="line862">It is <strong>very inefficient</strong> to change the sparsity structure of other formats in <tt class="backtick">scipy.sparse</tt>!  Indeed, most sparse formats in <a href="../SciPy.html">SciPy</a> do not even support setting matrix entries.  Notable exceptions are <tt class="backtick">csr_matrix</tt> and <tt class="backtick">csc_matrix</tt> which do permit such modifications. Nevertheless, don't do it!  If you do, you'll be greeted with a <tt class="backtick">SparseEfficiencyWarning</tt> the first time you try. <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-1-17"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-32515aada30ecfd69c3ad6cd5ed0724e078acce5" lang="en"><span class="line"><span class="anchor" id="line-1-18"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-9"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>((<span class="Number">4</span>,<span class="Number">3</span>), <span class="ID">dtype</span>=<span class="String">'</span><span class="String">float32</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-9"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">1</span>,<span class="Number">0</span>] = <span class="Number">3.0</span></span>
<span class="line"><span class="anchor" id="line-4-8"></span>/<span class="ID">usr</span>/<span class="ID">lib</span>/<span class="ID">python2</span>.<span class="Number">5</span>/<span class="ID">site</span>-<span class="ID">packages</span>/<span class="ID">scipy</span>/<span class="ID">sparse</span>/<span class="ID">compressed</span>.<span class="ID">py</span>:<span class="Number">623</span>: <span class="ID">SparseEfficiencyWarning</span>: <span class="ID">changing</span> <span class="ID">the</span> <span class="ID">sparsity</span> <span class="ID">structure</span> <span class="ID">of</span> <span class="ID">a</span> <span class="ID">csr_matrix</span> <span class="ResWord">is</span> <span class="ID">expensive</span>. <span class="ID">lil_matrix</span> <span class="ResWord">is</span> <span class="ID">more</span> <span class="ID">efficient</span>.</span>
<span class="line"><span class="anchor" id="line-5-7"></span>  <span class="ID">SparseEfficiencyWarning</span>)</span>
<span class="line"><span class="anchor" id="line-6-7"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">2</span>,<span class="Number">2</span>] = <span class="Number">7.0</span></span>
<span class="line"><span class="anchor" id="line-7-6"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">3</span>,<span class="Number">1</span>] = -<span class="Number">2.0</span></span>
</pre></div></div><span class="anchor" id="line-168"></span><p class="line862">You have been warned.  If you insist on abusing <tt class="backtick">csr_matrix</tt> and <tt class="backtick">csc_matrix</tt> in this way, and don't want to be warned, the <tt class="backtick">warnings</tt> module permits filtering, <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-1-19"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a98ef94cb9ae482ae3989ace78ec477631efcb99" lang="en"><span class="line"><span class="anchor" id="line-1-20"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span>, <span class="ID">SparseEfficiencyWarning</span></span>
<span class="line"><span class="anchor" id="line-2-10"></span>&gt;&gt;&gt; <span class="ResWord">import</span> <span class="ID">warnings</span></span>
<span class="line"><span class="anchor" id="line-3-10"></span>&gt;&gt;&gt; <span class="ID">warnings</span>.<span class="ID">simplefilter</span>(<span class="String">'</span><span class="String">ignore</span><span class="String">'</span>,<span class="ID">SparseEfficiencyWarning</span>)</span>
<span class="line"><span class="anchor" id="line-4-9"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>((<span class="Number">4</span>,<span class="Number">3</span>), <span class="ID">dtype</span>=<span class="String">'</span><span class="String">float32</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-5-8"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">1</span>,<span class="Number">0</span>] = <span class="Number">3.0</span></span>
<span class="line"><span class="anchor" id="line-6-8"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">2</span>,<span class="Number">2</span>] = <span class="Number">7.0</span></span>
<span class="line"><span class="anchor" id="line-7-7"></span>&gt;&gt;&gt; <span class="ID">A</span>[<span class="Number">3</span>,<span class="Number">1</span>] = -<span class="Number">2.0</span></span>
</pre></div></div><span class="anchor" id="line-178"></span>but you should still feel guilty. <span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><p class="line862">The justification for the warning is that, in general, changes to the structure of a <tt class="backtick">csr_matrix</tt> require the <strong>entire</strong> data structure to be altered.  The cost of such alterations is proportional to the number of non-zero entries in the matrix.  In contrast, the cost of adding a new value to a <tt class="backtick">lil_matrix</tt> is proportional to the number of non-zero values in that row, while a <tt class="backtick">dok_matrix</tt> typically does the update in constant time. <span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></li></ul><p class="line867">
<h2 id="constructing_from_scratch_faster.2C_with_coo_matrix">constructing from scratch faster, with coo_matrix</h2>
<span class="anchor" id="line-183"></span><ul><li style="list-style-type:none"><p class="line862">As discussed in the previous section <tt class="backtick">lil_matrix</tt> and <tt class="backtick">dok_matrix</tt> can be used to insert elements into a matrix efficiently.  However, when dealing with sparse matrices with <strong>millions</strong> of non-zeros, a faster method is required.  Behold, the coordinate matrix format. <span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line862">The coordinate matrix format is arguably the simplest of all sparse formats: it consists of three arrays <tt class="backtick">row</tt>, <tt class="backtick">col</tt>, and <tt class="backtick">data</tt> which record the row index, column index, and value of each entry in the matrix respectively.  Using these three arrays, the <tt class="backtick">coo_matrix</tt> is constructed as follows: <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-1-21"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-75c7c67e5d8909fd87f968eb41a9fc359bc453ba" lang="en"><span class="line"><span class="anchor" id="line-1-22"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">coo_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-11"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">array</span></span>
<span class="line"><span class="anchor" id="line-3-11"></span>&gt;&gt;&gt; <span class="ID">row</span> = <span class="ID">array</span>([<span class="Number">1</span>,<span class="Number">2</span>,<span class="Number">3</span>])</span>
<span class="line"><span class="anchor" id="line-4-10"></span>&gt;&gt;&gt; <span class="ID">col</span> = <span class="ID">array</span>([<span class="Number">0</span>,<span class="Number">2</span>,<span class="Number">1</span>])</span>
<span class="line"><span class="anchor" id="line-5-9"></span>&gt;&gt;&gt; <span class="ID">data</span> = <span class="ID">array</span>([<span class="Number">3.0</span>,<span class="Number">7.0</span>,-<span class="Number">2.0</span>])</span>
<span class="line"><span class="anchor" id="line-6-9"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">coo_matrix</span>((<span class="ID">data</span>,(<span class="ID">row</span>,<span class="ID">col</span>)), <span class="ID">shape</span>=(<span class="Number">4</span>,<span class="Number">3</span>))</span>
<span class="line"><span class="anchor" id="line-7-8"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-8-6"></span>&lt;<span class="Number">4</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-9-6"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">COOrdinate</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-10-5"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">todense</span>()</span>
<span class="line"><span class="anchor" id="line-11-4"></span><span class="ID">matrix</span>([[ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-12-2"></span>        [ <span class="Number">3.</span>,  <span class="Number">0.</span>,  <span class="Number">0.</span>],</span>
<span class="line"><span class="anchor" id="line-13-2"></span>        [ <span class="Number">0.</span>,  <span class="Number">0.</span>,  <span class="Number">7.</span>],</span>
<span class="line"><span class="anchor" id="line-14-1"></span>        [ <span class="Number">0.</span>, -<span class="Number">2.</span>,  <span class="Number">0.</span>]])</span>
</pre></div></div><span class="anchor" id="line-202"></span><p class="line862">Here we have used the <tt class="backtick">shape</tt> parameter of the constructor to inform <tt class="backtick">coo_matrix</tt> of the matrix dimension.  If <tt class="backtick">shape</tt> is not defined, then <tt class="backtick">coo_matrix</tt> will attempt to infer the matrix dimensions from <tt class="backtick">row</tt> and <tt class="backtick">col</tt> arrays.  Therefore, in this particular example, the shape parameter is not necessary.  However, if the last row or column contains no values, then it is necessary to supply a <tt class="backtick">shape</tt> parameter.  If you happen to forget any of this information, you can always use the <tt class="backtick">help</tt> command within Python to retrieve the documentation <span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><p class="line862">At this point, you might be questioning the utility of the humble <tt class="backtick">coo_matrix</tt>: you will be forgiven for that prejudice.  As a simple test, suppose we want a function that returns an identity matrix of a given size.  Consider the three functions in the code sample below which construct identity matrices using the COO, LIL, and DOK formats. <span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-1-23"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ea4992b0d0e09244cde4d5793e913df10f8c2984" lang="en"><span class="line"><span class="anchor" id="line-1-24"></span><span class="ResWord">from</span> <span class="ID">time</span> <span class="ResWord">import</span> <span class="ID">clock</span></span>
<span class="line"><span class="anchor" id="line-2-12"></span><span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">arange</span>, <span class="ID">ones</span></span>
<span class="line"><span class="anchor" id="line-3-12"></span><span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">coo_matrix</span>, <span class="ID">dok_matrix</span>, <span class="ID">lil_matrix</span></span>
<span class="line"><span class="anchor" id="line-4-11"></span></span>
<span class="line"><span class="anchor" id="line-5-10"></span><span class="ResWord">def</span> <span class="ID">identity_coo</span>(<span class="ID">N</span>):</span>
<span class="line"><span class="anchor" id="line-6-10"></span>    <span class="ID">row</span> = <span class="ID">arange</span>(<span class="ID">N</span>, <span class="ID">dtype</span>=<span class="String">'</span><span class="String">intc</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-7-9"></span>    <span class="ID">col</span> = <span class="ID">arange</span>(<span class="ID">N</span>, <span class="ID">dtype</span>=<span class="String">'</span><span class="String">intc</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-8-7"></span>    <span class="ID">data</span> = <span class="ID">ones</span>(<span class="ID">N</span>)</span>
<span class="line"><span class="anchor" id="line-9-7"></span>    <span class="ID">I</span> = <span class="ID">coo_matrix</span>((<span class="ID">data</span>,(<span class="ID">row</span>,<span class="ID">col</span>)), <span class="ID">shape</span>=(<span class="ID">N</span>,<span class="ID">N</span>))</span>
<span class="line"><span class="anchor" id="line-10-6"></span>    <span class="ResWord">return</span> <span class="ID">I</span></span>
<span class="line"><span class="anchor" id="line-11-5"></span></span>
<span class="line"><span class="anchor" id="line-12-3"></span><span class="ResWord">def</span> <span class="ID">identity_lil</span>(<span class="ID">N</span>):</span>
<span class="line"><span class="anchor" id="line-13-3"></span>    <span class="ID">I</span> = <span class="ID">lil_matrix</span>((<span class="ID">N</span>,<span class="ID">N</span>))</span>
<span class="line"><span class="anchor" id="line-14-2"></span>    <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">N</span>):</span>
<span class="line"><span class="anchor" id="line-15-1"></span>        <span class="ID">I</span>[<span class="ID">i</span>,<span class="ID">i</span>] = <span class="Number">1.0</span></span>
<span class="line"><span class="anchor" id="line-16-1"></span>    <span class="ResWord">return</span> <span class="ID">I</span></span>
<span class="line"><span class="anchor" id="line-17-1"></span></span>
<span class="line"><span class="anchor" id="line-18-1"></span><span class="ResWord">def</span> <span class="ID">identity_dok</span>(<span class="ID">N</span>):</span>
<span class="line"><span class="anchor" id="line-19-1"></span>    <span class="ID">I</span> = <span class="ID">dok_matrix</span>((<span class="ID">N</span>,<span class="ID">N</span>))</span>
<span class="line"><span class="anchor" id="line-20-1"></span>    <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">N</span>):</span>
<span class="line"><span class="anchor" id="line-21-1"></span>        <span class="ID">I</span>[<span class="ID">i</span>,<span class="ID">i</span>] = <span class="Number">1.0</span></span>
<span class="line"><span class="anchor" id="line-22-1"></span>    <span class="ResWord">return</span> <span class="ID">I</span></span>
<span class="line"><span class="anchor" id="line-23-1"></span></span>
<span class="line"><span class="anchor" id="line-24-1"></span><span class="ID">N</span> = <span class="Number">1000</span> * <span class="Number">1000</span></span>
<span class="line"><span class="anchor" id="line-25-1"></span></span>
<span class="line"><span class="anchor" id="line-26-1"></span><span class="ID">start</span> = <span class="ID">clock</span>(); <span class="ID">I</span> = <span class="ID">identity_coo</span>(<span class="ID">N</span>); <span class="ID">end</span> = <span class="ID">clock</span>();</span>
<span class="line"><span class="anchor" id="line-27-1"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">COO: </span><span class="String">%6.3f</span><span class="String"> seconds</span><span class="String">&quot;</span> % (<span class="ID">end</span> - <span class="ID">start</span>)</span>
<span class="line"><span class="anchor" id="line-28-1"></span></span>
<span class="line"><span class="anchor" id="line-29-1"></span><span class="ID">start</span> = <span class="ID">clock</span>(); <span class="ID">I</span> = <span class="ID">identity_lil</span>(<span class="ID">N</span>); <span class="ID">end</span> = <span class="ID">clock</span>()</span>
<span class="line"><span class="anchor" id="line-30-1"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">LIL: </span><span class="String">%6.3f</span><span class="String"> seconds</span><span class="String">&quot;</span> % (<span class="ID">end</span> - <span class="ID">start</span>)</span>
<span class="line"><span class="anchor" id="line-31-1"></span></span>
<span class="line"><span class="anchor" id="line-32-1"></span><span class="ID">start</span> = <span class="ID">clock</span>(); <span class="ID">I</span> = <span class="ID">identity_dok</span>(<span class="ID">N</span>); <span class="ID">end</span> = <span class="ID">clock</span>()</span>
<span class="line"><span class="anchor" id="line-33-1"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">DOK: </span><span class="String">%6.3f</span><span class="String"> seconds</span><span class="String">&quot;</span> % (<span class="ID">end</span> - <span class="ID">start</span>)</span>
</pre></div></div><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span></li></ul><p class="line874">Here's the result <span class="anchor" id="line-243"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><pre><span class="anchor" id="line-1-25"></span>COO:  0.030 seconds
<span class="anchor" id="line-2-13"></span>LIL: 19.870 seconds
<span class="anchor" id="line-3-13"></span>DOK: 15.790 seconds</pre><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span></li></ul><p class="line862">The <tt class="backtick">coo_matrix</tt> method is clearly the fastest, beating the others by a factor of 500.  Interestingly, constructing a matrix in COO first, and then converting to LIL or DOK is still faster than using those formats directly: <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><ul><li style="list-style-type:none"><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-1-26"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f0d0628304018b2d891a493d97ec2f507db39416" lang="en"><span class="line"><span class="anchor" id="line-1-27"></span><span class="ID">start</span> = <span class="ID">clock</span>(); <span class="ID">I</span> = <span class="ID">identity_coo</span>(<span class="ID">N</span>);  <span class="ID">I</span> = <span class="ID">I</span>.<span class="ID">tolil</span>(); <span class="ID">end</span> = <span class="ID">clock</span>()</span>
<span class="line"><span class="anchor" id="line-2-14"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">COO-&gt;LIL: </span><span class="String">%6.3f</span><span class="String"> seconds</span><span class="String">&quot;</span> % (<span class="ID">end</span> - <span class="ID">start</span>)</span>
<span class="line"><span class="anchor" id="line-3-14"></span></span>
<span class="line"><span class="anchor" id="line-4-12"></span><span class="ID">start</span> = <span class="ID">clock</span>(); <span class="ID">I</span> = <span class="ID">identity_coo</span>(<span class="ID">N</span>);  <span class="ID">I</span> = <span class="ID">I</span>.<span class="ID">todok</span>(); <span class="ID">end</span> = <span class="ID">clock</span>()</span>
<span class="line"><span class="anchor" id="line-5-11"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">COO-&gt;DOK: </span><span class="String">%6.3f</span><span class="String"> seconds</span><span class="String">&quot;</span> % (<span class="ID">end</span> - <span class="ID">start</span>)</span>
</pre></div></div><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><pre><span class="anchor" id="line-1-28"></span>COO-&gt;LIL:  7.990 seconds
<span class="anchor" id="line-2-15"></span>COO-&gt;DOK:  4.390 seconds</pre><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span></li></ul><p class="line867">
<h2 id="construction_utilities">construction utilities</h2>
<span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><ul><li>spdiags <span class="anchor" id="line-267"></span></li><li>sparse.kron <span class="anchor" id="line-268"></span></li><li>sparse.bmat, sparse.hstack, sparse.vstack <span class="anchor" id="line-269"></span></li><li><p class="line862">discuss <tt class="backtick">format</tt> parameter <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span></li></ul><p class="line867">
<h1 id="Handling_Sparse_Matrices">Handling Sparse Matrices</h1>
<span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><ul><li>Support for slicing and fancy indexing in CSR/CSC formats (but not for assignment) <span class="anchor" id="line-275"></span></li><li>Which formats implement efficient matrix-matrix arithmetic and matrix-vector opertions <span class="anchor" id="line-276"></span></li><li>why formats are not preserved (CSR.T becomes CSC and LIL * LIL becomes CSR, etc.) and what to do if you care about the format of the result <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span></li></ul><p class="line867">
<h1 id="Solving_Sparse_Linear_Systems">Solving Sparse Linear Systems</h1>
<span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><p class="line862">There are two main classes of solvers for sparse linear systems: <strong>direct</strong> and <strong>iterative</strong>. <span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><p class="line862">Direct method can be thought of as a extension of dense matrix factorizations, like the LU factorization, to sparse matrices.  The goal of such algorithms is to produce factors (e.g. matrices L and U) that are as sparse as possible.  Sophisticated agorithms are used to reorder rows and columns of the input matrix so that the <strong>fill in</strong> of the sparse factors is minimized. <span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><p class="line874">In contrast, iterative methods solve linear systems by iteratively improving an approximation to the solution. Since iterative methods do not require a matrix factorization to be computed they are usually applied to large linear systems where the memory cost of computing such factors is prohibitive.  On the other hand, many iterative methods only work for a specific type of matrix (e.g. symmetric matrices) and have several tuning parameters, so they can be somewhat more difficult to use. <span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><p class="line867">
<h2 id="Direct_Factorization_Methods">Direct Factorization Methods</h2>
<span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><ul><li>basic intuition and background <span class="anchor" id="line-291"></span></li><li>use of reordering to minimize fill <span class="anchor" id="line-292"></span></li><li>Further information.... (UMFPACK scikit, others) <span class="anchor" id="line-293"></span></li><li>Note: moved from scipy.linsolve to scipy.sparse.linalg, UMFPACK now deprecated <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span></li></ul><p class="line867">
<h2 id="Iterative_Methods">Iterative Methods</h2>
<span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><ul><li>basic intuition and background <span class="anchor" id="line-298"></span></li><li>explain classes of matrices (e.g. SPD) <span class="anchor" id="line-299"></span></li><li>simple examples with cg and gmres <span class="anchor" id="line-300"></span></li><li>solve a 2d Poisson problem and plot it w/ pcolor() <span class="anchor" id="line-301"></span></li><li>illustrate use of preconditioner <span class="anchor" id="line-302"></span></li><li>Further information.... (PyAMG,others) <span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span></li></ul><p class="line867">
<h1 id="Solving_Sparse_Eigenvalue_Problems">Solving Sparse Eigenvalue Problems</h1>
<span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><ul><li>basic intuition and background <span class="anchor" id="line-307"></span></li><li>examples with ARPACK and LOBPCG <span class="anchor" id="line-308"></span></li><li>find a few eigenmodes of a 2d Poisson problem and plot them w/ pcolor() <span class="anchor" id="line-309"></span></li><li>illustrate use of preconditioner <span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span></li></ul><p class="line867">
<h1 id="Sparse_Matrix_File_Input.2FOutput">Sparse Matrix File Input/Output</h1>
<span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">scipy.io</tt> module supports two file formats for reading and writing sparse matrices. <span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span></li></ul><p class="line867">
<h2 id="MatrixMarket">MatrixMarket</h2>
<span class="anchor" id="line-317"></span><ul><li style="list-style-type:none"><p class="line862">The <a class="http" href="../../external.html?link=http://math.nist.gov/MatrixMarket/formats.html#MMformat">MatrixMarket</a> format stores matrices in a simple ASCII file format.  Software for reading and writing <a class="nonexistent" href="../MatrixMatrix.html">MatrixMatrix</a> in various programming languages files is <a class="http" href="../../external.html?link=http://math.nist.gov/MatrixMarket/formats.html#MMformat">freely available</a>.  The <a class="http" href="../../external.html?link=http://bebop.cs.berkeley.edu/smc/">BeBOP sparse matrix converter</a> can be used to convert between the <a class="nonexistent" href="../MatrixMarket.html">MatrixMarket</a> format and other sparse formats (e.g. Harwell-Boeing). <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><p class="line862">Reading and writing files in the <a class="nonexistent" href="../MatrixMarket.html">MatrixMarket</a> format is easy: <span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-1-29"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-9697f9ff94f921cc97a246d3d37f8bd222f117c6" lang="en"><span class="line"><span class="anchor" id="line-1-30"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-16"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.io</span> <span class="ResWord">import</span> <span class="ID">mmread</span>, <span class="ID">mmwrite</span></span>
<span class="line"><span class="anchor" id="line-3-15"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>([[<span class="Number">1.0</span>,<span class="Number">0.0</span>,<span class="Number">2.0</span>],[<span class="Number">0.0</span>,<span class="Number">3.0</span>,<span class="Number">0.0</span>]])</span>
<span class="line"><span class="anchor" id="line-4-13"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-5-12"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-6-11"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-7-10"></span>&gt;&gt;&gt; <span class="ID">mmwrite</span>(<span class="String">'</span><span class="String">my_file.mtx</span><span class="String">'</span>, <span class="ID">A</span>)</span>
<span class="line"><span class="anchor" id="line-8-8"></span>&gt;&gt;&gt; <span class="ID">B</span> = <span class="ID">mmread</span>(<span class="String">'</span><span class="String">my_file.mtx</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-9-8"></span>&gt;&gt;&gt; <span class="ID">B</span></span>
<span class="line"><span class="anchor" id="line-10-7"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-11-6"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">COOrdinate</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-333"></span><p class="line862">Reading <a class="nonexistent" href="../MatrixMarket.html">MatrixMarket</a> files compressed with <tt class="backtick">gzip</tt> is also supported: <span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-1-31"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-900b09cec7375bd5bb2afcd622addfb9ab047a80" lang="en"><span class="line"><span class="anchor" id="line-1-32"></span>&gt;&gt;&gt; <span class="ID">B</span> = <span class="ID">mmread</span>(<span class="String">'</span><span class="String">my_file.mtx.gz</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-2-17"></span>&gt;&gt;&gt; <span class="ID">B</span></span>
<span class="line"><span class="anchor" id="line-3-16"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-4-14"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">COOrdinate</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span></li></ul><p class="line867">
<h2 id="MATLAB">MATLAB</h2>
<span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">scipy.io</tt> module also supports the MATLAB (tm) file format.  Considerably more sophisticated than the <a class="nonexistent" href="../MatrixMarket.html">MatrixMarket</a> format, MATLAB stores data in a binary format, so reading and writing large matrices is noticably more efficient.  On the other hand, the simplicity of the <a class="nonexistent" href="../MatrixMatket.html">MatrixMatket</a> makes it particularly easy to work with in other software (e.g. using <tt class="backtick">fprintf()</tt> and <tt class="backtick">fscanf()</tt>). <span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><p class="line862">The MATLAB format supports multiple matrices per-file.  These are stored in a Python <tt class="backtick">dict</tt> object as shown in the following example: <span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-1-33"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f0e604a29e1e2f827a29445d66bcc36e1066dea2" lang="en"><span class="line"><span class="anchor" id="line-1-34"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.sparse</span> <span class="ResWord">import</span> <span class="ID">csr_matrix</span></span>
<span class="line"><span class="anchor" id="line-2-18"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">scipy.io</span> <span class="ResWord">import</span> <span class="ID">loadmat</span>, <span class="ID">savemat</span></span>
<span class="line"><span class="anchor" id="line-3-17"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">csr_matrix</span>([[<span class="Number">1.0</span>,<span class="Number">0.0</span>,<span class="Number">2.0</span>],[<span class="Number">0.0</span>,<span class="Number">3.0</span>,<span class="Number">0.0</span>]])</span>
<span class="line"><span class="anchor" id="line-4-15"></span>&gt;&gt;&gt; <span class="ID">A</span></span>
<span class="line"><span class="anchor" id="line-5-13"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-6-12"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">Compressed</span> <span class="ID">Sparse</span> <span class="ID">Row</span> <span class="ID">format</span>&gt;</span>
<span class="line"><span class="anchor" id="line-7-11"></span>&gt;&gt;&gt; <span class="ID">savemat</span>(<span class="String">'</span><span class="String">my_file.mat</span><span class="String">'</span>, {<span class="String">'</span><span class="String">A</span><span class="String">'</span> : <span class="ID">A</span>})</span>
<span class="line"><span class="anchor" id="line-8-9"></span>&gt;&gt;&gt; <span class="ID">m_dict</span> = <span class="ID">loadmat</span>(<span class="String">'</span><span class="String">my_file.mat</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-9-9"></span>&gt;&gt;&gt; <span class="ID">m_dict</span>[<span class="String">'</span><span class="String">A</span><span class="String">'</span>]</span>
<span class="line"><span class="anchor" id="line-10-8"></span>&lt;<span class="Number">2</span><span class="ID">x3</span> <span class="ID">sparse</span> <span class="ID">matrix</span> <span class="ID">of</span> <span class="ResWord">type</span> <span class="String">'</span><span class="String">&lt;type </span><span class="String">'</span><span class="ID">numpy</span>.<span class="ID">float64</span><span class="String">'</span><span class="String">&gt;</span><span class="String">'</span></span>
<span class="line"><span class="anchor" id="line-11-7"></span>        <span class="ResWord">with</span> <span class="Number">3</span> <span class="ID">stored</span> <span class="ID">elements</span> <span class="ResWord">in</span> <span class="ID">COOrdinate</span> <span class="ID">format</span>&gt;</span>
</pre></div></div><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span></li></ul><p class="line867">
<h1 id="Additional_Resources">Additional Resources</h1>
<span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><p class="line867">
<h2 id="Python">Python</h2>
<span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://code.google.com/p/pyamg/">PyAMG</a> : Algebraic Multigrid Solvers in Python. <span class="anchor" id="line-366"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://code.google.com/p/sfepy/">SfePy</a> : Simple Finite Elements in Python. <span class="anchor" id="line-367"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://www.ctcms.nist.gov/fipy/">FiPy</a> : A Finite Volume PDE Solver Using Python <span class="anchor" id="line-368"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://scipy.org/scipy/scikits/">UMFPACK</a> : Support for the UMFPACK sparse solver library. <span class="anchor" id="line-369"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://trilinos.sandia.gov/packages/pytrilinos/">Pytrilinos</a>: High-Performance Distributed-Memory Solvers for Python <span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span></li></ul><p class="line867">
<h2 id="Books">Books</h2>
<span class="anchor" id="line-372"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://www-users.cs.umn.edu/~saad/books.html">Iterative Methods for Sparse Linear Systems</a> by Yousef Saad (first edition is freely available) <span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span></li></ul><p class="line867">
<h2 id="Other_Packages_and_Libraries">Other Packages and Libraries</h2>
<span class="anchor" id="line-375"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://www-users.cs.umn.edu/~saad/software/SPARSKIT/sparskit.html">SPARSKIT</a> : A basic tool-kit for sparse matrix computations. <span class="anchor" id="line-376"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://trilinos.sandia.gov/">Trilinos</a> : An extensive collection of distributed-memory solvers. <span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span></li></ul><p class="line867">
<h1 id="TODO:_update_and_integrate_this_information_where_possible">TODO: update and integrate this information where possible</h1>
<span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span><p class="line862">for convenience; the <tt class="backtick">lil_matrix</tt> class supports basic slicing and fancy indexing with a similar syntax to <a class="nonexistent" href="../NumPy.html">NumPy</a> arrays, and is adapted to gradually fill your sparse matrix, while compressed formats are not suited to a progressive filling. <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><p class="line862">To perform manipulations such as multiplication or inversion, first convert the matrix to either CSC or CSR format. These formats store the sparse matrix in arrays and allow faster computations than the list or dictionary-based formats. The <tt class="backtick">lil_matrix</tt> format is row-based, so conversion to CSR is efficient, whereas conversion to CSC is less so. <span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><p class="line874">Notes: <span class="anchor" id="line-385"></span><ul><li><p class="line862">CSC format is also called <a class="http" href="../../external.html?link=http://math.nist.gov/MatrixMarket/formats.html#hb">Harwell-Boeing</a> format, and used in other libraries or software (<a class="http" href="../../external.html?link=http://www.mathworks.com/access/helpdesk/help/techdoc/math/sparse3.html#12993">Matlab</a> for example). <span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span></li></ul><p class="line867">
<h1 id="Examples_.28TODO:_update.29">Examples (TODO: update)</h1>
<span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><p class="line867">
<h3 id="Example_1">Example 1</h3>
<span class="anchor" id="line-391"></span><p class="line862">This is a very simple example illustrating basic usage of <tt class="backtick">linsolve</tt>, <tt class="backtick">sparse</tt> <span class="anchor" id="line-392"></span>and some other useful things (use the latest version of linsolve.py). If you <span class="anchor" id="line-393"></span>don't know how to get hold of the latest modules, spend some time in the <span class="anchor" id="line-394"></span><a href="../Developer_Zone.html"><strong class="highlight">Developer_Zone</strong></a> and see the <strong>SOURCE CODE</strong> section. <span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><p class="line862">We're going to solve a trivial case of <tt class="backtick">Ax&nbsp;=&nbsp;b</tt>, where <tt class="backtick">A</tt> is a matrix, <tt class="backtick">b</tt> a <span class="anchor" id="line-398"></span>vector (the RHS) and <tt class="backtick">x</tt> the unknowns. In this example <tt class="backtick">A</tt> refers to the <span class="anchor" id="line-399"></span>'normal' matrix, and <tt class="backtick">Asp</tt> to the <strong>sparse representation</strong> of <tt class="backtick">A</tt>, <tt class="backtick">x</tt> for <span class="anchor" id="line-400"></span>the 'normal' solution and <tt class="backtick">xsp</tt> for the solution arising from using the sparse method. <span class="anchor" id="line-401"></span>(You'll most probably find it useful to use <a class="http" href="../../external.html?link=http://ipython.scipy.org/">IPython</a> <span class="anchor" id="line-402"></span>when going through this example, especially if you're used to Matlab®. The normal <span class="anchor" id="line-403"></span>Python prompt looks like this <tt class="backtick">&gt;&gt;&gt;</tt>, IPython's default prompt (one can change it) <span class="anchor" id="line-404"></span>looks like this <tt class="backtick">In&nbsp;[x]:</tt>, where the <tt class="backtick">x</tt> is a number). <span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><p class="line874">Import the necessary commands from the numpy and scipy modules: <span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-1-35"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-36220915f6c50429f9c562254ca9b34601d6158d" lang="en"><span class="line"><span class="anchor" id="line-1-36"></span><span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">allclose</span>, <span class="ID">arange</span>, <span class="ID">eye</span>, <span class="ID">linalg</span>, <span class="ID">ones</span></span>
<span class="line"><span class="anchor" id="line-2-19"></span><span class="ResWord">from</span> <span class="ID">scipy</span> <span class="ResWord">import</span> <span class="ID">linsolve</span>, <span class="ID">sparse</span></span>
</pre></div></div><span class="anchor" id="line-411"></span><p class="line874">It is of course also possible to import all the commands from the two modules, <span class="anchor" id="line-412"></span>but in that case it might not be a bad idea to do it as follows (note that this is <span class="anchor" id="line-413"></span>just one way of doing it): <span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-1-37"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-00628b144598fb4a2a814fdfd1acc5f284d5c6d3" lang="en"><span class="line"><span class="anchor" id="line-1-38"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="anchor" id="line-2-20"></span><span class="ResWord">import</span> <span class="ID">scipy</span> <span class="ResWord">as</span> <span class="ID">S</span></span>
</pre></div></div><span class="anchor" id="line-418"></span><p class="line862">If you're working in an IPython session, type <tt class="backtick">S.</tt> and press the &lt;TAB&gt; button, <span class="anchor" id="line-419"></span>you'll see all the available commands (attributes). The same goes for <tt class="backtick">N.</tt> <span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><p class="line862">Construct an identity 1000x1000 <tt class="backtick">lil_matrix</tt>. There is a couple of ways of <span class="anchor" id="line-422"></span>doing this, one method is slow, the other not. <span class="anchor" id="line-423"></span>A slow method: <span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-1-39"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-23ea3bcd4b57c8e84cc5cb7e97b05db79612904e" lang="en"><span class="line"><span class="anchor" id="line-1-40"></span><span class="ID">A</span> = <span class="ID">eye</span>(<span class="Number">1000</span>)</span>
<span class="line"><span class="anchor" id="line-2-21"></span><span class="ID">Asp</span> = <span class="ID">sparse</span>.<span class="ID">lil_matrix</span>(<span class="ID">A</span>)</span>
</pre></div></div><span class="anchor" id="line-428"></span><p class="line874">A faster method: <span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-1-41"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-6c2f6a7bda2aed3cf4dcc8ac3e683f57fa6b5326" lang="en"><span class="line"><span class="anchor" id="line-1-42"></span><span class="ID">Asp</span> = <span class="ID">sparse</span>.<span class="ID">lil_matrix</span>((<span class="Number">1000</span>,<span class="Number">1000</span>))</span>
<span class="line"><span class="anchor" id="line-2-22"></span><span class="ID">Asp</span>.<span class="ID">setdiag</span>(<span class="ID">ones</span>(<span class="Number">1000</span>))</span>
</pre></div></div><span class="anchor" id="line-433"></span><p class="line862">Note that <tt class="backtick">Asp</tt> is still in <strong>LI</strong>nked <strong>L</strong>ist (<tt class="backtick">lil_matrix</tt>) format - <span class="anchor" id="line-434"></span>leave it like that for now. <span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><p class="line862">Now create vector <tt class="backtick">b</tt>; we choose the entries so that we can easily check the (trivial) <span class="anchor" id="line-437"></span>solution: <span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span><span class="anchor" id="line-1-43"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-543b7cca583a04f11a11ba297e3b601fc6d235cd" lang="en"><span class="line"><span class="anchor" id="line-1-44"></span><span class="ID">b</span> = <span class="ID">arange</span>(<span class="Number">1</span>,<span class="Number">1001</span>)</span>
</pre></div></div><span class="anchor" id="line-441"></span><p class="line862">To see what <tt class="backtick">b</tt> looks like, type <tt class="backtick">b</tt> or <tt class="backtick">print&nbsp;b</tt> at your prompt. <span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><p class="line862">Now let's solve <tt class="backtick">Ax&nbsp;=&nbsp;b</tt>, first using <tt class="backtick">A</tt>... <span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-1-45"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-b4bd334e8ce66454d16e3be2145dea3f6e4cc51c" lang="en"><span class="line"><span class="anchor" id="line-1-46"></span><span class="ID">x</span> = <span class="ID">linalg</span>.<span class="ID">solve</span>(<span class="ID">A</span>,<span class="ID">b</span>)</span>
</pre></div></div><span class="anchor" id="line-447"></span><p class="line862">... and now using <tt class="backtick">Asp</tt>: <span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><span class="anchor" id="line-1-47"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-537f6b04f6a18bbed0a3b646e4c7d76a96ee55f6" lang="en"><span class="line"><span class="anchor" id="line-1-48"></span><span class="ID">xsp</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>,<span class="ID">b</span>)</span>
</pre></div></div><span class="anchor" id="line-451"></span><p class="line862">Check the result: <tt class="backtick">x</tt> and <tt class="backtick">xsp</tt> should both be equal to <tt class="backtick">b</tt>, as one expects. A convenient <span class="anchor" id="line-452"></span>way of checking this is to make use of <tt class="backtick">allclose()</tt>. In IPython you can type <tt class="backtick">allclose?</tt> <span class="anchor" id="line-453"></span>to get help on it, and at the Python prompt one will type <tt class="backtick">help(allclose)</tt> (this is the <span class="anchor" id="line-454"></span>case for almost all commands, but some might not have a <strong>Docstring</strong>). The input and <span class="anchor" id="line-455"></span>resulting output from the command is shown here: <span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-1-49"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-72297ffc20d8e248bff3c0b9ea833063161bb1b9" lang="en"><span class="line"><span class="anchor" id="line-1-50"></span>&gt;&gt;&gt; <span class="ID">allclose</span>(<span class="ID">x</span>,<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-2-23"></span><span class="ResWord">True</span></span>
<span class="line"><span class="anchor" id="line-3-18"></span>&gt;&gt;&gt; <span class="ID">allclose</span>(<span class="ID">b</span>,<span class="ID">xsp</span>)</span>
<span class="line"><span class="anchor" id="line-4-16"></span><span class="ResWord">True</span></span>
</pre></div></div><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><p class="line874">Let's have a look at the difference in solution time between the two methods. In an <span class="anchor" id="line-464"></span>IPython session, simply type (or scroll back with your arrow keys and just insert <span class="anchor" id="line-465"></span>the <tt class="backtick">time</tt> in front): <span class="anchor" id="line-466"></span><span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><span class="anchor" id="line-1-51"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-c10495bf6c7122430633bf262ea8f1a12e424bd9" lang="en"><span class="line"><span class="anchor" id="line-1-52"></span><span class="ID">time</span> <span class="ID">x</span> = <span class="ID">linalg</span>.<span class="ID">solve</span>(<span class="ID">A</span>,<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-2-24"></span><span class="ID">Itime</span> <span class="ID">xsp1</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>,<span class="ID">b</span>)</span>
</pre></div></div><span class="anchor" id="line-470"></span><p class="line874">You should see a significant difference (roughly 5 to 6 times faster). <span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><p class="line874">If you're working in the normal Python shell instead, do the following: <span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-1-53"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ece93d04d04240927afe5a9e1acda4e470008e37" lang="en"><span class="line"><span class="anchor" id="line-1-54"></span><span class="ResWord">from</span> <span class="ID">time</span> <span class="ResWord">import</span> <span class="ID">time</span></span>
<span class="line"><span class="anchor" id="line-2-25"></span><span class="ID">t</span>=<span class="ID">time</span>(); <span class="ID">x</span> = <span class="ID">linalg</span>.<span class="ID">solve</span>(<span class="ID">A</span>,<span class="ID">b</span>); <span class="ID">time</span>()-<span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-3-19"></span><span class="ID">t</span>=<span class="ID">time</span>(); <span class="ID">xsp1</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>,<span class="ID">b</span>); <span class="ID">time</span>()-<span class="ID">t</span></span>
</pre></div></div><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span><p class="line862">We saw that we can get the solution to <tt class="backtick">Ax&nbsp;=&nbsp;b</tt> even if <tt class="backtick">A</tt> is in <strong>LIL</strong> format. <span class="anchor" id="line-480"></span>We'll now inspect the difference in execution speed for the following (assuming <span class="anchor" id="line-481"></span>that you're using IPython, <tt class="backtick">Out&nbsp;[x]:</tt>'s not shown, and in a new session): <span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span><span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><span class="anchor" id="line-1-55"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-9ea7641e7937105e7567c4dac713218ab6f41d7a" lang="en"><span class="line"><span class="anchor" id="line-1-56"></span><span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">allclose</span>, <span class="ID">arange</span>, <span class="ID">eye</span>, <span class="ID">linalg</span>, <span class="ID">random</span>, <span class="ID">ones</span></span>
<span class="line"><span class="anchor" id="line-2-26"></span><span class="ResWord">from</span> <span class="ID">scipy</span> <span class="ResWord">import</span> <span class="ID">linsolve</span>, <span class="ID">sparse</span></span>
<span class="line"><span class="anchor" id="line-3-20"></span><span class="ID">Asp</span> = <span class="ID">sparse</span>.<span class="ID">lil_matrix</span>((<span class="Number">50000</span>,<span class="Number">50000</span>))</span>
<span class="line"><span class="anchor" id="line-4-17"></span><span class="ID">Asp</span>.<span class="ID">setdiag</span>(<span class="ID">ones</span>(<span class="Number">50000</span>))</span>
<span class="line"><span class="anchor" id="line-5-14"></span><span class="ID">Asp</span>[<span class="Number">20</span>,<span class="Number">100</span>:<span class="Number">250</span>] = <span class="Number">10</span>*<span class="ID">random</span>.<span class="ID">rand</span>(<span class="Number">150</span>)</span>
<span class="line"><span class="anchor" id="line-6-13"></span><span class="ID">Asp</span>[<span class="Number">200</span>:<span class="Number">250</span>,<span class="Number">30</span>] = <span class="Number">10</span>*<span class="ID">random</span>.<span class="ID">rand</span>(<span class="Number">50</span>)</span>
<span class="line"><span class="anchor" id="line-7-12"></span><span class="ID">b</span> = <span class="ID">arange</span>(<span class="Number">0</span>,<span class="Number">50000</span>)</span>
<span class="line"><span class="anchor" id="line-8-10"></span><span class="ID">time</span> <span class="ID">xsp1</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>,<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-9-10"></span><span class="ID">time</span> <span class="ID">xsp2</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>.<span class="ID">tocsc</span>(),<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-10-9"></span><span class="ID">time</span> <span class="ID">xsp3</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">Asp</span>.<span class="ID">tocsr</span>(),<span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-11-8"></span><span class="ID">allclose</span>(<span class="ID">xsp1</span>,<span class="ID">xsp2</span>) <span class="Comment"># Should be True</span></span>
<span class="line"><span class="anchor" id="line-12-4"></span><span class="ID">allclose</span>(<span class="ID">xsp2</span>,<span class="ID">xsp3</span>) <span class="Comment"># Should be True</span></span>
</pre></div></div><span class="anchor" id="line-496"></span><p class="line867"><strong>Note</strong>: the line that returns xsp3 fails if you don't have a recent enough <span class="anchor" id="line-497"></span>version of scipy. <span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span><p class="line862">The time for the last solution (<tt class="backtick">xsp3</tt>) should be the fastest by a factor of <span class="anchor" id="line-500"></span>roughly 1,5 to 2 times compared to the other two solutions (<tt class="backtick">xsp1</tt> and <tt class="backtick">xsp2</tt>). The <span class="anchor" id="line-501"></span>benefit in speed when compared to using 'normal' methods for solving <span class="anchor" id="line-502"></span>sparse systems is obvious. <span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><span class="anchor" id="line-505"></span><p class="line867">
<h3 id="Example_2">Example 2</h3>
<span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span><p class="line862">Construct a 1000x1000 <tt class="backtick">lil_matrix</tt> and add some values to it: <span class="anchor" id="line-508"></span><span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span><span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span><span class="anchor" id="line-515"></span><span class="anchor" id="line-1-57"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-e0c19044ef79a09946b890c9a752ff5ae0b8ce86" lang="en"><span class="line"><span class="anchor" id="line-1-58"></span><span class="ResWord">from</span> <span class="ID">scipy</span> <span class="ResWord">import</span> <span class="ID">sparse</span>, <span class="ID">linsolve</span></span>
<span class="line"><span class="anchor" id="line-2-27"></span><span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">random</span>, <span class="ID">linalg</span></span>
<span class="line"><span class="anchor" id="line-3-21"></span><span class="ID">A</span> = <span class="ID">sparse</span>.<span class="ID">lil_matrix</span>((<span class="Number">1000</span>, <span class="Number">1000</span>))</span>
<span class="line"><span class="anchor" id="line-4-18"></span><span class="ID">A</span>[<span class="Number">0</span>, :<span class="Number">100</span>] = <span class="ID">random</span>.<span class="ID">rand</span>(<span class="Number">100</span>)</span>
<span class="line"><span class="anchor" id="line-5-15"></span><span class="ID">A</span>[<span class="Number">1</span>, <span class="Number">100</span>:<span class="Number">200</span>] = <span class="ID">A</span>[<span class="Number">0</span>, :<span class="Number">100</span>]</span>
<span class="line"><span class="anchor" id="line-6-14"></span><span class="ID">A</span>.<span class="ID">setdiag</span>(<span class="ID">random</span>.<span class="ID">rand</span>(<span class="Number">1000</span>))</span>
</pre></div></div><span class="anchor" id="line-516"></span><p class="line874">Now convert it to CSR format and solve (A A^T) x = b for x: <span class="anchor" id="line-517"></span><span class="anchor" id="line-518"></span><span class="anchor" id="line-519"></span><span class="anchor" id="line-520"></span><span class="anchor" id="line-521"></span><span class="anchor" id="line-1-59"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a1083164d6d3d0e12784d297c01b9f5e3eb5f261" lang="en"><span class="line"><span class="anchor" id="line-1-60"></span><span class="ID">A</span> = <span class="ID">A</span>.<span class="ID">tocsr</span>()</span>
<span class="line"><span class="anchor" id="line-2-28"></span><span class="ID">b</span> = <span class="ID">random</span>.<span class="ID">rand</span>(<span class="Number">1000</span>)</span>
<span class="line"><span class="anchor" id="line-3-22"></span><span class="ID">x</span> = <span class="ID">linsolve</span>.<span class="ID">spsolve</span>(<span class="ID">A</span> * <span class="ID">A</span>.<span class="ID">T</span>, <span class="ID">b</span>)</span>
</pre></div></div><span class="anchor" id="line-522"></span><ul><li style="list-style-type:none"><p class="line862">The <tt class="backtick">.T</tt> bit of <tt class="backtick">A.T</tt> above computes the transpose of <tt class="backtick">A</tt>, i.e., it's a shortcut for <tt class="backtick">A.transpose()</tt>. <span class="anchor" id="line-523"></span>It will also work for 'normal' dense (numpy) matrices and currently works for arrays in the latest SVN versions of NumPy. <span class="anchor" id="line-524"></span>Also take note of the differences between matrices and arrays when working with them. If <tt class="backtick">B</tt> is a matrix and <tt class="backtick">C</tt> <span class="anchor" id="line-525"></span>an array, both with the same size and entries, then <tt class="backtick">B*B</tt> is <strong>not</strong> the same as <tt class="backtick">C*C</tt>. <span class="anchor" id="line-526"></span>See <a href="../NumPy_for_Matlab_Users.html">NumPy_for_Matlab_Users</a> for more details. <span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span></li></ul><p class="line874">Convert it to a dense matrix and solve, and check that the result is the same: <span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span><span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span><span class="anchor" id="line-1-61"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-1462a84cd25265ebae5b932158be1eed84fa0a16" lang="en"><span class="line"><span class="anchor" id="line-1-62"></span><span class="ID">A_</span> = <span class="ID">A</span>.<span class="ID">todense</span>()</span>
<span class="line"><span class="anchor" id="line-2-29"></span><span class="ID">x_</span> = <span class="ID">linalg</span>.<span class="ID">solve</span>(<span class="ID">A_</span> * <span class="ID">A_</span>.<span class="ID">T</span>, <span class="ID">b</span>)</span>
<span class="line"><span class="anchor" id="line-3-23"></span><span class="ID">err</span> = <span class="ID">linalg</span>.<span class="ID">norm</span>(<span class="ID">x</span>-<span class="ID">x_</span>)</span>
</pre></div></div><span class="anchor" id="line-534"></span><p class="line874">Now we can print the error norm with: <span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-1-63"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-c4a582625f068ae7c170e4d7bbd2922be975a8ad" lang="en"><span class="line"><span class="anchor" id="line-1-64"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">Norm error =</span><span class="String">&quot;</span>, <span class="ID">err</span></span>
</pre></div></div><span class="anchor" id="line-538"></span><p class="line862">It should be small <img alt=":)" height="15" src="../moin_static197/modern/img/smile.png" title=":)" width="15" /> <span class="anchor" id="line-539"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: SciPyPackages/Sparse  (last edited 2015-10-24 17:48:26 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Sparse37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/SciPyPackages/Sparse">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/SciPyPackages/Sparse?highlight=%28%28Developer_Zone%29%29 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:26 GMT -->
</html>

