<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/PerformanceTips?highlight=%28%28PerformancePython%29%29 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="noindex,nofollow">

<title>PerformanceTips - SciPy</title>
<script type="text/javascript" src="moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: PerformanceTips" href="../external.html?link=http://localhost:8080/PerformanceTips?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=PerformanceTips&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../external.html?link=http://localhost:8080/PerformanceTips?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../external.html?link=http://localhost:8080/PerformanceTips?action=print">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">


<form id="searchform" method="get" action="../external.html?link=http://localhost:8080/PerformanceTips">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="PerformanceTips456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a class="backlink" href="PerformanceTips17c6.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22PerformanceTips%22" rel="nofollow" title="Click to do a full-text search for this title">PerformanceTips</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="HelpContents.html">HelpContents</a></li><li class="current"><a href="PerformanceTips.html">PerformanceTips</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="PerformanceTips37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/PerformanceTips">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line874">This page collects tips and tricks to increase the speed  <span class="anchor" id="line-2"></span>of your code using numpy/scipy. <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line874">For general tips and tricks to improve the performance of your Python <span class="anchor" id="line-5"></span>programs see <span class="anchor" id="line-6"></span><a class="http" href="../external.html?link=http://wiki.python.org/moin/PythonSpeed/PerformanceTips">http://wiki.python.org/moin/PythonSpeed/PerformanceTips</a>. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><p class="line867">
<h1 id="Python_built-ins_vs._numpy_functions">Python built-ins vs. numpy functions</h1>
<span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line862">Note that the built-in python <tt class="backtick">min</tt> function   <span class="anchor" id="line-11"></span>can be much slower (up to 300-500 times)  <span class="anchor" id="line-12"></span>than using the <tt class="backtick">.min()</tt> method of an array. <span class="anchor" id="line-13"></span>I.e.: use <tt class="backtick">x.min()</tt> instead of <tt class="backtick">min(x)</tt>. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">The same applies to <tt class="backtick">max</tt>. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line862">This is also true for the new <tt class="backtick">any</tt> and <tt class="backtick">all</tt> <span class="anchor" id="line-18"></span>functions for Python &gt;=2.5. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line867">
<h1 id="Beyond_pure_Python">Beyond pure Python</h1>
<span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><p class="line874">Sometimes there are tasks for which pure python code can be too slow. <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line874">Possible solutions can be obtained via: <span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><ul><li><p class="line862">hand-written <a href="Cookbook/C_Extensions.html">C extensions</a> <span class="anchor" id="line-29"></span></li><li>psyco <span class="anchor" id="line-30"></span></li><li>pyrex <span class="anchor" id="line-31"></span></li><li>ctypes <span class="anchor" id="line-32"></span></li><li>f2py <span class="anchor" id="line-33"></span></li><li>weave <span class="anchor" id="line-34"></span></li><li>swig <span class="anchor" id="line-35"></span></li><li>boost <span class="anchor" id="line-36"></span></li><li>SIP <span class="anchor" id="line-37"></span></li><li>CXX <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></li></ul><p class="line862">For a full discussion with examples on performance gains through interfacing with other languages see <a href="PerformancePython.html">this article</a>. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line867">
<h1 id="Examples">Examples</h1>
<span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line874">Tips and tricks for specific situations. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><p class="line867">
<h2 id="Finding_the_row_and_column_of_the_min_or_max_value_of_an_array_or_matrix">Finding the row and column of the min or max value of an array or matrix</h2>
<span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line862">A slow, but straightforward, way to find the row and column indices of the minimum value of an array or matrix <em>x</em>: <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line867"><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-cb83df8616e2ffd696d8ab5ac21469bdce4d4d80" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">np</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span></span>
<span class="line"><span class="anchor" id="line-3-1"></span><span class="ResWord">def</span> <span class="ID">min_ij</span>(<span class="ID">x</span>):</span>
<span class="line"><span class="anchor" id="line-4-1"></span>    <span class="ID">i</span>, <span class="ID">j</span> = <span class="ID">np</span>.<span class="ID">where</span>(<span class="ID">x</span> == <span class="ID">x</span>.<span class="ID">min</span>())</span>
<span class="line"><span class="anchor" id="line-5-1"></span>    <span class="ResWord">return</span> <span class="ID">i</span>[<span class="Number">0</span>], <span class="ID">j</span>[<span class="Number">0</span>]</span>
</pre></div></div><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><p class="line874">This can be made quite a bit faster: <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><p class="line867"><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-e8dbac7348d3498ba7475386049ebf627a0823f3" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="ResWord">def</span> <span class="ID">min_ij</span>(<span class="ID">x</span>):</span>
<span class="line"><span class="anchor" id="line-2-2"></span>    <span class="ID">i</span>, <span class="ID">j</span> = <span class="ResWord">divmod</span>(<span class="ID">x</span>.<span class="ID">argmin</span>(), <span class="ID">x</span>.<span class="ID">shape</span>[<span class="Number">1</span>])</span>
<span class="line"><span class="anchor" id="line-3-2"></span>    <span class="ResWord">return</span> <span class="ID">i</span>, <span class="ID">j</span></span>
</pre></div></div><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line874">The fast method is about 4 times faster on a 500 by 500 array. <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867">
<h2 id="Removing_the_i-th_row_and_j-th_column_of_a_2d_array_or_matrix">Removing the i-th row and j-th column of a 2d array or matrix</h2>
<span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line874">The slow way to remove the i-th row and j-th column from a 2d array or matrix: <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><p class="line867"><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-28847ca274f3549f6f55e5a0109716c927cbfa16" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">np</span></span>
<span class="line"><span class="anchor" id="line-2-3"></span></span>
<span class="line"><span class="anchor" id="line-3-3"></span><span class="ResWord">def</span> <span class="ID">remove_ij</span>(<span class="ID">x</span>, <span class="ID">i</span>, <span class="ID">j</span>):</span>
<span class="line"><span class="anchor" id="line-4-2"></span>    </span>
<span class="line"><span class="anchor" id="line-5-2"></span>    <span class="Comment"># Remove the ith row</span></span>
<span class="line"><span class="anchor" id="line-6-1"></span>    <span class="ID">idx</span> = <span class="ResWord">range</span>(<span class="ID">x</span>.<span class="ID">shape</span>[<span class="Number">0</span>])</span>
<span class="line"><span class="anchor" id="line-7-1"></span>    <span class="ID">idx</span>.<span class="ID">remove</span>(<span class="ID">i</span>)</span>
<span class="line"><span class="anchor" id="line-8-1"></span>    <span class="ID">x</span> = <span class="ID">x</span>[<span class="ID">idx</span>,:]</span>
<span class="line"><span class="anchor" id="line-9-1"></span></span>
<span class="line"><span class="anchor" id="line-10-1"></span>    <span class="Comment"># Remove the jth column</span></span>
<span class="line"><span class="anchor" id="line-11-1"></span>    <span class="ID">idx</span> = <span class="ResWord">range</span>(<span class="ID">x</span>.<span class="ID">shape</span>[<span class="Number">1</span>])</span>
<span class="line"><span class="anchor" id="line-12-1"></span>    <span class="ID">idx</span>.<span class="ID">remove</span>(<span class="ID">j</span>)</span>
<span class="line"><span class="anchor" id="line-13-1"></span>    <span class="ID">x</span> = <span class="ID">x</span>[:,<span class="ID">idx</span>]</span>
<span class="line"><span class="anchor" id="line-14-1"></span></span>
<span class="line"><span class="anchor" id="line-15-1"></span>    <span class="ResWord">return</span> <span class="ID">x</span></span>
</pre></div></div><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line874">The fast way, because it avoids making copies, to remove the i-th row and j-th column from a 2d array or matrix: <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867"><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a6bdc8e902be07f798c7cd655e4d1ecd64467378" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span><span class="ResWord">def</span> <span class="ID">remove_ij</span>(<span class="ID">x</span>, <span class="ID">i</span>, <span class="ID">j</span>):</span>
<span class="line"><span class="anchor" id="line-2-4"></span>    <span class="Comment"># Row i and column j divide the array into 4 quadrants</span></span>
<span class="line"><span class="anchor" id="line-3-4"></span>    <span class="ID">y</span> = <span class="ID">x</span>[:-<span class="Number">1</span>,:-<span class="Number">1</span>]</span>
<span class="line"><span class="anchor" id="line-4-3"></span>    <span class="ID">y</span>[:<span class="ID">i</span>,<span class="ID">j</span>:] = <span class="ID">x</span>[:<span class="ID">i</span>,<span class="ID">j</span>+<span class="Number">1</span>:]</span>
<span class="line"><span class="anchor" id="line-5-3"></span>    <span class="ID">y</span>[<span class="ID">i</span>:,:<span class="ID">j</span>] = <span class="ID">x</span>[<span class="ID">i</span>+<span class="Number">1</span>:,:<span class="ID">j</span>]</span>
<span class="line"><span class="anchor" id="line-6-2"></span>    <span class="ID">y</span>[<span class="ID">i</span>:,<span class="ID">j</span>:] = <span class="ID">x</span>[<span class="ID">i</span>+<span class="Number">1</span>:,<span class="ID">j</span>+<span class="Number">1</span>:]</span>
<span class="line"><span class="anchor" id="line-7-2"></span>    <span class="ResWord">return</span> <span class="ID">y</span></span>
</pre></div></div><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line874">For a 500 by 500 array the second method is over 25 times faster. <span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line867">
<h2 id="Linear_Algebra_on_Large_Arrays">Linear Algebra on Large Arrays</h2>
<span class="anchor" id="line-104"></span><p class="line874">Sometimes the performance or memory behaviour of linear algebra on large arrays can suffer because of copying behind the scenes.  Consider for example, computing the dot product of two large matrices with a small result: <span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><p class="line867"><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-a31e0253e30e3a6ed3a9ca2923211e45d35ce246" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span>&gt;&gt;&gt; <span class="ID">N</span> = <span class="Number">1e6</span></span>
<span class="line"><span class="anchor" id="line-2-5"></span>&gt;&gt;&gt; <span class="ID">n</span> = <span class="Number">40</span></span>
<span class="line"><span class="anchor" id="line-3-5"></span>&gt;&gt;&gt; <span class="ID">A</span> = <span class="ID">np</span>.<span class="ID">ones</span>((<span class="ID">N</span>,<span class="ID">n</span>))</span>
<span class="line"><span class="anchor" id="line-4-4"></span>&gt;&gt;&gt; <span class="ID">C</span> = <span class="ID">np</span>.<span class="ID">dot</span>(<span class="ID">A</span>.<span class="ID">T</span>, <span class="ID">A</span>)</span>
</pre></div></div><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line862">Although <tt>C</tt> is only 40 by 40, inspecting the memory usage during the operation of <tt>dot</tt> will indicate that a copy is being made.  The reason is that the dot product uses underlying BLAS operations which depend on the matrices being stored in contiguous C order.  The transpose of operation does not effect a copy, but places the transposed array in Fortran order: <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867"><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-1-11"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-8cc9234ef4d486e12546d259b78c12a645307fd3" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">flags</span></span>
<span class="line"><span class="anchor" id="line-2-6"></span>  <span class="ID">C_CONTIGUOUS</span> : <span class="ResWord">True</span></span>
<span class="line"><span class="anchor" id="line-3-6"></span>  <span class="ID">F_CONTIGUOUS</span> : <span class="ResWord">False</span></span>
<span class="line"><span class="anchor" id="line-4-5"></span>   ...</span>
<span class="line"><span class="anchor" id="line-5-4"></span>&gt;&gt;&gt; <span class="ID">A</span>.<span class="ID">T</span>.<span class="ID">flags</span></span>
<span class="line"><span class="anchor" id="line-6-3"></span>  <span class="ID">C_CONTIGUOUS</span> : <span class="ResWord">False</span></span>
<span class="line"><span class="anchor" id="line-7-3"></span>  <span class="ID">F_CONTIGUOUS</span> : <span class="ResWord">True</span></span>
<span class="line"><span class="anchor" id="line-8-2"></span>   ...</span>
</pre></div></div><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line862">If we give <tt>dot</tt> two matrices that are both <tt>C_CONTIGUOUS</tt>, then the performance is better: <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-1-13"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-6598e79f72c738a9019a24155c438573728b55ea" lang="en"><span class="line"><span class="anchor" id="line-1-14"></span>&gt;&gt;&gt; <span class="ResWord">from</span> <span class="ID">time</span> <span class="ResWord">import</span> <span class="ID">time</span></span>
<span class="line"><span class="anchor" id="line-2-7"></span>&gt;&gt;&gt; <span class="ID">AT_F</span> = <span class="ID">np</span>.<span class="ID">ones</span>((<span class="ID">n</span>,<span class="ID">N</span>), <span class="ID">order</span>=<span class="String">'</span><span class="String">F</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-3-7"></span>&gt;&gt;&gt; <span class="ID">AT_C</span> = <span class="ID">np</span>.<span class="ID">ones</span>((<span class="ID">n</span>,<span class="ID">N</span>), <span class="ID">order</span>=<span class="String">'</span><span class="String">C</span><span class="String">'</span>)</span>
<span class="line"><span class="anchor" id="line-4-6"></span>&gt;&gt;&gt; <span class="ID">t</span> = <span class="ID">time</span>();<span class="ID">C</span> = <span class="ID">np</span>.<span class="ID">dot</span>(<span class="ID">A</span>.<span class="ID">T</span>, <span class="ID">A</span>);<span class="ID">time</span>() - <span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-5-5"></span><span class="Number">3.9203271865844727</span></span>
<span class="line"><span class="anchor" id="line-6-4"></span>&gt;&gt;&gt; <span class="ID">t</span> = <span class="ID">time</span>();<span class="ID">C</span> = <span class="ID">np</span>.<span class="ID">dot</span>(<span class="ID">AT_F</span>, <span class="ID">A</span>);<span class="ID">time</span>() - <span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-7-4"></span><span class="Number">3.9461679458618164</span></span>
<span class="line"><span class="anchor" id="line-8-3"></span>&gt;&gt;&gt; <span class="ID">t</span> = <span class="ID">time</span>();<span class="ID">C</span> = <span class="ID">np</span>.<span class="ID">dot</span>(<span class="ID">AT_C</span>, <span class="ID">A</span>);<span class="ID">time</span>() - <span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-9-2"></span><span class="Number">2.4167969226837158</span></span>
</pre></div></div><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line862">This is not ideal, however, because it required us to start with two arrays.  Is there not some way of computing <tt>dot(A.T,&nbsp;A</tt> without making an extra copy?  There is support for this in the <a class="http" href="../external.html?link=http://www.netlib.org/blas/">BLAS</a> through the method <tt>_SYRK</tt> method (see <a class="http" href="../external.html?link=http://www.netlib.org/blas/blasqr.pdf">http://www.netlib.org/blas/blasqr.pdf</a>).  <a href="SciPy.html">SciPy</a> exposes this through <a class="http" href="../external.html?link=http://docs.scipy.org/scipy/docs/scipy.linalg.blas/">scipy.linalg.blas</a> (which can be used with <tt>C_CONTIGUOUS</tt> arrays and <tt>F_CONTIGUOUS</tt> arrays respectively).  Alas, this function is not yet implemented, however, <tt>_GEMM</tt> is **it is now (scipy 0.13.0)**.  Here we use it: <span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><p class="line867"><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-1-15"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-76dead83bb4ae34f6865f4f584f417cc52212857" lang="en"><span class="line"><span class="anchor" id="line-1-16"></span>&gt;&gt;&gt; <span class="ResWord">import</span> <span class="ID">scipy.linalg.blas</span></span>
<span class="line"><span class="anchor" id="line-2-8"></span>&gt;&gt;&gt; <span class="ID">t</span> = <span class="ID">time</span>();<span class="ID">C</span> = <span class="ID">scipy</span>.<span class="ID">linalg</span>.<span class="ID">blas</span>.<span class="ID">dgemm</span>(<span class="ID">alpha</span>=<span class="Number">1.0</span>, <span class="ID">a</span>=<span class="ID">A</span>.<span class="ID">T</span>, <span class="ID">b</span>=<span class="ID">A</span>.<span class="ID">T</span>, <span class="ID">trans_b</span>=<span class="ResWord">True</span>);<span class="ID">time</span>() - <span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-3-8"></span><span class="Number">2.412520170211792</span></span>
</pre></div></div><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">This gives the same performance as <tt>dot</tt> but with the advantage that we did not need to make an extra copy.  Note that we passed <tt>A.T</tt> here so that the array was in Fortran order because <tt>blas</tt> is the Fortran BLAS.  One must be careful about this: passing the wrong type of array will not realize the performance gains.  Here, for example, we pass the <tt>C_CONTIGUOUS</tt> arrays for which copies must me made. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line867"><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-1-17"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-156d25233b3491e44c651c6ecab7e509d722177f" lang="en"><span class="line"><span class="anchor" id="line-1-18"></span>&gt;&gt;&gt; <span class="ID">t</span> = <span class="ID">time</span>();<span class="ID">C</span> = <span class="ID">scipy</span>.<span class="ID">linalg</span>.<span class="ID">blas</span>.<span class="ID">dgemm</span>(<span class="ID">alpha</span>=<span class="Number">1.0</span>, <span class="ID">a</span>=<span class="ID">A</span>, <span class="ID">b</span>=<span class="ID">A</span>, <span class="ID">trans_a</span>=<span class="ResWord">True</span>);<span class="ID">time</span>() - <span class="ID">t</span></span>
<span class="line"><span class="anchor" id="line-2-9"></span><span class="Number">5.0581560134887695</span></span>
</pre></div></div><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><p class="line874">There is not much documentation about this, but some useful discussions can be found in the mailing list archives.  Another related question is about inplace operations (again, avoiding copying).  Some functions provide an option for this, and again, some of the BLAS functions can be used for this.  Here are some related discussions: <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><ul><li><p class="line891"><a class="http" href="../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/6589/">Enhancing dot()</a>  <span class="anchor" id="line-157"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/17886/focus=17890">numpy large arrays?</a> <span class="anchor" id="line-158"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://mail.scipy.org/pipermail/scipy-user/2008-August/017954.html">dgemm overwrite_c bug?</a> <span class="anchor" id="line-159"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/28135/">inplace dot products</a> <span class="anchor" id="line-160"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/25519/">making numpy.dot faster</a> <span class="anchor" id="line-161"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/24551/">Inplace dot and blas access</a> <span class="anchor" id="line-162"></span></li></ul><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: PerformanceTips  (last edited 2015-10-24 17:48:23 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="PerformanceTips37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/PerformanceTips">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/PerformanceTips?highlight=%28%28PerformancePython%29%29 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:47 GMT -->
</html>

