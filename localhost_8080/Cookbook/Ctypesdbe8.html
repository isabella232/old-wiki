<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/Cookbook/Ctypes?action=recoverpass by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="noindex,nofollow">

<title>Cookbook/Ctypes - SciPy</title>
<script type="text/javascript" src="../moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: Cookbook/Ctypes" href="../../external.html?link=http://localhost:8080/Cookbook/Ctypes?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Cookbook%2FCtypes&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="../AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../../external.html?link=http://localhost:8080/Cookbook/Ctypes?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../../external.html?link=http://localhost:8080/Cookbook/Ctypes?action=print">
<link rel="Up" href="../Cookbook.html">
<link rel="Search" href="../FindPage.html">
<link rel="Index" href="../TitleIndex.html">
<link rel="Glossary" href="../WordIndex.html">
<link rel="Help" href="../HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">


<form id="searchform" method="get" action="../../external.html?link=http://localhost:8080/Cookbook/Ctypes">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="Ctypes456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="../AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a href="../Cookbook.html">Cookbook</a></li><li><a class="backlink" href="Ctypesedea.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22Cookbook%2FCtypes%22" rel="nofollow" title="Click to do a full-text search for this title">Ctypes</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="../RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="../FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="../HelpContents.html">HelpContents</a></li><li class="current"><a href="Ctypes.html">Cookbook/Ctypes</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>
<div id="message">
<p><div class="warning">This wiki is not enabled for mail processing.
Contact the owner of the wiki, who can enable email.</div></p><a class="clear-link" href="Ctypes.html">Clear message</a>
</div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Ctypes37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/Ctypes">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="Table_of_Contents">Table of Contents</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Table_of_Contents">Table of Contents</a></li><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Getting_Started_with_ctypes">Getting Started with ctypes</a><ol><li>
<a href="#Nmake_Makefile_.28Windows.29">Nmake Makefile (Windows)</a></li><li>
<a href="#SConstruct_.28GCC.29">SConstruct (GCC)</a></li><li>
<a href="#foo.cpp">foo.cpp</a></li><li>
<a href="#foo.py">foo.py</a></li></ol></li><li>
<a href="#NumPy_arrays.27_ctypes_property">NumPy arrays' ctypes property</a></li><li>
<a href="#NumPy.27s_ndpointer_with_ctypes_argtypes">NumPy's ndpointer with ctypes argtypes</a></li><li>
<a href="#Dynamic_allocation_through_callbacks">Dynamic allocation through callbacks</a></li><li>
<a href="#More_useful_code_frags">More useful code frags</a></li><li>
<a href="#Heterogeneous_Types_Example">Heterogeneous Types Example</a></li><li>
<a href="#Fibonacci_example_.28using_NumPy_arrays.2C_C_and_Scons.29">Fibonacci example (using NumPy arrays, C and Scons)</a></li><li>
<a href="#Pertinent_Mailing_List_Threads">Pertinent Mailing List Threads</a></li><li>
<a href="#Documentation">Documentation</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line867"><a class="http" href="../../external.html?link=http://starship.python.net/crew/theller/ctypes/">ctypes</a> is an advanced Foreign Function Interface package for Python 2.3 and higher. It is included in the standard library for Python 2.5. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line874">ctypes allows to call functions exposed from DLLs/shared libraries and has extensive facilities to create, access and manipulate simple and complicated C data types in Python - in other words: wrap libraries in pure Python. It is even possible to implement C callback functions in pure Python. <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">ctypes also includes a code generator tool chain which allows automatic creation of library wrappers from C header files. ctypes works on Windows, Mac OS X, Linux, Solaris, FreeBSD, OpenBSD and other systems. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line867"><strong>Ensure that you have at least ctypes version 1.0.1 or later.</strong> <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">Other possibilities to call or run C code in python include: <a class="http" href="../../external.html?link=http://www.scipy.org/Cookbook/SWIG_and_NumPy">SWIG</a>, <a class="http" href="../../external.html?link=http://wiki.cython.org/tutorials/numpy">Cython</a>, <a href="../Weave.html">Weave</a>, etc <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h1 id="Getting_Started_with_ctypes">Getting Started with ctypes</h1>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">The <a class="http" href="../../external.html?link=http://starship.python.net/crew/theller/ctypes/tutorial.html">ctypes tutorial</a> and the <a class="http" href="../../external.html?link=http://docs.python.org/lib/module-ctypes.html">ctypes documentation for Python</a> provide extensive information on getting started with ctypes. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">Assuming you've built a library called <tt class="backtick">foo.dll</tt> or <tt class="backtick">libfoo.so</tt> containing a function called <tt class="backtick">bar</tt> that takes a pointer to a buffer of doubles and an int as arguments and returns an int, the following code should get you up and running. The following sections cover some possible build scripts, C code and Python code. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line862">If you would like to build your DLL/shared library with distutils, take a look at the SharedLibrary distutils extension included with <a class="http" href="../../external.html?link=http://www.ctcms.nist.gov/oof/oof2/index.html">OOF2</a>. This should probably be included in numpy.distutils at some point. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867">
<h2 id="Nmake_Makefile_.28Windows.29">Nmake Makefile (Windows)</h2>
<span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line874">Run nmake inside the Visual Studio Command Prompt to build with the following file. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><p class="line874">You should be able to build the DLL with any version of the Visual Studio compiler regardless of the compiler used to compile Python. Keep in mind that you shouldn't allocate/deallocate memory across different debug/release and single-threaded/multi-threaded runtimes or operate on FILE*s from different runtimes. <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line867"><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><pre><span class="anchor" id="line-1"></span>CXX = cl.exe
<span class="anchor" id="line-2"></span>LINK = link.exe
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span>CPPFLAGS = -D_WIN32 -D_USRDLL -DFOO_DLL -DFOO_EXPORTS
<span class="anchor" id="line-5"></span>CXXFLAGSALL = -nologo -EHsc -GS -W3 -Wp64 $(CPPFLAGS)
<span class="anchor" id="line-6"></span>CXXFLAGSDBG = -MDd -Od -Z7 -RTCcsu
<span class="anchor" id="line-7"></span>CXXFLAGSOPT = -MD -O2
<span class="anchor" id="line-8"></span>#CXXFLAGS = $(CXXFLAGSALL) $(CXXFLAGSDBG)
<span class="anchor" id="line-9"></span>CXXFLAGS = $(CXXFLAGSALL) $(CXXFLAGSOPT)
<span class="anchor" id="line-10"></span>
<span class="anchor" id="line-11"></span>LINKFLAGSALL = /nologo /DLL
<span class="anchor" id="line-12"></span>LINKFLAGSDBG = /DEBUG
<span class="anchor" id="line-13"></span>LINKFLAGSOPT =
<span class="anchor" id="line-14"></span>#LINKFLAGS = $(LINKFLAGSALL) $(LINKFLAGSDBG)
<span class="anchor" id="line-15"></span>LINKFLAGS = $(LINKFLAGSALL) $(LINKFLAGSOPT)
<span class="anchor" id="line-16"></span>
<span class="anchor" id="line-17"></span>all: foo.dll
<span class="anchor" id="line-18"></span>
<span class="anchor" id="line-19"></span>foo.dll: foo.obj
<span class="anchor" id="line-20"></span>    $(LINK) $(LINKFLAGS) foo.obj /OUT:foo.dll
<span class="anchor" id="line-21"></span>
<span class="anchor" id="line-22"></span>svm.obj: svm.cpp svm.h
<span class="anchor" id="line-23"></span>    $(CXX) $(CXXFLAGS) -c foo.cpp
<span class="anchor" id="line-24"></span>
<span class="anchor" id="line-25"></span>clean:
<span class="anchor" id="line-26"></span>    -erase /Q *.obj *.dll *.exp *.lib</pre><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><p class="line867">
<h2 id="SConstruct_.28GCC.29">SConstruct (GCC)</h2>
<span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><p class="line862">You can use the following file with <a class="http" href="../../external.html?link=http://www.scons.org/">SCons</a> to build a shared library. <span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line867"><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-0f0319c91dfcc84247ece5cc463a1006b710ab22\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-0f0319c91dfcc84247ece5cc463a1006b710ab22" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_1">   1</a> </span><span class="LineAnchor" id="CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_1"></span><span class="anchor" id="line-1-2"></span><span class="ID">env</span> = <span class="ID">Environment</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_2">   2</a> </span><span class="LineAnchor" id="CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_2"></span><span class="anchor" id="line-2-1"></span><span class="ID">env</span>.<span class="ID">Replace</span>(<span class="ID">CFLAGS</span>=[<span class="String">'</span><span class="String">-O2</span><span class="String">'</span>,<span class="String">'</span><span class="String">-Wall</span><span class="String">'</span>,<span class="String">'</span><span class="String">-ansi</span><span class="String">'</span>,<span class="String">'</span><span class="String">-pedantic</span><span class="String">'</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_3">   3</a> </span><span class="LineAnchor" id="CA-0f0319c91dfcc84247ece5cc463a1006b710ab22_3"></span><span class="anchor" id="line-3-1"></span><span class="ID">env</span>.<span class="ID">SharedLibrary</span>(<span class="String">'</span><span class="String">foo</span><span class="String">'</span>, [<span class="String">'</span><span class="String">foo.cpp</span><span class="String">'</span>])</span>
</pre></div></div><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line867">
<h2 id="foo.cpp">foo.cpp</h2>
<span class="anchor" id="line-71"></span><p class="line867"><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-1-3"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_1">   1</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_1"></span><span class="anchor" id="line-1-4"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_2">   2</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_2"></span><span class="anchor" id="line-2-2"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_3">   3</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_3"></span><span class="anchor" id="line-3-2"></span><span class="Preprc">#</span><span class="Preprc">ifdef FOO_DLL</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_4">   4</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_4"></span><span class="anchor" id="line-4-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">ifdef FOO_EXPORTS</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_5">   5</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_5"></span><span class="anchor" id="line-5-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API __declspec(dllexport)</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_6">   6</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_6"></span><span class="anchor" id="line-6-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">else</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_7">   7</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_7"></span><span class="anchor" id="line-7-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API __declspec(dllimport)</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_8">   8</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_8"></span><span class="anchor" id="line-8-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">endif </span><span class="Comment">/* FOO_EXPORTS */</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_9">   9</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_9"></span><span class="anchor" id="line-9-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">else</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_10">  10</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_10"></span><span class="anchor" id="line-10-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API extern </span><span class="Comment">/* XXX confirm this */</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_11">  11</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_11"></span><span class="anchor" id="line-11-1"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">endif </span><span class="Comment">/* FOO_DLL */</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_12">  12</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_12"></span><span class="anchor" id="line-12-1"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_13">  13</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_13"></span><span class="anchor" id="line-13-1"></span><span class="Preprc">#</span><span class="Preprc">ifdef __cplusplus</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_14">  14</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_14"></span><span class="anchor" id="line-14-1"></span><span class="Preprc"></span><span class="ResWord">extern</span> <span class="String">&quot;</span><span class="String">C</span><span class="String">&quot;</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_15">  15</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_15"></span><span class="anchor" id="line-15-1"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_16">  16</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_16"></span><span class="anchor" id="line-16-1"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_17">  17</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_17"></span><span class="anchor" id="line-17-1"></span><span class="ResWord">extern</span> <span class="ID">FOO_API</span> <span class="ResWord">int</span> <span class="ID">bar</span>(<span class="ResWord">double</span>* <span class="ID">data</span>, <span class="ResWord">int</span> <span class="ID">len</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_18">  18</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_18"></span><span class="anchor" id="line-18-1"></span>   <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_19">  19</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_19"></span><span class="anchor" id="line-19-1"></span>   <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">data = %p</span><span class="SPChar">\n</span><span class="String">&quot;</span>, (<span class="ResWord">void</span>*) <span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_20">  20</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_20"></span><span class="anchor" id="line-20-1"></span>   <span class="ResWord">for</span> (<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">len</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_21">  21</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_21"></span><span class="anchor" id="line-21-1"></span>      <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">data[%d] = %f</span><span class="SPChar">\n</span><span class="String">&quot;</span>, <span class="ID">i</span>, <span class="ID">data</span>[<span class="ID">i</span>]);</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_22">  22</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_22"></span><span class="anchor" id="line-22-1"></span>   }</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_23">  23</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_23"></span><span class="anchor" id="line-23-1"></span>   <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">len = %d</span><span class="SPChar">\n</span><span class="String">&quot;</span>, <span class="ID">len</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_24">  24</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_24"></span><span class="anchor" id="line-24-1"></span>   <span class="ResWord">return</span> <span class="ID">len</span> + <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_25">  25</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_25"></span><span class="anchor" id="line-25-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_26">  26</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_26"></span><span class="anchor" id="line-26-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_27">  27</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_27"></span><span class="anchor" id="line-27-1"></span><span class="Preprc">#</span><span class="Preprc">ifdef __cplusplus</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_28">  28</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_28"></span><span class="anchor" id="line-28-1"></span><span class="Preprc"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_29">  29</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_29"></span><span class="anchor" id="line-29-1"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_30">  30</a> </span><span class="LineAnchor" id="CA-d1b0b48206f08549ca7f9c6063a79cdea4d19a22_30"></span><span class="anchor" id="line-30-1"></span><span class="Preprc"></span></span>
</pre></div></div><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line862">When building the DLL for foo on Windows, define <tt class="backtick">FOO_DLL</tt> and <tt class="backtick">FOO_EXPORTS</tt> (this is what you want to do when building a DLL for use with ctypes). When linking against the DLL, define <tt class="backtick">FOO_DLL</tt>. When linking against a static library that contains foo, or when including foo in an executable, don't define anything. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><p class="line862">If you're unclear about what <tt>extern&nbsp;&quot;C&quot;</tt> is for, read <a class="http" href="../../external.html?link=http://www.tldp.org/HOWTO/C++-dlopen/thesolution.html">section 3 of the C++ dlopen mini HOWTO</a>. This allows you to write function wrappers with C linkage on top of a bunch of C++ classes so that you can use them with ctypes. Alternatively, you might prefer to write C code. <span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><p class="line867">
<h2 id="foo.py">foo.py</h2>
<span class="anchor" id="line-108"></span><p class="line867"><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-bacaf7cc5c1531c633aeee83095642d372559ba6\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_1">   1</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_1"></span><span class="anchor" id="line-1-6"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_2">   2</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_2"></span><span class="anchor" id="line-2-3"></span><span class="ResWord">import</span> <span class="ID">ctypes</span> <span class="ResWord">as</span> <span class="ID">C</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_3">   3</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_3"></span><span class="anchor" id="line-3-3"></span><span class="ID">_foo</span> = <span class="ID">N</span>.<span class="ID">ctypeslib</span>.<span class="ID">load_library</span>(<span class="String">'</span><span class="String">libfoo</span><span class="String">'</span>, <span class="String">'</span><span class="String">.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_4">   4</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_4"></span><span class="anchor" id="line-4-2"></span><span class="ID">_foo</span>.<span class="ID">bar</span>.<span class="ID">restype</span> = <span class="ID">C</span>.<span class="ID">c_int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_5">   5</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_5"></span><span class="anchor" id="line-5-2"></span><span class="ID">_foo</span>.<span class="ID">bar</span>.<span class="ID">argtypes</span> = [<span class="ID">C</span>.<span class="ID">POINTER</span>(<span class="ID">C</span>.<span class="ID">c_double</span>), <span class="ID">C</span>.<span class="ID">c_int</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_6">   6</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_6"></span><span class="anchor" id="line-6-2"></span><span class="ResWord">def</span> <span class="ID">bar</span>(<span class="ID">x</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_7">   7</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_7"></span><span class="anchor" id="line-7-2"></span>    <span class="ResWord">return</span> <span class="ID">_foo</span>.<span class="ID">bar</span>(<span class="ID">x</span>.<span class="ID">ctypes</span>.<span class="ID">data_as</span>(<span class="ID">C</span>.<span class="ID">POINTER</span>(<span class="ID">C</span>.<span class="ID">c_double</span>)), <span class="ResWord">len</span>(<span class="ID">x</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_8">   8</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_8"></span><span class="anchor" id="line-8-2"></span><span class="ID">x</span> = <span class="ID">N</span>.<span class="ID">random</span>.<span class="ID">randn</span>(<span class="Number">10</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-bacaf7cc5c1531c633aeee83095642d372559ba6_9">   9</a> </span><span class="LineAnchor" id="CA-bacaf7cc5c1531c633aeee83095642d372559ba6_9"></span><span class="anchor" id="line-9-2"></span><span class="ID">n</span> = <span class="ID">bar</span>(<span class="ID">x</span>)</span>
</pre></div></div><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line867">
<h1 id="NumPy_arrays.27_ctypes_property">NumPy arrays' ctypes property</h1>
<span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><p class="line862">A ctypes property was recently added to <a class="nonexistent" href="../NumPy.html">NumPy</a> arrays: <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><p class="line867"><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><pre><span class="anchor" id="line-1-1"></span>In [18]: x = N.random.randn(2,3,4)
<span class="anchor" id="line-2-1"></span>
<span class="anchor" id="line-3-1"></span>In [19]: x.ctypes.data
<span class="anchor" id="line-4-1"></span>Out[19]: c_void_p(14394256)
<span class="anchor" id="line-5-1"></span>
<span class="anchor" id="line-6-1"></span>In [21]: x.ctypes.data_as(ctypes.POINTER(c_double))
<span class="anchor" id="line-7-1"></span>
<span class="anchor" id="line-8-1"></span>In [24]: x.ctypes.shape
<span class="anchor" id="line-9-1"></span>Out[24]: &lt;ctypes._endian.c_long_Array_3 object at 0x00DEF2B0&gt;
<span class="anchor" id="line-10-1"></span>
<span class="anchor" id="line-11-1"></span>In [25]: x.ctypes.shape[:3]
<span class="anchor" id="line-12-1"></span>Out[25]: [2, 3, 4]
<span class="anchor" id="line-13-1"></span>
<span class="anchor" id="line-14-1"></span>In [26]: x.ctypes.strides
<span class="anchor" id="line-15-1"></span>Out[26]: &lt;ctypes._endian.c_long_Array_3 object at 0x00DEF300&gt;
<span class="anchor" id="line-16-1"></span>
<span class="anchor" id="line-17-1"></span>In [27]: x.ctypes.strides[:3]
<span class="anchor" id="line-18-1"></span>Out[27]: [96, 32, 8]</pre><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><p class="line874">In general, a C function might take a pointer to the array's data, an integer indicating the number of array dimensions, (pass the value of the ndim property here) and two int pointers to the shapes and stride information. <span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line862">If your C function assumes contiguous storage, you might want to wrap it with a Python function that calls NumPy's <tt class="backtick">ascontiguousarray</tt> function on all the input arrays. <span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><p class="line867">
<h1 id="NumPy.27s_ndpointer_with_ctypes_argtypes">NumPy's ndpointer with ctypes argtypes</h1>
<span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line874">Starting with ctypes 0.9.9.9, any class implementing the from_param method can be used in the argtypes list of a function. Before ctypes calls a C function, it uses the argtypes list to check each parameter. <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><p class="line862">Using NumPy's ndpointer function, some very useful argtypes classes can be constructed, for example: <span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><p class="line867"><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-9d4daa7775af7da49bfacf4351d434047a416456\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-9d4daa7775af7da49bfacf4351d434047a416456" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_1">   1</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_1"></span><span class="anchor" id="line-1-8"></span><span class="ResWord">from</span> <span class="ID">numpy.ctypeslib</span> <span class="ResWord">import</span> <span class="ID">ndpointer</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_2">   2</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_2"></span><span class="anchor" id="line-2-4"></span><span class="ID">arg1</span> = <span class="ID">ndpointer</span>(<span class="ID">dtype</span>=<span class="String">'</span><span class="String">&lt;f4</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_3">   3</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_3"></span><span class="anchor" id="line-3-4"></span><span class="ID">arg2</span> = <span class="ID">ndpointer</span>(<span class="ID">ndim</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_4">   4</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_4"></span><span class="anchor" id="line-4-3"></span><span class="ID">arg3</span> = <span class="ID">ndpointer</span>(<span class="ID">shape</span>=(<span class="Number">10</span>,<span class="Number">10</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_5">   5</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_5"></span><span class="anchor" id="line-5-3"></span><span class="ID">arg4</span> = <span class="ID">ndpointer</span>(<span class="ID">flags</span>=<span class="String">'</span><span class="String">CONTIGUOUS,ALIGNED</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_6">   6</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_6"></span><span class="anchor" id="line-6-3"></span><span class="Comment"># or any combination of the above</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_7">   7</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_7"></span><span class="anchor" id="line-7-3"></span><span class="ID">arg5</span> = <span class="ID">ndpointer</span>(<span class="ID">dtype</span>=<span class="String">'</span><span class="String">&gt;i4</span><span class="String">'</span>, <span class="ID">flags</span>=<span class="String">'</span><span class="String">CONTIGUOUS</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9d4daa7775af7da49bfacf4351d434047a416456_8">   8</a> </span><span class="LineAnchor" id="CA-9d4daa7775af7da49bfacf4351d434047a416456_8"></span><span class="anchor" id="line-8-3"></span><span class="ID">func</span>.<span class="ID">argtypes</span> = [<span class="ID">arg1</span>,<span class="ID">arg2</span>,<span class="ID">arg3</span>,<span class="ID">arg4</span>,<span class="ID">arg5</span>]</span>
</pre></div></div><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line862">Now, if an argument doesn't meet the requirements, a TypeError is raised. This allows one to make sure that arrays passed to the C function is in a form that the function can handle. <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line862">See also the mailing list thread on <a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/7418/focus=7418">ctypes and ndpointer</a>. <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><p class="line867">
<h1 id="Dynamic_allocation_through_callbacks">Dynamic allocation through callbacks</h1>
<span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><p class="line862">ctypes supports the idea of <a class="http" href="../../external.html?link=http://docs.python.org/lib/ctypes-callback-functions.html">callbacks</a>, allowing C code to call back into Python through a function pointer. This is possible because ctypes releases the Python Global Interpreter Lock (GIL) before calling the C function. <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><p class="line862">We can use this feature to allocate NumPy arrays if and when we need a buffer for C code to operate on. This could avoid having to copy data in certain cases. You also don't have to worry about freeing the C data after you're done with it. By allocating your buffers as NumPy arrays, the Python garbage collector can take care of this. <span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><p class="line874">Python code: <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_1">   1</a> </span><span class="LineAnchor" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_1"></span><span class="anchor" id="line-1-10"></span><span class="ResWord">from</span> <span class="ID">ctypes</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_2">   2</a> </span><span class="LineAnchor" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_2"></span><span class="anchor" id="line-2-5"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">c_long</span>, <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_3">   3</a> </span><span class="LineAnchor" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_3"></span><span class="anchor" id="line-3-5"></span><span class="Comment"># load your library as lib</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_4">   4</a> </span><span class="LineAnchor" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_4"></span><span class="anchor" id="line-4-4"></span><span class="ID">lib</span>.<span class="ID">baz</span>.<span class="ID">restype</span> = <span class="ResWord">None</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_5">   5</a> </span><span class="LineAnchor" id="CA-1a1b35345dda6f91b6fa9bd5564a4491aa3a2815_5"></span><span class="anchor" id="line-5-4"></span><span class="ID">lib</span>.<span class="ID">baz</span>.<span class="ID">argtypes</span> = [<span class="ID">c_float</span>, <span class="ID">c_int</span>, <span class="ID">ALLOCATOR</span>]</span>
</pre></div></div><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><p class="line874">This isn't the prettiest way to define the allocator (I'm also not sure if c_long is the right return type), but there are a few bugs in ctypes that seem to make this the only way at present.  Eventually, we'd like to write the allocator like this (but it doesn't work yet): <span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line867"><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-1-11"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-9ee50826b64799e6c99b46f02f4df05284f08acd\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-9ee50826b64799e6c99b46f02f4df05284f08acd" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-9ee50826b64799e6c99b46f02f4df05284f08acd_1">   1</a> </span><span class="LineAnchor" id="CA-9ee50826b64799e6c99b46f02f4df05284f08acd_1"></span><span class="anchor" id="line-1-12"></span><span class="ResWord">from</span> <span class="ID">numpy.ctypeslib</span> <span class="ResWord">import</span> <span class="ID">ndpointer</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9ee50826b64799e6c99b46f02f4df05284f08acd_2">   2</a> </span><span class="LineAnchor" id="CA-9ee50826b64799e6c99b46f02f4df05284f08acd_2"></span><span class="anchor" id="line-2-6"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">ndpointer</span>(<span class="String">'</span><span class="String">f4</span><span class="String">'</span>), <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>))</span>
</pre></div></div><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><p class="line874">The following also seems to cause problems: <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><p class="line867"><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-1-13"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-ac72c4b1a05b3aed16963ec88d8255090960e274\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-ac72c4b1a05b3aed16963ec88d8255090960e274" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-ac72c4b1a05b3aed16963ec88d8255090960e274_1">   1</a> </span><span class="LineAnchor" id="CA-ac72c4b1a05b3aed16963ec88d8255090960e274_1"></span><span class="anchor" id="line-1-14"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">POINTER</span>(<span class="ID">c_float</span>), <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-ac72c4b1a05b3aed16963ec88d8255090960e274_2">   2</a> </span><span class="LineAnchor" id="CA-ac72c4b1a05b3aed16963ec88d8255090960e274_2"></span><span class="anchor" id="line-2-7"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">c_void_p</span>, <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-ac72c4b1a05b3aed16963ec88d8255090960e274_3">   3</a> </span><span class="LineAnchor" id="CA-ac72c4b1a05b3aed16963ec88d8255090960e274_3"></span><span class="anchor" id="line-3-6"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ResWord">None</span>, <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>), <span class="ID">POINTER</span>(<span class="ID">c_void_p</span>))</span>
</pre></div></div><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><p class="line862">Possible failures include a SystemError exception being raised, the interpreter crashing or the interpreter hanging. Check these mailing list threads for more details: <span class="anchor" id="line-201"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.ctypes/2979">Pointer-to-pointer unchanged when assigning in callback</a> <span class="anchor" id="line-202"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.ctypes/2974">Hang with callback returning POINTER(c_float)</a> <span class="anchor" id="line-203"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.ctypes/2972">Error with callback function and as_parameter with NumPy ndpointer</a> <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span></li></ul><p class="line874">Time for an example. The C code for the example: <span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><p class="line867"><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-1-15"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-871f76f4aa8657c396ed3d875aaaf3015033b70b\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_1">   1</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_1"></span><span class="anchor" id="line-1-16"></span><span class="Preprc">#</span><span class="Preprc">ifndef CSPKREC_H</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_2">   2</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_2"></span><span class="anchor" id="line-2-8"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define CSPKREC_H</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_3">   3</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_3"></span><span class="anchor" id="line-3-7"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">ifdef FOO_DLL</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_4">   4</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_4"></span><span class="anchor" id="line-4-5"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">ifdef FOO_EXPORTS</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_5">   5</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_5"></span><span class="anchor" id="line-5-5"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API __declspec(dllexport)</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_6">   6</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_6"></span><span class="anchor" id="line-6-4"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">else</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_7">   7</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_7"></span><span class="anchor" id="line-7-4"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API __declspec(dllimport)</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_8">   8</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_8"></span><span class="anchor" id="line-8-4"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_9">   9</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_9"></span><span class="anchor" id="line-9-3"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">else</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_10">  10</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_10"></span><span class="anchor" id="line-10-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">define FOO_API</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_11">  11</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_11"></span><span class="anchor" id="line-11-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_12">  12</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_12"></span><span class="anchor" id="line-12-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_13">  13</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_13"></span><span class="anchor" id="line-13-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_14">  14</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_14"></span><span class="anchor" id="line-14-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">ifdef __cplusplus</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_15">  15</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_15"></span><span class="anchor" id="line-15-2"></span><span class="Preprc"></span><span class="ResWord">extern</span> <span class="String">&quot;</span><span class="String">C</span><span class="String">&quot;</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_16">  16</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_16"></span><span class="anchor" id="line-16-2"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_17">  17</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_17"></span><span class="anchor" id="line-17-2"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_18">  18</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_18"></span><span class="anchor" id="line-18-2"></span><span class="ResWord">typedef</span> <span class="ResWord">void</span>*(*<span class="ResWord">allocator_t</span>)(<span class="ResWord">int</span>, <span class="ResWord">int</span>*);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_19">  19</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_19"></span><span class="anchor" id="line-19-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_20">  20</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_20"></span><span class="anchor" id="line-20-2"></span><span class="ResWord">extern</span> <span class="ID">FOO_API</span> <span class="ResWord">void</span> <span class="ID">foo</span>(<span class="ResWord">allocator_t</span> <span class="ID">allocator</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_21">  21</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_21"></span><span class="anchor" id="line-21-2"></span>   <span class="ResWord">int</span> <span class="ID">dim</span> = <span class="Number">2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_22">  22</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_22"></span><span class="anchor" id="line-22-2"></span>   <span class="ResWord">int</span> <span class="ID">shape</span>[] = {<span class="Number">2</span>, <span class="Number">3</span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_23">  23</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_23"></span><span class="anchor" id="line-23-2"></span>   <span class="ResWord">float</span>* <span class="ID">data</span> = <span class="ResWord">NULL</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_24">  24</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_24"></span><span class="anchor" id="line-24-2"></span>   <span class="ResWord">int</span> <span class="ID">i</span>, <span class="ID">j</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_25">  25</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_25"></span><span class="anchor" id="line-25-2"></span>   <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">foo calling allocator</span><span class="SPChar">\n</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_26">  26</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_26"></span><span class="anchor" id="line-26-2"></span>   <span class="ID">data</span> = (<span class="ResWord">float</span>*) <span class="ID">allocator</span>(<span class="ID">dim</span>, <span class="ID">shape</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_27">  27</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_27"></span><span class="anchor" id="line-27-2"></span>   <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">allocator returned in foo</span><span class="SPChar">\n</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_28">  28</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_28"></span><span class="anchor" id="line-28-2"></span>   <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">data = 0x%p</span><span class="SPChar">\n</span><span class="String">&quot;</span>, <span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_29">  29</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_29"></span><span class="anchor" id="line-29-2"></span>   <span class="ResWord">for</span> (<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">shape</span>[<span class="Number">0</span>]; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_30">  30</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_30"></span><span class="anchor" id="line-30-2"></span>      <span class="ResWord">for</span> (<span class="ID">j</span> = <span class="Number">0</span>; <span class="ID">j</span> &lt; <span class="ID">shape</span>[<span class="Number">1</span>]; <span class="ID">j</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_31">  31</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_31"></span><span class="anchor" id="line-31-1"></span>         *<span class="ID">data</span>++ = (<span class="ID">i</span> + <span class="Number">1</span>) * (<span class="ID">j</span> + <span class="Number">1</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_32">  32</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_32"></span><span class="anchor" id="line-32-1"></span>      }</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_33">  33</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_33"></span><span class="anchor" id="line-33-1"></span>   }</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_34">  34</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_34"></span><span class="anchor" id="line-34-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_35">  35</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_35"></span><span class="anchor" id="line-35-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_36">  36</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_36"></span><span class="anchor" id="line-36-1"></span><span class="Preprc">#</span><span class="Preprc">ifdef __cplusplus</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_37">  37</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_37"></span><span class="anchor" id="line-37-1"></span><span class="Preprc"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_38">  38</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_38"></span><span class="anchor" id="line-38-1"></span><span class="Preprc">#</span><span class="Preprc">endif</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_39">  39</a> </span><span class="LineAnchor" id="CA-871f76f4aa8657c396ed3d875aaaf3015033b70b_39"></span><span class="anchor" id="line-39-1"></span><span class="Preprc"></span></span>
</pre></div></div><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line862">Check the <a class="http" href="../../external.html?link=http://www.newty.de/fpt/index.html">The Function Pointer Tutorials</a> if you're new to function pointers in C or C++. And the Python code: <span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><p class="line867"><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-1-17"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-d15ca66c05311bf75eb62754562f5217190ede84\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-d15ca66c05311bf75eb62754562f5217190ede84" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_1">   1</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_1"></span><span class="anchor" id="line-1-18"></span><span class="ResWord">from</span> <span class="ID">ctypes</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_2">   2</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_2"></span><span class="anchor" id="line-2-9"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_3">   3</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_3"></span><span class="anchor" id="line-3-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_4">   4</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_4"></span><span class="anchor" id="line-4-6"></span><span class="ID">allocated_arrays</span> = []</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_5">   5</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_5"></span><span class="anchor" id="line-5-6"></span><span class="ResWord">def</span> <span class="ID">allocate</span>(<span class="ID">dim</span>, <span class="ID">shape</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_6">   6</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_6"></span><span class="anchor" id="line-6-5"></span>    <span class="ResWord">print</span> <span class="String">'</span><span class="String">allocate called</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_7">   7</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_7"></span><span class="anchor" id="line-7-5"></span>    <span class="ID">x</span> = <span class="ID">N</span>.<span class="ID">zeros</span>(<span class="ID">shape</span>[:<span class="ID">dim</span>], <span class="String">'</span><span class="String">f4</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_8">   8</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_8"></span><span class="anchor" id="line-8-5"></span>    <span class="ID">allocated_arrays</span>.<span class="ID">append</span>(<span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_9">   9</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_9"></span><span class="anchor" id="line-9-4"></span>    <span class="ID">ptr</span> = <span class="ID">x</span>.<span class="ID">ctypes</span>.<span class="ID">data_as</span>(<span class="ID">c_void_p</span>).<span class="ID">value</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_10">  10</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_10"></span><span class="anchor" id="line-10-3"></span>    <span class="ResWord">print</span> <span class="ResWord">hex</span>(<span class="ID">ptr</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_11">  11</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_11"></span><span class="anchor" id="line-11-3"></span>    <span class="ResWord">print</span> <span class="String">'</span><span class="String">allocate returning</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_12">  12</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_12"></span><span class="anchor" id="line-12-3"></span>    <span class="ResWord">return</span> <span class="ID">ptr</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_13">  13</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_13"></span><span class="anchor" id="line-13-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_14">  14</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_14"></span><span class="anchor" id="line-14-3"></span><span class="ID">lib</span> = <span class="ID">cdll</span>[<span class="String">'</span><span class="String">callback.dll</span><span class="String">'</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_15">  15</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_15"></span><span class="anchor" id="line-15-3"></span><span class="ID">lib</span>.<span class="ID">foo</span>.<span class="ID">restype</span> = <span class="ResWord">None</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_16">  16</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_16"></span><span class="anchor" id="line-16-3"></span><span class="ID">ALLOCATOR</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">c_long</span>, <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_17">  17</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_17"></span><span class="anchor" id="line-17-3"></span><span class="ID">lib</span>.<span class="ID">foo</span>.<span class="ID">argtypes</span> = [<span class="ID">ALLOCATOR</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_18">  18</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_18"></span><span class="anchor" id="line-18-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_19">  19</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_19"></span><span class="anchor" id="line-19-3"></span><span class="ResWord">print</span> <span class="String">'</span><span class="String">calling foo</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_20">  20</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_20"></span><span class="anchor" id="line-20-3"></span><span class="ID">lib</span>.<span class="ID">foo</span>(<span class="ID">ALLOCATOR</span>(<span class="ID">allocate</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_21">  21</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_21"></span><span class="anchor" id="line-21-3"></span><span class="ResWord">print</span> <span class="String">'</span><span class="String">foo returned</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_22">  22</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_22"></span><span class="anchor" id="line-22-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d15ca66c05311bf75eb62754562f5217190ede84_23">  23</a> </span><span class="LineAnchor" id="CA-d15ca66c05311bf75eb62754562f5217190ede84_23"></span><span class="anchor" id="line-23-3"></span><span class="ResWord">print</span> <span class="ID">allocated_arrays</span>[<span class="Number">0</span>]</span>
</pre></div></div><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><p class="line862">The allocate function creates a new NumPy array and puts it in a list so that we keep a reference to it after the callback function returns. Expected output: <span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><p class="line867"><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><pre><span class="anchor" id="line-1-2"></span>calling foo
<span class="anchor" id="line-2-2"></span>foo calling allocator
<span class="anchor" id="line-3-2"></span>allocate called
<span class="anchor" id="line-4-2"></span>0xaf5778
<span class="anchor" id="line-5-2"></span>allocate returning
<span class="anchor" id="line-6-2"></span>allocator returned in foo
<span class="anchor" id="line-7-2"></span>data = 0x00AF5778
<span class="anchor" id="line-8-2"></span>foo returned
<span class="anchor" id="line-9-2"></span>[[ 1.  2.  3.]
<span class="anchor" id="line-10-2"></span> [ 2.  4.  6.]]</pre><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><p class="line862">Here's another idea for an Allocator class to manage this kind of thing. In addition to dimension and shape, this allocator function takes a char indicating what type of array to allocate. You can get these typecodes from the ndarrayobject.h header, in the <tt class="backtick">NPY_TYPECHAR</tt> enum. <span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><p class="line867"><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-1-19"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-b85bc56aebbca44342c13ea0bc47f57b92f71750\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_1">   1</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_1"></span><span class="anchor" id="line-1-20"></span><span class="ResWord">from</span> <span class="ID">ctypes</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_2">   2</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_2"></span><span class="anchor" id="line-2-10"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_3">   3</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_3"></span><span class="anchor" id="line-3-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_4">   4</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_4"></span><span class="anchor" id="line-4-7"></span><span class="ResWord">class</span> <span class="ID">Allocator</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_5">   5</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_5"></span><span class="anchor" id="line-5-7"></span>    <span class="ID">CFUNCTYPE</span> = <span class="ID">CFUNCTYPE</span>(<span class="ID">c_long</span>, <span class="ID">c_int</span>, <span class="ID">POINTER</span>(<span class="ID">c_int</span>), <span class="ID">c_char</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_6">   6</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_6"></span><span class="anchor" id="line-6-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_7">   7</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_7"></span><span class="anchor" id="line-7-6"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_8">   8</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_8"></span><span class="anchor" id="line-8-6"></span>        <span class="ResWord">self</span>.<span class="ID">allocated_arrays</span> = []</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_9">   9</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_9"></span><span class="anchor" id="line-9-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_10">  10</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_10"></span><span class="anchor" id="line-10-4"></span>    <span class="ResWord">def</span> <span class="ID">__call__</span>(<span class="ResWord">self</span>, <span class="ID">dims</span>, <span class="ID">shape</span>, <span class="ID">dtype</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_11">  11</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_11"></span><span class="anchor" id="line-11-4"></span>        <span class="ID">x</span> = <span class="ID">N</span>.<span class="ID">empty</span>(<span class="ID">shape</span>[:<span class="ID">dims</span>], <span class="ID">N</span>.<span class="ID">dtype</span>(<span class="ID">dtype</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_12">  12</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_12"></span><span class="anchor" id="line-12-4"></span>        <span class="ResWord">self</span>.<span class="ID">allocated_arrays</span>.<span class="ID">append</span>(<span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_13">  13</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_13"></span><span class="anchor" id="line-13-4"></span>        <span class="ResWord">return</span> <span class="ID">x</span>.<span class="ID">ctypes</span>.<span class="ID">data_as</span>(<span class="ID">c_void_p</span>).<span class="ID">value</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_14">  14</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_14"></span><span class="anchor" id="line-14-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_15">  15</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_15"></span><span class="anchor" id="line-15-4"></span>    <span class="ResWord">def</span> <span class="ID">getcfunc</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_16">  16</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_16"></span><span class="anchor" id="line-16-4"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">CFUNCTYPE</span>(<span class="ResWord">self</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_17">  17</a> </span><span class="LineAnchor" id="CA-b85bc56aebbca44342c13ea0bc47f57b92f71750_17"></span><span class="anchor" id="line-17-4"></span>    <span class="ID">cfunc</span> = <span class="ResWord">property</span>(<span class="ID">getcfunc</span>)</span>
</pre></div></div><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><p class="line874">Use it like this in Python: <span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><p class="line867"><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-1-21"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-bbf9164caf372e07dc68f6e04230d4877c59546a\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-bbf9164caf372e07dc68f6e04230d4877c59546a_1">   1</a> </span><span class="LineAnchor" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a_1"></span><span class="anchor" id="line-1-22"></span><span class="ID">lib</span>.<span class="ID">func</span>.<span class="ID">argtypes</span> = [..., <span class="ID">Allocator</span>.<span class="ID">CFUNCTYPE</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-bbf9164caf372e07dc68f6e04230d4877c59546a_2">   2</a> </span><span class="LineAnchor" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a_2"></span><span class="anchor" id="line-2-11"></span><span class="ResWord">def</span> <span class="ID">func</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-bbf9164caf372e07dc68f6e04230d4877c59546a_3">   3</a> </span><span class="LineAnchor" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a_3"></span><span class="anchor" id="line-3-10"></span>    <span class="ID">alloc</span> = <span class="ID">Allocator</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-bbf9164caf372e07dc68f6e04230d4877c59546a_4">   4</a> </span><span class="LineAnchor" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a_4"></span><span class="anchor" id="line-4-8"></span>    <span class="ID">lib</span>.<span class="ID">func</span>(..., <span class="ID">alloc</span>.<span class="ID">cfunc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-bbf9164caf372e07dc68f6e04230d4877c59546a_5">   5</a> </span><span class="LineAnchor" id="CA-bbf9164caf372e07dc68f6e04230d4877c59546a_5"></span><span class="anchor" id="line-5-8"></span>    <span class="ResWord">return</span> <span class="ResWord">tuple</span>(<span class="ID">alloc</span>.<span class="ID">allocated_arrays</span>[:<span class="Number">3</span>])</span>
</pre></div></div><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><p class="line874">Corresponding C code: <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><p class="line867"><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-1-23"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_1">   1</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_1"></span><span class="anchor" id="line-1-24"></span><span class="ResWord">typedef</span> <span class="ResWord">void</span>*(*<span class="ResWord">allocator_t</span>)(<span class="ResWord">int</span>, <span class="ResWord">int</span>*, <span class="ResWord">char</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_2">   2</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_2"></span><span class="anchor" id="line-2-12"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_3">   3</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_3"></span><span class="anchor" id="line-3-11"></span><span class="ResWord">void</span> <span class="ID">func</span>(..., <span class="ResWord">allocator_t</span> <span class="ID">allocator</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_4">   4</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_4"></span><span class="anchor" id="line-4-9"></span>   <span class="Comment">/* ... */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_5">   5</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_5"></span><span class="anchor" id="line-5-9"></span>   <span class="ResWord">int</span> <span class="ID">dims</span>[] = {<span class="Number">2</span>, <span class="Number">3</span>, <span class="Number">4</span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_6">   6</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_6"></span><span class="anchor" id="line-6-7"></span>   <span class="ResWord">double</span>* <span class="ID">data</span> = (<span class="ResWord">double</span>*) <span class="ID">allocator</span>(<span class="Number">3</span>, <span class="ID">dims</span>, <span class="Char">'d'</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_7">   7</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_7"></span><span class="anchor" id="line-7-7"></span>   <span class="Comment">/* allocate more arrays here */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_8">   8</a> </span><span class="LineAnchor" id="CA-29c2a0223d3c50114ef1d4d94081a93687d8a0b9_8"></span><span class="anchor" id="line-8-7"></span>}</span>
</pre></div></div><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><p class="line874">None of the allocators presented above are thread safe. If you have multiple Python threads calling the C code that invokes your callbacks, you will have to do something a bit smarter. <span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line867">
<h1 id="More_useful_code_frags">More useful code frags</h1>
<span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><p class="line874">Suppose you have a C function like the following, which operates on a pointer-to-pointers data structure. <span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-1-25"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_1">   1</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_1"></span><span class="anchor" id="line-1-26"></span><span class="ResWord">void</span> <span class="ID">foo</span>(<span class="ResWord">float</span>** <span class="ID">data</span>, <span class="ResWord">int</span> <span class="ID">len</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_2">   2</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_2"></span><span class="anchor" id="line-2-13"></span>    <span class="ResWord">float</span>** <span class="ID">x</span> = <span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_3">   3</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_3"></span><span class="anchor" id="line-3-12"></span>    <span class="ResWord">for</span> (<span class="ResWord">int</span> <span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">len</span>; <span class="ID">i</span>++, <span class="ID">x</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_4">   4</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_4"></span><span class="anchor" id="line-4-10"></span>        <span class="Comment">/* do something with *x */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_5">   5</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_5"></span><span class="anchor" id="line-5-10"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_6">   6</a> </span><span class="LineAnchor" id="CA-44ff0fc1073b47f7b3f34db7cfec1ed21a9525aa_6"></span><span class="anchor" id="line-6-8"></span>}</span>
</pre></div></div><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><p class="line862">You can create the necessary structure from an existing 2-D NumPy array using the following code: <span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><p class="line867"><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-1-27"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_1">   1</a> </span><span class="LineAnchor" id="CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_1"></span><span class="anchor" id="line-1-28"></span><span class="ID">x</span> = <span class="ID">N</span>.<span class="ID">array</span>([[<span class="Number">10</span>,<span class="Number">20</span>,<span class="Number">30</span>], [<span class="Number">40</span>,<span class="Number">50</span>,<span class="Number">60</span>], [<span class="Number">80</span>,<span class="Number">90</span>,<span class="Number">100</span>]], <span class="String">'</span><span class="String">f4</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_2">   2</a> </span><span class="LineAnchor" id="CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_2"></span><span class="anchor" id="line-2-14"></span><span class="ID">f4ptr</span> = <span class="ID">POINTER</span>(<span class="ID">c_float</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_3">   3</a> </span><span class="LineAnchor" id="CA-582a2b4a16bc66f7df6b86a3e0f42e5377178b39_3"></span><span class="anchor" id="line-3-13"></span><span class="ID">data</span> = (<span class="ID">f4ptr</span>*<span class="ResWord">len</span>(<span class="ID">x</span>))(*[<span class="ID">row</span>.<span class="ID">ctypes</span>.<span class="ID">data_as</span>(<span class="ID">f4ptr</span>) <span class="ResWord">for</span> <span class="ID">row</span> <span class="ResWord">in</span> <span class="ID">x</span>])</span>
</pre></div></div><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><p class="line867"><tt class="backtick">f4ptr*len(x)</tt> creates a ctypes array type that is just large enough to contain a pointer to every row of the array. <span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><p class="line867">
<h1 id="Heterogeneous_Types_Example">Heterogeneous Types Example</h1>
<span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><p class="line874">Here's a simple example when using heterogeneous dtypes (record arrays). <span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><p class="line862">But, be warned that <a class="nonexistent" href="../NumPy.html">NumPy</a> recarrays and corresponding structs in C <em><strong>may not</strong></em> be congruent. <span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><p class="line874">Also structs are not standardized across platforms <span class="anchor" id="line-368"></span>...In other words, <em><strong> be aware of padding issues!</strong></em> <span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><p class="line874">sample.c <span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-1-29"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f520b5c666044d6ffde56a517922fe518646b694\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-f520b5c666044d6ffde56a517922fe518646b694" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_1">   1</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_1"></span><span class="anchor" id="line-1-30"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_2">   2</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_2"></span><span class="anchor" id="line-2-15"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_3">   3</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_3"></span><span class="anchor" id="line-3-14"></span><span class="ResWord">typedef</span> <span class="ResWord">struct</span> <span class="ID">Weather_t</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_4">   4</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_4"></span><span class="anchor" id="line-4-11"></span>    <span class="ResWord">int</span> <span class="ID">timestamp</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_5">   5</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_5"></span><span class="anchor" id="line-5-11"></span>    <span class="ResWord">char</span> <span class="ID">desc</span>[<span class="Number">12</span>];</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_6">   6</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_6"></span><span class="anchor" id="line-6-9"></span>} <span class="ID">Weather</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_7">   7</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_7"></span><span class="anchor" id="line-7-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_8">   8</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_8"></span><span class="anchor" id="line-8-8"></span><span class="ResWord">void</span> <span class="ID">print_weather</span>(<span class="ID">Weather</span>* <span class="ID">w</span>, <span class="ResWord">int</span> <span class="ID">nelems</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_9">   9</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_9"></span><span class="anchor" id="line-9-6"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_10">  10</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_10"></span><span class="anchor" id="line-10-5"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_11">  11</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_11"></span><span class="anchor" id="line-11-5"></span>    <span class="ResWord">for</span> (<span class="ID">i</span>=<span class="Number">0</span>;<span class="ID">i</span>&lt;<span class="ID">nelems</span>;++<span class="ID">i</span>) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_12">  12</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_12"></span><span class="anchor" id="line-12-5"></span>        <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">timestamp: %d</span><span class="SPChar">\n</span><span class="String">description: %s</span><span class="SPChar">\n</span><span class="SPChar">\n</span><span class="String">&quot;</span>, <span class="ID">w</span>[<span class="ID">i</span>].<span class="ID">timestamp</span>, <span class="ID">w</span>[<span class="ID">i</span>].<span class="ID">desc</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_13">  13</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_13"></span><span class="anchor" id="line-13-5"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-f520b5c666044d6ffde56a517922fe518646b694_14">  14</a> </span><span class="LineAnchor" id="CA-f520b5c666044d6ffde56a517922fe518646b694_14"></span><span class="anchor" id="line-14-5"></span>}</span>
</pre></div></div><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><p class="line874">SConstruct <span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-1-31"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_1">   1</a> </span><span class="LineAnchor" id="CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_1"></span><span class="anchor" id="line-1-32"></span><span class="ID">env</span> = <span class="ID">Environment</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_2">   2</a> </span><span class="LineAnchor" id="CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_2"></span><span class="anchor" id="line-2-16"></span><span class="ID">env</span>.<span class="ID">Replace</span>(<span class="ID">CFLAGS</span>=[<span class="String">'</span><span class="String">-O2</span><span class="String">'</span>,<span class="String">'</span><span class="String">-Wall</span><span class="String">'</span>,<span class="String">'</span><span class="String">-ansi</span><span class="String">'</span>,<span class="String">'</span><span class="String">-pedantic</span><span class="String">'</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_3">   3</a> </span><span class="LineAnchor" id="CA-6ade246f4fe307a52aa084819e63a95a2b2d1bd0_3"></span><span class="anchor" id="line-3-15"></span><span class="ID">env</span>.<span class="ID">SharedLibrary</span>(<span class="String">'</span><span class="String">sample</span><span class="String">'</span>, [<span class="String">'</span><span class="String">sample.c</span><span class="String">'</span>])</span>
</pre></div></div><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><p class="line874">sample.py <span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-1-33"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_1">   1</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_1"></span><span class="anchor" id="line-1-34"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_2">   2</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_2"></span><span class="anchor" id="line-2-17"></span><span class="ResWord">import</span> <span class="ID">ctypes</span> <span class="ResWord">as</span> <span class="ID">C</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_3">   3</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_3"></span><span class="anchor" id="line-3-16"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_4">   4</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_4"></span><span class="anchor" id="line-4-12"></span><span class="ID">dat</span> = [[<span class="Number">1126877361</span>,<span class="String">'</span><span class="String">sunny</span><span class="String">'</span>], [<span class="Number">1126877371</span>,<span class="String">'</span><span class="String">rain</span><span class="String">'</span>], [<span class="Number">1126877385</span>,<span class="String">'</span><span class="String">damn nasty</span><span class="String">'</span>], [<span class="Number">1126877387</span>,<span class="String">'</span><span class="String">sunny</span><span class="String">'</span>]]</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_5">   5</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_5"></span><span class="anchor" id="line-5-12"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_6">   6</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_6"></span><span class="anchor" id="line-6-10"></span><span class="ID">dat_dtype</span> = <span class="ID">N</span>.<span class="ID">dtype</span>([(<span class="String">'</span><span class="String">timestamp</span><span class="String">'</span>,<span class="String">'</span><span class="String">i4</span><span class="String">'</span>),(<span class="String">'</span><span class="String">desc</span><span class="String">'</span>,<span class="String">'</span><span class="String">|S12</span><span class="String">'</span>)])</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_7">   7</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_7"></span><span class="anchor" id="line-7-9"></span><span class="ID">arr</span> = <span class="ID">N</span>.<span class="ID">rec</span>.<span class="ID">fromrecords</span>(<span class="ID">dat</span>,<span class="ID">dtype</span>=<span class="ID">dat_dtype</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_8">   8</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_8"></span><span class="anchor" id="line-8-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_9">   9</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_9"></span><span class="anchor" id="line-9-7"></span><span class="ID">_sample</span> = <span class="ID">N</span>.<span class="ID">ctypeslib</span>.<span class="ID">load_library</span>(<span class="String">'</span><span class="String">libsample</span><span class="String">'</span>,<span class="String">'</span><span class="String">.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_10">  10</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_10"></span><span class="anchor" id="line-10-6"></span><span class="ID">_sample</span>.<span class="ID">print_weather</span>.<span class="ID">restype</span> = <span class="ResWord">None</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_11">  11</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_11"></span><span class="anchor" id="line-11-6"></span><span class="ID">_sample</span>.<span class="ID">print_weather</span>.<span class="ID">argtypes</span> = [<span class="ID">N</span>.<span class="ID">ctypeslib</span>.<span class="ID">ndpointer</span>(<span class="ID">dat_dtype</span>, <span class="ID">flags</span>=<span class="String">'</span><span class="String">aligned, contiguous</span><span class="String">'</span>), <span class="ID">C</span>.<span class="ID">c_int</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_12">  12</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_12"></span><span class="anchor" id="line-12-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_13">  13</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_13"></span><span class="anchor" id="line-13-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_14">  14</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_14"></span><span class="anchor" id="line-14-6"></span><span class="ResWord">def</span> <span class="ID">print_weather</span>(<span class="ID">x</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_15">  15</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_15"></span><span class="anchor" id="line-15-5"></span>    <span class="ID">_sample</span>.<span class="ID">print_weather</span>(<span class="ID">x</span>, <span class="ID">x</span>.<span class="ID">size</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_16">  16</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_16"></span><span class="anchor" id="line-16-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_17">  17</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_17"></span><span class="anchor" id="line-17-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_18">  18</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_18"></span><span class="anchor" id="line-18-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_19">  19</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_19"></span><span class="anchor" id="line-19-4"></span><span class="ResWord">if</span> <span class="ID">__name__</span>==<span class="String">'</span><span class="String">__main__</span><span class="String">'</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_20">  20</a> </span><span class="LineAnchor" id="CA-6ebc3107b8afe1059f14a7979a346f50e30ffaba_20"></span><span class="anchor" id="line-20-4"></span>    <span class="ID">print_weather</span>(<span class="ID">arr</span>)</span>
</pre></div></div><span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><p class="line867">
<h1 id="Fibonacci_example_.28using_NumPy_arrays.2C_C_and_Scons.29">Fibonacci example (using NumPy arrays, C and Scons)</h1>
<span class="anchor" id="line-421"></span><p class="line874">The following was tested and works on Windows (using MinGW) and GNU/Linux 32-bit OSs (last tested 13-08-2009). Copy all three files to the same directory. <span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><p class="line874">The C code (this calculates the Fibonacci number recursively): <span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><span class="anchor" id="line-453"></span><span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><span class="anchor" id="line-456"></span><span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><span class="anchor" id="line-459"></span><span class="anchor" id="line-460"></span><span class="anchor" id="line-461"></span><span class="anchor" id="line-462"></span><span class="anchor" id="line-463"></span><span class="anchor" id="line-464"></span><span class="anchor" id="line-465"></span><span class="anchor" id="line-466"></span><span class="anchor" id="line-1-35"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-aa1850cd2b26ee007207c693738e302857bbbf6b\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_1">   1</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_1"></span><span class="anchor" id="line-1-36"></span><span class="Comment">/*</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_2">   2</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_2"></span><span class="anchor" id="line-2-18"></span><span class="Comment">    Filename: fibonacci.c</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_3">   3</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_3"></span><span class="anchor" id="line-3-17"></span><span class="Comment">    To be used with fibonacci.py, as an imported library. Use Scons to compile,</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_4">   4</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_4"></span><span class="anchor" id="line-4-13"></span><span class="Comment">    simply type 'scons' in the same directory as this file (see www.scons.org).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_5">   5</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_5"></span><span class="anchor" id="line-5-13"></span><span class="Comment">*/</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_6">   6</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_6"></span><span class="anchor" id="line-6-11"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_7">   7</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_7"></span><span class="anchor" id="line-7-10"></span><span class="Comment">/* Function prototypes */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_8">   8</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_8"></span><span class="anchor" id="line-8-10"></span><span class="ResWord">int</span> <span class="ID">fib</span>(<span class="ResWord">int</span> <span class="ID">a</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_9">   9</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_9"></span><span class="anchor" id="line-9-8"></span><span class="ResWord">void</span> <span class="ID">fibseries</span>(<span class="ResWord">int</span> *<span class="ID">a</span>, <span class="ResWord">int</span> <span class="ID">elements</span>, <span class="ResWord">int</span> *<span class="ID">series</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_10">  10</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_10"></span><span class="anchor" id="line-10-7"></span><span class="ResWord">void</span> <span class="ID">fibmatrix</span>(<span class="ResWord">int</span> *<span class="ID">a</span>, <span class="ResWord">int</span> <span class="ID">rows</span>, <span class="ResWord">int</span> <span class="ID">columns</span>, <span class="ResWord">int</span> *<span class="ID">matrix</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_11">  11</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_11"></span><span class="anchor" id="line-11-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_12">  12</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_12"></span><span class="anchor" id="line-12-7"></span><span class="ResWord">int</span> <span class="ID">fib</span>(<span class="ResWord">int</span> <span class="ID">a</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_13">  13</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_13"></span><span class="anchor" id="line-13-7"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_14">  14</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_14"></span><span class="anchor" id="line-14-7"></span>    <span class="ResWord">if</span> (<span class="ID">a</span> &lt;= <span class="Number">0</span>) <span class="Comment">/*  Error -- wrong input will return -1. */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_15">  15</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_15"></span><span class="anchor" id="line-15-6"></span>        <span class="ResWord">return</span> -<span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_16">  16</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_16"></span><span class="anchor" id="line-16-6"></span>    <span class="ResWord">else</span> <span class="ResWord">if</span> (<span class="ID">a</span>==<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_17">  17</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_17"></span><span class="anchor" id="line-17-6"></span>        <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_18">  18</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_18"></span><span class="anchor" id="line-18-5"></span>    <span class="ResWord">else</span> <span class="ResWord">if</span> ((<span class="ID">a</span>==<span class="Number">2</span>)||(<span class="ID">a</span>==<span class="Number">3</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_19">  19</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_19"></span><span class="anchor" id="line-19-5"></span>        <span class="ResWord">return</span> <span class="Number">1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_20">  20</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_20"></span><span class="anchor" id="line-20-5"></span>    <span class="ResWord">else</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_21">  21</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_21"></span><span class="anchor" id="line-21-4"></span>        <span class="ResWord">return</span> <span class="ID">fib</span>(<span class="ID">a</span> - <span class="Number">2</span>) + <span class="ID">fib</span>(<span class="ID">a</span> - <span class="Number">1</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_22">  22</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_22"></span><span class="anchor" id="line-22-4"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_23">  23</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_23"></span><span class="anchor" id="line-23-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_24">  24</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_24"></span><span class="anchor" id="line-24-3"></span><span class="ResWord">void</span> <span class="ID">fibseries</span>(<span class="ResWord">int</span> *<span class="ID">a</span>, <span class="ResWord">int</span> <span class="ID">elements</span>, <span class="ResWord">int</span> *<span class="ID">series</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_25">  25</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_25"></span><span class="anchor" id="line-25-3"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_26">  26</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_26"></span><span class="anchor" id="line-26-3"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_27">  27</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_27"></span><span class="anchor" id="line-27-3"></span>    <span class="ResWord">for</span> (<span class="ID">i</span>=<span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="ID">elements</span>; <span class="ID">i</span>++)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_28">  28</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_28"></span><span class="anchor" id="line-28-3"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_29">  29</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_29"></span><span class="anchor" id="line-29-3"></span>    <span class="ID">series</span>[<span class="ID">i</span>] = <span class="ID">fib</span>(<span class="ID">a</span>[<span class="ID">i</span>]);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_30">  30</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_30"></span><span class="anchor" id="line-30-3"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_31">  31</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_31"></span><span class="anchor" id="line-31-2"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_32">  32</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_32"></span><span class="anchor" id="line-32-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_33">  33</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_33"></span><span class="anchor" id="line-33-2"></span><span class="ResWord">void</span> <span class="ID">fibmatrix</span>(<span class="ResWord">int</span> *<span class="ID">a</span>, <span class="ResWord">int</span> <span class="ID">rows</span>, <span class="ResWord">int</span> <span class="ID">columns</span>, <span class="ResWord">int</span> *<span class="ID">matrix</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_34">  34</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_34"></span><span class="anchor" id="line-34-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_35">  35</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_35"></span><span class="anchor" id="line-35-2"></span>    <span class="ResWord">int</span> <span class="ID">i</span>, <span class="ID">j</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_36">  36</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_36"></span><span class="anchor" id="line-36-2"></span>    <span class="ResWord">for</span> (<span class="ID">i</span>=<span class="Number">0</span>; <span class="ID">i</span>&lt;<span class="ID">rows</span>; <span class="ID">i</span>++)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_37">  37</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_37"></span><span class="anchor" id="line-37-2"></span>        <span class="ResWord">for</span> (<span class="ID">j</span>=<span class="Number">0</span>; <span class="ID">j</span>&lt;<span class="ID">columns</span>; <span class="ID">j</span>++)</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_38">  38</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_38"></span><span class="anchor" id="line-38-2"></span>        {</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_39">  39</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_39"></span><span class="anchor" id="line-39-2"></span>            <span class="ID">matrix</span>[<span class="ID">i</span> * <span class="ID">columns</span> + <span class="ID">j</span>] = <span class="ID">fib</span>(<span class="ID">a</span>[<span class="ID">i</span> * <span class="ID">columns</span> + <span class="ID">j</span>]);</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_40">  40</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_40"></span><span class="anchor" id="line-40-1"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-aa1850cd2b26ee007207c693738e302857bbbf6b_41">  41</a> </span><span class="LineAnchor" id="CA-aa1850cd2b26ee007207c693738e302857bbbf6b_41"></span><span class="anchor" id="line-41-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-467"></span><span class="anchor" id="line-468"></span><span class="anchor" id="line-469"></span><p class="line874">The Python code: <span class="anchor" id="line-470"></span><span class="anchor" id="line-471"></span><span class="anchor" id="line-472"></span><span class="anchor" id="line-473"></span><span class="anchor" id="line-474"></span><span class="anchor" id="line-475"></span><span class="anchor" id="line-476"></span><span class="anchor" id="line-477"></span><span class="anchor" id="line-478"></span><span class="anchor" id="line-479"></span><span class="anchor" id="line-480"></span><span class="anchor" id="line-481"></span><span class="anchor" id="line-482"></span><span class="anchor" id="line-483"></span><span class="anchor" id="line-484"></span><span class="anchor" id="line-485"></span><span class="anchor" id="line-486"></span><span class="anchor" id="line-487"></span><span class="anchor" id="line-488"></span><span class="anchor" id="line-489"></span><span class="anchor" id="line-490"></span><span class="anchor" id="line-491"></span><span class="anchor" id="line-492"></span><span class="anchor" id="line-493"></span><span class="anchor" id="line-494"></span><span class="anchor" id="line-495"></span><span class="anchor" id="line-496"></span><span class="anchor" id="line-497"></span><span class="anchor" id="line-498"></span><span class="anchor" id="line-499"></span><span class="anchor" id="line-500"></span><span class="anchor" id="line-501"></span><span class="anchor" id="line-502"></span><span class="anchor" id="line-503"></span><span class="anchor" id="line-504"></span><span class="anchor" id="line-505"></span><span class="anchor" id="line-506"></span><span class="anchor" id="line-507"></span><span class="anchor" id="line-508"></span><span class="anchor" id="line-509"></span><span class="anchor" id="line-510"></span><span class="anchor" id="line-511"></span><span class="anchor" id="line-512"></span><span class="anchor" id="line-513"></span><span class="anchor" id="line-514"></span><span class="anchor" id="line-515"></span><span class="anchor" id="line-516"></span><span class="anchor" id="line-517"></span><span class="anchor" id="line-518"></span><span class="anchor" id="line-519"></span><span class="anchor" id="line-520"></span><span class="anchor" id="line-521"></span><span class="anchor" id="line-522"></span><span class="anchor" id="line-523"></span><span class="anchor" id="line-524"></span><span class="anchor" id="line-525"></span><span class="anchor" id="line-526"></span><span class="anchor" id="line-527"></span><span class="anchor" id="line-528"></span><span class="anchor" id="line-529"></span><span class="anchor" id="line-530"></span><span class="anchor" id="line-531"></span><span class="anchor" id="line-532"></span><span class="anchor" id="line-533"></span><span class="anchor" id="line-534"></span><span class="anchor" id="line-535"></span><span class="anchor" id="line-536"></span><span class="anchor" id="line-537"></span><span class="anchor" id="line-538"></span><span class="anchor" id="line-539"></span><span class="anchor" id="line-540"></span><span class="anchor" id="line-541"></span><span class="anchor" id="line-542"></span><span class="anchor" id="line-543"></span><span class="anchor" id="line-544"></span><span class="anchor" id="line-545"></span><span class="anchor" id="line-546"></span><span class="anchor" id="line-547"></span><span class="anchor" id="line-548"></span><span class="anchor" id="line-549"></span><span class="anchor" id="line-550"></span><span class="anchor" id="line-551"></span><span class="anchor" id="line-552"></span><span class="anchor" id="line-553"></span><span class="anchor" id="line-554"></span><span class="anchor" id="line-555"></span><span class="anchor" id="line-556"></span><span class="anchor" id="line-557"></span><span class="anchor" id="line-558"></span><span class="anchor" id="line-559"></span><span class="anchor" id="line-560"></span><span class="anchor" id="line-561"></span><span class="anchor" id="line-562"></span><span class="anchor" id="line-563"></span><span class="anchor" id="line-564"></span><span class="anchor" id="line-565"></span><span class="anchor" id="line-1-37"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_1">   1</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_1"></span><span class="anchor" id="line-1-38"></span><span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_2">   2</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_2"></span><span class="anchor" id="line-2-19"></span><span class="String">Filename: fibonacci.py</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_3">   3</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_3"></span><span class="anchor" id="line-3-18"></span><span class="String">Demonstrates the use of ctypes with three functions:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_4">   4</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_4"></span><span class="anchor" id="line-4-14"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_5">   5</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_5"></span><span class="anchor" id="line-5-14"></span><span class="String">    (1) fib(a)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_6">   6</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_6"></span><span class="anchor" id="line-6-12"></span><span class="String">    (2) fibseries(b)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_7">   7</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_7"></span><span class="anchor" id="line-7-11"></span><span class="String">    (3) fibmatrix(c)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_8">   8</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_8"></span><span class="anchor" id="line-8-11"></span><span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_9">   9</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_9"></span><span class="anchor" id="line-9-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_10">  10</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_10"></span><span class="anchor" id="line-10-8"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">nm</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_11">  11</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_11"></span><span class="anchor" id="line-11-8"></span><span class="ResWord">import</span> <span class="ID">ctypes</span> <span class="ResWord">as</span> <span class="ID">ct</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_12">  12</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_12"></span><span class="anchor" id="line-12-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_13">  13</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_13"></span><span class="anchor" id="line-13-8"></span><span class="Comment"># Load the library as _libfibonacci.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_14">  14</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_14"></span><span class="anchor" id="line-14-8"></span><span class="Comment"># Why the underscore (_) in front of _libfibonacci below?</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_15">  15</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_15"></span><span class="anchor" id="line-15-7"></span><span class="Comment"># To mimimise namespace pollution -- see PEP 8 (www.python.org).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_16">  16</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_16"></span><span class="anchor" id="line-16-7"></span><span class="ID">_libfibonacci</span> = <span class="ID">nm</span>.<span class="ID">ctypeslib</span>.<span class="ID">load_library</span>(<span class="String">'</span><span class="String">libfibonacci</span><span class="String">'</span>, <span class="String">'</span><span class="String">.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_17">  17</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_17"></span><span class="anchor" id="line-17-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_18">  18</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_18"></span><span class="anchor" id="line-18-6"></span><span class="ID">_libfibonacci</span>.<span class="ID">fib</span>.<span class="ID">argtypes</span> = [<span class="ID">ct</span>.<span class="ID">c_int</span>] <span class="Comment">#  Declare arg type, same below.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_19">  19</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_19"></span><span class="anchor" id="line-19-6"></span><span class="ID">_libfibonacci</span>.<span class="ID">fib</span>.<span class="ID">restype</span>  =  <span class="ID">ct</span>.<span class="ID">c_int</span>  <span class="Comment">#  Declare result type, same below.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_20">  20</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_20"></span><span class="anchor" id="line-20-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_21">  21</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_21"></span><span class="anchor" id="line-21-5"></span><span class="ID">_libfibonacci</span>.<span class="ID">fibseries</span>.<span class="ID">argtypes</span> = [<span class="ID">nm</span>.<span class="ID">ctypeslib</span>.<span class="ID">ndpointer</span>(<span class="ID">dtype</span> = <span class="ID">nm</span>.<span class="ID">int</span>),\</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_22">  22</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_22"></span><span class="anchor" id="line-22-5"></span>                                     <span class="ID">ct</span>.<span class="ID">c_int</span>,\</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_23">  23</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_23"></span><span class="anchor" id="line-23-5"></span>                                     <span class="ID">nm</span>.<span class="ID">ctypeslib</span>.<span class="ID">ndpointer</span>(<span class="ID">dtype</span> = <span class="ID">nm</span>.<span class="ID">int</span>)]</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_24">  24</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_24"></span><span class="anchor" id="line-24-4"></span><span class="ID">_libfibonacci</span>.<span class="ID">fibseries</span>.<span class="ID">restype</span>  = <span class="ID">ct</span>.<span class="ID">c_void_p</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_25">  25</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_25"></span><span class="anchor" id="line-25-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_26">  26</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_26"></span><span class="anchor" id="line-26-4"></span><span class="ID">_libfibonacci</span>.<span class="ID">fibmatrix</span>.<span class="ID">argtypes</span> = [<span class="ID">nm</span>.<span class="ID">ctypeslib</span>.<span class="ID">ndpointer</span>(<span class="ID">dtype</span> = <span class="ID">nm</span>.<span class="ID">int</span>),\</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_27">  27</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_27"></span><span class="anchor" id="line-27-4"></span>                                     <span class="ID">ct</span>.<span class="ID">c_int</span>, <span class="ID">ct</span>.<span class="ID">c_int</span>,\</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_28">  28</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_28"></span><span class="anchor" id="line-28-4"></span>                                    <span class="ID">nm</span>.<span class="ID">ctypeslib</span>.<span class="ID">ndpointer</span>(<span class="ID">dtype</span> = <span class="ID">nm</span>.<span class="ID">int</span>)]</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_29">  29</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_29"></span><span class="anchor" id="line-29-4"></span><span class="ID">_libfibonacci</span>.<span class="ID">fibmatrix</span>.<span class="ID">restype</span>  = <span class="ID">ct</span>.<span class="ID">c_void_p</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_30">  30</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_30"></span><span class="anchor" id="line-30-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_31">  31</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_31"></span><span class="anchor" id="line-31-3"></span><span class="ResWord">def</span> <span class="ID">fib</span>(<span class="ID">a</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_32">  32</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_32"></span><span class="anchor" id="line-32-3"></span>    <span class="String">&quot;&quot;&quot;Compute the n'th Fibonacci number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_33">  33</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_33"></span><span class="anchor" id="line-33-3"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_34">  34</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_34"></span><span class="anchor" id="line-34-3"></span><span class="String">    ARGUMENT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_35">  35</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_35"></span><span class="anchor" id="line-35-3"></span><span class="String">        An integer.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_36">  36</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_36"></span><span class="anchor" id="line-36-3"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_37">  37</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_37"></span><span class="anchor" id="line-37-3"></span><span class="String">    RESULT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_38">  38</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_38"></span><span class="anchor" id="line-38-3"></span><span class="String">        The n'th Fibonacci number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_39">  39</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_39"></span><span class="anchor" id="line-39-3"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_40">  40</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_40"></span><span class="anchor" id="line-40-2"></span><span class="String">    EXAMPLE(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_41">  41</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_41"></span><span class="anchor" id="line-41-2"></span><span class="String">    &gt;&gt;&gt; fib(8)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_42">  42</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_42"></span><span class="anchor" id="line-42-1"></span><span class="String">    13</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_43">  43</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_43"></span><span class="anchor" id="line-43-1"></span><span class="String">    &gt;&gt;&gt; fib(23)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_44">  44</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_44"></span><span class="anchor" id="line-44-1"></span><span class="String">    17711</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_45">  45</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_45"></span><span class="anchor" id="line-45-1"></span><span class="String">    &gt;&gt;&gt; fib(0)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_46">  46</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_46"></span><span class="anchor" id="line-46-1"></span><span class="String">    -1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_47">  47</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_47"></span><span class="anchor" id="line-47-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_48">  48</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_48"></span><span class="anchor" id="line-48-1"></span>    <span class="ResWord">return</span> <span class="ID">_libfibonacci</span>.<span class="ID">fib</span>(<span class="ResWord">int</span>(<span class="ID">a</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_49">  49</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_49"></span><span class="anchor" id="line-49-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_50">  50</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_50"></span><span class="anchor" id="line-50-1"></span><span class="ResWord">def</span> <span class="ID">fibseries</span>(<span class="ID">b</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_51">  51</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_51"></span><span class="anchor" id="line-51-1"></span>    <span class="String">&quot;&quot;&quot;Compute an array containing the n'th Fibonacci number of each entry.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_52">  52</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_52"></span><span class="anchor" id="line-52-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_53">  53</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_53"></span><span class="anchor" id="line-53-1"></span><span class="String">    ARGUMENT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_54">  54</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_54"></span><span class="anchor" id="line-54-1"></span><span class="String">        A list or NumPy array (dim = 1) of integers.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_55">  55</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_55"></span><span class="anchor" id="line-55-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_56">  56</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_56"></span><span class="anchor" id="line-56-1"></span><span class="String">    RESULT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_57">  57</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_57"></span><span class="anchor" id="line-57-1"></span><span class="String">        NumPy array containing the n'th Fibonacci number of each entry.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_58">  58</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_58"></span><span class="anchor" id="line-58-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_59">  59</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_59"></span><span class="anchor" id="line-59-1"></span><span class="String">    EXAMPLE(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_60">  60</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_60"></span><span class="anchor" id="line-60-1"></span><span class="String">    &gt;&gt;&gt; fibseries([1,2,3,4,5,6,7,8])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_61">  61</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_61"></span><span class="anchor" id="line-61-1"></span><span class="String">    array([ 0,  1,  1,  2,  3,  5,  8, 13])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_62">  62</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_62"></span><span class="anchor" id="line-62-1"></span><span class="String">    &gt;&gt;&gt; fibseries(range(1,12))</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_63">  63</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_63"></span><span class="anchor" id="line-63-1"></span><span class="String">    array([ 0,  1,  1,  2,  3,  5,  8, 13, 21, 34, 55])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_64">  64</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_64"></span><span class="anchor" id="line-64-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_65">  65</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_65"></span><span class="anchor" id="line-65-1"></span>    <span class="ID">b</span> = <span class="ID">nm</span>.<span class="ID">asarray</span>(<span class="ID">b</span>, <span class="ID">dtype</span>=<span class="ID">nm</span>.<span class="ID">intc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_66">  66</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_66"></span><span class="anchor" id="line-66-1"></span>    <span class="ID">result</span> = <span class="ID">nm</span>.<span class="ID">empty</span>(<span class="ResWord">len</span>(<span class="ID">b</span>), <span class="ID">dtype</span>=<span class="ID">nm</span>.<span class="ID">intc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_67">  67</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_67"></span><span class="anchor" id="line-67-1"></span>    <span class="ID">_libfibonacci</span>.<span class="ID">fibseries</span>(<span class="ID">b</span>, <span class="ResWord">len</span>(<span class="ID">b</span>), <span class="ID">result</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_68">  68</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_68"></span><span class="anchor" id="line-68-1"></span>    <span class="ResWord">return</span> <span class="ID">result</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_69">  69</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_69"></span><span class="anchor" id="line-69-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_70">  70</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_70"></span><span class="anchor" id="line-70-1"></span><span class="ResWord">def</span> <span class="ID">fibmatrix</span>(<span class="ID">c</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_71">  71</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_71"></span><span class="anchor" id="line-71-1"></span>    <span class="String">&quot;&quot;&quot;Compute a matrix containing the n'th Fibonacci number of each entry.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_72">  72</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_72"></span><span class="anchor" id="line-72-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_73">  73</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_73"></span><span class="anchor" id="line-73-1"></span><span class="String">    ARGUMENT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_74">  74</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_74"></span><span class="anchor" id="line-74-1"></span><span class="String">        A nested list or NumPy array (dim = 2) of integers.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_75">  75</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_75"></span><span class="anchor" id="line-75-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_76">  76</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_76"></span><span class="anchor" id="line-76-1"></span><span class="String">    RESULT(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_77">  77</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_77"></span><span class="anchor" id="line-77-1"></span><span class="String">        NumPy array containing the n'th Fibonacci number of each entry.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_78">  78</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_78"></span><span class="anchor" id="line-78-1"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_79">  79</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_79"></span><span class="anchor" id="line-79-1"></span><span class="String">    EXAMPLE(S):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_80">  80</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_80"></span><span class="anchor" id="line-80-1"></span><span class="String">    &gt;&gt;&gt; from numpy import array</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_81">  81</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_81"></span><span class="anchor" id="line-81-1"></span><span class="String">    &gt;&gt;&gt; fibmatrix([[3,4],[5,6]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_82">  82</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_82"></span><span class="anchor" id="line-82-1"></span><span class="String">    array([[1, 2],</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_83">  83</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_83"></span><span class="anchor" id="line-83-1"></span><span class="String">           [3, 5]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_84">  84</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_84"></span><span class="anchor" id="line-84-1"></span><span class="String">    &gt;&gt;&gt; fibmatrix(array([[1,2,3],[4,5,6],[7,8,9]]))</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_85">  85</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_85"></span><span class="anchor" id="line-85-1"></span><span class="String">    array([[ 0,  1,  1],</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_86">  86</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_86"></span><span class="anchor" id="line-86-1"></span><span class="String">           [ 2,  3,  5],</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_87">  87</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_87"></span><span class="anchor" id="line-87-1"></span><span class="String">           [ 8, 13, 21]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_88">  88</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_88"></span><span class="anchor" id="line-88-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_89">  89</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_89"></span><span class="anchor" id="line-89-1"></span>    <span class="ID">tmp</span> = <span class="ID">nm</span>.<span class="ID">asarray</span>(<span class="ID">c</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_90">  90</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_90"></span><span class="anchor" id="line-90-1"></span>    <span class="ID">rows</span>, <span class="ID">cols</span> = <span class="ID">tmp</span>.<span class="ID">shape</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_91">  91</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_91"></span><span class="anchor" id="line-91-1"></span>    <span class="ID">c</span> = <span class="ID">tmp</span>.<span class="ID">astype</span>(<span class="ID">nm</span>.<span class="ID">intc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_92">  92</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_92"></span><span class="anchor" id="line-92-1"></span>    <span class="ID">result</span> = <span class="ID">nm</span>.<span class="ID">empty</span>(<span class="ID">c</span>.<span class="ID">shape</span>, <span class="ID">dtype</span>=<span class="ID">nm</span>.<span class="ID">intc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_93">  93</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_93"></span><span class="anchor" id="line-93-1"></span>    <span class="ID">_libfibonacci</span>.<span class="ID">fibmatrix</span>(<span class="ID">c</span>, <span class="ID">rows</span>, <span class="ID">cols</span>, <span class="ID">result</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_94">  94</a> </span><span class="LineAnchor" id="CA-d07d63fcb83d843dc0c41545b82d55ee8e9eca92_94"></span><span class="anchor" id="line-94-1"></span>    <span class="ResWord">return</span> <span class="ID">result</span></span>
</pre></div></div><span class="anchor" id="line-566"></span><span class="anchor" id="line-567"></span><p class="line874">Here's the SConstruct file contents (filename: SConstruct): <span class="anchor" id="line-568"></span><span class="anchor" id="line-569"></span><span class="anchor" id="line-570"></span><span class="anchor" id="line-571"></span><span class="anchor" id="line-572"></span><span class="anchor" id="line-1-39"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_1">   1</a> </span><span class="LineAnchor" id="CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_1"></span><span class="anchor" id="line-1-40"></span><span class="ID">env</span> = <span class="ID">Environment</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_2">   2</a> </span><span class="LineAnchor" id="CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_2"></span><span class="anchor" id="line-2-20"></span><span class="ID">env</span>.<span class="ID">Replace</span>(<span class="ID">CFLAGS</span>=[<span class="String">'</span><span class="String">-O2</span><span class="String">'</span>, <span class="String">'</span><span class="String">-Wall</span><span class="String">'</span>, <span class="String">'</span><span class="String">-ansi</span><span class="String">'</span>, <span class="String">'</span><span class="String">-pedantic</span><span class="String">'</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_3">   3</a> </span><span class="LineAnchor" id="CA-5dfb5f759f458f0a70d97d7835ab4d4bcbc001f2_3"></span><span class="anchor" id="line-3-19"></span><span class="ID">env</span>.<span class="ID">SharedLibrary</span>(<span class="String">'</span><span class="String">libfibonacci</span><span class="String">'</span>, [<span class="String">'</span><span class="String">fibonacci.c</span><span class="String">'</span>])</span>
</pre></div></div><span class="anchor" id="line-573"></span><span class="anchor" id="line-574"></span><p class="line874">In Python interpreter (or whatever you use), do: <span class="anchor" id="line-575"></span><span class="anchor" id="line-576"></span><span class="anchor" id="line-577"></span><span class="anchor" id="line-578"></span><span class="anchor" id="line-579"></span><span class="anchor" id="line-580"></span><span class="anchor" id="line-581"></span><pre><span class="anchor" id="line-1-3"></span>&gt;&gt;&gt; import fibonacci as fb
<span class="anchor" id="line-2-3"></span>&gt;&gt;&gt; fb.fib(8)
<span class="anchor" id="line-3-3"></span>13
<span class="anchor" id="line-4-3"></span>&gt;&gt;&gt; fb.fibseries([5,13,2,6]
<span class="anchor" id="line-5-3"></span>array([  3, 144,   1,   5])</pre><span class="anchor" id="line-582"></span><span class="anchor" id="line-583"></span><p class="line874">etc. <span class="anchor" id="line-584"></span><span class="anchor" id="line-585"></span><p class="line867">
<h1 id="Pertinent_Mailing_List_Threads">Pertinent Mailing List Threads</h1>
<span class="anchor" id="line-586"></span><span class="anchor" id="line-587"></span><p class="line874">Some useful threads on the ctypes-users mailing list: <span class="anchor" id="line-588"></span><span class="anchor" id="line-589"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://aspn.activestate.com/ASPN/Mail/Message/ctypes-users/3119087">IndexError when indexing on POINTER(POINTER(ctype))</a> <span class="anchor" id="line-590"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://aspn.activestate.com/ASPN/Mail/Message/ctypes-users/3118513">Adding ctypes support to NumPy</a> <span class="anchor" id="line-591"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://aspn.activestate.com/ASPN/Mail/Message/ctypes-users/3118656">Determining if a ctype is a pointer type (was RE: Adding ctypes support to NumPy)</a> <span class="anchor" id="line-592"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://aspn.activestate.com/ASPN/Mail/Message/ctypes-users/3117306">Check for NULL pointer without ValueError</a> <span class="anchor" id="line-593"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://aspn.activestate.com/ASPN/Mail/Message/ctypes-users/3205951">Problem with callbacks from C into Python</a> <span class="anchor" id="line-594"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.numeric.general/7418/">ctypes and ndpointer</a> <span class="anchor" id="line-595"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://thread.gmane.org/gmane.comp.python.ctypes/3116">Problems with 64 signed integer</a> <span class="anchor" id="line-596"></span><span class="anchor" id="line-597"></span></li></ul><p class="line874">Thomas Heller's answers are particularly insightful. <span class="anchor" id="line-598"></span><span class="anchor" id="line-599"></span><p class="line867">
<h1 id="Documentation">Documentation</h1>
<span class="anchor" id="line-600"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://starship.python.net/crew/theller/ctypes/tutorial.html">ctypes tutorial</a> <span class="anchor" id="line-601"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://docs.python.org/dev/lib/module-ctypes.html">13.14 ctypes -- A foreign function library for Python.</a> <span class="anchor" id="line-602"></span><span class="anchor" id="line-603"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-604"></span><a href="../CategoryCookbook.html">CategoryCookbook</a> <a href="../CategoryCookbook.html">CategoryCookbook</a> <span class="anchor" id="line-605"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Ctypes37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/Ctypes">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/Cookbook/Ctypes?action=recoverpass by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:03 GMT -->
</html>

