<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/Cookbook/SavitzkyGolay by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:22:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="index,nofollow">

<title>Cookbook/SavitzkyGolay - SciPy</title>
<script type="text/javascript" src="../moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: Cookbook/SavitzkyGolay" href="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Cookbook%2FSavitzkyGolay&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="../AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay?action=print">
<link rel="Up" href="../Cookbook.html">
<link rel="Appendix" title="Original+noise+filtered.pdf" href="SavitzkyGolay7ad3.html?action=AttachFile&amp;do=view&amp;target=Original%2Bnoise%2Bfiltered.pdf">
<link rel="Appendix" title="Original+noise.pdf" href="SavitzkyGolay9775.html?action=AttachFile&amp;do=view&amp;target=Original%2Bnoise.pdf">
<link rel="Appendix" title="Original.pdf" href="SavitzkyGolay667b.html?action=AttachFile&amp;do=view&amp;target=Original.pdf">
<link rel="Appendix" title="cd_spec.png" href="SavitzkyGolay5829.html?action=AttachFile&amp;do=view&amp;target=cd_spec.png">
<link rel="Appendix" title="original+noise+filtered.pdf" href="SavitzkyGolayc19b.html?action=AttachFile&amp;do=view&amp;target=original%2Bnoise%2Bfiltered.pdf">
<link rel="Appendix" title="original+noise.pdf" href="SavitzkyGolay7d85.html?action=AttachFile&amp;do=view&amp;target=original%2Bnoise.pdf">
<link rel="Appendix" title="original.pdf" href="SavitzkyGolay75d7.html?action=AttachFile&amp;do=view&amp;target=original.pdf">
<link rel="Search" href="../FindPage.html">
<link rel="Index" href="../TitleIndex.html">
<link rel="Glossary" href="../WordIndex.html">
<link rel="Help" href="../HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr">

<div id="header">


<form id="searchform" method="get" action="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="SavitzkyGolay456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="../AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a href="../Cookbook.html">Cookbook</a></li><li><a class="backlink" href="SavitzkyGolay5d40.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22Cookbook%2FSavitzkyGolay%22" rel="nofollow" title="Click to do a full-text search for this title">SavitzkyGolay</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="../RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="../FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="../HelpContents.html">HelpContents</a></li><li class="current"><a href="SavitzkyGolay.html">Cookbook/SavitzkyGolay</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="SavitzkyGolay37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="Savitzky_Golay_Filtering">Savitzky Golay Filtering</h1>
<span class="anchor" id="line-2"></span><p class="line862">The Savitzky Golay filter is a particular type of low-pass filter, well adapted for data smoothing. For further information see: <a class="http" href="../../external.html?link=http://www.wire.tu-bs.de/OLDWEB/mameyer/cmr/savgol.pdf">http://www.wire.tu-bs.de/OLDWEB/mameyer/cmr/savgol.pdf</a> (or <a class="http" href="../../external.html?link=http://www.dalkescientific.com/writings/NBN/data/savitzky_golay.py">http://www.dalkescientific.com/writings/NBN/data/savitzky_golay.py</a> for a pre-numpy implementation). <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867">
<h2 id="Sample_Code">Sample Code</h2>
<span class="anchor" id="line-5"></span><p class="line867"><span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-c19b68915bad91da540301a14195b703a80afdd6\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-c19b68915bad91da540301a14195b703a80afdd6" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_1">   1</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_1"></span><span class="anchor" id="line-1-2"></span><span class="ResWord">def</span> <span class="ID">savitzky_golay</span>(<span class="ID">y</span>, <span class="ID">window_size</span>, <span class="ID">order</span>, <span class="ID">deriv</span>=<span class="Number">0</span>, <span class="ID">rate</span>=<span class="Number">1</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_2">   2</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_2"></span><span class="anchor" id="line-2-1"></span>    <span class="String">r&quot;&quot;&quot;Smooth (and optionally differentiate) data with a Savitzky-Golay filter.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_3">   3</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_3"></span><span class="anchor" id="line-3-1"></span><span class="String">    The Savitzky-Golay filter removes high frequency noise from data.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_4">   4</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_4"></span><span class="anchor" id="line-4-1"></span><span class="String">    It has the advantage of preserving the original shape and</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_5">   5</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_5"></span><span class="anchor" id="line-5-1"></span><span class="String">    features of the signal better than other types of filtering</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_6">   6</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_6"></span><span class="anchor" id="line-6-1"></span><span class="String">    approaches, such as moving averages techniques.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_7">   7</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_7"></span><span class="anchor" id="line-7-1"></span><span class="String">    Parameters</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_8">   8</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_8"></span><span class="anchor" id="line-8-1"></span><span class="String">    ----------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_9">   9</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_9"></span><span class="anchor" id="line-9-1"></span><span class="String">    y : array_like, shape (N,)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_10">  10</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_10"></span><span class="anchor" id="line-10-1"></span><span class="String">        the values of the time history of the signal.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_11">  11</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_11"></span><span class="anchor" id="line-11-1"></span><span class="String">    window_size : int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_12">  12</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_12"></span><span class="anchor" id="line-12-1"></span><span class="String">        the length of the window. Must be an odd integer number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_13">  13</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_13"></span><span class="anchor" id="line-13-1"></span><span class="String">    order : int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_14">  14</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_14"></span><span class="anchor" id="line-14-1"></span><span class="String">        the order of the polynomial used in the filtering.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_15">  15</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_15"></span><span class="anchor" id="line-15-1"></span><span class="String">        Must be less then `window_size` - 1.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_16">  16</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_16"></span><span class="anchor" id="line-16-1"></span><span class="String">    deriv: int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_17">  17</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_17"></span><span class="anchor" id="line-17-1"></span><span class="String">        the order of the derivative to compute (default = 0 means only smoothing)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_18">  18</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_18"></span><span class="anchor" id="line-18-1"></span><span class="String">    Returns</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_19">  19</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_19"></span><span class="anchor" id="line-19-1"></span><span class="String">    -------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_20">  20</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_20"></span><span class="anchor" id="line-20-1"></span><span class="String">    ys : ndarray, shape (N)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_21">  21</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_21"></span><span class="anchor" id="line-21-1"></span><span class="String">        the smoothed signal (or it's n-th derivative).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_22">  22</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_22"></span><span class="anchor" id="line-22-1"></span><span class="String">    Notes</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_23">  23</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_23"></span><span class="anchor" id="line-23-1"></span><span class="String">    -----</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_24">  24</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_24"></span><span class="anchor" id="line-24-1"></span><span class="String">    The Savitzky-Golay is a type of low-pass filter, particularly</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_25">  25</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_25"></span><span class="anchor" id="line-25-1"></span><span class="String">    suited for smoothing noisy data. The main idea behind this</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_26">  26</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_26"></span><span class="anchor" id="line-26-1"></span><span class="String">    approach is to make for each point a least-square fit with a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_27">  27</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_27"></span><span class="anchor" id="line-27-1"></span><span class="String">    polynomial of high order over a odd-sized window centered at</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_28">  28</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_28"></span><span class="anchor" id="line-28-1"></span><span class="String">    the point.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_29">  29</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_29"></span><span class="anchor" id="line-29-1"></span><span class="String">    Examples</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_30">  30</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_30"></span><span class="anchor" id="line-30-1"></span><span class="String">    --------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_31">  31</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_31"></span><span class="anchor" id="line-31-1"></span><span class="String">    t = np.linspace(-4, 4, 500)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_32">  32</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_32"></span><span class="anchor" id="line-32-1"></span><span class="String">    y = np.exp( -t**2 ) + np.random.normal(0, 0.05, t.shape)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_33">  33</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_33"></span><span class="anchor" id="line-33-1"></span><span class="String">    ysg = savitzky_golay(y, window_size=31, order=4)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_34">  34</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_34"></span><span class="anchor" id="line-34-1"></span><span class="String">    import matplotlib.pyplot as plt</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_35">  35</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_35"></span><span class="anchor" id="line-35-1"></span><span class="String">    plt.plot(t, y, label='Noisy signal')</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_36">  36</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_36"></span><span class="anchor" id="line-36-1"></span><span class="String">    plt.plot(t, np.exp(-t**2), 'k', lw=1.5, label='Original signal')</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_37">  37</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_37"></span><span class="anchor" id="line-37-1"></span><span class="String">    plt.plot(t, ysg, 'r', label='Filtered signal')</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_38">  38</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_38"></span><span class="anchor" id="line-38-1"></span><span class="String">    plt.legend()</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_39">  39</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_39"></span><span class="anchor" id="line-39-1"></span><span class="String">    plt.show()</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_40">  40</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_40"></span><span class="anchor" id="line-40-1"></span><span class="String">    References</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_41">  41</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_41"></span><span class="anchor" id="line-41-1"></span><span class="String">    ----------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_42">  42</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_42"></span><span class="anchor" id="line-42-1"></span><span class="String">    .. [1] A. Savitzky, M. J. E. Golay, Smoothing and Differentiation of</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_43">  43</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_43"></span><span class="anchor" id="line-43-1"></span><span class="String">       Data by Simplified Least Squares Procedures. Analytical</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_44">  44</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_44"></span><span class="anchor" id="line-44-1"></span><span class="String">       Chemistry, 1964, 36 (8), pp 1627-1639.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_45">  45</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_45"></span><span class="anchor" id="line-45-1"></span><span class="String">    .. [2] Numerical Recipes 3rd Edition: The Art of Scientific Computing</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_46">  46</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_46"></span><span class="anchor" id="line-46-1"></span><span class="String">       W.H. Press, S.A. Teukolsky, W.T. Vetterling, B.P. Flannery</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_47">  47</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_47"></span><span class="anchor" id="line-47-1"></span><span class="String">       Cambridge University Press ISBN-13: 9780521880688</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_48">  48</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_48"></span><span class="anchor" id="line-48-1"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_49">  49</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_49"></span><span class="anchor" id="line-49-1"></span>    <span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">np</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_50">  50</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_50"></span><span class="anchor" id="line-50-1"></span>    <span class="ResWord">from</span> <span class="ID">math</span> <span class="ResWord">import</span> <span class="ID">factorial</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_51">  51</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_51"></span><span class="anchor" id="line-51-1"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_52">  52</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_52"></span><span class="anchor" id="line-52-1"></span>    <span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_53">  53</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_53"></span><span class="anchor" id="line-53-1"></span>        <span class="ID">window_size</span> = <span class="ID">np</span>.<span class="ID">abs</span>(<span class="ID">np</span>.<span class="ID">int</span>(<span class="ID">window_size</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_54">  54</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_54"></span><span class="anchor" id="line-54-1"></span>        <span class="ID">order</span> = <span class="ID">np</span>.<span class="ID">abs</span>(<span class="ID">np</span>.<span class="ID">int</span>(<span class="ID">order</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_55">  55</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_55"></span><span class="anchor" id="line-55-1"></span>    <span class="ResWord">except</span> <span class="ID">ValueError</span>, <span class="ID">msg</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_56">  56</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_56"></span><span class="anchor" id="line-56-1"></span>        <span class="ResWord">raise</span> <span class="ID">ValueError</span>(<span class="String">&quot;</span><span class="String">window_size and order have to be of type int</span><span class="String">&quot;</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_57">  57</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_57"></span><span class="anchor" id="line-57-1"></span>    <span class="ResWord">if</span> <span class="ID">window_size</span> % <span class="Number">2</span> != <span class="Number">1</span> <span class="ResWord">or</span> <span class="ID">window_size</span> &lt; <span class="Number">1</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_58">  58</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_58"></span><span class="anchor" id="line-58-1"></span>        <span class="ResWord">raise</span> <span class="ID">TypeError</span>(<span class="String">&quot;</span><span class="String">window_size size must be a positive odd number</span><span class="String">&quot;</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_59">  59</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_59"></span><span class="anchor" id="line-59-1"></span>    <span class="ResWord">if</span> <span class="ID">window_size</span> &lt; <span class="ID">order</span> + <span class="Number">2</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_60">  60</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_60"></span><span class="anchor" id="line-60-1"></span>        <span class="ResWord">raise</span> <span class="ID">TypeError</span>(<span class="String">&quot;</span><span class="String">window_size is too small for the polynomials order</span><span class="String">&quot;</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_61">  61</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_61"></span><span class="anchor" id="line-61-1"></span>    <span class="ID">order_range</span> = <span class="ResWord">range</span>(<span class="ID">order</span>+<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_62">  62</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_62"></span><span class="anchor" id="line-62-1"></span>    <span class="ID">half_window</span> = (<span class="ID">window_size</span> -<span class="Number">1</span>) // <span class="Number">2</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_63">  63</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_63"></span><span class="anchor" id="line-63-1"></span>    <span class="Comment"># precompute coefficients</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_64">  64</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_64"></span><span class="anchor" id="line-64-1"></span>    <span class="ID">b</span> = <span class="ID">np</span>.<span class="ID">mat</span>([[<span class="ID">k</span>**<span class="ID">i</span> <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ID">order_range</span>] <span class="ResWord">for</span> <span class="ID">k</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(-<span class="ID">half_window</span>, <span class="ID">half_window</span>+<span class="Number">1</span>)])</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_65">  65</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_65"></span><span class="anchor" id="line-65-1"></span>    <span class="ID">m</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">b</span>).<span class="ID">A</span>[<span class="ID">deriv</span>] * <span class="ID">rate</span>**<span class="ID">deriv</span> * <span class="ID">factorial</span>(<span class="ID">deriv</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_66">  66</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_66"></span><span class="anchor" id="line-66-1"></span>    <span class="Comment"># pad the signal at the extremes with</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_67">  67</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_67"></span><span class="anchor" id="line-67-1"></span>    <span class="Comment"># values taken from the signal itself</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_68">  68</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_68"></span><span class="anchor" id="line-68-1"></span>    <span class="ID">firstvals</span> = <span class="ID">y</span>[<span class="Number">0</span>] - <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">y</span>[<span class="Number">1</span>:<span class="ID">half_window</span>+<span class="Number">1</span>][::-<span class="Number">1</span>] - <span class="ID">y</span>[<span class="Number">0</span>] )</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_69">  69</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_69"></span><span class="anchor" id="line-69-1"></span>    <span class="ID">lastvals</span> = <span class="ID">y</span>[-<span class="Number">1</span>] + <span class="ID">np</span>.<span class="ID">abs</span>(<span class="ID">y</span>[-<span class="ID">half_window</span>-<span class="Number">1</span>:-<span class="Number">1</span>][::-<span class="Number">1</span>] - <span class="ID">y</span>[-<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_70">  70</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_70"></span><span class="anchor" id="line-70-1"></span>    <span class="ID">y</span> = <span class="ID">np</span>.<span class="ID">concatenate</span>((<span class="ID">firstvals</span>, <span class="ID">y</span>, <span class="ID">lastvals</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-c19b68915bad91da540301a14195b703a80afdd6_71">  71</a> </span><span class="LineAnchor" id="CA-c19b68915bad91da540301a14195b703a80afdd6_71"></span><span class="anchor" id="line-71-1"></span>    <span class="ResWord">return</span> <span class="ID">np</span>.<span class="ID">convolve</span>( <span class="ID">m</span>[::-<span class="Number">1</span>], <span class="ID">y</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>)</span>
</pre></div></div><span class="anchor" id="line-79"></span><p class="line867">
<h2 id="Code_explanation">Code explanation</h2>
<span class="anchor" id="line-80"></span><p class="line874">In lines 61-62 the coefficients of the local least-square polynomial fit are pre-computed. These will be used later at line 68, where they will be correlated with the signal. To prevent spurious results at the extremes of the data, the signal is padded at both ends with its mirror image, (lines 65-67). <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line867">
<h2 id="Figure">Figure</h2>
<span class="anchor" id="line-83"></span><p class="line867"><img alt="cd_spec.png" class="attachment" src="cd_specd934.png?action=AttachFile&amp;do=get&amp;target=cd_spec.png" title="cd_spec.png" /> <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line874">CD-spectrum of a protein. Black: raw data. Red: filter applied <span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><p class="line867">
<h2 id="A_wrapper_for_cyclic_voltammetry_data">A wrapper for cyclic voltammetry data</h2>
<span class="anchor" id="line-88"></span><p class="line874">One of the most popular applications of S-G filter, apart from smoothing UV-VIS and IR spectra, is smoothing of curves obtained in electroanalytical experiments. In cyclic voltammetry, voltage (being the abcissa) changes like a triangle wave. And in the signal there are cusps at the turning points (at switching potentials) which should never be smoothed. In this case, Savitzky-Golay smoothing should be done piecewise, ie. separately on pieces monotonic in x: <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line867"><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-b5086c731a225a8bdd370c8e4a8f9b9dbfffb003" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="ResWord">def</span> <span class="ID">savitzky_golay_piecewise</span>(<span class="ID">xvals</span>, <span class="ID">data</span>, <span class="ID">kernel</span>=<span class="Number">11</span>, <span class="ID">order</span> =<span class="Number">4</span>):</span>
<span class="line"><span class="anchor" id="line-2-2"></span>    <span class="ID">turnpoint</span>=<span class="Number">0</span></span>
<span class="line"><span class="anchor" id="line-3-2"></span>    <span class="ID">last</span>=<span class="ResWord">len</span>(<span class="ID">xvals</span>)</span>
<span class="line"><span class="anchor" id="line-4-2"></span>    <span class="ResWord">if</span> <span class="ID">xvals</span>[<span class="Number">1</span>]&gt;<span class="ID">xvals</span>[<span class="Number">0</span>] : <span class="Comment">#x is increasing?</span></span>
<span class="line"><span class="anchor" id="line-5-2"></span>        <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="Number">1</span>,<span class="ID">last</span>) : <span class="Comment">#yes</span></span>
<span class="line"><span class="anchor" id="line-6-2"></span>            <span class="ResWord">if</span> <span class="ID">xvals</span>[<span class="ID">i</span>]&lt;<span class="ID">xvals</span>[<span class="ID">i</span>-<span class="Number">1</span>] : <span class="Comment">#search where x starts to fall</span></span>
<span class="line"><span class="anchor" id="line-7-2"></span>                <span class="ID">turnpoint</span>=<span class="ID">i</span></span>
<span class="line"><span class="anchor" id="line-8-2"></span>                <span class="ResWord">break</span></span>
<span class="line"><span class="anchor" id="line-9-2"></span>    <span class="ResWord">else</span>: <span class="Comment">#no, x is decreasing</span></span>
<span class="line"><span class="anchor" id="line-10-2"></span>        <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="Number">1</span>,<span class="ID">last</span>) : <span class="Comment">#search where it starts to rise</span></span>
<span class="line"><span class="anchor" id="line-11-2"></span>            <span class="ResWord">if</span> <span class="ID">xvals</span>[<span class="ID">i</span>]&gt;<span class="ID">xvals</span>[<span class="ID">i</span>-<span class="Number">1</span>] :</span>
<span class="line"><span class="anchor" id="line-12-2"></span>                <span class="ID">turnpoint</span>=<span class="ID">i</span></span>
<span class="line"><span class="anchor" id="line-13-2"></span>                <span class="ResWord">break</span></span>
<span class="line"><span class="anchor" id="line-14-2"></span>    <span class="ResWord">if</span> <span class="ID">turnpoint</span>==<span class="Number">0</span> : <span class="Comment">#no change in direction of x</span></span>
<span class="line"><span class="anchor" id="line-15-2"></span>        <span class="ResWord">return</span> <span class="ID">savitzky_golay</span>(<span class="ID">data</span>, <span class="ID">kernel</span>, <span class="ID">order</span>)</span>
<span class="line"><span class="anchor" id="line-16-2"></span>    <span class="ResWord">else</span>:</span>
<span class="line"><span class="anchor" id="line-17-2"></span>        <span class="Comment">#smooth the first piece</span></span>
<span class="line"><span class="anchor" id="line-18-2"></span>        <span class="ID">firstpart</span>=<span class="ID">savitzky_golay</span>(<span class="ID">data</span>[<span class="Number">0</span>:<span class="ID">turnpoint</span>],<span class="ID">kernel</span>,<span class="ID">order</span>)</span>
<span class="line"><span class="anchor" id="line-19-2"></span>        <span class="Comment">#recursively smooth the rest</span></span>
<span class="line"><span class="anchor" id="line-20-2"></span>        <span class="ID">rest</span>=<span class="ID">savitzky_golay_piecewise</span>(<span class="ID">xvals</span>[<span class="ID">turnpoint</span>:], <span class="ID">data</span>[<span class="ID">turnpoint</span>:], <span class="ID">kernel</span>, <span class="ID">order</span>)</span>
<span class="line"><span class="anchor" id="line-21-2"></span>        <span class="ResWord">return</span> <span class="ID">numpy</span>.<span class="ID">concatenate</span>((<span class="ID">firstpart</span>,<span class="ID">rest</span>))</span>
</pre></div></div><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><p class="line867">
<h2 id="Two_dimensional_data_smoothing_and_least-square_gradient_estimate">Two dimensional data smoothing and least-square gradient estimate</h2>
<span class="anchor" id="line-116"></span><p class="line874">Savitsky-Golay filters can also be used to smooth two dimensional data affected by noise.  <span class="anchor" id="line-117"></span>The algorithm is exactly the same as for the one dimensional case, only the math is a bit more tricky. The basic algorithm is as follow:  <span class="anchor" id="line-118"></span><ol type="1"><li>for each point of the two dimensional matrix extract a sub-matrix, centered at that point and with a size equal to an odd number &quot;window_size&quot;. <span class="anchor" id="line-119"></span></li><li>for this sub-matrix compute a least-square fit of a polynomial surface, defined as  <span class="anchor" id="line-120"></span><p class="line862">p(x,y) =  a0 + a1*x + a2*y + a3*x<sup>2 + a4*y</sup>2 + a5*x*y + ... . <span class="anchor" id="line-121"></span>Note that x and y are equal to zero at the central point. <span class="anchor" id="line-122"></span></li><li>replace the initial central point with the value computed with the fit. <span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span></li></ol><p class="line874">Note that because the fit coefficients are linear with respect to the data spacing, they can pre-computed for efficiency. Moreover, it is important to appropriately pad the borders of the data, with a mirror image of the data itself, so that the evaluation of the fit at the borders of the data can happen smoothly. <span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line874">Here is the code for two dimensional filtering. <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-23cdec12c63b908e1fabb29e00a71df9be8affa1\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_1">   1</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_1"></span><span class="anchor" id="line-1-6"></span><span class="ResWord">def</span> <span class="ID">sgolay2d</span> ( <span class="ID">z</span>, <span class="ID">window_size</span>, <span class="ID">order</span>, <span class="ID">derivative</span>=<span class="ResWord">None</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_2">   2</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_2"></span><span class="anchor" id="line-2-3"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_3">   3</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_3"></span><span class="anchor" id="line-3-3"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_4">   4</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_4"></span><span class="anchor" id="line-4-3"></span>    <span class="Comment"># number of terms in the polynomial expression</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_5">   5</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_5"></span><span class="anchor" id="line-5-3"></span>    <span class="ID">n_terms</span> = ( <span class="ID">order</span> + <span class="Number">1</span> ) * ( <span class="ID">order</span> + <span class="Number">2</span>)  / <span class="Number">2.0</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_6">   6</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_6"></span><span class="anchor" id="line-6-3"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_7">   7</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_7"></span><span class="anchor" id="line-7-3"></span>    <span class="ResWord">if</span>  <span class="ID">window_size</span> % <span class="Number">2</span> == <span class="Number">0</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_8">   8</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_8"></span><span class="anchor" id="line-8-3"></span>        <span class="ResWord">raise</span> <span class="ID">ValueError</span>(<span class="String">'</span><span class="String">window_size must be odd</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_9">   9</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_9"></span><span class="anchor" id="line-9-3"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_10">  10</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_10"></span><span class="anchor" id="line-10-3"></span>    <span class="ResWord">if</span> <span class="ID">window_size</span>**<span class="Number">2</span> &lt; <span class="ID">n_terms</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_11">  11</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_11"></span><span class="anchor" id="line-11-3"></span>        <span class="ResWord">raise</span> <span class="ID">ValueError</span>(<span class="String">'</span><span class="String">order is too high for the window size</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_12">  12</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_12"></span><span class="anchor" id="line-12-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_13">  13</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_13"></span><span class="anchor" id="line-13-3"></span>    <span class="ID">half_size</span> = <span class="ID">window_size</span> // <span class="Number">2</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_14">  14</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_14"></span><span class="anchor" id="line-14-3"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_15">  15</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_15"></span><span class="anchor" id="line-15-3"></span>    <span class="Comment"># exponents of the polynomial. </span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_16">  16</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_16"></span><span class="anchor" id="line-16-3"></span>    <span class="Comment"># p(x,y) = a0 + a1*x + a2*y + a3*x^2 + a4*y^2 + a5*x*y + ... </span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_17">  17</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_17"></span><span class="anchor" id="line-17-3"></span>    <span class="Comment"># this line gives a list of two item tuple. Each tuple contains </span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_18">  18</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_18"></span><span class="anchor" id="line-18-3"></span>    <span class="Comment"># the exponents of the k-th term. First element of tuple is for x</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_19">  19</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_19"></span><span class="anchor" id="line-19-3"></span>    <span class="Comment"># second element for y.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_20">  20</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_20"></span><span class="anchor" id="line-20-3"></span>    <span class="Comment"># Ex. exps = [(0,0), (1,0), (0,1), (2,0), (1,1), (0,2), ...]</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_21">  21</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_21"></span><span class="anchor" id="line-21-3"></span>    <span class="ID">exps</span> = [ (<span class="ID">k</span>-<span class="ID">n</span>, <span class="ID">n</span>) <span class="ResWord">for</span> <span class="ID">k</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">order</span>+<span class="Number">1</span>) <span class="ResWord">for</span> <span class="ID">n</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">k</span>+<span class="Number">1</span>) ]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_22">  22</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_22"></span><span class="anchor" id="line-22-2"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_23">  23</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_23"></span><span class="anchor" id="line-23-2"></span>    <span class="Comment"># coordinates of points</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_24">  24</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_24"></span><span class="anchor" id="line-24-2"></span>    <span class="ID">ind</span> = <span class="ID">np</span>.<span class="ID">arange</span>(-<span class="ID">half_size</span>, <span class="ID">half_size</span>+<span class="Number">1</span>, <span class="ID">dtype</span>=<span class="ID">np</span>.<span class="ID">float64</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_25">  25</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_25"></span><span class="anchor" id="line-25-2"></span>    <span class="ID">dx</span> = <span class="ID">np</span>.<span class="ID">repeat</span>( <span class="ID">ind</span>, <span class="ID">window_size</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_26">  26</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_26"></span><span class="anchor" id="line-26-2"></span>    <span class="ID">dy</span> = <span class="ID">np</span>.<span class="ID">tile</span>( <span class="ID">ind</span>, [<span class="ID">window_size</span>, <span class="Number">1</span>]).<span class="ID">reshape</span>(<span class="ID">window_size</span>**<span class="Number">2</span>, )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_27">  27</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_27"></span><span class="anchor" id="line-27-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_28">  28</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_28"></span><span class="anchor" id="line-28-2"></span>    <span class="Comment"># build matrix of system of equation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_29">  29</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_29"></span><span class="anchor" id="line-29-2"></span>    <span class="ID">A</span> = <span class="ID">np</span>.<span class="ID">empty</span>( (<span class="ID">window_size</span>**<span class="Number">2</span>, <span class="ResWord">len</span>(<span class="ID">exps</span>)) )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_30">  30</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_30"></span><span class="anchor" id="line-30-2"></span>    <span class="ResWord">for</span> <span class="ID">i</span>, <span class="ID">exp</span> <span class="ResWord">in</span> <span class="ResWord">enumerate</span>( <span class="ID">exps</span> ):</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_31">  31</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_31"></span><span class="anchor" id="line-31-2"></span>        <span class="ID">A</span>[:,<span class="ID">i</span>] = (<span class="ID">dx</span>**<span class="ID">exp</span>[<span class="Number">0</span>]) * (<span class="ID">dy</span>**<span class="ID">exp</span>[<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_32">  32</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_32"></span><span class="anchor" id="line-32-2"></span>        </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_33">  33</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_33"></span><span class="anchor" id="line-33-2"></span>    <span class="Comment"># pad input array with appropriate values at the four borders</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_34">  34</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_34"></span><span class="anchor" id="line-34-2"></span>    <span class="ID">new_shape</span> = <span class="ID">z</span>.<span class="ID">shape</span>[<span class="Number">0</span>] + <span class="Number">2</span>*<span class="ID">half_size</span>, <span class="ID">z</span>.<span class="ID">shape</span>[<span class="Number">1</span>] + <span class="Number">2</span>*<span class="ID">half_size</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_35">  35</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_35"></span><span class="anchor" id="line-35-2"></span>    <span class="ID">Z</span> = <span class="ID">np</span>.<span class="ID">zeros</span>( (<span class="ID">new_shape</span>) )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_36">  36</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_36"></span><span class="anchor" id="line-36-2"></span>    <span class="Comment"># top band</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_37">  37</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_37"></span><span class="anchor" id="line-37-2"></span>    <span class="ID">band</span> = <span class="ID">z</span>[<span class="Number">0</span>, :]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_38">  38</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_38"></span><span class="anchor" id="line-38-2"></span>    <span class="ID">Z</span>[:<span class="ID">half_size</span>, <span class="ID">half_size</span>:-<span class="ID">half_size</span>] =  <span class="ID">band</span> -  <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">flipud</span>( <span class="ID">z</span>[<span class="Number">1</span>:<span class="ID">half_size</span>+<span class="Number">1</span>, :] ) - <span class="ID">band</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_39">  39</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_39"></span><span class="anchor" id="line-39-2"></span>    <span class="Comment"># bottom band</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_40">  40</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_40"></span><span class="anchor" id="line-40-2"></span>    <span class="ID">band</span> = <span class="ID">z</span>[-<span class="Number">1</span>, :]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_41">  41</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_41"></span><span class="anchor" id="line-41-2"></span>    <span class="ID">Z</span>[-<span class="ID">half_size</span>:, <span class="ID">half_size</span>:-<span class="ID">half_size</span>] = <span class="ID">band</span>  + <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">flipud</span>( <span class="ID">z</span>[-<span class="ID">half_size</span>-<span class="Number">1</span>:-<span class="Number">1</span>, :] )  -<span class="ID">band</span> ) </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_42">  42</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_42"></span><span class="anchor" id="line-42-2"></span>    <span class="Comment"># left band</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_43">  43</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_43"></span><span class="anchor" id="line-43-2"></span>    <span class="ID">band</span> = <span class="ID">np</span>.<span class="ID">tile</span>( <span class="ID">z</span>[:,<span class="Number">0</span>].<span class="ID">reshape</span>(-<span class="Number">1</span>,<span class="Number">1</span>), [<span class="Number">1</span>,<span class="ID">half_size</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_44">  44</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_44"></span><span class="anchor" id="line-44-2"></span>    <span class="ID">Z</span>[<span class="ID">half_size</span>:-<span class="ID">half_size</span>, :<span class="ID">half_size</span>] = <span class="ID">band</span> - <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">fliplr</span>( <span class="ID">z</span>[:, <span class="Number">1</span>:<span class="ID">half_size</span>+<span class="Number">1</span>] ) - <span class="ID">band</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_45">  45</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_45"></span><span class="anchor" id="line-45-2"></span>    <span class="Comment"># right band</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_46">  46</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_46"></span><span class="anchor" id="line-46-2"></span>    <span class="ID">band</span> = <span class="ID">np</span>.<span class="ID">tile</span>( <span class="ID">z</span>[:,-<span class="Number">1</span>].<span class="ID">reshape</span>(-<span class="Number">1</span>,<span class="Number">1</span>), [<span class="Number">1</span>,<span class="ID">half_size</span>] )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_47">  47</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_47"></span><span class="anchor" id="line-47-2"></span>    <span class="ID">Z</span>[<span class="ID">half_size</span>:-<span class="ID">half_size</span>, -<span class="ID">half_size</span>:] =  <span class="ID">band</span> + <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">fliplr</span>( <span class="ID">z</span>[:, -<span class="ID">half_size</span>-<span class="Number">1</span>:-<span class="Number">1</span>] ) - <span class="ID">band</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_48">  48</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_48"></span><span class="anchor" id="line-48-2"></span>    <span class="Comment"># central band</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_49">  49</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_49"></span><span class="anchor" id="line-49-2"></span>    <span class="ID">Z</span>[<span class="ID">half_size</span>:-<span class="ID">half_size</span>, <span class="ID">half_size</span>:-<span class="ID">half_size</span>] = <span class="ID">z</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_50">  50</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_50"></span><span class="anchor" id="line-50-2"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_51">  51</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_51"></span><span class="anchor" id="line-51-2"></span>    <span class="Comment"># top left corner</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_52">  52</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_52"></span><span class="anchor" id="line-52-2"></span>    <span class="ID">band</span> = <span class="ID">z</span>[<span class="Number">0</span>,<span class="Number">0</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_53">  53</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_53"></span><span class="anchor" id="line-53-2"></span>    <span class="ID">Z</span>[:<span class="ID">half_size</span>,:<span class="ID">half_size</span>] = <span class="ID">band</span> - <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">flipud</span>(<span class="ID">np</span>.<span class="ID">fliplr</span>(<span class="ID">z</span>[<span class="Number">1</span>:<span class="ID">half_size</span>+<span class="Number">1</span>,<span class="Number">1</span>:<span class="ID">half_size</span>+<span class="Number">1</span>]) ) - <span class="ID">band</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_54">  54</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_54"></span><span class="anchor" id="line-54-2"></span>    <span class="Comment"># bottom right corner</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_55">  55</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_55"></span><span class="anchor" id="line-55-2"></span>    <span class="ID">band</span> = <span class="ID">z</span>[-<span class="Number">1</span>,-<span class="Number">1</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_56">  56</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_56"></span><span class="anchor" id="line-56-2"></span>    <span class="ID">Z</span>[-<span class="ID">half_size</span>:,-<span class="ID">half_size</span>:] = <span class="ID">band</span> + <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">flipud</span>(<span class="ID">np</span>.<span class="ID">fliplr</span>(<span class="ID">z</span>[-<span class="ID">half_size</span>-<span class="Number">1</span>:-<span class="Number">1</span>,-<span class="ID">half_size</span>-<span class="Number">1</span>:-<span class="Number">1</span>]) ) - <span class="ID">band</span> ) </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_57">  57</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_57"></span><span class="anchor" id="line-57-2"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_58">  58</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_58"></span><span class="anchor" id="line-58-2"></span>    <span class="Comment"># top right corner</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_59">  59</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_59"></span><span class="anchor" id="line-59-2"></span>    <span class="ID">band</span> = <span class="ID">Z</span>[<span class="ID">half_size</span>,-<span class="ID">half_size</span>:]</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_60">  60</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_60"></span><span class="anchor" id="line-60-2"></span>    <span class="ID">Z</span>[:<span class="ID">half_size</span>,-<span class="ID">half_size</span>:] = <span class="ID">band</span> - <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">flipud</span>(<span class="ID">Z</span>[<span class="ID">half_size</span>+<span class="Number">1</span>:<span class="Number">2</span>*<span class="ID">half_size</span>+<span class="Number">1</span>,-<span class="ID">half_size</span>:]) - <span class="ID">band</span> ) </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_61">  61</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_61"></span><span class="anchor" id="line-61-2"></span>    <span class="Comment"># bottom left corner</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_62">  62</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_62"></span><span class="anchor" id="line-62-2"></span>    <span class="ID">band</span> = <span class="ID">Z</span>[-<span class="ID">half_size</span>:,<span class="ID">half_size</span>].<span class="ID">reshape</span>(-<span class="Number">1</span>,<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_63">  63</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_63"></span><span class="anchor" id="line-63-2"></span>    <span class="ID">Z</span>[-<span class="ID">half_size</span>:,:<span class="ID">half_size</span>] = <span class="ID">band</span> - <span class="ID">np</span>.<span class="ID">abs</span>( <span class="ID">np</span>.<span class="ID">fliplr</span>(<span class="ID">Z</span>[-<span class="ID">half_size</span>:, <span class="ID">half_size</span>+<span class="Number">1</span>:<span class="Number">2</span>*<span class="ID">half_size</span>+<span class="Number">1</span>]) - <span class="ID">band</span> ) </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_64">  64</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_64"></span><span class="anchor" id="line-64-2"></span>    </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_65">  65</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_65"></span><span class="anchor" id="line-65-2"></span>    <span class="Comment"># solve system and convolve</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_66">  66</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_66"></span><span class="anchor" id="line-66-2"></span>    <span class="ResWord">if</span> <span class="ID">derivative</span> == <span class="ResWord">None</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_67">  67</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_67"></span><span class="anchor" id="line-67-2"></span>        <span class="ID">m</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">A</span>)[<span class="Number">0</span>].<span class="ID">reshape</span>((<span class="ID">window_size</span>, -<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_68">  68</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_68"></span><span class="anchor" id="line-68-2"></span>        <span class="ResWord">return</span> <span class="ID">scipy</span>.<span class="ID">signal</span>.<span class="ID">fftconvolve</span>(<span class="ID">Z</span>, <span class="ID">m</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_69">  69</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_69"></span><span class="anchor" id="line-69-2"></span>    <span class="ResWord">elif</span> <span class="ID">derivative</span> == <span class="String">'</span><span class="String">col</span><span class="String">'</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_70">  70</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_70"></span><span class="anchor" id="line-70-2"></span>        <span class="ID">c</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">A</span>)[<span class="Number">1</span>].<span class="ID">reshape</span>((<span class="ID">window_size</span>, -<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_71">  71</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_71"></span><span class="anchor" id="line-71-2"></span>        <span class="ResWord">return</span> <span class="ID">scipy</span>.<span class="ID">signal</span>.<span class="ID">fftconvolve</span>(<span class="ID">Z</span>, -<span class="ID">c</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>)        </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_72">  72</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_72"></span><span class="anchor" id="line-72-1"></span>    <span class="ResWord">elif</span> <span class="ID">derivative</span> == <span class="String">'</span><span class="String">row</span><span class="String">'</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_73">  73</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_73"></span><span class="anchor" id="line-73-1"></span>        <span class="ID">r</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">A</span>)[<span class="Number">2</span>].<span class="ID">reshape</span>((<span class="ID">window_size</span>, -<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_74">  74</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_74"></span><span class="anchor" id="line-74-1"></span>        <span class="ResWord">return</span> <span class="ID">scipy</span>.<span class="ID">signal</span>.<span class="ID">fftconvolve</span>(<span class="ID">Z</span>, -<span class="ID">r</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>)        </span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_75">  75</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_75"></span><span class="anchor" id="line-75-1"></span>    <span class="ResWord">elif</span> <span class="ID">derivative</span> == <span class="String">'</span><span class="String">both</span><span class="String">'</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_76">  76</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_76"></span><span class="anchor" id="line-76-1"></span>        <span class="ID">c</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">A</span>)[<span class="Number">1</span>].<span class="ID">reshape</span>((<span class="ID">window_size</span>, -<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_77">  77</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_77"></span><span class="anchor" id="line-77-1"></span>        <span class="ID">r</span> = <span class="ID">np</span>.<span class="ID">linalg</span>.<span class="ID">pinv</span>(<span class="ID">A</span>)[<span class="Number">2</span>].<span class="ID">reshape</span>((<span class="ID">window_size</span>, -<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_78">  78</a> </span><span class="LineAnchor" id="CA-23cdec12c63b908e1fabb29e00a71df9be8affa1_78"></span><span class="anchor" id="line-78-1"></span>        <span class="ResWord">return</span> <span class="ID">scipy</span>.<span class="ID">signal</span>.<span class="ID">fftconvolve</span>(<span class="ID">Z</span>, -<span class="ID">r</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>), <span class="ID">scipy</span>.<span class="ID">signal</span>.<span class="ID">fftconvolve</span>(<span class="ID">Z</span>, -<span class="ID">c</span>, <span class="ID">mode</span>=<span class="String">'</span><span class="String">valid</span><span class="String">'</span>)        </span>
</pre></div></div><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line874">Here is a demo <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><p class="line867"><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_1">   1</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_1"></span><span class="anchor" id="line-1-8"></span><span class="Comment"># create some sample twoD data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_2">   2</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_2"></span><span class="anchor" id="line-2-4"></span><span class="ID">x</span> = <span class="ID">np</span>.<span class="ID">linspace</span>(-<span class="Number">3</span>,<span class="Number">3</span>,<span class="Number">100</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_3">   3</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_3"></span><span class="anchor" id="line-3-4"></span><span class="ID">y</span> = <span class="ID">np</span>.<span class="ID">linspace</span>(-<span class="Number">3</span>,<span class="Number">3</span>,<span class="Number">100</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_4">   4</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_4"></span><span class="anchor" id="line-4-4"></span><span class="ID">X</span>, <span class="ID">Y</span> = <span class="ID">np</span>.<span class="ID">meshgrid</span>(<span class="ID">x</span>,<span class="ID">y</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_5">   5</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_5"></span><span class="anchor" id="line-5-4"></span><span class="ID">Z</span> = <span class="ID">np</span>.<span class="ID">exp</span>( -(<span class="ID">X</span>**<span class="Number">2</span>+<span class="ID">Y</span>**<span class="Number">2</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_6">   6</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_6"></span><span class="anchor" id="line-6-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_7">   7</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_7"></span><span class="anchor" id="line-7-4"></span><span class="Comment"># add noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_8">   8</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_8"></span><span class="anchor" id="line-8-4"></span><span class="ID">Zn</span> = <span class="ID">Z</span> + <span class="ID">np</span>.<span class="ID">random</span>.<span class="ID">normal</span>( <span class="Number">0</span>, <span class="Number">0.2</span>, <span class="ID">Z</span>.<span class="ID">shape</span> )</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_9">   9</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_9"></span><span class="anchor" id="line-9-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_10">  10</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_10"></span><span class="anchor" id="line-10-4"></span><span class="Comment"># filter it</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_11">  11</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_11"></span><span class="anchor" id="line-11-4"></span><span class="ID">Zf</span> = <span class="ID">sgolay2d</span>( <span class="ID">Zn</span>, <span class="ID">window_size</span>=<span class="Number">29</span>, <span class="ID">order</span>=<span class="Number">4</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_12">  12</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_12"></span><span class="anchor" id="line-12-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_13">  13</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_13"></span><span class="anchor" id="line-13-4"></span><span class="Comment"># do some plotting</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_14">  14</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_14"></span><span class="anchor" id="line-14-4"></span><span class="ID">matshow</span>(<span class="ID">Z</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_15">  15</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_15"></span><span class="anchor" id="line-15-4"></span><span class="ID">matshow</span>(<span class="ID">Zn</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_16">  16</a> </span><span class="LineAnchor" id="CA-c4d7720f4d538f8e229a99ce4e637d584a1cc55f_16"></span><span class="anchor" id="line-16-4"></span><span class="ID">matshow</span>(<span class="ID">Zf</span>)</span>
</pre></div></div><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><p class="line867"><a class="attachment" href="SavitzkyGolay667b.html?action=AttachFile&amp;do=view&amp;target=Original.pdf" title="">Original.pdf</a> Original data <span class="anchor" id="line-235"></span><a class="attachment" href="SavitzkyGolay9775.html?action=AttachFile&amp;do=view&amp;target=Original%2Bnoise.pdf" title="">Original+noise.pdf</a> Original data + noise <span class="anchor" id="line-236"></span><a class="attachment" href="SavitzkyGolay7ad3.html?action=AttachFile&amp;do=view&amp;target=Original%2Bnoise%2Bfiltered.pdf" title="">Original+noise+filtered.pdf</a> (Original data + noise) filtered <span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line867">
<h2 id="Gradient_of_a_two-dimensional_function">Gradient of a two-dimensional function</h2>
<span class="anchor" id="line-240"></span><p class="line874">Since we have computed the best fitting interpolating polynomial surface it is easy to compute its gradient. This method of computing the gradient of a two dimensional function is quite robust, and partially hides the noise in the data, which strongly affects the differentiation operation. The maximum order of the derivative that can be computed obviously depends on the order of the polynomial used in the fitting. <span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><p class="line862">The code provided above have an option <tt class="backtick">derivative</tt>, which as of now allows to compute the first derivative of the 2D data. It can be &quot;row&quot;or &quot;column&quot;, indicating the direction of the derivative, or &quot;both&quot;, which returns the gradient. <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-247"></span><ul><li style="list-style-type:none"><p class="line891"><a href="../CategoryCookbook.html">CategoryCookbook</a> <a href="../CategoryCookbook.html">CategoryCookbook</a> <span class="anchor" id="line-248"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-249"></span><a href="../CategoryCookbook.html">CategoryCookbook</a> <span class="anchor" id="line-250"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: Cookbook/SavitzkyGolay  (last edited 2015-10-24 17:48:25 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="SavitzkyGolay37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/SavitzkyGolay">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/Cookbook/SavitzkyGolay by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:22:18 GMT -->
</html>

