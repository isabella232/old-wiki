<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/Subclasses by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:32:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="index,nofollow">

<title>Subclasses - SciPy wiki dump</title>
<script type="text/javascript" src="moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: Subclasses" href="../external.html?link=http://localhost:8080/Subclasses?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Subclasses&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../external.html?link=http://localhost:8080/Subclasses?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../external.html?link=http://localhost:8080/Subclasses?action=print">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr"><div style="background: white; width:100%; padding:2em;">This is an archival dump of old wiki content --- see <a href="http://scipy.org/">scipy.org</a> for current material</div>

<div id="header">


<form id="searchform" method="get" action="../external.html?link=http://localhost:8080/Subclasses">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="Subclasses456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a class="backlink" href="AllPages95b9.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22Subclasses%22" rel="nofollow" title="Click to do a full-text search for this title">Subclasses</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="HelpContents.html">HelpContents</a></li><li class="current"><a href="Subclasses.html">Subclasses</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Subclasses37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/Subclasses">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="Overview">Overview</h1>
<span class="anchor" id="line-2"></span><p class="line862">An easy way to add attributes or user-defined methods to an array is to define a subclass of <tt>ndarray</tt>. Typically, your new class needs to define at least a <tt>__new__</tt> method and a <tt>__array_finalize__</tt>. <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span><p class="line867">
<h3 id="The___new___method">The __new__ method</h3>
<span class="anchor" id="line-5"></span><p class="line862">The <tt>__new__</tt> is the class constructor. A call to <tt>__new__(cls,...)</tt> creates a new instance of the class <tt>cls</tt>, but doesn't initialize the instance. According to the python documentation, <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><pre><span class="anchor" id="line-1"></span>If new() returns an instance of cls, then the new instance's init() method will be invoked like &quot;init(self[, ...])&quot;, where self is  the new instance and the remaining arguments are the same as were passed to  new().
<span class="anchor" id="line-2"></span>If new() does not return an instance of cls, then the new instance's init() method will not be invoked.
<span class="anchor" id="line-3"></span>new() is intended mainly to allow subclasses of immutable types (like int, str, or tuple) to customize instance creation. </pre><span class="anchor" id="line-10"></span><p class="line862">It turns out that even if ndarrays are not immutable <em>stricto sensu</em>, they have some characteristics of immutable types: they use a definite portion of memory which is allocated at their creation, and this portion of memory cannot be <em>drastically</em> altered.  For example, you can substitute one element or a group of elements to others that have the same type, but you cannot extend a standard ndarray as you could with lists or strings, nor can you mix types (unless particular cases, but that's another story). In other terms, from a python point of view, the <tt>__new__</tt> method of your subclass does not call <tt>__init__</tt>. The docstring of the <tt>ndarray.__new__</tt> method is quite clear: <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line867"><span class="anchor" id="line-13"></span><pre><span class="anchor" id="line-1-1"></span>No __init__ method is needed because the array is fully initialized after the __new__ method.</pre><span class="anchor" id="line-14"></span><p class="line862">However, we need to keep in mind that any attribute that we define in the <tt>__new__</tt> method will be shared among all the instances. If we want instance-specific attributes, we still need some specific initialization. We cannot use the <tt>__init__</tt> method, as it won't be called. That's where  <tt>__array_finalize__</tt> comes to play. <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span><p class="line867">
<h4 id="Some_words_of_caution">Some words of caution</h4>
<span class="anchor" id="line-17"></span><p class="line862">The definition of default values for subclass attributes (as opposed to instance attributes) in the <tt>__new__</tt> method is strongly discouraged for several reasons: <span class="anchor" id="line-18"></span><ul><li>It is not thread-safe. <span class="anchor" id="line-19"></span></li><li><p class="line862">An array of a given subclass can be created from an array of another subclass without any call to the <tt>__new__</tt> method at all. This situation occurs with the use of the <tt>view</tt> method. In that case, we must still initialize the attributes of the new subclass with the <tt>__array_finalize__</tt> method. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></li></ul><p class="line867">
<h3 id="The___array_finalize___method">The __array_finalize__ method</h3>
<span class="anchor" id="line-23"></span><p class="line862">According to the numpy documentation, the <tt>.__array_finalize__(self,&nbsp;obj)</tt> method <em> </em> <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line867"><span class="anchor" id="line-26"></span><pre><span class="anchor" id="line-1-2"></span>is called whenever the system internally allocates a new array from obj, where obj is a subclass (subtype) of the (big)ndarray [. It can be used to change attributes of self after construction (so as to ensure a 2-d matrix for example), or to update meta-information from the “parent.” Subclasses inherit a default implementation of this method that does nothing.&quot;</pre><span class="anchor" id="line-27"></span><p class="line862">In other terms, <tt>__array_finalize__</tt> is called: <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><ul><li><p class="line862">Once an array is created with a function or a method that invokes <tt>__new__</tt>: the <tt>obj</tt> argument is then what was returned by <tt>__new__</tt>. <span class="anchor" id="line-30"></span></li><li><p class="line862">Each time a method returns a modified array, without invoking <tt>__new__</tt>. In that case, the <tt>obj</tt> argument is the modified array. <span class="anchor" id="line-31"></span></li><li><p class="line862">Each time an array is created as a view from another array. In that case, the <tt>obj</tt> argument is the array that calls the <tt>view</tt> method. <span class="anchor" id="line-32"></span></li></ul><p class="line862">Note that if a method returns nothing, then <tt>__array_finalize__</tt> won't be called.  <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867"><tt>__array_finalize__</tt> is thus where we need to transform the attributes from class-generic (as they were defined by <tt>__new__</tt>) to instance-specific. More generally, it is where we must define the default attributes of the subclass. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><p class="line867">
<h3 id="Example">Example</h3>
<span class="anchor" id="line-39"></span><p class="line862">The short example below is an example of subclassed ndarray, where an extra <tt>info</tt> tag can be used to store some metainformation. To illustrate the calls to <tt>__new__</tt> and <tt>__array_finalize__</tt>, some messages will be printed. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line867"><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-1-1"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_1">   1</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_1"></span><span class="anchor" id="line-1-2"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_2">   2</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_2"></span><span class="anchor" id="line-2-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_3">   3</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_3"></span><span class="anchor" id="line-3-1"></span><span class="ResWord">class</span> <span class="ID">InfoArray</span>(<span class="ID">N</span>.<span class="ID">ndarray</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_4">   4</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_4"></span><span class="anchor" id="line-4-1"></span>   </span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_5">   5</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_5"></span><span class="anchor" id="line-5-1"></span>    <span class="ResWord">def</span> <span class="ID">__new__</span>(<span class="ID">subtype</span>, <span class="ID">data</span>, <span class="ID">info</span>=<span class="ResWord">None</span>, <span class="ID">dtype</span>=<span class="ResWord">None</span>, <span class="ID">copy</span>=<span class="ResWord">False</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_6">   6</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_6"></span><span class="anchor" id="line-6-1"></span>        <span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">__new__ received </span><span class="String">%s</span><span class="String">&quot;</span> % <span class="ResWord">type</span>(<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_7">   7</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_7"></span><span class="anchor" id="line-7-1"></span>        <span class="Comment"># Make sure we are working with an array, and copy the data if requested</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_8">   8</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_8"></span><span class="anchor" id="line-8-1"></span>        <span class="ID">subarr</span> = <span class="ID">N</span>.<span class="ID">array</span>(<span class="ID">data</span>, <span class="ID">dtype</span>=<span class="ID">dtype</span>, <span class="ID">copy</span>=<span class="ID">copy</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_9">   9</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_9"></span><span class="anchor" id="line-9-1"></span>        </span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_10">  10</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_10"></span><span class="anchor" id="line-10-1"></span>        <span class="Comment"># Transform 'subarr' from an ndarray to our new subclass.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_11">  11</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_11"></span><span class="anchor" id="line-11-1"></span>        <span class="ID">subarr</span> = <span class="ID">subarr</span>.<span class="ID">view</span>(<span class="ID">subtype</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_12">  12</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_12"></span><span class="anchor" id="line-12-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_13">  13</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_13"></span><span class="anchor" id="line-13-1"></span>        <span class="Comment"># Use the specified 'info' parameter if given</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_14">  14</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_14"></span><span class="anchor" id="line-14-1"></span>        <span class="ResWord">if</span> <span class="ID">info</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ResWord">None</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_15">  15</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_15"></span><span class="anchor" id="line-15-1"></span>            <span class="ID">subarr</span>.<span class="ID">info</span> = <span class="ID">info</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_16">  16</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_16"></span><span class="anchor" id="line-16-1"></span>        <span class="Comment"># Otherwise, use data's info attribute if it exists</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_17">  17</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_17"></span><span class="anchor" id="line-17-1"></span>        <span class="ResWord">elif</span> <span class="ResWord">hasattr</span>(<span class="ID">data</span>, <span class="String">'</span><span class="String">info</span><span class="String">'</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_18">  18</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_18"></span><span class="anchor" id="line-18-1"></span>                <span class="ID">subarr</span>.<span class="ID">info</span> = <span class="ID">data</span>.<span class="ID">info</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_19">  19</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_19"></span><span class="anchor" id="line-19-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_20">  20</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_20"></span><span class="anchor" id="line-20-1"></span>        <span class="Comment"># Finally, we must return the newly created object:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_21">  21</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_21"></span><span class="anchor" id="line-21-1"></span>        <span class="ResWord">return</span> <span class="ID">subarr</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_22">  22</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_22"></span><span class="anchor" id="line-22-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_23">  23</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_23"></span><span class="anchor" id="line-23-1"></span>    <span class="ResWord">def</span> <span class="ID">__array_finalize__</span>(<span class="ResWord">self</span>,<span class="ID">obj</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_24">  24</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_24"></span><span class="anchor" id="line-24-1"></span>        <span class="Comment"># We use the getattr method to set a default if 'obj' doesn't have the 'info' attribute</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_25">  25</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_25"></span><span class="anchor" id="line-25-1"></span>        <span class="ResWord">self</span>.<span class="ID">info</span> = <span class="ResWord">getattr</span>(<span class="ID">obj</span>, <span class="String">'</span><span class="String">info</span><span class="String">'</span>, {})</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_26">  26</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_26"></span><span class="anchor" id="line-26-1"></span>        <span class="Comment"># We could have checked first whether self.info was already defined:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_27">  27</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_27"></span><span class="anchor" id="line-27-1"></span>        <span class="Comment">#if not hasattr(self, 'info'):</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_28">  28</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_28"></span><span class="anchor" id="line-28-1"></span>        <span class="Comment">#    self.info = getattr(obj, 'info', {})</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_29">  29</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_29"></span><span class="anchor" id="line-29-1"></span>                                                                                                                                                    </span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_30">  30</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_30"></span><span class="anchor" id="line-30-1"></span>    <span class="ResWord">def</span> <span class="ID">__repr__</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_31">  31</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_31"></span><span class="anchor" id="line-31-1"></span>        <span class="ID">desc</span>=<span class="String">&quot;&quot;&quot;</span><span class="SPChar">\</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_32">  32</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_32"></span><span class="anchor" id="line-32-1"></span><span class="SPChar"></span><span class="String">array(data=</span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_33">  33</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_33"></span><span class="anchor" id="line-33-1"></span><span class="String"></span><span class="String">  </span><span class="String">%(data)s</span><span class="String">,</span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_34">  34</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_34"></span><span class="anchor" id="line-34-1"></span><span class="String"></span><span class="String">      tag=</span><span class="String">%(tag)s</span><span class="String">)</span><span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_35">  35</a> </span><span class="LineAnchor" id="CA-5f22247f2fd9b181624e6d47eae8a7f40e52c428_35"></span><span class="anchor" id="line-35-1"></span>        <span class="ResWord">return</span> <span class="ID">desc</span> % {<span class="String">'</span><span class="String">data</span><span class="String">'</span>: <span class="ResWord">str</span>(<span class="ResWord">self</span>), <span class="String">'</span><span class="String">tag</span><span class="String">'</span>:<span class="ResWord">self</span>.<span class="ID">info</span> }</span>
</pre></div></div><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><p class="line874">Such a class can be used like this: <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><p class="line867"><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-1-3"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_1">   1</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_1"></span><span class="anchor" id="line-1-4"></span>&gt;&gt;&gt; <span class="ID">x</span> = <span class="ID">InfoArray</span>(<span class="ID">N</span>.<span class="ID">arange</span>(<span class="Number">10</span>), <span class="ID">info</span>={<span class="String">'</span><span class="String">name</span><span class="String">'</span>:<span class="String">'</span><span class="String">x</span><span class="String">'</span>})</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_2">   2</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_2"></span><span class="anchor" id="line-2-2"></span><span class="ID">__new__</span> <span class="ID">received</span> &lt;<span class="ResWord">type</span> <span class="String">'</span><span class="String">numpy.ndarray</span><span class="String">'</span>&gt;</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_3">   3</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_3"></span><span class="anchor" id="line-3-2"></span>&gt;&gt;&gt; <span class="ID">x</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_4">   4</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_4"></span><span class="anchor" id="line-4-2"></span><span class="ID">array</span>(<span class="ID">data</span>=</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_5">   5</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_5"></span><span class="anchor" id="line-5-2"></span>  [<span class="Number">0</span> <span class="Number">1</span> <span class="Number">2</span> <span class="Number">3</span> <span class="Number">4</span> <span class="Number">5</span> <span class="Number">6</span> <span class="Number">7</span> <span class="Number">8</span> <span class="Number">9</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_6">   6</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_6"></span><span class="anchor" id="line-6-2"></span>      <span class="ID">tag</span>={<span class="String">'</span><span class="String">name</span><span class="String">'</span>: <span class="String">'</span><span class="String">x</span><span class="String">'</span>})</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_7">   7</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_7"></span><span class="anchor" id="line-7-2"></span>&gt;&gt;&gt; <span class="ID">y</span> = <span class="ID">InfoArray</span>(<span class="ID">N</span>.<span class="ID">arange</span>(<span class="Number">10</span>), <span class="ID">info</span>={<span class="String">'</span><span class="String">name</span><span class="String">'</span>:<span class="String">'</span><span class="String">y</span><span class="String">'</span>})</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_8">   8</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_8"></span><span class="anchor" id="line-8-2"></span>&gt;&gt;&gt; <span class="ResWord">assert</span> (<span class="ID">x</span>.<span class="ID">info</span>[<span class="String">'</span><span class="String">name</span><span class="String">'</span>]==<span class="String">'</span><span class="String">x</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_9">   9</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_9"></span><span class="anchor" id="line-9-2"></span>&gt;&gt;&gt; <span class="ResWord">assert</span> (<span class="ID">y</span>.<span class="ID">info</span>[<span class="String">'</span><span class="String">name</span><span class="String">'</span>]==<span class="String">'</span><span class="String">y</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_10">  10</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_10"></span><span class="anchor" id="line-10-2"></span><span class="Comment"># Now, let's try the view method...</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_11">  11</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_11"></span><span class="anchor" id="line-11-2"></span>&gt;&gt;&gt; <span class="ID">z</span> = <span class="ID">N</span>.<span class="ID">arange</span>(<span class="Number">10</span>).<span class="ID">view</span>(<span class="ID">InfoArray</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_12">  12</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_12"></span><span class="anchor" id="line-12-2"></span>&gt;&gt;&gt; <span class="ResWord">assert</span> (<span class="ResWord">isinstance</span>(<span class="ID">z</span>, <span class="ID">InfoArray</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_13">  13</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_13"></span><span class="anchor" id="line-13-2"></span>&gt;&gt;&gt; <span class="ResWord">assert</span> (<span class="ID">z</span>.<span class="ID">info</span> == {})   </span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_14">  14</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_14"></span><span class="anchor" id="line-14-2"></span><span class="Comment"># Explanation: </span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_15">  15</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_15"></span><span class="anchor" id="line-15-2"></span><span class="Comment"># We created an InfoArray from a standard ndarray with the 'view' method.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_16">  16</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_16"></span><span class="anchor" id="line-16-2"></span><span class="Comment"># As a ndarray does not have a 'info' attribute, the default {} is used.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_17">  17</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_17"></span><span class="anchor" id="line-17-2"></span>&gt;&gt;&gt; <span class="ID">z</span> = <span class="ID">x</span>.<span class="ID">view</span>(<span class="ID">InfoArray</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_18">  18</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_18"></span><span class="anchor" id="line-18-2"></span>&gt;&gt;&gt; <span class="ResWord">assert</span>(<span class="ID">z</span>.<span class="ID">info</span> == <span class="ID">x</span>.<span class="ID">info</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_19">  19</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_19"></span><span class="anchor" id="line-19-2"></span><span class="Comment"># Here, we created a new InfoArray from an existing one with the 'view' method.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_20">  20</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_20"></span><span class="anchor" id="line-20-2"></span><span class="Comment"># Therefore, the 'info' attribute is propagated to the view.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_21">  21</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_21"></span><span class="anchor" id="line-21-2"></span><span class="Comment">#</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_22">  22</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_22"></span><span class="anchor" id="line-22-2"></span><span class="Comment"># Now, let's apply a numpy function to an InfoArray: the 'view' method will be called internally...</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_23">  23</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_23"></span><span class="anchor" id="line-23-2"></span><span class="Comment"># ... and the result will inherit the 'info' attribute of the original InfoArray</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_24">  24</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_24"></span><span class="anchor" id="line-24-2"></span>&gt;&gt;&gt; <span class="ID">z</span> = <span class="ID">N</span>.<span class="ID">sqrt</span>(<span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_25">  25</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_25"></span><span class="anchor" id="line-25-2"></span>&gt;&gt;&gt; <span class="ID">z</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_26">  26</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_26"></span><span class="anchor" id="line-26-2"></span><span class="ID">array</span>(<span class="ID">data</span>=</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_27">  27</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_27"></span><span class="anchor" id="line-27-2"></span>  [ <span class="Number">0.</span>          <span class="Number">1.</span>          <span class="Number">1.41421356</span>  <span class="Number">1.73205081</span>  <span class="Number">2.</span>          <span class="Number">2.23606798</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_28">  28</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_28"></span><span class="anchor" id="line-28-2"></span>  <span class="Number">2.44948974</span>  <span class="Number">2.64575131</span>  <span class="Number">2.82842712</span>  <span class="Number">3.</span>        ],</span>
<span class="line"><span class="LineNumber"><a href="#CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_29">  29</a> </span><span class="LineAnchor" id="CA-f9e3ac42af40bac9f6f45b3924270ea52d64d1ce_29"></span><span class="anchor" id="line-29-2"></span>      <span class="ID">tag</span>={<span class="String">'</span><span class="String">name</span><span class="String">'</span>: <span class="String">'</span><span class="String">x</span><span class="String">'</span>})</span>
</pre></div></div><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line862">Note that this InfoArray class is fairly basic, and can lead to surprises. For example, we haven't defined how the metadata must be updated when combining two InfoArrays. The default behavior is to use the <tt>info</tt> tag of the first element: <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867"><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-1-5"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_1">   1</a> </span><span class="LineAnchor" id="CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_1"></span><span class="anchor" id="line-1-6"></span>&gt;&gt;&gt; <span class="ResWord">assert</span>((<span class="ID">x</span>+<span class="ID">y</span>).<span class="ID">info</span>[<span class="String">'</span><span class="String">name</span><span class="String">'</span>]==<span class="String">'</span><span class="String">x</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_2">   2</a> </span><span class="LineAnchor" id="CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_2"></span><span class="anchor" id="line-2-3"></span><span class="ResWord">True</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_3">   3</a> </span><span class="LineAnchor" id="CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_3"></span><span class="anchor" id="line-3-3"></span>&gt;&gt;&gt; <span class="ResWord">assert</span>((<span class="ID">y</span>+<span class="ID">x</span>).<span class="ID">info</span>[<span class="String">'</span><span class="String">name</span><span class="String">'</span>]==<span class="String">'</span><span class="String">y</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_4">   4</a> </span><span class="LineAnchor" id="CA-9850f27ac1664e07fad8ec2ee79d21833ca690b5_4"></span><span class="anchor" id="line-4-3"></span><span class="ResWord">True</span></span>
</pre></div></div><span class="anchor" id="line-126"></span><p class="line862">If we want to change this behavior, we need to update the <tt>__add__</tt> method (or whatever method is required). <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><p class="line867">
<h3 id="The___array_wrap___method">The __array_wrap__ method</h3>
<span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><p class="line862">When a numpy ufunc is called on a subclass of ndarray, the <tt>__array_wrap__</tt> method is called to transform the result into a new instance of the subclass. By default, <tt>__array_wrap__</tt> will call <tt>__array_finalize__</tt>, and the attributes will be inherited. <span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line862">By defining a specific <tt>__array_wrap__</tt> method for our subclass, we can tweak the output. <span class="anchor" id="line-135"></span>The <tt>__array_wrap__</tt> method requires one argument, the object on which the ufunc is applied, and an optional parameter <tt>context</tt>. This parameter is returned by some ufuncs as a 3-element tuple: (name of the ufunc, argument of the ufunc, domain of the ufunc). <span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><p class="line862">For example, let's modify our <tt>InfoArray</tt> class, so that we can keep track of the modifications: <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><p class="line867"><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-1-7"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-adaab952ac1ffddcc50da8619b162fdb06473b39\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_1">   1</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_1"></span><span class="anchor" id="line-1-8"></span><span class="ResWord">def</span> <span class="ID">__array_wrap__</span>(<span class="ResWord">self</span>,<span class="ID">obj</span>, <span class="ID">context</span>=<span class="ResWord">None</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_2">   2</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_2"></span><span class="anchor" id="line-2-4"></span>    <span class="ID">result</span> = <span class="ID">obj</span>.<span class="ID">view</span>(<span class="ResWord">type</span>(<span class="ResWord">self</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_3">   3</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_3"></span><span class="anchor" id="line-3-4"></span>    <span class="ID">result</span>.<span class="ID">info</span>.<span class="ID">update</span>(<span class="ResWord">self</span>.<span class="ID">info</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_4">   4</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_4"></span><span class="anchor" id="line-4-4"></span>    <span class="ResWord">if</span> <span class="ID">context</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ResWord">None</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_5">   5</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_5"></span><span class="anchor" id="line-5-3"></span>            <span class="ID">modif</span> = <span class="ID">result</span>.<span class="ID">info</span>.<span class="ID">get</span>(<span class="String">'</span><span class="String">modif</span><span class="String">'</span>,<span class="String">'</span><span class="String">modified by</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_6">   6</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_6"></span><span class="anchor" id="line-6-3"></span>            <span class="ID">modif</span> += <span class="String">&quot;</span><span class="String">: </span><span class="String">%s</span><span class="String">&quot;</span> % <span class="ID">context</span>[<span class="Number">0</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_7">   7</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_7"></span><span class="anchor" id="line-7-3"></span>            <span class="ID">result</span>.<span class="ID">info</span>.<span class="ID">update</span>({<span class="String">'</span><span class="String">modif</span><span class="String">'</span>: <span class="ID">modif</span>})</span>
<span class="line"><span class="LineNumber"><a href="#CA-adaab952ac1ffddcc50da8619b162fdb06473b39_8">   8</a> </span><span class="LineAnchor" id="CA-adaab952ac1ffddcc50da8619b162fdb06473b39_8"></span><span class="anchor" id="line-8-3"></span>    <span class="ResWord">return</span> <span class="ID">result</span></span>
</pre></div></div><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><p class="line874">Using the same example as earlier: <span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><pre><span class="anchor" id="line-1-3"></span>&gt;&gt;&gt; z = N.sqrt(x)
<span class="anchor" id="line-2-1"></span>&gt;&gt;&gt; z
<span class="anchor" id="line-3-1"></span>array(data=
<span class="anchor" id="line-4"></span>  [ 0.          1.          1.41421356  1.73205081  2.          2.23606798
<span class="anchor" id="line-5"></span>  2.44948974  2.64575131  2.82842712  3.        ],
<span class="anchor" id="line-6"></span>      tag={'modif': &quot;modified by: &lt;ufunc 'sqrt'&gt;&quot;, 'name': 'x'})
<span class="anchor" id="line-7"></span># Let's add 1 in place
<span class="anchor" id="line-8"></span>&gt;&gt;&gt; z +=1
<span class="anchor" id="line-9"></span>&gt;&gt;&gt; z
<span class="anchor" id="line-10"></span>array(data=
<span class="anchor" id="line-11"></span>  [ 1.          2.          2.41421356  2.73205081  3.          3.23606798
<span class="anchor" id="line-12"></span>  3.44948974  3.64575131  3.82842712  4.        ],
<span class="anchor" id="line-13"></span>      tag={'modif': &quot;modified by: &lt;ufunc 'sqrt'&gt;: &lt;ufunc 'add'&gt;&quot;, 'name': 'x'})</pre><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><p class="line862">A more realistic example of a <tt>__array_wrap__</tt> methods is available in the <tt>maskedarray</tt> package. There, the mask of the output is modified to take the domain of the ufunc into account. <span class="anchor" id="line-169"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: Subclasses  (last edited 2015-10-24 17:48:23 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Subclasses37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/Subclasses">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/Subclasses by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:32:42 GMT -->
</html>

