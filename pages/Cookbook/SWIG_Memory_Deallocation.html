<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/Cookbook/SWIG_Memory_Deallocation by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:22:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="index,nofollow">

<title>Cookbook/SWIG_Memory_Deallocation - SciPy wiki dump</title>
<script type="text/javascript" src="../moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="../moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="../moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: Cookbook/SWIG_Memory_Deallocation" href="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Cookbook%2FSWIG_Memory_Deallocation&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="../AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation?action=print">
<link rel="Up" href="../Cookbook.html">
<link rel="Search" href="../FindPage.html">
<link rel="Index" href="../TitleIndex.html">
<link rel="Glossary" href="../WordIndex.html">
<link rel="Help" href="../HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr"><div style="background: white; padding:2em;">This is an archival dump of old wiki content --- see <a href="http://scipy.org/">scipy.org</a> for current material.<br>Please see <a href="http://scipy-cookbook.readthedocs.org/">http://scipy-cookbook.readthedocs.org/</a></div>

<div id="header">


<form id="searchform" method="get" action="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="SWIG_Memory_Deallocation456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="../AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a href="../Cookbook.html">Cookbook</a></li><li><a class="backlink" href="SWIG_Memory_Deallocation5160.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22Cookbook%2FSWIG_Memory_Deallocation%22" rel="nofollow" title="Click to do a full-text search for this title">SWIG_Memory_Deallocation</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="../RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="../FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="../HelpContents.html">HelpContents</a></li><li class="current"><a href="SWIG_Memory_Deallocation.html">SWIG_Memory_Deallocation</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="SWIG_Memory_Deallocation37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
<h1 id="Table_of_Contents">Table of Contents</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#Table_of_Contents">Table of Contents</a></li><li>
<a href="#Introduction">Introduction</a><ol><li>
<a href="#Recipe_description">Recipe description</a></li><li>
<a href="#Where_to_get_the_files">Where to get the files</a></li><li>
<a href="#How_the_code_came_about">How the code came about</a></li></ol></li><li>
<a href="#How_to_use_the_new_fragments">How to use the new fragments</a><ol><li>
<a href="#Important_steps">Important steps</a></li></ol></li><li>
<a href="#A_simple_ARGOUTVIEWM_ARRAY1_example">A simple ARGOUTVIEWM_ARRAY1 example</a><ol><li>
<a href="#The_C_source_.28ezalloc.c_and_ezalloc.h.29">The C source (ezalloc.c and ezalloc.h)</a></li><li>
<a href="#The_interface_file_.28ezalloc.i.29">The interface file (ezalloc.i)</a></li><li>
<a href="#Setup_file_.28setup_alloc.py.29">Setup file (setup_alloc.py)</a></li><li>
<a href="#Compiling_the_module">Compiling the module</a></li><li>
<a href="#Testing_the_module">Testing the module</a></li></ol></li><li>
<a href="#A_simple_ARGOUTVIEWM_ARRAY2_example">A simple ARGOUTVIEWM_ARRAY2 example</a><ol><li>
<a href="#The_C_source_.28crop.c_and_crop.h.29">The C source (crop.c and crop.h)</a></li><li>
<a href="#The_interface_file_.28crop.i.29">The interface file (crop.i)</a></li><li>
<a href="#Setup_file_.28setup_crop.py.29">Setup file (setup_crop.py)</a></li><li>
<a href="#Testing_the_module-1">Testing the module</a></li></ol></li><li>
<a href="#Conclusion_and_comments">Conclusion and comments</a></li></ol></div> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span><p class="line867">
<h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-7"></span><p class="line867">
<h2 id="Recipe_description">Recipe description</h2>
<span class="anchor" id="line-8"></span><p class="line862">This cookbook recipe describes the automatic deallocation of memory blocks allocated via <tt class="backtick">malloc()</tt> calls in C, when the corresponding Python numpy array objects are destroyed. The recipe uses SWIG and a modified <tt class="backtick">numpy.i</tt> helper file. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span><p class="line862">To be more specific, new fragments were added to the existing <tt class="backtick">numpy.i</tt> to handle automatic deallocation of arrays, the size of which is not known in advance. As with the original fragments, a block of <tt class="backtick">malloc()</tt> memory can be converted into a returned numpy python object via a call to <tt class="backtick">PyArray_SimpleNewFromData()</tt>. However, the returned python object is created using <tt class="backtick">PyCObject_FromVoidPtr()</tt>, which ensures that the allocated memory is automatically disposed of when the Python object is destroyed. Examples below show how using these new fragments avoids leaking memory. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line862">Since the new fragments are based on the <tt class="backtick">_ARGOUTVIEW_</tt> ones, the name <tt class="backtick">_ARGOUTVIEWM_</tt> was chosen, where <tt class="backtick">M</tt> stands for managed. All managed fragments (ARRAY1, 2 and 3, FARRAY1, 2 and 3) were implemented, and have now been extensively tested. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><p class="line867">
<h2 id="Where_to_get_the_files">Where to get the files</h2>
<span class="anchor" id="line-15"></span><p class="line874">At the moment, the modified numpy.i file is available here (last updated 2012-04-22): <span class="anchor" id="line-16"></span><ul><li><p class="line891"><a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/numpy.i">http://ezwidgets.googlecode.com/svn/trunk/numpy/numpy.i</a> <span class="anchor" id="line-17"></span></li><li><p class="line891"><a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/pyfragments.swg">http://ezwidgets.googlecode.com/svn/trunk/numpy/pyfragments.swg</a> <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></li></ul><p class="line867">
<h2 id="How_the_code_came_about">How the code came about</h2>
<span class="anchor" id="line-20"></span><p class="line862">The original memory deallocation code was written by Travis Oliphant (see <a class="http" href="../../external.html?link=http://blog.enthought.com/?p=62">http://blog.enthought.com/?p=62</a> ) and as far as I know, these clever people were the first ones to use it in a swig file (see <a class="http" href="../../external.html?link=http://niftilib.sourceforge.net/pynifti">http://niftilib.sourceforge.net/pynifti</a>, file nifticlib.i). Lisandro Dalcin then pointed out a simplified implementation using <a class="http" href="../../external.html?link=http://docs.python.org/c-api/cobject.html">CObjects</a>, which Travis details in this <a class="http" href="../../external.html?link=http://blog.enthought.com/python/numpy/simplified-creation-of-numpy-arrays-from-pre-allocated-memory/">updated blog post</a>. <span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867">
<h1 id="How_to_use_the_new_fragments">How to use the new fragments</h1>
<span class="anchor" id="line-23"></span><p class="line867">
<h2 id="Important_steps">Important steps</h2>
<span class="anchor" id="line-24"></span><p class="line862">In yourfile.i, the %init function uses the same <tt class="backtick">import_array()</tt> call you already know: <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><p class="line867"><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-1-1"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_1">   1</a> </span><span class="LineAnchor" id="CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_1"></span><span class="anchor" id="line-1-2"></span>%<span class="ID">init</span> %{</span>
<span class="line"><span class="LineNumber"><a href="#CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_2">   2</a> </span><span class="LineAnchor" id="CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_2"></span><span class="anchor" id="line-2-1"></span>    <span class="ID">import_array</span>();</span>
<span class="line"><span class="LineNumber"><a href="#CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_3">   3</a> </span><span class="LineAnchor" id="CA-c52e397a7a763c4d75552e0e5d3c4c8ce206f67c_3"></span><span class="anchor" id="line-3-1"></span>%}</span>
</pre></div></div><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><p class="line874">... then just use ARGOUTVIEWM_ARRAY1 instead of ARGOUTVIEW_ARRAY1 and memory deallocation is handled automatically when the python array is destroyed (see examples below). <span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line867">
<h1 id="A_simple_ARGOUTVIEWM_ARRAY1_example">A simple ARGOUTVIEWM_ARRAY1 example</h1>
<span class="anchor" id="line-35"></span><p class="line862">The SWIG-wrapped function in C creates an N integers array, using <tt class="backtick">malloc()</tt> to allocate memory. From python, this function is repetitively called and the array created destroyed (M times). <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><p class="line874">Using the ARGOUTVIEW_ARRAY1 provided in numpy.i, this will create memory leaks (I know ARGOUTVIEW_ARRAY1 has not been designed for this purpose but it's tempting!). <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line862">Using the ARGOUTVIEWM_ARRAY1 fragment instead, the memory allocated with <tt class="backtick">malloc()</tt> will be automatically deallocated when the array is deleted. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><p class="line874">The python test program creates and deletes a 1024^2 ints array 2048 times using both ARGOUTVIEW_ARRAY1 and ARGOUTVIEWM_ARRAY1 and when memory allocation fails, an exception is generated in C and caught in Python, showing which iteration finally caused the allocation to fail. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867">
<h2 id="The_C_source_.28ezalloc.c_and_ezalloc.h.29">The C source (ezalloc.c and ezalloc.h)</h2>
<span class="anchor" id="line-44"></span><p class="line862">Here is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/ezalloc.h">ezalloc.h</a> file: <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-1-3"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-d1ee9168e14ff4b37a906963dddd74d073ec02fe\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-d1ee9168e14ff4b37a906963dddd74d073ec02fe" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-d1ee9168e14ff4b37a906963dddd74d073ec02fe_1">   1</a> </span><span class="LineAnchor" id="CA-d1ee9168e14ff4b37a906963dddd74d073ec02fe_1"></span><span class="anchor" id="line-1-4"></span><span class="ResWord">void</span> <span class="ID">alloc</span>(<span class="ResWord">int</span> <span class="ID">ni</span>, <span class="ResWord">int</span>** <span class="ID">veco</span>, <span class="ResWord">int</span> *<span class="ID">n</span>);</span>
</pre></div></div><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line862">Here is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/ezalloc.c">ezalloc.c</a> file: <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-1-5"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-2e491dc91c64894daf8310b93a09b57284b7fe9f\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_1">   1</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_1"></span><span class="anchor" id="line-1-6"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_2">   2</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_2"></span><span class="anchor" id="line-2-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &lt;errno.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_3">   3</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_3"></span><span class="anchor" id="line-3-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &quot;ezalloc.h&quot;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_4">   4</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_4"></span><span class="anchor" id="line-4-1"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_5">   5</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_5"></span><span class="anchor" id="line-5-1"></span><span class="ResWord">void</span> <span class="ID">alloc</span>(<span class="ResWord">int</span> <span class="ID">ni</span>, <span class="ResWord">int</span>** <span class="ID">veco</span>, <span class="ResWord">int</span> *<span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_6">   6</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_6"></span><span class="anchor" id="line-6-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_7">   7</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_7"></span><span class="anchor" id="line-7-1"></span>    <span class="ResWord">int</span> *<span class="ID">temp</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_8">   8</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_8"></span><span class="anchor" id="line-8-1"></span>    <span class="ID">temp</span> = (<span class="ResWord">int</span> *)<span class="ID">malloc</span>(<span class="ID">ni</span>*<span class="ResWord">sizeof</span>(<span class="ResWord">int</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_9">   9</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_9"></span><span class="anchor" id="line-9-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_10">  10</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_10"></span><span class="anchor" id="line-10-1"></span>    <span class="ResWord">if</span> (<span class="ID">temp</span> == <span class="ResWord">NULL</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_11">  11</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_11"></span><span class="anchor" id="line-11-1"></span>        <span class="ID">errno</span> = <span class="ID">ENOMEM</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_12">  12</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_12"></span><span class="anchor" id="line-12-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_13">  13</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_13"></span><span class="anchor" id="line-13-1"></span>    <span class="Comment">//veco is either NULL or pointing to the allocated block of memory...</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_14">  14</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_14"></span><span class="anchor" id="line-14-1"></span><span class="Comment"></span>    *<span class="ID">veco</span> = <span class="ID">temp</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_15">  15</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_15"></span><span class="anchor" id="line-15-1"></span>    *<span class="ID">n</span> = <span class="ID">ni</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_16">  16</a> </span><span class="LineAnchor" id="CA-2e491dc91c64894daf8310b93a09b57284b7fe9f_16"></span><span class="anchor" id="line-16-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><p class="line867">
<h2 id="The_interface_file_.28ezalloc.i.29">The interface file (ezalloc.i)</h2>
<span class="anchor" id="line-70"></span><p class="line862">The file (available here: <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/ezalloc.i">ezalloc.i</a>) does a couple of interesting things: <span class="anchor" id="line-71"></span><ul><li><p class="line862">Like I said in the introduction, calling the <tt class="backtick">import_array()</tt> function in the <tt class="backtick">%init</tt> section now also initialises the memory deallocation code. There is nothing else to add here. <span class="anchor" id="line-72"></span></li><li><p class="line862">An exception is generated if memory allocation fails. After a few iterations of the code construct, using <tt class="backtick">errno</tt> and <tt class="backtick">SWIG_fail</tt> is the simplest I've come-up with. <span class="anchor" id="line-73"></span></li><li><p class="line862">In this example, two inline functions are created, one using ARGOUTVIEW_ARRAY1 and the other ARGOUTVIEWM_ARRAY1. Both function use the <tt class="backtick">alloc()</tt> function (see ezalloc.h and ezalloc.c). <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></li></ul><p class="line867"><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-1-7"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_1">   1</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_1"></span><span class="anchor" id="line-1-8"></span>%<span class="ID">module</span> <span class="ID">ezalloc</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_2">   2</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_2"></span><span class="anchor" id="line-2-3"></span>%{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_3">   3</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_3"></span><span class="anchor" id="line-3-3"></span><span class="Preprc">#</span><span class="Preprc">include &lt;errno.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_4">   4</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_4"></span><span class="anchor" id="line-4-2"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &quot;ezalloc.h&quot;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_5">   5</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_5"></span><span class="anchor" id="line-5-2"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_6">   6</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_6"></span><span class="anchor" id="line-6-2"></span><span class="Preprc">#</span><span class="Preprc">define SWIG_FILE_WITH_INIT</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_7">   7</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_7"></span><span class="anchor" id="line-7-2"></span><span class="Preprc"></span>%}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_8">   8</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_8"></span><span class="anchor" id="line-8-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_9">   9</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_9"></span><span class="anchor" id="line-9-2"></span>%<span class="ID">include</span> <span class="String">&quot;</span><span class="String">numpy.i</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_10">  10</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_10"></span><span class="anchor" id="line-10-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_11">  11</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_11"></span><span class="anchor" id="line-11-2"></span>%<span class="ID">init</span> %{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_12">  12</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_12"></span><span class="anchor" id="line-12-2"></span>    <span class="ID">import_array</span>();</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_13">  13</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_13"></span><span class="anchor" id="line-13-2"></span>%}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_14">  14</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_14"></span><span class="anchor" id="line-14-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_15">  15</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_15"></span><span class="anchor" id="line-15-2"></span>%<span class="ID">apply</span> (<span class="ResWord">int</span>** <span class="ID">ARGOUTVIEWM_ARRAY1</span>, <span class="ResWord">int</span> *<span class="ID">DIM1</span>) {(<span class="ResWord">int</span>** <span class="ID">veco1</span>, <span class="ResWord">int</span>* <span class="ID">n1</span>)}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_16">  16</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_16"></span><span class="anchor" id="line-16-2"></span>%<span class="ID">apply</span> (<span class="ResWord">int</span>** <span class="ID">ARGOUTVIEW_ARRAY1</span>, <span class="ResWord">int</span> *<span class="ID">DIM1</span>) {(<span class="ResWord">int</span>** <span class="ID">veco2</span>, <span class="ResWord">int</span>* <span class="ID">n2</span>)}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_17">  17</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_17"></span><span class="anchor" id="line-17-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_18">  18</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_18"></span><span class="anchor" id="line-18-1"></span>%<span class="ID">include</span> <span class="String">&quot;</span><span class="String">ezalloc.h</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_19">  19</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_19"></span><span class="anchor" id="line-19-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_20">  20</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_20"></span><span class="anchor" id="line-20-1"></span>%<span class="ID">exception</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_21">  21</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_21"></span><span class="anchor" id="line-21-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_22">  22</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_22"></span><span class="anchor" id="line-22-1"></span>    <span class="ID">errno</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_23">  23</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_23"></span><span class="anchor" id="line-23-1"></span>    $<span class="ID">action</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_24">  24</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_24"></span><span class="anchor" id="line-24-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_25">  25</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_25"></span><span class="anchor" id="line-25-1"></span>    <span class="ResWord">if</span> (<span class="ID">errno</span> != <span class="Number">0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_26">  26</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_26"></span><span class="anchor" id="line-26-1"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_27">  27</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_27"></span><span class="anchor" id="line-27-1"></span>        <span class="ResWord">switch</span>(<span class="ID">errno</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_28">  28</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_28"></span><span class="anchor" id="line-28-1"></span>        {</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_29">  29</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_29"></span><span class="anchor" id="line-29-1"></span>            <span class="ResWord">case</span> <span class="ID">ENOMEM</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_30">  30</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_30"></span><span class="anchor" id="line-30-1"></span>                <span class="ID">PyErr_Format</span>(<span class="ID">PyExc_MemoryError</span>, <span class="String">&quot;</span><span class="String">Failed malloc()</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_31">  31</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_31"></span><span class="anchor" id="line-31-1"></span>                <span class="ResWord">break</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_32">  32</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_32"></span><span class="anchor" id="line-32-1"></span>            <span class="ResWord">default</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_33">  33</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_33"></span><span class="anchor" id="line-33-1"></span>                <span class="ID">PyErr_Format</span>(<span class="ID">PyExc_Exception</span>, <span class="String">&quot;</span><span class="String">Unknown exception</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_34">  34</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_34"></span><span class="anchor" id="line-34-1"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_35">  35</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_35"></span><span class="anchor" id="line-35-1"></span>        <span class="ID">SWIG_fail</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_36">  36</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_36"></span><span class="anchor" id="line-36-1"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_37">  37</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_37"></span><span class="anchor" id="line-37-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_38">  38</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_38"></span><span class="anchor" id="line-38-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_39">  39</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_39"></span><span class="anchor" id="line-39-1"></span>%<span class="ID">rename</span> (<span class="ID">alloc_managed</span>) <span class="ID">my_alloc1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_40">  40</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_40"></span><span class="anchor" id="line-40-1"></span>%<span class="ID">rename</span> (<span class="ID">alloc_leaking</span>) <span class="ID">my_alloc2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_41">  41</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_41"></span><span class="anchor" id="line-41-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_42">  42</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_42"></span><span class="anchor" id="line-42-1"></span>%<span class="ResWord">inline</span> %{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_43">  43</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_43"></span><span class="anchor" id="line-43-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_44">  44</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_44"></span><span class="anchor" id="line-44-1"></span><span class="ResWord">void</span> <span class="ID">my_alloc1</span>(<span class="ResWord">int</span> <span class="ID">ni</span>, <span class="ResWord">int</span>** <span class="ID">veco1</span>, <span class="ResWord">int</span> *<span class="ID">n1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_45">  45</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_45"></span><span class="anchor" id="line-45-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_46">  46</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_46"></span><span class="anchor" id="line-46-1"></span>    <span class="Comment">/* The function... */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_47">  47</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_47"></span><span class="anchor" id="line-47-1"></span>    <span class="ID">alloc</span>(<span class="ID">ni</span>, <span class="ID">veco1</span>, <span class="ID">n1</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_48">  48</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_48"></span><span class="anchor" id="line-48-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_49">  49</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_49"></span><span class="anchor" id="line-49-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_50">  50</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_50"></span><span class="anchor" id="line-50-1"></span><span class="ResWord">void</span> <span class="ID">my_alloc2</span>(<span class="ResWord">int</span> <span class="ID">ni</span>, <span class="ResWord">int</span>** <span class="ID">veco2</span>, <span class="ResWord">int</span> *<span class="ID">n2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_51">  51</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_51"></span><span class="anchor" id="line-51-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_52">  52</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_52"></span><span class="anchor" id="line-52-1"></span>    <span class="Comment">/* The function... */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_53">  53</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_53"></span><span class="anchor" id="line-53-1"></span>    <span class="ID">alloc</span>(<span class="ID">ni</span>, <span class="ID">veco2</span>, <span class="ID">n2</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_54">  54</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_54"></span><span class="anchor" id="line-54-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_55">  55</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_55"></span><span class="anchor" id="line-55-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_56">  56</a> </span><span class="LineAnchor" id="CA-19b70a5333f2facc4b911005dfaed7555ac2b3b0_56"></span><span class="anchor" id="line-56-1"></span>%}</span>
</pre></div></div><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><p class="line862">Don't forget that you will need the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/numpy.i">numpy.i</a> file in the same directory for this to compile. <span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><p class="line867">
<h2 id="Setup_file_.28setup_alloc.py.29">Setup file (setup_alloc.py)</h2>
<span class="anchor" id="line-137"></span><p class="line862">This is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/setup_alloc.py">setup_alloc.py</a> file: <span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-1-9"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-cc116f03a56a377e449cab7fed856d65d02db024\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-cc116f03a56a377e449cab7fed856d65d02db024" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_1">   1</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_1"></span><span class="anchor" id="line-1-10"></span><span class="Comment">#! /usr/bin/env python</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_2">   2</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_2"></span><span class="anchor" id="line-2-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_3">   3</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_3"></span><span class="anchor" id="line-3-4"></span><span class="Comment"># System imports</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_4">   4</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_4"></span><span class="anchor" id="line-4-3"></span><span class="ResWord">from</span> <span class="ID">distutils.core</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_5">   5</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_5"></span><span class="anchor" id="line-5-3"></span><span class="ResWord">from</span> <span class="ID">distutils</span>      <span class="ResWord">import</span> <span class="ID">sysconfig</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_6">   6</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_6"></span><span class="anchor" id="line-6-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_7">   7</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_7"></span><span class="anchor" id="line-7-3"></span><span class="Comment"># Third-party modules - we depend on numpy for everything</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_8">   8</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_8"></span><span class="anchor" id="line-8-3"></span><span class="ResWord">import</span> <span class="ID">numpy</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_9">   9</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_9"></span><span class="anchor" id="line-9-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_10">  10</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_10"></span><span class="anchor" id="line-10-3"></span><span class="Comment"># Obtain the numpy include directory.  This logic works across numpy versions.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_11">  11</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_11"></span><span class="anchor" id="line-11-3"></span><span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_12">  12</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_12"></span><span class="anchor" id="line-12-3"></span>    <span class="ID">numpy_include</span> = <span class="ID">numpy</span>.<span class="ID">get_include</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_13">  13</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_13"></span><span class="anchor" id="line-13-3"></span><span class="ResWord">except</span> <span class="ID">AttributeError</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_14">  14</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_14"></span><span class="anchor" id="line-14-3"></span>    <span class="ID">numpy_include</span> = <span class="ID">numpy</span>.<span class="ID">get_numpy_include</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_15">  15</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_15"></span><span class="anchor" id="line-15-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_16">  16</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_16"></span><span class="anchor" id="line-16-3"></span><span class="Comment"># alloc extension module</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_17">  17</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_17"></span><span class="anchor" id="line-17-2"></span><span class="ID">_ezalloc</span> = <span class="ID">Extension</span>(<span class="String">&quot;</span><span class="String">_ezalloc</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_18">  18</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_18"></span><span class="anchor" id="line-18-2"></span>                   [<span class="String">&quot;</span><span class="String">ezalloc.i</span><span class="String">&quot;</span>,<span class="String">&quot;</span><span class="String">ezalloc.c</span><span class="String">&quot;</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_19">  19</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_19"></span><span class="anchor" id="line-19-2"></span>                   <span class="ID">include_dirs</span> = [<span class="ID">numpy_include</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_20">  20</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_20"></span><span class="anchor" id="line-20-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_21">  21</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_21"></span><span class="anchor" id="line-21-2"></span>                   <span class="ID">extra_compile_args</span> = [<span class="String">&quot;</span><span class="String">--verbose</span><span class="String">&quot;</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_22">  22</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_22"></span><span class="anchor" id="line-22-2"></span>                   )</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_23">  23</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_23"></span><span class="anchor" id="line-23-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_24">  24</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_24"></span><span class="anchor" id="line-24-2"></span><span class="Comment"># NumyTypemapTests setup</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_25">  25</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_25"></span><span class="anchor" id="line-25-2"></span><span class="ID">setup</span>(  <span class="ID">name</span>        = <span class="String">&quot;</span><span class="String">alloc functions</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_26">  26</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_26"></span><span class="anchor" id="line-26-2"></span>        <span class="ID">description</span> = <span class="String">&quot;</span><span class="String">Testing managed arrays</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_27">  27</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_27"></span><span class="anchor" id="line-27-2"></span>        <span class="ID">author</span>      = <span class="String">&quot;</span><span class="String">Egor Zindy</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_28">  28</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_28"></span><span class="anchor" id="line-28-2"></span>        <span class="ID">version</span>     = <span class="String">&quot;</span><span class="String">1.0</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_29">  29</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_29"></span><span class="anchor" id="line-29-2"></span>        <span class="ID">ext_modules</span> = [<span class="ID">_ezalloc</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-cc116f03a56a377e449cab7fed856d65d02db024_30">  30</a> </span><span class="LineAnchor" id="CA-cc116f03a56a377e449cab7fed856d65d02db024_30"></span><span class="anchor" id="line-30-2"></span>        )</span>
</pre></div></div><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><p class="line867">
<h2 id="Compiling_the_module">Compiling the module</h2>
<span class="anchor" id="line-172"></span><p class="line874">The setup command-line is (in Windows, using mingw): <span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><pre><span class="anchor" id="line-1"></span>$&gt; python setup_alloc.py build --compiler=mingw32</pre><span class="anchor" id="line-176"></span><p class="line874">or in UN*X, simply  <span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><pre><span class="anchor" id="line-1-1"></span>$&gt; python setup_alloc.py build</pre><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><p class="line867">
<h2 id="Testing_the_module">Testing the module</h2>
<span class="anchor" id="line-182"></span><p class="line862">If everything goes according to plan, there should be a <tt class="backtick">_ezalloc.pyd</tt> file available in the <tt class="backtick">build\lib.XXX</tt> directory. The file needs to be copied in the directory with the <tt class="backtick">ezalloc.py</tt> file (generated by swig). <span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><p class="line862">A python test program is provided in the SVN repository (<a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/test_alloc.py">test_alloc.py</a>) and reproduced below: <span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-1-11"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_1">   1</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_1"></span><span class="anchor" id="line-1-12"></span><span class="ResWord">import</span> <span class="ID">ezalloc</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_2">   2</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_2"></span><span class="anchor" id="line-2-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_3">   3</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_3"></span><span class="anchor" id="line-3-5"></span><span class="ID">n</span> = <span class="Number">2048</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_4">   4</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_4"></span><span class="anchor" id="line-4-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_5">   5</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_5"></span><span class="anchor" id="line-5-4"></span><span class="Comment"># this multiplied by sizeof(int) to get size in bytes...</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_6">   6</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_6"></span><span class="anchor" id="line-6-4"></span><span class="Comment">#assuming sizeof(int)=4 on a 32bit machine (sorry, it's late!)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_7">   7</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_7"></span><span class="anchor" id="line-7-4"></span><span class="ID">m</span> = <span class="Number">1024</span> * <span class="Number">1024</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_8">   8</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_8"></span><span class="anchor" id="line-8-4"></span><span class="ID">err</span> = <span class="Number">0</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_9">   9</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_9"></span><span class="anchor" id="line-9-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_10">  10</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_10"></span><span class="anchor" id="line-10-4"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">ARGOUTVIEWM_ARRAY1 (managed arrays) - </span><span class="String">%d</span><span class="String"> allocations (</span><span class="String">%d</span><span class="String"> bytes each)</span><span class="String">&quot;</span> % (<span class="ID">n</span>,<span class="Number">4</span>*<span class="ID">m</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_11">  11</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_11"></span><span class="anchor" id="line-11-4"></span><span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">n</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_12">  12</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_12"></span><span class="anchor" id="line-12-4"></span>    <span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_13">  13</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_13"></span><span class="anchor" id="line-13-4"></span>        <span class="Comment">#allocating some memory</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_14">  14</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_14"></span><span class="anchor" id="line-14-4"></span>        <span class="ID">a</span> = <span class="ID">ezalloc</span>.<span class="ID">alloc_managed</span>(<span class="ID">m</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_15">  15</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_15"></span><span class="anchor" id="line-15-4"></span>        <span class="Comment">#deleting the array</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_16">  16</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_16"></span><span class="anchor" id="line-16-4"></span>        <span class="ResWord">del</span> <span class="ID">a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_17">  17</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_17"></span><span class="anchor" id="line-17-3"></span>    <span class="ResWord">except</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_18">  18</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_18"></span><span class="anchor" id="line-18-3"></span>        <span class="ID">err</span> = <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_19">  19</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_19"></span><span class="anchor" id="line-19-3"></span>        <span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">Step </span><span class="String">%d</span><span class="String"> failed</span><span class="String">&quot;</span> % <span class="ID">i</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_20">  20</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_20"></span><span class="anchor" id="line-20-3"></span>        <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_21">  21</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_21"></span><span class="anchor" id="line-21-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_22">  22</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_22"></span><span class="anchor" id="line-22-3"></span><span class="ResWord">if</span> <span class="ID">err</span> == <span class="Number">0</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_23">  23</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_23"></span><span class="anchor" id="line-23-3"></span>    <span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">Done!</span><span class="SPChar">\n</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_24">  24</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_24"></span><span class="anchor" id="line-24-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_25">  25</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_25"></span><span class="anchor" id="line-25-3"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">ARGOUTVIEW_ARRAY1 (unmanaged, leaking) - </span><span class="String">%d</span><span class="String"> allocations (</span><span class="String">%d</span><span class="String"> bytes each)</span><span class="String">&quot;</span> % (<span class="ID">n</span>,<span class="Number">4</span>*<span class="ID">m</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_26">  26</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_26"></span><span class="anchor" id="line-26-3"></span><span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="ID">n</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_27">  27</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_27"></span><span class="anchor" id="line-27-3"></span>    <span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_28">  28</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_28"></span><span class="anchor" id="line-28-3"></span>        <span class="Comment">#allocating some memory</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_29">  29</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_29"></span><span class="anchor" id="line-29-3"></span>        <span class="ID">a</span> = <span class="ID">ezalloc</span>.<span class="ID">alloc_leaking</span>(<span class="ID">m</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_30">  30</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_30"></span><span class="anchor" id="line-30-3"></span>        <span class="Comment">#deleting the array</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_31">  31</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_31"></span><span class="anchor" id="line-31-2"></span>        <span class="ResWord">del</span> <span class="ID">a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_32">  32</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_32"></span><span class="anchor" id="line-32-2"></span>    <span class="ResWord">except</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_33">  33</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_33"></span><span class="anchor" id="line-33-2"></span>        <span class="ID">err</span> = <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_34">  34</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_34"></span><span class="anchor" id="line-34-2"></span>        <span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">Step </span><span class="String">%d</span><span class="String"> failed</span><span class="String">&quot;</span> % <span class="ID">i</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_35">  35</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_35"></span><span class="anchor" id="line-35-2"></span>        <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_36">  36</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_36"></span><span class="anchor" id="line-36-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_37">  37</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_37"></span><span class="anchor" id="line-37-2"></span><span class="ResWord">if</span> <span class="ID">err</span> == <span class="Number">0</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_38">  38</a> </span><span class="LineAnchor" id="CA-e55be3ca31c0879bb9e7ea5925cd27a73a6d99c8_38"></span><span class="anchor" id="line-38-2"></span>    <span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">Done? Increase n!</span><span class="SPChar">\n</span><span class="String">&quot;</span></span>
</pre></div></div><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><p class="line874">Then, a <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><pre><span class="anchor" id="line-1-2"></span>$&gt; python test_alloc.py</pre><span class="anchor" id="line-230"></span><p class="line874">will produce an output similar to this: <span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><pre><span class="anchor" id="line-1-3"></span>ARGOUTVIEWM_ARRAY1 (managed arrays) - 2048 allocations (4194304 bytes each)
<span class="anchor" id="line-2"></span>Done!
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span>ARGOUTVIEW_ARRAY1 (unmanaged, leaking) - 2048 allocations (4194304 bytes each)
<span class="anchor" id="line-5"></span>Step 483 failed</pre><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line874">The unmanaged array leaks memory every time the array view is deleted. The managed one will delete the memory block seamlessly. This was tested both in Windows XP and Linux. <span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><p class="line867">
<h1 id="A_simple_ARGOUTVIEWM_ARRAY2_example">A simple ARGOUTVIEWM_ARRAY2 example</h1>
<span class="anchor" id="line-242"></span><p class="line874">The following examples shows how to return a two-dimensional array from C which also benefits from the automatic memory deallocation. <span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><p class="line874">A naive &quot;crop&quot; function is wrapped using SWIG/numpy.i and returns a slice of the input array. <span class="anchor" id="line-245"></span>When used as <tt class="backtick">array_out&nbsp;=&nbsp;crop.crop(array_in,&nbsp;d1_0,d1_1,&nbsp;d2_0,d2_1)</tt>, it is equivalent to the native numpy slicing <tt class="backtick">array_out&nbsp;=&nbsp;array_in[d1_0:d1_1,&nbsp;d2_0:d2_1]</tt>. <span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line867">
<h2 id="The_C_source_.28crop.c_and_crop.h.29">The C source (crop.c and crop.h)</h2>
<span class="anchor" id="line-249"></span><p class="line862">Here is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/crop.h">crop.h</a> file: <span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-1-13"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-7d1fcf24cac71623958f9e57a38c0acacfd53081\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-7d1fcf24cac71623958f9e57a38c0acacfd53081" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-7d1fcf24cac71623958f9e57a38c0acacfd53081_1">   1</a> </span><span class="LineAnchor" id="CA-7d1fcf24cac71623958f9e57a38c0acacfd53081_1"></span><span class="anchor" id="line-1-14"></span><span class="ResWord">void</span> <span class="ID">crop</span>(<span class="ResWord">int</span> *<span class="ID">arr_in</span>, <span class="ResWord">int</span> <span class="ID">dim1</span>, <span class="ResWord">int</span> <span class="ID">dim2</span>, <span class="ResWord">int</span> <span class="ID">d1_0</span>, <span class="ResWord">int</span> <span class="ID">d1_1</span>, <span class="ResWord">int</span> <span class="ID">d2_0</span>, <span class="ResWord">int</span> <span class="ID">d2_1</span>, <span class="ResWord">int</span> **<span class="ID">arr_out</span>, <span class="ResWord">int</span> *<span class="ID">dim1_out</span>, <span class="ResWord">int</span> *<span class="ID">dim2_out</span>);</span>
</pre></div></div><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><p class="line862">Here is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/crop.c">crop.c</a> file: <span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-1-15"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_1">   1</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_1"></span><span class="anchor" id="line-1-16"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdlib.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_2">   2</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_2"></span><span class="anchor" id="line-2-6"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &lt;errno.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_3">   3</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_3"></span><span class="anchor" id="line-3-6"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_4">   4</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_4"></span><span class="anchor" id="line-4-5"></span><span class="Preprc">#</span><span class="Preprc">include &quot;crop.h&quot;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_5">   5</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_5"></span><span class="anchor" id="line-5-5"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_6">   6</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_6"></span><span class="anchor" id="line-6-5"></span><span class="ResWord">void</span> <span class="ID">crop</span>(<span class="ResWord">int</span> *<span class="ID">arr_in</span>, <span class="ResWord">int</span> <span class="ID">dim1</span>, <span class="ResWord">int</span> <span class="ID">dim2</span>, <span class="ResWord">int</span> <span class="ID">d1_0</span>, <span class="ResWord">int</span> <span class="ID">d1_1</span>, <span class="ResWord">int</span> <span class="ID">d2_0</span>, <span class="ResWord">int</span> <span class="ID">d2_1</span>, <span class="ResWord">int</span> **<span class="ID">arr_out</span>, <span class="ResWord">int</span> *<span class="ID">dim1_out</span>, <span class="ResWord">int</span> *<span class="ID">dim2_out</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_7">   7</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_7"></span><span class="anchor" id="line-7-5"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_8">   8</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_8"></span><span class="anchor" id="line-8-5"></span>    <span class="ResWord">int</span> *<span class="ID">arr</span>=<span class="ResWord">NULL</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_9">   9</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_9"></span><span class="anchor" id="line-9-5"></span>    <span class="ResWord">int</span> <span class="ID">dim1_o</span>=<span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_10">  10</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_10"></span><span class="anchor" id="line-10-5"></span>    <span class="ResWord">int</span> <span class="ID">dim2_o</span>=<span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_11">  11</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_11"></span><span class="anchor" id="line-11-5"></span>    <span class="ResWord">int</span> <span class="ID">i</span>,<span class="ID">j</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_12">  12</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_12"></span><span class="anchor" id="line-12-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_13">  13</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_13"></span><span class="anchor" id="line-13-5"></span>    <span class="Comment">//value checks</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_14">  14</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_14"></span><span class="anchor" id="line-14-5"></span><span class="Comment"></span>    <span class="ResWord">if</span> ((<span class="ID">d1_1</span> &lt; <span class="ID">d1_0</span>) || (<span class="ID">d2_1</span> &lt; <span class="ID">d2_0</span>) ||</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_15">  15</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_15"></span><span class="anchor" id="line-15-5"></span>        (<span class="ID">d1_0</span> &gt;= <span class="ID">dim1</span>) || (<span class="ID">d1_1</span> &gt;= <span class="ID">dim1</span>) || (<span class="ID">d1_0</span> &lt; <span class="Number">0</span>) || (<span class="ID">d1_1</span> &lt; <span class="Number">0</span>) ||</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_16">  16</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_16"></span><span class="anchor" id="line-16-5"></span>        (<span class="ID">d2_0</span> &gt;= <span class="ID">dim2</span>) || (<span class="ID">d2_1</span> &gt;= <span class="ID">dim2</span>) || (<span class="ID">d2_0</span> &lt; <span class="Number">0</span>) || (<span class="ID">d2_1</span> &lt; <span class="Number">0</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_17">  17</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_17"></span><span class="anchor" id="line-17-4"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_18">  18</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_18"></span><span class="anchor" id="line-18-4"></span>        <span class="ID">errno</span> = <span class="ID">EPERM</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_19">  19</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_19"></span><span class="anchor" id="line-19-4"></span>        <span class="ResWord">goto</span> <span class="ID">end</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_20">  20</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_20"></span><span class="anchor" id="line-20-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_21">  21</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_21"></span><span class="anchor" id="line-21-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_22">  22</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_22"></span><span class="anchor" id="line-22-4"></span>    <span class="Comment">//output sizes</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_23">  23</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_23"></span><span class="anchor" id="line-23-4"></span><span class="Comment"></span>    <span class="ID">dim1_o</span> = <span class="ID">d1_1</span>-<span class="ID">d1_0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_24">  24</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_24"></span><span class="anchor" id="line-24-4"></span>    <span class="ID">dim2_o</span> = <span class="ID">d2_1</span>-<span class="ID">d2_0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_25">  25</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_25"></span><span class="anchor" id="line-25-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_26">  26</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_26"></span><span class="anchor" id="line-26-4"></span>    <span class="Comment">//memory allocation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_27">  27</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_27"></span><span class="anchor" id="line-27-4"></span><span class="Comment"></span>    <span class="ID">arr</span> = (<span class="ResWord">int</span> *)<span class="ID">malloc</span>(<span class="ID">dim1_o</span>*<span class="ID">dim2_o</span>*<span class="ResWord">sizeof</span>(<span class="ResWord">int</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_28">  28</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_28"></span><span class="anchor" id="line-28-4"></span>    <span class="ResWord">if</span> (<span class="ID">arr</span> == <span class="ResWord">NULL</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_29">  29</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_29"></span><span class="anchor" id="line-29-4"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_30">  30</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_30"></span><span class="anchor" id="line-30-4"></span>        <span class="ID">errno</span> = <span class="ID">ENOMEM</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_31">  31</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_31"></span><span class="anchor" id="line-31-3"></span>        <span class="ResWord">goto</span> <span class="ID">end</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_32">  32</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_32"></span><span class="anchor" id="line-32-3"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_33">  33</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_33"></span><span class="anchor" id="line-33-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_34">  34</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_34"></span><span class="anchor" id="line-34-3"></span>    <span class="Comment">//copying the cropped arr_in region to arr (naive implementation)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_35">  35</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_35"></span><span class="anchor" id="line-35-3"></span><span class="Comment"></span>    <span class="ID">printf</span>(<span class="String">&quot;</span><span class="SPChar">\n</span><span class="String">--- d1_0=%d d1_1=%d (rows)  -- d2_0=%d d2_1=%d (columns)</span><span class="SPChar">\n</span><span class="String">&quot;</span>,<span class="ID">d1_0</span>,<span class="ID">d1_1</span>,<span class="ID">d2_0</span>,<span class="ID">d2_1</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_36">  36</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_36"></span><span class="anchor" id="line-36-3"></span>    <span class="ResWord">for</span> (<span class="ID">j</span>=<span class="Number">0</span>; <span class="ID">j</span>&lt;<span class="ID">dim1_o</span>; <span class="ID">j</span>++)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_37">  37</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_37"></span><span class="anchor" id="line-37-3"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_38">  38</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_38"></span><span class="anchor" id="line-38-3"></span>        <span class="ResWord">for</span> (<span class="ID">i</span>=<span class="Number">0</span>; <span class="ID">i</span>&lt;<span class="ID">dim2_o</span>; <span class="ID">i</span>++)</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_39">  39</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_39"></span><span class="anchor" id="line-39-2"></span>        {</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_40">  40</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_40"></span><span class="anchor" id="line-40-2"></span>            <span class="ID">arr</span>[<span class="ID">j</span>*<span class="ID">dim2_o</span>+<span class="ID">i</span>] = <span class="ID">arr_in</span>[(<span class="ID">j</span>+<span class="ID">d1_0</span>)*<span class="ID">dim2</span>+(<span class="ID">i</span>+<span class="ID">d2_0</span>)];</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_41">  41</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_41"></span><span class="anchor" id="line-41-2"></span>            <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">%d </span><span class="String">&quot;</span>,<span class="ID">arr</span>[<span class="ID">j</span>*<span class="ID">dim2_o</span>+<span class="ID">i</span>]);</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_42">  42</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_42"></span><span class="anchor" id="line-42-2"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_43">  43</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_43"></span><span class="anchor" id="line-43-2"></span>        <span class="ID">printf</span>(<span class="String">&quot;</span><span class="SPChar">\n</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_44">  44</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_44"></span><span class="anchor" id="line-44-2"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_45">  45</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_45"></span><span class="anchor" id="line-45-2"></span>    <span class="ID">printf</span>(<span class="String">&quot;</span><span class="String">---</span><span class="SPChar">\n</span><span class="SPChar">\n</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_46">  46</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_46"></span><span class="anchor" id="line-46-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_47">  47</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_47"></span><span class="anchor" id="line-47-2"></span><span class="ID">end</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_48">  48</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_48"></span><span class="anchor" id="line-48-2"></span>    *<span class="ID">dim1_out</span> = <span class="ID">dim1_o</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_49">  49</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_49"></span><span class="anchor" id="line-49-2"></span>    *<span class="ID">dim2_out</span> = <span class="ID">dim2_o</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_50">  50</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_50"></span><span class="anchor" id="line-50-2"></span>    *<span class="ID">arr_out</span> = <span class="ID">arr</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_51">  51</a> </span><span class="LineAnchor" id="CA-ec4b3145f23b269e90ccbf0a5733366efe9ff6e2_51"></span><span class="anchor" id="line-51-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><p class="line867">
<h2 id="The_interface_file_.28crop.i.29">The interface file (crop.i)</h2>
<span class="anchor" id="line-310"></span><p class="line862">The file (available here: <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/crop.i">crop.i</a>) does a couple of interesting things: <span class="anchor" id="line-311"></span><ul><li>The array dimensions DIM1 and DIM2 are in the same order as array.shape on the Python side. In a row major array definition for an image, DIM1 would the number of rows and DIM2 the number of columns. <span class="anchor" id="line-312"></span></li><li>Using the errno library, An exception is generated when memory allocation fails (ENOMEM) or when a problem occurs with the indexes (EPERM). <span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span></li></ul><p class="line867"><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-1-17"></span><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_1">   1</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_1"></span><span class="anchor" id="line-1-18"></span>%<span class="ID">module</span> <span class="ID">crop</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_2">   2</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_2"></span><span class="anchor" id="line-2-7"></span>%{</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_3">   3</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_3"></span><span class="anchor" id="line-3-7"></span><span class="Preprc">#</span><span class="Preprc">include &lt;errno.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_4">   4</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_4"></span><span class="anchor" id="line-4-6"></span><span class="Preprc"></span><span class="Preprc">#</span><span class="Preprc">include &quot;crop.h&quot;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_5">   5</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_5"></span><span class="anchor" id="line-5-6"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_6">   6</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_6"></span><span class="anchor" id="line-6-6"></span><span class="Preprc">#</span><span class="Preprc">define SWIG_FILE_WITH_INIT</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_7">   7</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_7"></span><span class="anchor" id="line-7-6"></span><span class="Preprc"></span>%}</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_8">   8</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_8"></span><span class="anchor" id="line-8-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_9">   9</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_9"></span><span class="anchor" id="line-9-6"></span>%<span class="ID">include</span> <span class="String">&quot;</span><span class="String">numpy.i</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_10">  10</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_10"></span><span class="anchor" id="line-10-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_11">  11</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_11"></span><span class="anchor" id="line-11-6"></span>%<span class="ID">init</span> %{</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_12">  12</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_12"></span><span class="anchor" id="line-12-6"></span>    <span class="ID">import_array</span>();</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_13">  13</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_13"></span><span class="anchor" id="line-13-6"></span>%}</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_14">  14</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_14"></span><span class="anchor" id="line-14-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_15">  15</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_15"></span><span class="anchor" id="line-15-6"></span>%<span class="ID">exception</span> <span class="ID">crop</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_16">  16</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_16"></span><span class="anchor" id="line-16-6"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_17">  17</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_17"></span><span class="anchor" id="line-17-5"></span>    <span class="ID">errno</span> = <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_18">  18</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_18"></span><span class="anchor" id="line-18-5"></span>    $<span class="ID">action</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_19">  19</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_19"></span><span class="anchor" id="line-19-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_20">  20</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_20"></span><span class="anchor" id="line-20-5"></span>    <span class="ResWord">if</span> (<span class="ID">errno</span> != <span class="Number">0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_21">  21</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_21"></span><span class="anchor" id="line-21-5"></span>    {</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_22">  22</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_22"></span><span class="anchor" id="line-22-5"></span>        <span class="ResWord">switch</span>(<span class="ID">errno</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_23">  23</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_23"></span><span class="anchor" id="line-23-5"></span>        {</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_24">  24</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_24"></span><span class="anchor" id="line-24-5"></span>            <span class="ResWord">case</span> <span class="ID">EPERM</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_25">  25</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_25"></span><span class="anchor" id="line-25-5"></span>                <span class="ID">PyErr_Format</span>(<span class="ID">PyExc_IndexError</span>, <span class="String">&quot;</span><span class="String">Index error</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_26">  26</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_26"></span><span class="anchor" id="line-26-5"></span>                <span class="ResWord">break</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_27">  27</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_27"></span><span class="anchor" id="line-27-5"></span>            <span class="ResWord">case</span> <span class="ID">ENOMEM</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_28">  28</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_28"></span><span class="anchor" id="line-28-5"></span>                <span class="ID">PyErr_Format</span>(<span class="ID">PyExc_MemoryError</span>, <span class="String">&quot;</span><span class="String">Not enough memory</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_29">  29</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_29"></span><span class="anchor" id="line-29-5"></span>                <span class="ResWord">break</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_30">  30</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_30"></span><span class="anchor" id="line-30-5"></span>            <span class="ResWord">default</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_31">  31</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_31"></span><span class="anchor" id="line-31-4"></span>                <span class="ID">PyErr_Format</span>(<span class="ID">PyExc_Exception</span>, <span class="String">&quot;</span><span class="String">Unknown exception</span><span class="String">&quot;</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_32">  32</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_32"></span><span class="anchor" id="line-32-4"></span>        }</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_33">  33</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_33"></span><span class="anchor" id="line-33-4"></span>        <span class="ID">SWIG_fail</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_34">  34</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_34"></span><span class="anchor" id="line-34-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_35">  35</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_35"></span><span class="anchor" id="line-35-4"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_36">  36</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_36"></span><span class="anchor" id="line-36-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_37">  37</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_37"></span><span class="anchor" id="line-37-4"></span>%<span class="ID">apply</span> (<span class="ResWord">int</span>* <span class="ID">IN_ARRAY2</span>, <span class="ResWord">int</span> <span class="ID">DIM1</span>, <span class="ResWord">int</span> <span class="ID">DIM2</span>) {(<span class="ResWord">int</span> *<span class="ID">arr_in</span>, <span class="ResWord">int</span> <span class="ID">dim1</span>, <span class="ResWord">int</span> <span class="ID">dim2</span>)}</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_38">  38</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_38"></span><span class="anchor" id="line-38-4"></span>%<span class="ID">apply</span> (<span class="ResWord">int</span>** <span class="ID">ARGOUTVIEWM_ARRAY2</span>, <span class="ResWord">int</span>* <span class="ID">DIM1</span>, <span class="ResWord">int</span>* <span class="ID">DIM2</span>) {(<span class="ResWord">int</span> **<span class="ID">arr_out</span>, <span class="ResWord">int</span> *<span class="ID">dim1_out</span>, <span class="ResWord">int</span> *<span class="ID">dim2_out</span>)}</span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_39">  39</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_39"></span><span class="anchor" id="line-39-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_40">  40</a> </span><span class="LineAnchor" id="CA-05e9e3fcadbf8b144719ac9091c2de055e971e3d_40"></span><span class="anchor" id="line-40-3"></span>%<span class="ID">include</span> <span class="String">&quot;</span><span class="String">crop.h</span><span class="String">&quot;</span></span>
</pre></div></div><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><p class="line862">Don't forget that you will need the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/numpy.i">numpy.i</a> file in the same directory for this to compile. <span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><p class="line867">
<h2 id="Setup_file_.28setup_crop.py.29">Setup file (setup_crop.py)</h2>
<span class="anchor" id="line-360"></span><p class="line862">This is the <a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/setup_crop.py">setup_crop.py</a> file: <span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span><span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span><span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span><span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span><span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span><span class="anchor" id="line-393"></span><span class="anchor" id="line-1-19"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-369ae09a7caecde96329a97907c117fff5de9f39\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-369ae09a7caecde96329a97907c117fff5de9f39" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_1">   1</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_1"></span><span class="anchor" id="line-1-20"></span><span class="Comment">#! /usr/bin/env python</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_2">   2</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_2"></span><span class="anchor" id="line-2-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_3">   3</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_3"></span><span class="anchor" id="line-3-8"></span><span class="Comment"># System imports</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_4">   4</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_4"></span><span class="anchor" id="line-4-7"></span><span class="ResWord">from</span> <span class="ID">distutils.core</span> <span class="ResWord">import</span> *</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_5">   5</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_5"></span><span class="anchor" id="line-5-7"></span><span class="ResWord">from</span> <span class="ID">distutils</span>      <span class="ResWord">import</span> <span class="ID">sysconfig</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_6">   6</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_6"></span><span class="anchor" id="line-6-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_7">   7</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_7"></span><span class="anchor" id="line-7-7"></span><span class="Comment"># Third-party modules - we depend on numpy for everything</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_8">   8</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_8"></span><span class="anchor" id="line-8-7"></span><span class="ResWord">import</span> <span class="ID">numpy</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_9">   9</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_9"></span><span class="anchor" id="line-9-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_10">  10</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_10"></span><span class="anchor" id="line-10-7"></span><span class="Comment"># Obtain the numpy include directory.  This logic works across numpy versions.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_11">  11</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_11"></span><span class="anchor" id="line-11-7"></span><span class="ResWord">try</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_12">  12</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_12"></span><span class="anchor" id="line-12-7"></span>    <span class="ID">numpy_include</span> = <span class="ID">numpy</span>.<span class="ID">get_include</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_13">  13</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_13"></span><span class="anchor" id="line-13-7"></span><span class="ResWord">except</span> <span class="ID">AttributeError</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_14">  14</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_14"></span><span class="anchor" id="line-14-7"></span>    <span class="ID">numpy_include</span> = <span class="ID">numpy</span>.<span class="ID">get_numpy_include</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_15">  15</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_15"></span><span class="anchor" id="line-15-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_16">  16</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_16"></span><span class="anchor" id="line-16-7"></span><span class="Comment"># crop extension module</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_17">  17</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_17"></span><span class="anchor" id="line-17-6"></span><span class="ID">_crop</span> = <span class="ID">Extension</span>(<span class="String">&quot;</span><span class="String">_crop</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_18">  18</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_18"></span><span class="anchor" id="line-18-6"></span>                   [<span class="String">&quot;</span><span class="String">crop.i</span><span class="String">&quot;</span>,<span class="String">&quot;</span><span class="String">crop.c</span><span class="String">&quot;</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_19">  19</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_19"></span><span class="anchor" id="line-19-6"></span>                   <span class="ID">include_dirs</span> = [<span class="ID">numpy_include</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_20">  20</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_20"></span><span class="anchor" id="line-20-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_21">  21</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_21"></span><span class="anchor" id="line-21-6"></span>                   <span class="ID">extra_compile_args</span> = [<span class="String">&quot;</span><span class="String">--verbose</span><span class="String">&quot;</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_22">  22</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_22"></span><span class="anchor" id="line-22-6"></span>                   )</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_23">  23</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_23"></span><span class="anchor" id="line-23-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_24">  24</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_24"></span><span class="anchor" id="line-24-6"></span><span class="Comment"># NumyTypemapTests setup</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_25">  25</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_25"></span><span class="anchor" id="line-25-6"></span><span class="ID">setup</span>(  <span class="ID">name</span>        = <span class="String">&quot;</span><span class="String">crop test</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_26">  26</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_26"></span><span class="anchor" id="line-26-6"></span>        <span class="ID">description</span> = <span class="String">&quot;</span><span class="String">A simple crop test to demonstrate the use of ARGOUTVIEWM_ARRAY2</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_27">  27</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_27"></span><span class="anchor" id="line-27-6"></span>        <span class="ID">author</span>      = <span class="String">&quot;</span><span class="String">Egor Zindy</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_28">  28</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_28"></span><span class="anchor" id="line-28-6"></span>        <span class="ID">version</span>     = <span class="String">&quot;</span><span class="String">1.0</span><span class="String">&quot;</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_29">  29</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_29"></span><span class="anchor" id="line-29-6"></span>        <span class="ID">ext_modules</span> = [<span class="ID">_crop</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-369ae09a7caecde96329a97907c117fff5de9f39_30">  30</a> </span><span class="LineAnchor" id="CA-369ae09a7caecde96329a97907c117fff5de9f39_30"></span><span class="anchor" id="line-30-6"></span>        )</span>
</pre></div></div><span class="anchor" id="line-394"></span><span class="anchor" id="line-395"></span><p class="line867">
<h2 id="Testing_the_module-1">Testing the module</h2>
<span class="anchor" id="line-396"></span><p class="line862">If everything goes according to plan, there should be a <tt class="backtick">_crop.pyd</tt> file available in the <tt class="backtick">build\lib.XXX</tt> directory. The file needs to be copied in the directory with the <tt class="backtick">crop.py</tt> file (generated by swig). <span class="anchor" id="line-397"></span><span class="anchor" id="line-398"></span><p class="line862">A python test program is provided in the SVN repository (<a class="http" href="../../external.html?link=http://ezwidgets.googlecode.com/svn/trunk/numpy/test_crop.py">test_crop.py</a>) and reproduced below: <span class="anchor" id="line-399"></span><span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span><span class="anchor" id="line-422"></span><span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span><span class="anchor" id="line-425"></span><span class="anchor" id="line-1-21"></span><div class="highlight python"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_1">   1</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_1"></span><span class="anchor" id="line-1-22"></span><span class="ResWord">import</span> <span class="ID">crop</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_2">   2</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_2"></span><span class="anchor" id="line-2-9"></span><span class="ResWord">import</span> <span class="ID">numpy</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_3">   3</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_3"></span><span class="anchor" id="line-3-9"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_4">   4</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_4"></span><span class="anchor" id="line-4-8"></span><span class="ID">a</span> = <span class="ID">numpy</span>.<span class="ID">zeros</span>((<span class="Number">5</span>,<span class="Number">10</span>),<span class="ID">numpy</span>.<span class="ID">int</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_5">   5</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_5"></span><span class="anchor" id="line-5-8"></span><span class="ID">a</span>[<span class="ID">numpy</span>.<span class="ID">arange</span>(<span class="Number">5</span>),:] = <span class="ID">numpy</span>.<span class="ID">arange</span>(<span class="Number">10</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_6">   6</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_6"></span><span class="anchor" id="line-6-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_7">   7</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_7"></span><span class="anchor" id="line-7-8"></span><span class="ID">b</span> = <span class="ID">numpy</span>.<span class="ID">transpose</span>([(<span class="Number">10</span> ** <span class="ID">numpy</span>.<span class="ID">arange</span>(<span class="Number">5</span>))])</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_8">   8</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_8"></span><span class="anchor" id="line-8-8"></span><span class="ID">a</span> = (<span class="ID">a</span>*<span class="ID">b</span>)[:,<span class="Number">1</span>:] <span class="Comment">#this array is most likely NOT contiguous</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_9">   9</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_9"></span><span class="anchor" id="line-9-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_10">  10</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_10"></span><span class="anchor" id="line-10-8"></span><span class="ResWord">print</span> <span class="ID">a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_11">  11</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_11"></span><span class="anchor" id="line-11-8"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">dim1=</span><span class="String">%d</span><span class="String"> dim2=</span><span class="String">%d</span><span class="String">&quot;</span> % (<span class="ID">a</span>.<span class="ID">shape</span>[<span class="Number">0</span>],<span class="ID">a</span>.<span class="ID">shape</span>[<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_12">  12</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_12"></span><span class="anchor" id="line-12-8"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_13">  13</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_13"></span><span class="anchor" id="line-13-8"></span><span class="ID">d1_0</span> = <span class="Number">2</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_14">  14</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_14"></span><span class="anchor" id="line-14-8"></span><span class="ID">d1_1</span> = <span class="Number">4</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_15">  15</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_15"></span><span class="anchor" id="line-15-8"></span><span class="ID">d2_0</span> = <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_16">  16</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_16"></span><span class="anchor" id="line-16-8"></span><span class="ID">d2_1</span> = <span class="Number">5</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_17">  17</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_17"></span><span class="anchor" id="line-17-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_18">  18</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_18"></span><span class="anchor" id="line-18-7"></span><span class="ID">c</span> = <span class="ID">crop</span>.<span class="ID">crop</span>(<span class="ID">a</span>, <span class="ID">d1_0</span>,<span class="ID">d1_1</span>, <span class="ID">d2_0</span>,<span class="ID">d2_1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_19">  19</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_19"></span><span class="anchor" id="line-19-7"></span><span class="ID">d</span> = <span class="ID">a</span>[<span class="ID">d1_0</span>:<span class="ID">d1_1</span>, <span class="ID">d2_0</span>:<span class="ID">d2_1</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_20">  20</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_20"></span><span class="anchor" id="line-20-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_21">  21</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_21"></span><span class="anchor" id="line-21-7"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">returned array:</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_22">  22</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_22"></span><span class="anchor" id="line-22-7"></span><span class="ResWord">print</span> <span class="ID">c</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_23">  23</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_23"></span><span class="anchor" id="line-23-7"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_24">  24</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_24"></span><span class="anchor" id="line-24-7"></span><span class="ResWord">print</span> <span class="String">&quot;</span><span class="String">native slicing:</span><span class="String">&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_25">  25</a> </span><span class="LineAnchor" id="CA-5fd6d4c6ad80deb77045dbc13d42998500064a3c_25"></span><span class="anchor" id="line-25-7"></span><span class="ResWord">print</span> <span class="ID">d</span></span>
</pre></div></div><span class="anchor" id="line-426"></span><span class="anchor" id="line-427"></span><p class="line874">This is what the output looks like: <span class="anchor" id="line-428"></span><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><span class="anchor" id="line-431"></span><span class="anchor" id="line-432"></span><span class="anchor" id="line-433"></span><span class="anchor" id="line-434"></span><span class="anchor" id="line-435"></span><span class="anchor" id="line-436"></span><span class="anchor" id="line-437"></span><span class="anchor" id="line-438"></span><span class="anchor" id="line-439"></span><span class="anchor" id="line-440"></span><span class="anchor" id="line-441"></span><span class="anchor" id="line-442"></span><span class="anchor" id="line-443"></span><span class="anchor" id="line-444"></span><span class="anchor" id="line-445"></span><span class="anchor" id="line-446"></span><span class="anchor" id="line-447"></span><span class="anchor" id="line-448"></span><pre><span class="anchor" id="line-1-4"></span>$ python test_crop.py 
<span class="anchor" id="line-2-1"></span>[[    1     2     3     4     5     6     7     8     9]
<span class="anchor" id="line-3-1"></span> [   10    20    30    40    50    60    70    80    90]
<span class="anchor" id="line-4-1"></span> [  100   200   300   400   500   600   700   800   900]
<span class="anchor" id="line-5-1"></span> [ 1000  2000  3000  4000  5000  6000  7000  8000  9000]
<span class="anchor" id="line-6"></span> [10000 20000 30000 40000 50000 60000 70000 80000 90000]]
<span class="anchor" id="line-7"></span>dim1=5 dim2=9
<span class="anchor" id="line-8"></span>
<span class="anchor" id="line-9"></span>--- d1_0=2 d1_1=4 (rows)  -- d2_0=1 d2_1=5 (columns)
<span class="anchor" id="line-10"></span>200 300 400 500 
<span class="anchor" id="line-11"></span>2000 3000 4000 5000 
<span class="anchor" id="line-12"></span>---
<span class="anchor" id="line-13"></span>
<span class="anchor" id="line-14"></span>returned array:
<span class="anchor" id="line-15"></span>[[ 200  300  400  500]
<span class="anchor" id="line-16"></span> [2000 3000 4000 5000]]
<span class="anchor" id="line-17"></span>native slicing:
<span class="anchor" id="line-18"></span>[[ 200  300  400  500]
<span class="anchor" id="line-19"></span> [2000 3000 4000 5000]]</pre><span class="anchor" id="line-449"></span><span class="anchor" id="line-450"></span><p class="line874">numpy.i takes care of making the array contiguous if needed, so the only thing left to take care of is the array orientation.  <span class="anchor" id="line-451"></span><span class="anchor" id="line-452"></span><p class="line867">
<h1 id="Conclusion_and_comments">Conclusion and comments</h1>
<span class="anchor" id="line-453"></span><p class="line862">That's all folks! Files are available on the <a class="http" href="../../external.html?link=http://code.google.com/p/ezwidgets/source/browse/#svn/trunk/numpy">Google code SVN</a>. As usual, comments welcome! <span class="anchor" id="line-454"></span><span class="anchor" id="line-455"></span><p class="line874">Regards, <span class="anchor" id="line-456"></span>Egor <span class="anchor" id="line-457"></span><span class="anchor" id="line-458"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-459"></span><a href="../CategoryCookbook.html">CategoryCookbook</a> <span class="anchor" id="line-460"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">SciPy: Cookbook/SWIG_Memory_Deallocation  (last edited 2015-10-24 17:48:26 by <span title="">anonymous</span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="SWIG_Memory_Deallocation37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../../external.html?link=http://localhost:8080/Cookbook/SWIG_Memory_Deallocation">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/Cookbook/SWIG_Memory_Deallocation by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 20:22:58 GMT -->
</html>

