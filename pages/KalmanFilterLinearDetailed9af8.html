<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/KalmanFilterLinearDetailed?action=AttachFile&do=view&target=kalman.py by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 21:48:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="noindex,nofollow">

<title>attachment:kalman.py of KalmanFilterLinearDetailed - SciPy wiki dump</title>
<script type="text/javascript" src="moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: KalmanFilterLinearDetailed" href="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=KalmanFilterLinearDetailed&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed?action=print">
<link rel="Appendix" title="kalman.py" href="KalmanFilterLinearDetailed9af8.html?action=AttachFile&amp;do=view&amp;target=kalman.py">
<link rel="Appendix" title="kalman_filter_constantValue.png" href="KalmanFilterLinearDetailed393b.html?action=AttachFile&amp;do=view&amp;target=kalman_filter_constantValue.png">
<link rel="Appendix" title="kalman_filter_tank.png" href="KalmanFilterLinearDetailed8445.html?action=AttachFile&amp;do=view&amp;target=kalman_filter_tank.png">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr"><div style="background: white; width:100%; padding:2em;">This is an archival dump of old wiki content --- see <a href="http://scipy.org/">scipy.org</a> for current material</div>

<div id="header">


<form id="searchform" method="get" action="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="KalmanFilterLinearDetailed456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li>attachment:kalman.py of KalmanFilterLinearDetailed</li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="HelpContents.html">HelpContents</a></li><li class="current"><a href="KalmanFilterLinearDetailed.html">KalmanFilte...earDetailed</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="KalmanFilterLinearDetailed37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<h2>Attachment 'kalman.py'</h2><a class="download" href="kalmanc517.py?action=AttachFile&amp;do=get&amp;target=kalman.py">Download</a><br><br><span class="anchor" id="line-1"></span><div class="highlight text"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_1">   1</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_1"></span><span class="anchor" id="line-1-1"></span><span class="Comment">###############################################################################</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_2">   2</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_2"></span><span class="anchor" id="line-2"></span><span class="Comment">#    Copyright (C) 2007 by Eike Welk                                          #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_3">   3</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_3"></span><span class="anchor" id="line-3"></span><span class="Comment">#    eike.welk@gmx.net                                                        #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_4">   4</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_4"></span><span class="anchor" id="line-4"></span><span class="Comment">#                                                                             #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_5">   5</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_5"></span><span class="anchor" id="line-5"></span><span class="Comment">#    Permission is hereby granted, free of charge, to any person obtaining    #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_6">   6</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_6"></span><span class="anchor" id="line-6"></span><span class="Comment">#    a copy of this software and associated documentation files (the          #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_7">   7</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_7"></span><span class="anchor" id="line-7"></span><span class="Comment">#    &quot;Software&quot;), to deal in the Software without restriction, including      #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_8">   8</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_8"></span><span class="anchor" id="line-8"></span><span class="Comment">#    without limitation the rights to use, copy, modify, merge, publish,      #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_9">   9</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_9"></span><span class="anchor" id="line-9"></span><span class="Comment">#    distribute, sublicense, and#or sell copies of the Software, and to       #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_10">  10</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_10"></span><span class="anchor" id="line-10"></span><span class="Comment">#    permit persons to whom the Software is furnished to do so, subject to    #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_11">  11</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_11"></span><span class="anchor" id="line-11"></span><span class="Comment">#    the following conditions:                                                #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_12">  12</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_12"></span><span class="anchor" id="line-12"></span><span class="Comment">#                                                                             #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_13">  13</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_13"></span><span class="anchor" id="line-13"></span><span class="Comment">#    The above copyright notice and this permission notice shall be           #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_14">  14</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_14"></span><span class="anchor" id="line-14"></span><span class="Comment">#    included in all copies or substantial portions of the Software.          #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_15">  15</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_15"></span><span class="anchor" id="line-15"></span><span class="Comment">#                                                                             #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_16">  16</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_16"></span><span class="anchor" id="line-16"></span><span class="Comment">#    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,          #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_17">  17</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_17"></span><span class="anchor" id="line-17"></span><span class="Comment">#    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF       #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_18">  18</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_18"></span><span class="anchor" id="line-18"></span><span class="Comment">#    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.   #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_19">  19</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_19"></span><span class="anchor" id="line-19"></span><span class="Comment">#    IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR        #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_20">  20</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_20"></span><span class="anchor" id="line-20"></span><span class="Comment">#    OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,    #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_21">  21</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_21"></span><span class="anchor" id="line-21"></span><span class="Comment">#    ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR    #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_22">  22</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_22"></span><span class="anchor" id="line-22"></span><span class="Comment">#    OTHER DEALINGS IN THE SOFTWARE.                                          #</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_23">  23</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_23"></span><span class="anchor" id="line-23"></span><span class="Comment">###############################################################################</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_24">  24</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_24"></span><span class="anchor" id="line-24"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_25">  25</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_25"></span><span class="anchor" id="line-25"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_26">  26</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_26"></span><span class="anchor" id="line-26"></span><span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_27">  27</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_27"></span><span class="anchor" id="line-27"></span><span class="String">Naive but fairly general implementation of a Kalman Filter, together with</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_28">  28</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_28"></span><span class="anchor" id="line-28"></span><span class="String">some examples.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_29">  29</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_29"></span><span class="anchor" id="line-29"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_30">  30</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_30"></span><span class="anchor" id="line-30"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_31">  31</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_31"></span><span class="anchor" id="line-31"></span><span class="String">This program is based on the following paper:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_32">  32</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_32"></span><span class="anchor" id="line-32"></span><span class="String">    Greg Welsh and Garry Bishop. An Introduction to the Kalman Filter.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_33">  33</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_33"></span><span class="anchor" id="line-33"></span><span class="String">    http://www.cs.unc.edu/~welch/kalman/kalmanIntro.html</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_34">  34</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_34"></span><span class="anchor" id="line-34"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_35">  35</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_35"></span><span class="anchor" id="line-35"></span><span class="String">See also:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_36">  36</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_36"></span><span class="anchor" id="line-36"></span><span class="String">    http://en.wikipedia.org/wiki/Kalman_filter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_37">  37</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_37"></span><span class="anchor" id="line-37"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_38">  38</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_38"></span><span class="anchor" id="line-38"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_39">  39</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_39"></span><span class="anchor" id="line-39"></span><span class="String">A Kalman filter is an Algorithm to estimate the states of a linear system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_40">  40</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_40"></span><span class="anchor" id="line-40"></span><span class="String">from noisy measurements. It must know the system's parameters, as well as</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_41">  41</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_41"></span><span class="anchor" id="line-41"></span><span class="String">the (noisy) inputs and outputs.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_42">  42</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_42"></span><span class="anchor" id="line-42"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_43">  43</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_43"></span><span class="anchor" id="line-43"></span><span class="String">A linear system can be interpreted as a system of linear differential</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_44">  44</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_44"></span><span class="anchor" id="line-44"></span><span class="String">equations, in a time discete form. Therfore the state variables of many</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_45">  45</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_45"></span><span class="anchor" id="line-45"></span><span class="String">physical systems can be estimated by a Kalman Filter. But there does not</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_46">  46</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_46"></span><span class="anchor" id="line-46"></span><span class="String">need to be an interpretation as a differential equation. Welsh and Bishop</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_47">  47</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_47"></span><span class="anchor" id="line-47"></span><span class="String">(the authors of the paper above) use the Kalman Filter to predict the</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_48">  48</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_48"></span><span class="anchor" id="line-48"></span><span class="String">position of moving objects in image sequences (IMHO).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_49">  49</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_49"></span><span class="anchor" id="line-49"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_50">  50</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_50"></span><span class="anchor" id="line-50"></span><span class="String">System Equations:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_51">  51</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_51"></span><span class="anchor" id="line-51"></span><span class="String">            x[k] = A*x[k-1] + B*u[k] + w[k]                             (1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_52">  52</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_52"></span><span class="anchor" id="line-52"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_53">  53</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_53"></span><span class="anchor" id="line-53"></span><span class="String">            z[k] = H*x[k] + v[k]                                        (2)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_54">  54</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_54"></span><span class="anchor" id="line-54"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_55">  55</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_55"></span><span class="anchor" id="line-55"></span><span class="String">with:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_56">  56</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_56"></span><span class="anchor" id="line-56"></span><span class="String">    x: State variables (vector)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_57">  57</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_57"></span><span class="anchor" id="line-57"></span><span class="String">    u: Inputs (vector)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_58">  58</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_58"></span><span class="anchor" id="line-58"></span><span class="String">    z: Outputs (vector)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_59">  59</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_59"></span><span class="anchor" id="line-59"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_60">  60</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_60"></span><span class="anchor" id="line-60"></span><span class="String">    w,v: Random noise (vector)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_61">  61</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_61"></span><span class="anchor" id="line-61"></span><span class="String">    A,B,H: Parameter matrices</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_62">  62</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_62"></span><span class="anchor" id="line-62"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_63">  63</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_63"></span><span class="anchor" id="line-63"></span><span class="String">(For more details of the system see the documentation of the LinSys class.)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_64">  64</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_64"></span><span class="anchor" id="line-64"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_65">  65</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_65"></span><span class="anchor" id="line-65"></span><span class="String">As one can see from equation (2) it is not necessary to measure the state</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_66">  66</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_66"></span><span class="anchor" id="line-66"></span><span class="String">variables directly. A Kalman Filter can estimate the system states from a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_67">  67</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_67"></span><span class="anchor" id="line-67"></span><span class="String">linear combination of them, with added noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_68">  68</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_68"></span><span class="anchor" id="line-68"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_69">  69</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_69"></span><span class="anchor" id="line-69"></span><span class="String">Example systems:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_70">  70</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_70"></span><span class="anchor" id="line-70"></span><span class="String">    - Estimate a constant value</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_71">  71</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_71"></span><span class="anchor" id="line-71"></span><span class="String">    - Tank with inaccurate level measurement.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_72">  72</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_72"></span><span class="anchor" id="line-72"></span><span class="String">    - Spring and damper system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_73">  73</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_73"></span><span class="anchor" id="line-73"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_74">  74</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_74"></span><span class="anchor" id="line-74"></span><span class="String">TODO:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_75">  75</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_75"></span><span class="anchor" id="line-75"></span><span class="String">    - Optional more accurate method for simulation (scipy, Runge-Kutta)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_76">  76</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_76"></span><span class="anchor" id="line-76"></span><span class="String">    Example systems:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_77">  77</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_77"></span><span class="anchor" id="line-77"></span><span class="String">        - 1D Vehicle</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_78">  78</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_78"></span><span class="anchor" id="line-78"></span><span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_79">  79</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_79"></span><span class="anchor" id="line-79"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_80">  80</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_80"></span><span class="anchor" id="line-80"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_81">  81</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_81"></span><span class="anchor" id="line-81"></span><span class="ResWord">from</span> <span class="ID">__future__</span> <span class="ResWord">import</span> <span class="ID">division</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_82">  82</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_82"></span><span class="anchor" id="line-82"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_83">  83</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_83"></span><span class="anchor" id="line-83"></span><span class="ResWord">import</span> <span class="ID">pylab</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_84">  84</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_84"></span><span class="anchor" id="line-84"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_85">  85</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_85"></span><span class="anchor" id="line-85"></span><span class="ResWord">import</span> <span class="ID">numpy</span> <span class="ResWord">as</span> <span class="ID">N</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_86">  86</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_86"></span><span class="anchor" id="line-86"></span><span class="ResWord">from</span> <span class="ID">numpy</span> <span class="ResWord">import</span> <span class="ID">mat</span>, <span class="ID">array</span>, <span class="ID">c_</span>, <span class="ID">r_</span>, <span class="ID">vstack</span>, <span class="ID">ones</span>, <span class="ID">zeros</span>, <span class="ID">identity</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_87">  87</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_87"></span><span class="anchor" id="line-87"></span><span class="ResWord">from</span> <span class="ID">numpy.linalg</span> <span class="ResWord">import</span> <span class="ID">inv</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_88">  88</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_88"></span><span class="anchor" id="line-88"></span><span class="ResWord">from</span> <span class="ID">numpy.random</span> <span class="ResWord">import</span> <span class="ID">multivariate_normal</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_89">  89</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_89"></span><span class="anchor" id="line-89"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_90">  90</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_90"></span><span class="anchor" id="line-90"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_91">  91</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_91"></span><span class="anchor" id="line-91"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_92">  92</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_92"></span><span class="anchor" id="line-92"></span><span class="Comment">#  Main classes that do the maths</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_93">  93</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_93"></span><span class="anchor" id="line-93"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_94">  94</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_94"></span><span class="anchor" id="line-94"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_95">  95</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_95"></span><span class="anchor" id="line-95"></span><span class="ResWord">class</span> <span class="ID">LinSys</span>(<span class="ResWord">object</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_96">  96</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_96"></span><span class="anchor" id="line-96"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_97">  97</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_97"></span><span class="anchor" id="line-97"></span><span class="String">    General linear dynamic system. (Discrete ODE)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_98">  98</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_98"></span><span class="anchor" id="line-98"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_99">  99</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_99"></span><span class="anchor" id="line-99"></span><span class="String">    The class can simulate the system either step by step, or do the whole</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_100"> 100</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_100"></span><span class="anchor" id="line-100"></span><span class="String">    simulation in one go. It stores all system parameters and it is therefore</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_101"> 101</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_101"></span><span class="anchor" id="line-101"></span><span class="String">    used to represent the system in the Kalman filter. This class is intended</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_102"> 102</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_102"></span><span class="anchor" id="line-102"></span><span class="String">    as a base class for more specialized simulator classes.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_103"> 103</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_103"></span><span class="anchor" id="line-103"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_104"> 104</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_104"></span><span class="anchor" id="line-104"></span><span class="String">    Random noise is generated internally, when the simulation is started. For</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_105"> 105</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_105"></span><span class="anchor" id="line-105"></span><span class="String">    repeated computations the same random values are used.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_106"> 106</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_106"></span><span class="anchor" id="line-106"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_107"> 107</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_107"></span><span class="anchor" id="line-107"></span><span class="String">    Do not use this class to seriously solve a (continuous) differential equation.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_108"> 108</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_108"></span><span class="anchor" id="line-108"></span><span class="String">    The integration method used here is the very inaccurate Euler method.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_109"> 109</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_109"></span><span class="anchor" id="line-109"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_110"> 110</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_110"></span><span class="anchor" id="line-110"></span><span class="String">    System Equations:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_111"> 111</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_111"></span><span class="anchor" id="line-111"></span><span class="String">        Compute the state:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_112"> 112</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_112"></span><span class="anchor" id="line-112"></span><span class="String">            x_k = A x_{k-1} + B u_k + w_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_113"> 113</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_113"></span><span class="anchor" id="line-113"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_114"> 114</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_114"></span><span class="anchor" id="line-114"></span><span class="String">        Compute the measurements:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_115"> 115</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_115"></span><span class="anchor" id="line-115"></span><span class="String">            z_k = H x_k + v_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_116"> 116</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_116"></span><span class="anchor" id="line-116"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_117"> 117</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_117"></span><span class="anchor" id="line-117"></span><span class="String">    with:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_118"> 118</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_118"></span><span class="anchor" id="line-118"></span><span class="String">        x_k, x_{k-1}:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_119"> 119</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_119"></span><span class="anchor" id="line-119"></span><span class="String">            Current state vector, last state vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_120"> 120</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_120"></span><span class="anchor" id="line-120"></span><span class="String">        u_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_121"> 121</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_121"></span><span class="anchor" id="line-121"></span><span class="String">            Control vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_122"> 122</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_122"></span><span class="anchor" id="line-122"></span><span class="String">        z_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_123"> 123</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_123"></span><span class="anchor" id="line-123"></span><span class="String">            Measurement vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_124"> 124</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_124"></span><span class="anchor" id="line-124"></span><span class="String">        w_k, v_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_125"> 125</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_125"></span><span class="anchor" id="line-125"></span><span class="String">            Independent random variables, with (multivariate) normal probability</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_126"> 126</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_126"></span><span class="anchor" id="line-126"></span><span class="String">            distributions. They represent process noise and measurement noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_127"> 127</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_127"></span><span class="anchor" id="line-127"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_128"> 128</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_128"></span><span class="anchor" id="line-128"></span><span class="String">            w_k: Process noise:     mean = 0, covariance = Q</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_129"> 129</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_129"></span><span class="anchor" id="line-129"></span><span class="String">            v_k: Measurement noise: mean = 0, covariance = R</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_130"> 130</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_130"></span><span class="anchor" id="line-130"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_131"> 131</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_131"></span><span class="anchor" id="line-131"></span><span class="String">        A, B, H:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_132"> 132</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_132"></span><span class="anchor" id="line-132"></span><span class="String">            Parameter matrices; system, control and measurement matrix.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_133"> 133</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_133"></span><span class="anchor" id="line-133"></span><span class="String">        Q, R:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_134"> 134</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_134"></span><span class="anchor" id="line-134"></span><span class="String">            Covariance matrices of process and measurement noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_135"> 135</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_135"></span><span class="anchor" id="line-135"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_136"> 136</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_136"></span><span class="anchor" id="line-136"></span><span class="String">    Usage:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_137"> 137</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_137"></span><span class="anchor" id="line-137"></span><span class="String">    Inherit from this class and write a problem specific __init__</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_138"> 138</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_138"></span><span class="anchor" id="line-138"></span><span class="String">    function, that accepts arguments that are easy to understand.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_139"> 139</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_139"></span><span class="anchor" id="line-139"></span><span class="String">    The new __init__ must compute the matrices A, B, H, Q, R and give</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_140"> 140</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_140"></span><span class="anchor" id="line-140"></span><span class="String">    them to LinSys.__init__.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_141"> 141</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_141"></span><span class="anchor" id="line-141"></span><span class="String">    For examples see: SysConstVal, SysTank, SysSpringPendulum</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_142"> 142</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_142"></span><span class="anchor" id="line-142"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_143"> 143</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_143"></span><span class="anchor" id="line-143"></span><span class="String">    You can call simulate(x_0, U) to compute multiple simulation steps at</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_144"> 144</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_144"></span><span class="anchor" id="line-144"></span><span class="String">    once:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_145"> 145</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_145"></span><span class="anchor" id="line-145"></span><span class="String">    &gt;&gt;&gt; tank = SysTank(q=0.002, r=2)          #Create system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_146"> 146</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_146"></span><span class="anchor" id="line-146"></span><span class="String">    &gt;&gt;&gt; U = vstack((ones(10)*0.1, zeros(10))) #Create inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_147"> 147</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_147"></span><span class="anchor" id="line-147"></span><span class="String">    &gt;&gt;&gt; X, Z = tank.simulate(mat('2.'), U)    #Simulate</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_148"> 148</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_148"></span><span class="anchor" id="line-148"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_149"> 149</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_149"></span><span class="anchor" id="line-149"></span><span class="String">    For more complex problems you can compute each simulation step</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_150"> 150</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_150"></span><span class="anchor" id="line-150"></span><span class="String">    separately:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_151"> 151</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_151"></span><span class="anchor" id="line-151"></span><span class="String">    - At the beginning of the simulation call startSimulation(x_0) to supply</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_152"> 152</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_152"></span><span class="anchor" id="line-152"></span><span class="String">      the initial values.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_153"> 153</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_153"></span><span class="anchor" id="line-153"></span><span class="String">    - For each time step call simulateStep(u_k). You must supply the input</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_154"> 154</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_154"></span><span class="anchor" id="line-154"></span><span class="String">      values.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_155"> 155</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_155"></span><span class="anchor" id="line-155"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_156"> 156</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_156"></span><span class="anchor" id="line-156"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_157"> 157</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_157"></span><span class="anchor" id="line-157"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">A</span>=<span class="ResWord">None</span>, <span class="ID">B</span>=<span class="ResWord">None</span>, <span class="ID">H</span>=<span class="ResWord">None</span>, <span class="ID">Q</span>=<span class="ResWord">None</span>, <span class="ID">R</span>=<span class="ResWord">None</span>, <span class="ID">nSteps</span>=<span class="Number">1000</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_158"> 158</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_158"></span><span class="anchor" id="line-158"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_159"> 159</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_159"></span><span class="anchor" id="line-159"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_160"> 160</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_160"></span><span class="anchor" id="line-160"></span><span class="String">            A:      system matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_161"> 161</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_161"></span><span class="anchor" id="line-161"></span><span class="String">            B:      control input matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_162"> 162</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_162"></span><span class="anchor" id="line-162"></span><span class="String">            H:      measurement matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_163"> 163</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_163"></span><span class="anchor" id="line-163"></span><span class="String">            Q:      process noise covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_164"> 164</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_164"></span><span class="anchor" id="line-164"></span><span class="String">            R:      measurement noise covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_165"> 165</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_165"></span><span class="anchor" id="line-165"></span><span class="String">            nSteps: number of steps for which noise will be computed</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_166"> 166</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_166"></span><span class="anchor" id="line-166"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_167"> 167</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_167"></span><span class="anchor" id="line-167"></span>        <span class="ResWord">self</span>.<span class="ID">A</span> = <span class="ID">mat</span>(<span class="ID">A</span>).<span class="ID">copy</span>()  <span class="Comment"># system matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_168"> 168</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_168"></span><span class="anchor" id="line-168"></span>        <span class="ResWord">self</span>.<span class="ID">B</span> = <span class="ID">mat</span>(<span class="ID">B</span>).<span class="ID">copy</span>()  <span class="Comment"># control input matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_169"> 169</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_169"></span><span class="anchor" id="line-169"></span>        <span class="ResWord">self</span>.<span class="ID">H</span> = <span class="ID">mat</span>(<span class="ID">H</span>).<span class="ID">copy</span>()  <span class="Comment"># measurement matrix</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_170"> 170</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_170"></span><span class="anchor" id="line-170"></span>        <span class="ResWord">self</span>.<span class="ID">Q</span> = <span class="ID">mat</span>(<span class="ID">Q</span>).<span class="ID">copy</span>()  <span class="Comment"># process noise covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_171"> 171</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_171"></span><span class="anchor" id="line-171"></span>        <span class="ResWord">self</span>.<span class="ID">R</span> = <span class="ID">mat</span>(<span class="ID">R</span>).<span class="ID">copy</span>()  <span class="Comment"># measurement noise covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_172"> 172</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_172"></span><span class="anchor" id="line-172"></span>        <span class="ResWord">self</span>.<span class="ID">x</span> = <span class="ID">mat</span>(<span class="ResWord">None</span>)      <span class="Comment"># state</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_173"> 173</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_173"></span><span class="anchor" id="line-173"></span>        <span class="ResWord">self</span>.<span class="ID">k</span> = <span class="ResWord">None</span>           <span class="Comment"># step count (for noise)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_174"> 174</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_174"></span><span class="anchor" id="line-174"></span>        <span class="ResWord">self</span>.<span class="ID">W</span> = <span class="ResWord">None</span>           <span class="Comment"># precomputed process noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_175"> 175</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_175"></span><span class="anchor" id="line-175"></span>        <span class="ResWord">self</span>.<span class="ID">V</span> = <span class="ResWord">None</span>           <span class="Comment"># precomputed measurement noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_176"> 176</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_176"></span><span class="anchor" id="line-176"></span>        <span class="ResWord">self</span>.<span class="ID">computeNoise</span>(<span class="ID">nSteps</span>) <span class="Comment">#pre-compute the noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_177"> 177</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_177"></span><span class="anchor" id="line-177"></span>        <span class="ResWord">self</span>.<span class="ID">_checkMatrixCompatibility</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_178"> 178</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_178"></span><span class="anchor" id="line-178"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_179"> 179</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_179"></span><span class="anchor" id="line-179"></span>    <span class="ResWord">def</span> <span class="ID">_checkMatrixCompatibility</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_180"> 180</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_180"></span><span class="anchor" id="line-180"></span>        <span class="ResWord">assert</span> <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">1</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_181"> 181</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_181"></span><span class="anchor" id="line-181"></span>               <span class="String">'</span><span class="String">Matrix </span><span class="String">&quot;</span><span class="String">A</span><span class="String">&quot;</span><span class="String"> must be square!</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_182"> 182</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_182"></span><span class="anchor" id="line-182"></span>        <span class="ResWord">assert</span> <span class="ResWord">self</span>.<span class="ID">B</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_183"> 183</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_183"></span><span class="anchor" id="line-183"></span>               <span class="String">'</span><span class="String">Matrix </span><span class="String">&quot;</span><span class="String">B</span><span class="String">&quot;</span><span class="String"> must have same number of rows as matrix </span><span class="String">&quot;</span><span class="String">A</span><span class="String">&quot;</span><span class="String">!</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_184"> 184</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_184"></span><span class="anchor" id="line-184"></span>        <span class="ResWord">assert</span> <span class="ResWord">self</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">1</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_185"> 185</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_185"></span><span class="anchor" id="line-185"></span>               <span class="String">'</span><span class="String">Matrix </span><span class="String">&quot;</span><span class="String">H</span><span class="String">&quot;</span><span class="String"> must have same number of columns as matrix </span><span class="String">&quot;</span><span class="String">A</span><span class="String">&quot;</span><span class="String">!</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_186"> 186</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_186"></span><span class="anchor" id="line-186"></span>        <span class="ResWord">assert</span> <span class="ResWord">self</span>.<span class="ID">Q</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">Q</span>.<span class="ID">shape</span>[<span class="Number">1</span>] <span class="ResWord">and</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_187"> 187</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_187"></span><span class="anchor" id="line-187"></span>               <span class="ResWord">self</span>.<span class="ID">Q</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_188"> 188</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_188"></span><span class="anchor" id="line-188"></span>               <span class="String">'</span><span class="String">Matrix </span><span class="String">&quot;</span><span class="String">Q</span><span class="String">&quot;</span><span class="String"> must be square, </span><span class="String">'</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_189"> 189</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_189"></span><span class="anchor" id="line-189"></span>               <span class="String">'</span><span class="String">and it must have the same dimensions as matrix </span><span class="String">&quot;</span><span class="String">A</span><span class="String">&quot;</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_190"> 190</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_190"></span><span class="anchor" id="line-190"></span>        <span class="ResWord">assert</span> <span class="ResWord">self</span>.<span class="ID">R</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">R</span>.<span class="ID">shape</span>[<span class="Number">1</span>]<span class="ResWord">and</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_191"> 191</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_191"></span><span class="anchor" id="line-191"></span>               <span class="ResWord">self</span>.<span class="ID">R</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">0</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_192"> 192</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_192"></span><span class="anchor" id="line-192"></span>               <span class="String">'</span><span class="String">Matrix </span><span class="String">&quot;</span><span class="String">R</span><span class="String">&quot;</span><span class="String"> must be square, </span><span class="String">'</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_193"> 193</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_193"></span><span class="anchor" id="line-193"></span>               <span class="String">'</span><span class="String">and it must have the same number of rows as matrix </span><span class="String">&quot;</span><span class="String">H</span><span class="String">&quot;</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_194"> 194</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_194"></span><span class="anchor" id="line-194"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_195"> 195</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_195"></span><span class="anchor" id="line-195"></span>    <span class="ResWord">def</span> <span class="ID">computeNoise</span>(<span class="ResWord">self</span>, <span class="ID">nSteps</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_196"> 196</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_196"></span><span class="anchor" id="line-196"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_197"> 197</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_197"></span><span class="anchor" id="line-197"></span><span class="String">        Compute all process and measurement noise (self.V, self.W) in advance.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_198"> 198</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_198"></span><span class="anchor" id="line-198"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_199"> 199</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_199"></span><span class="anchor" id="line-199"></span><span class="String">        Dimensions of self.V, self.W:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_200"> 200</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_200"></span><span class="anchor" id="line-200"></span><span class="String">            The second dimension is the step number; so self.V[:, 2] is the</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_201"> 201</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_201"></span><span class="anchor" id="line-201"></span><span class="String">            measurement noise for step two.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_202"> 202</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_202"></span><span class="anchor" id="line-202"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_203"> 203</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_203"></span><span class="anchor" id="line-203"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_204"> 204</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_204"></span><span class="anchor" id="line-204"></span><span class="String">            nSteps: Number of steps that should be simulated.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_205"> 205</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_205"></span><span class="anchor" id="line-205"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_206"> 206</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_206"></span><span class="anchor" id="line-206"></span>        <span class="ID">matWidth</span> = <span class="ID">nSteps</span> + <span class="Number">1</span> <span class="Comment">#just in case</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_207"> 207</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_207"></span><span class="anchor" id="line-207"></span>        <span class="Comment">#compute process noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_208"> 208</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_208"></span><span class="anchor" id="line-208"></span>        <span class="ID">meanW</span> = <span class="ID">N</span>.<span class="ID">zeros</span>(<span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_209"> 209</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_209"></span><span class="anchor" id="line-209"></span>        <span class="ID">W</span> = <span class="ID">multivariate_normal</span>(<span class="ID">meanW</span>, <span class="ResWord">self</span>.<span class="ID">Q</span>, [<span class="ID">matWidth</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_210"> 210</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_210"></span><span class="anchor" id="line-210"></span>        <span class="ResWord">self</span>.<span class="ID">W</span> = <span class="ID">mat</span>(<span class="ID">W</span>).<span class="ID">T</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_211"> 211</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_211"></span><span class="anchor" id="line-211"></span>        <span class="Comment">#compute measurement noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_212"> 212</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_212"></span><span class="anchor" id="line-212"></span>        <span class="ID">meanV</span> = <span class="ID">N</span>.<span class="ID">zeros</span>(<span class="ResWord">self</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">0</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_213"> 213</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_213"></span><span class="anchor" id="line-213"></span>        <span class="ID">V</span> = <span class="ID">multivariate_normal</span>(<span class="ID">meanV</span>, <span class="ResWord">self</span>.<span class="ID">R</span>, [<span class="ID">matWidth</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_214"> 214</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_214"></span><span class="anchor" id="line-214"></span>        <span class="ResWord">self</span>.<span class="ID">V</span> = <span class="ID">mat</span>(<span class="ID">V</span>).<span class="ID">T</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_215"> 215</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_215"></span><span class="anchor" id="line-215"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_216"> 216</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_216"></span><span class="anchor" id="line-216"></span>    <span class="ResWord">def</span> <span class="ID">_procNoise</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_217"> 217</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_217"></span><span class="anchor" id="line-217"></span>        <span class="String">&quot;&quot;&quot;Return process noise for current step.&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_218"> 218</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_218"></span><span class="anchor" id="line-218"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">W</span>[:, <span class="ResWord">self</span>.<span class="ID">k</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_219"> 219</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_219"></span><span class="anchor" id="line-219"></span>    <span class="ResWord">def</span> <span class="ID">_measNoise</span>(<span class="ResWord">self</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_220"> 220</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_220"></span><span class="anchor" id="line-220"></span>        <span class="String">&quot;&quot;&quot;Return measurement noise current step.&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_221"> 221</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_221"></span><span class="anchor" id="line-221"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">V</span>[:, <span class="ResWord">self</span>.<span class="ID">k</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_222"> 222</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_222"></span><span class="anchor" id="line-222"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_223"> 223</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_223"></span><span class="anchor" id="line-223"></span>    <span class="ResWord">def</span> <span class="ID">startSimulation</span>(<span class="ResWord">self</span>, <span class="ID">x_0</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_224"> 224</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_224"></span><span class="anchor" id="line-224"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_225"> 225</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_225"></span><span class="anchor" id="line-225"></span><span class="String">        Set initial conditions</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_226"> 226</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_226"></span><span class="anchor" id="line-226"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_227"> 227</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_227"></span><span class="anchor" id="line-227"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_228"> 228</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_228"></span><span class="anchor" id="line-228"></span><span class="String">            x_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_229"> 229</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_229"></span><span class="anchor" id="line-229"></span><span class="String">                initial conditions: column vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_230"> 230</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_230"></span><span class="anchor" id="line-230"></span><span class="String">        Return:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_231"> 231</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_231"></span><span class="anchor" id="line-231"></span><span class="String">            (x_0, z_k)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_232"> 232</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_232"></span><span class="anchor" id="line-232"></span><span class="String">            x_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_233"> 233</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_233"></span><span class="anchor" id="line-233"></span><span class="String">                state vector (initial conditions): column vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_234"> 234</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_234"></span><span class="anchor" id="line-234"></span><span class="String">                (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_235"> 235</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_235"></span><span class="anchor" id="line-235"></span><span class="String">            z_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_236"> 236</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_236"></span><span class="anchor" id="line-236"></span><span class="String">                first measurements: column vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_237"> 237</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_237"></span><span class="anchor" id="line-237"></span><span class="String">         &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_238"> 238</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_238"></span><span class="anchor" id="line-238"></span>        <span class="ResWord">assert</span>(<span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">0</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_239"> 239</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_239"></span><span class="anchor" id="line-239"></span>        <span class="ResWord">assert</span>(<span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_240"> 240</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_240"></span><span class="anchor" id="line-240"></span>        <span class="Comment">#store initial initial conditions</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_241"> 241</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_241"></span><span class="anchor" id="line-241"></span>        <span class="ResWord">self</span>.<span class="ID">k</span> = <span class="Number">0</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_242"> 242</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_242"></span><span class="anchor" id="line-242"></span>        <span class="ResWord">self</span>.<span class="ID">x</span> = <span class="ID">mat</span>(<span class="ID">x_0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_243"> 243</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_243"></span><span class="anchor" id="line-243"></span>        <span class="Comment">#compute the first measurement</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_244"> 244</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_244"></span><span class="anchor" id="line-244"></span>        <span class="ID">z_k</span> = <span class="ResWord">self</span>.<span class="ID">H</span> * <span class="ResWord">self</span>.<span class="ID">x</span> + <span class="ResWord">self</span>.<span class="ID">_measNoise</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_245"> 245</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_245"></span><span class="anchor" id="line-245"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_246"> 246</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_246"></span><span class="anchor" id="line-246"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">x</span>, <span class="ID">z_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_247"> 247</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_247"></span><span class="anchor" id="line-247"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_248"> 248</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_248"></span><span class="anchor" id="line-248"></span>    <span class="ResWord">def</span> <span class="ID">simulateStep</span>(<span class="ResWord">self</span>, <span class="ID">u_k</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_249"> 249</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_249"></span><span class="anchor" id="line-249"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_250"> 250</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_250"></span><span class="anchor" id="line-250"></span><span class="String">        Compute one simulation step.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_251"> 251</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_251"></span><span class="anchor" id="line-251"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_252"> 252</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_252"></span><span class="anchor" id="line-252"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_253"> 253</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_253"></span><span class="anchor" id="line-253"></span><span class="String">            u_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_254"> 254</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_254"></span><span class="anchor" id="line-254"></span><span class="String">                control input: column vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_255"> 255</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_255"></span><span class="anchor" id="line-255"></span><span class="String">        Return:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_256"> 256</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_256"></span><span class="anchor" id="line-256"></span><span class="String">            (x_k, z_k)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_257"> 257</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_257"></span><span class="anchor" id="line-257"></span><span class="String">            x_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_258"> 258</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_258"></span><span class="anchor" id="line-258"></span><span class="String">                state vector: column vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_259"> 259</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_259"></span><span class="anchor" id="line-259"></span><span class="String">            z_k:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_260"> 260</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_260"></span><span class="anchor" id="line-260"></span><span class="String">                new measurements: column vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_261"> 261</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_261"></span><span class="anchor" id="line-261"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_262"> 262</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_262"></span><span class="anchor" id="line-262"></span>        <span class="Comment">#compute new state</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_263"> 263</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_263"></span><span class="anchor" id="line-263"></span>        <span class="ID">x_new</span> = <span class="ResWord">self</span>.<span class="ID">A</span> * <span class="ResWord">self</span>.<span class="ID">x</span>  + <span class="ResWord">self</span>.<span class="ID">B</span> * <span class="ID">u_k</span> + <span class="ResWord">self</span>.<span class="ID">_procNoise</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_264"> 264</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_264"></span><span class="anchor" id="line-264"></span>        <span class="Comment">#advance time and step count (only used for repeatable noise)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_265"> 265</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_265"></span><span class="anchor" id="line-265"></span>        <span class="Comment">#the new state values are the current values from now on</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_266"> 266</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_266"></span><span class="anchor" id="line-266"></span>        <span class="ResWord">self</span>.<span class="ID">k</span> += <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_267"> 267</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_267"></span><span class="anchor" id="line-267"></span>        <span class="ResWord">self</span>.<span class="ID">x</span> = <span class="ID">x_new</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_268"> 268</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_268"></span><span class="anchor" id="line-268"></span>        <span class="Comment">#compute new measurement</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_269"> 269</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_269"></span><span class="anchor" id="line-269"></span>        <span class="ID">z_k</span> = <span class="ResWord">self</span>.<span class="ID">H</span> * <span class="ResWord">self</span>.<span class="ID">x</span> + <span class="ResWord">self</span>.<span class="ID">_measNoise</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_270"> 270</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_270"></span><span class="anchor" id="line-270"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_271"> 271</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_271"></span><span class="anchor" id="line-271"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">x</span>, <span class="ID">z_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_272"> 272</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_272"></span><span class="anchor" id="line-272"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_273"> 273</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_273"></span><span class="anchor" id="line-273"></span>    <span class="ResWord">def</span> <span class="ID">simulate</span>(<span class="ResWord">self</span>, <span class="ID">x_0</span>, <span class="ID">U</span>, <span class="ID">computeNoiseAgain</span>=<span class="ResWord">False</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_274"> 274</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_274"></span><span class="anchor" id="line-274"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_275"> 275</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_275"></span><span class="anchor" id="line-275"></span><span class="String">        Compute multiple time steps. The simulation is run until the control</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_276"> 276</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_276"></span><span class="anchor" id="line-276"></span><span class="String">        inputs (U) are exhausted.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_277"> 277</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_277"></span><span class="anchor" id="line-277"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_278"> 278</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_278"></span><span class="anchor" id="line-278"></span><span class="String">        Dimensions of input and outputs:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_279"> 279</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_279"></span><span class="anchor" id="line-279"></span><span class="String">        The second dimension is the step number; so U[:,2] is the control</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_280"> 280</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_280"></span><span class="anchor" id="line-280"></span><span class="String">        input for step three.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_281"> 281</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_281"></span><span class="anchor" id="line-281"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_282"> 282</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_282"></span><span class="anchor" id="line-282"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_283"> 283</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_283"></span><span class="anchor" id="line-283"></span><span class="String">            x_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_284"> 284</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_284"></span><span class="anchor" id="line-284"></span><span class="String">                initial conditions: 1D array or matrix. Will be converted to</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_285"> 285</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_285"></span><span class="anchor" id="line-285"></span><span class="String">                column vector.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_286"> 286</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_286"></span><span class="anchor" id="line-286"></span><span class="String">            U:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_287"> 287</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_287"></span><span class="anchor" id="line-287"></span><span class="String">                Control inputs: 2D Array. 2nd dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_288"> 288</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_288"></span><span class="anchor" id="line-288"></span><span class="String">            computeNoiseAgain:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_289"> 289</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_289"></span><span class="anchor" id="line-289"></span><span class="String">                If True: compute new random noise even if it has already been</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_290"> 290</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_290"></span><span class="anchor" id="line-290"></span><span class="String">                computed.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_291"> 291</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_291"></span><span class="anchor" id="line-291"></span><span class="String">                If False: compute noise only if none exists.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_292"> 292</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_292"></span><span class="anchor" id="line-292"></span><span class="String">                Default is False.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_293"> 293</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_293"></span><span class="anchor" id="line-293"></span><span class="String">        Return:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_294"> 294</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_294"></span><span class="anchor" id="line-294"></span><span class="String">            (X, Z)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_295"> 295</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_295"></span><span class="anchor" id="line-295"></span><span class="String">            X:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_296"> 296</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_296"></span><span class="anchor" id="line-296"></span><span class="String">                states: 2D Array; 2nd dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_297"> 297</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_297"></span><span class="anchor" id="line-297"></span><span class="String">            Z:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_298"> 298</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_298"></span><span class="anchor" id="line-298"></span><span class="String">                measurements: 2D Array; 2nd dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_299"> 299</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_299"></span><span class="anchor" id="line-299"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_300"> 300</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_300"></span><span class="anchor" id="line-300"></span>        <span class="Comment">#convert x_o to column vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_301"> 301</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_301"></span><span class="anchor" id="line-301"></span>        <span class="ID">x_0</span> = <span class="ID">mat</span>(<span class="ID">x_0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_302"> 302</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_302"></span><span class="anchor" id="line-302"></span>        <span class="ResWord">if</span> <span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="Number">1</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_303"> 303</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_303"></span><span class="anchor" id="line-303"></span>            <span class="ID">x_0</span> = <span class="ID">x_0</span>.<span class="ID">T</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_304"> 304</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_304"></span><span class="anchor" id="line-304"></span>        <span class="ResWord">assert</span> <span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="Number">1</span>  <span class="Comment">#column vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_305"> 305</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_305"></span><span class="anchor" id="line-305"></span>        <span class="ResWord">assert</span> <span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">1</span>] <span class="Comment"># A * x_0 possible</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_306"> 306</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_306"></span><span class="anchor" id="line-306"></span>        <span class="Comment">#Prepare control inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_307"> 307</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_307"></span><span class="anchor" id="line-307"></span>        <span class="ID">U</span> = <span class="ID">mat</span>(<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_308"> 308</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_308"></span><span class="anchor" id="line-308"></span>        <span class="ResWord">assert</span> <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">B</span>.<span class="ID">shape</span>[<span class="Number">1</span>]  <span class="Comment"># B * U[:,k] possible</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_309"> 309</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_309"></span><span class="anchor" id="line-309"></span>        <span class="Comment">#create output arrays</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_310"> 310</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_310"></span><span class="anchor" id="line-310"></span>        <span class="ID">X</span> = <span class="ID">mat</span>(<span class="ID">N</span>.<span class="ID">zeros</span>((<span class="ID">x_0</span>.<span class="ID">shape</span>[<span class="Number">0</span>], <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>])))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_311"> 311</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_311"></span><span class="anchor" id="line-311"></span>        <span class="ID">Z</span> = <span class="ID">mat</span>(<span class="ID">N</span>.<span class="ID">zeros</span>((<span class="ResWord">self</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">0</span>], <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>])))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_312"> 312</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_312"></span><span class="anchor" id="line-312"></span>        <span class="Comment">#see if there is enough noise - 'number of steps' == U.shape[1]</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_313"> 313</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_313"></span><span class="anchor" id="line-313"></span>        <span class="ResWord">if</span> <span class="ResWord">self</span>.<span class="ID">V</span>.<span class="ID">shape</span>[<span class="Number">1</span>] &lt; <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>] <span class="ResWord">or</span> <span class="ResWord">self</span>.<span class="ID">W</span>.<span class="ID">shape</span>[<span class="Number">1</span>] &lt; <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>] <span class="ResWord">or</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_314"> 314</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_314"></span><span class="anchor" id="line-314"></span>           <span class="ID">computeNoiseAgain</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_315"> 315</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_315"></span><span class="anchor" id="line-315"></span>            <span class="ResWord">self</span>.<span class="ID">computeNoise</span>(<span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_316"> 316</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_316"></span><span class="anchor" id="line-316"></span>        <span class="Comment">#start simulation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_317"> 317</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_317"></span><span class="anchor" id="line-317"></span>        <span class="ID">dummy</span>, <span class="ID">z_k</span> = <span class="ResWord">self</span>.<span class="ID">startSimulation</span>(<span class="ID">x_0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_318"> 318</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_318"></span><span class="anchor" id="line-318"></span>        <span class="ID">X</span>[:, <span class="Number">0</span>] = <span class="ID">x_0</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_319"> 319</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_319"></span><span class="anchor" id="line-319"></span>        <span class="ID">Z</span>[:, <span class="Number">0</span>] = <span class="ID">z_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_320"> 320</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_320"></span><span class="anchor" id="line-320"></span>        <span class="Comment">#run simulation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_321"> 321</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_321"></span><span class="anchor" id="line-321"></span>        <span class="ResWord">for</span> <span class="ID">k</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="Number">1</span>, <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>]):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_322"> 322</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_322"></span><span class="anchor" id="line-322"></span>            <span class="Comment">#An old input U[:, k-1] is put into the filter to compute new</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_323"> 323</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_323"></span><span class="anchor" id="line-323"></span>            <span class="Comment">#states X[:, k] and measurements Z[:, k]</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_324"> 324</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_324"></span><span class="anchor" id="line-324"></span>            <span class="ID">x_k</span>, <span class="ID">z_k</span> = <span class="ResWord">self</span>.<span class="ID">simulateStep</span>(<span class="ID">U</span>[:, <span class="ID">k</span>-<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_325"> 325</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_325"></span><span class="anchor" id="line-325"></span>            <span class="ID">X</span>[:, <span class="ID">k</span>] = <span class="ID">x_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_326"> 326</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_326"></span><span class="anchor" id="line-326"></span>            <span class="ID">Z</span>[:, <span class="ID">k</span>] = <span class="ID">z_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_327"> 327</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_327"></span><span class="anchor" id="line-327"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_328"> 328</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_328"></span><span class="anchor" id="line-328"></span>        <span class="ResWord">return</span> <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">X</span>), <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">Z</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_329"> 329</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_329"></span><span class="anchor" id="line-329"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_330"> 330</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_330"></span><span class="anchor" id="line-330"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_331"> 331</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_331"></span><span class="anchor" id="line-331"></span><span class="ResWord">class</span> <span class="ID">KalmanFilter</span>(<span class="ResWord">object</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_332"> 332</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_332"></span><span class="anchor" id="line-332"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_333"> 333</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_333"></span><span class="anchor" id="line-333"></span><span class="String">    Kalman Filter for use together with LinSys objects.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_334"> 334</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_334"></span><span class="anchor" id="line-334"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_335"> 335</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_335"></span><span class="anchor" id="line-335"></span><span class="String">    A Kalman filter estimates the states of a linear system from noisy</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_336"> 336</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_336"></span><span class="anchor" id="line-336"></span><span class="String">    measurements. It must know the system's parameters, and (noisy) inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_337"> 337</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_337"></span><span class="anchor" id="line-337"></span><span class="String">    and outputs. The system parameters are taken from a LinSys instance.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_338"> 338</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_338"></span><span class="anchor" id="line-338"></span><span class="String">    The inputs and outputs must be given at each step.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_339"> 339</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_339"></span><span class="anchor" id="line-339"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_340"> 340</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_340"></span><span class="anchor" id="line-340"></span><span class="String">    As a convenience, the function estimate(...) can process multiple</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_341"> 341</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_341"></span><span class="anchor" id="line-341"></span><span class="String">    measurements and control inputs in one go.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_342"> 342</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_342"></span><span class="anchor" id="line-342"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_343"> 343</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_343"></span><span class="anchor" id="line-343"></span><span class="String">    Usage:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_344"> 344</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_344"></span><span class="anchor" id="line-344"></span><span class="String">    Create system and inputs; then simulate the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_345"> 345</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_345"></span><span class="anchor" id="line-345"></span><span class="String">    &gt;&gt;&gt; tank = SysTank(q=0.002, r=2)          #Create system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_346"> 346</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_346"></span><span class="anchor" id="line-346"></span><span class="String">    &gt;&gt;&gt; U = vstack((ones(10)*0.1, zeros(10))) #Create inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_347"> 347</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_347"></span><span class="anchor" id="line-347"></span><span class="String">    &gt;&gt;&gt; X, Z = tank.simulate(mat('2.'), U)    #Simulate</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_348"> 348</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_348"></span><span class="anchor" id="line-348"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_349"> 349</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_349"></span><span class="anchor" id="line-349"></span><span class="String">    Create a Filter instance, and estimate system state from noisy measurements:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_350"> 350</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_350"></span><span class="anchor" id="line-350"></span><span class="String">    &gt;&gt;&gt; kFilt = KalmanFilter(tank)            #Create Filter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_351"> 351</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_351"></span><span class="anchor" id="line-351"></span><span class="String">    &gt;&gt;&gt; X_hat = kFilt.estimate(Z, U)          #Estimate</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_352"> 352</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_352"></span><span class="anchor" id="line-352"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_353"> 353</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_353"></span><span class="anchor" id="line-353"></span><span class="String">    For complex problems each estimation step can be done separately.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_354"> 354</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_354"></span><span class="anchor" id="line-354"></span><span class="String">    - Start the estimation with a call to startEstimation()</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_355"> 355</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_355"></span><span class="anchor" id="line-355"></span><span class="String">    - Compute one estimate with estimateStep(...)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_356"> 356</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_356"></span><span class="anchor" id="line-356"></span><span class="String">    In the loop that computes the estimation steps you will most likely also</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_357"> 357</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_357"></span><span class="anchor" id="line-357"></span><span class="String">    compute system states (simulateStep) and control values.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_358"> 358</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_358"></span><span class="anchor" id="line-358"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_359"> 359</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_359"></span><span class="anchor" id="line-359"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_360"> 360</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_360"></span><span class="anchor" id="line-360"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">linearSystem</span>=<span class="ResWord">None</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_361"> 361</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_361"></span><span class="anchor" id="line-361"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_362"> 362</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_362"></span><span class="anchor" id="line-362"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_363"> 363</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_363"></span><span class="anchor" id="line-363"></span><span class="String">            linearSystem:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_364"> 364</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_364"></span><span class="anchor" id="line-364"></span><span class="String">                The linear system: LinSys.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_365"> 365</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_365"></span><span class="anchor" id="line-365"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_366"> 366</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_366"></span><span class="anchor" id="line-366"></span>        <span class="ResWord">self</span>.<span class="ID">sys</span> = <span class="ID">linearSystem</span> <span class="Comment"># the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_367"> 367</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_367"></span><span class="anchor" id="line-367"></span>        <span class="ResWord">self</span>.<span class="ID">x_hat</span> = <span class="ID">mat</span>(<span class="ResWord">None</span>) <span class="Comment"># estimated state (a posteriori)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_368"> 368</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_368"></span><span class="anchor" id="line-368"></span>        <span class="ResWord">self</span>.<span class="ID">P</span> = <span class="ID">mat</span>(<span class="ResWord">None</span>) <span class="Comment"># error covariance of estimated state (a posteriori)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_369"> 369</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_369"></span><span class="anchor" id="line-369"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_370"> 370</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_370"></span><span class="anchor" id="line-370"></span>    <span class="ResWord">def</span> <span class="ID">startEstimation</span>(<span class="ResWord">self</span>, <span class="ID">x_hat_0</span>=<span class="ResWord">None</span>, <span class="ID">P_0</span>=<span class="ResWord">None</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_371"> 371</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_371"></span><span class="anchor" id="line-371"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_372"> 372</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_372"></span><span class="anchor" id="line-372"></span><span class="String">        Determine start values for the the estimation algorithm.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_373"> 373</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_373"></span><span class="anchor" id="line-373"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_374"> 374</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_374"></span><span class="anchor" id="line-374"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_375"> 375</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_375"></span><span class="anchor" id="line-375"></span><span class="String">            x_hat_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_376"> 376</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_376"></span><span class="anchor" id="line-376"></span><span class="String">                Start value for estimated system states. (the algorithm can</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_377"> 377</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_377"></span><span class="anchor" id="line-377"></span><span class="String">                guess this value).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_378"> 378</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_378"></span><span class="anchor" id="line-378"></span><span class="String">            P_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_379"> 379</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_379"></span><span class="anchor" id="line-379"></span><span class="String">                Start value for estimation error covariance matrix (the</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_380"> 380</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_380"></span><span class="anchor" id="line-380"></span><span class="String">                algorithm can guess this value).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_381"> 381</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_381"></span><span class="anchor" id="line-381"></span><span class="String">        Return:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_382"> 382</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_382"></span><span class="anchor" id="line-382"></span><span class="String">            (x_hat_0, P_0)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_383"> 383</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_383"></span><span class="anchor" id="line-383"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_384"> 384</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_384"></span><span class="anchor" id="line-384"></span>        <span class="ID">xLen</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>] <span class="Comment">#number of variables in state vector</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_385"> 385</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_385"></span><span class="anchor" id="line-385"></span>        <span class="Comment"># a posteriori estimated state - start value</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_386"> 386</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_386"></span><span class="anchor" id="line-386"></span>        <span class="ResWord">self</span>.<span class="ID">x_hat</span> = <span class="ID">mat</span>(<span class="ID">x_hat_0</span>).<span class="ID">copy</span>() <span class="ResWord">if</span> <span class="ID">x_hat_0</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ResWord">None</span> <span class="ResWord">else</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_387"> 387</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_387"></span><span class="anchor" id="line-387"></span>                     <span class="ID">mat</span>(<span class="ID">N</span>.<span class="ID">zeros</span>(<span class="ID">xLen</span>)).<span class="ID">T</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_388"> 388</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_388"></span><span class="anchor" id="line-388"></span>        <span class="Comment"># a posteriori estimate error covariance - start value</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_389"> 389</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_389"></span><span class="anchor" id="line-389"></span>        <span class="ResWord">self</span>.<span class="ID">P</span> = <span class="ID">mat</span>(<span class="ID">P_0</span>).<span class="ID">copy</span>() <span class="ResWord">if</span> <span class="ID">P_0</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ResWord">None</span> <span class="ResWord">else</span> \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_390"> 390</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_390"></span><span class="anchor" id="line-390"></span>                 <span class="ID">mat</span>(<span class="ID">N</span>.<span class="ID">identity</span>(<span class="ID">xLen</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_391"> 391</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_391"></span><span class="anchor" id="line-391"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_392"> 392</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_392"></span><span class="anchor" id="line-392"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">x_hat</span>, <span class="ResWord">self</span>.<span class="ID">P</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_393"> 393</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_393"></span><span class="anchor" id="line-393"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_394"> 394</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_394"></span><span class="anchor" id="line-394"></span>    <span class="ResWord">def</span> <span class="ID">estimateStep</span>(<span class="ResWord">self</span>, <span class="ID">z_k</span>, <span class="ID">u_k1</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_395"> 395</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_395"></span><span class="anchor" id="line-395"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_396"> 396</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_396"></span><span class="anchor" id="line-396"></span><span class="String">        Perform one estimation step.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_397"> 397</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_397"></span><span class="anchor" id="line-397"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_398"> 398</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_398"></span><span class="anchor" id="line-398"></span><span class="String">        Function takes new measurements and control values. From these inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_399"> 399</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_399"></span><span class="anchor" id="line-399"></span><span class="String">        it computes new estimates for the linear system's state and for the</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_400"> 400</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_400"></span><span class="anchor" id="line-400"></span><span class="String">        estimation error covariance.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_401"> 401</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_401"></span><span class="anchor" id="line-401"></span><span class="String">        (System state and covariance are both returned and stored as data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_402"> 402</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_402"></span><span class="anchor" id="line-402"></span><span class="String">        attributes.)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_403"> 403</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_403"></span><span class="anchor" id="line-403"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_404"> 404</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_404"></span><span class="anchor" id="line-404"></span><span class="String">        This is the complete algorithm of the Kalman filter.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_405"> 405</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_405"></span><span class="anchor" id="line-405"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_406"> 406</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_406"></span><span class="anchor" id="line-406"></span><span class="String">        Parameter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_407"> 407</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_407"></span><span class="anchor" id="line-407"></span><span class="String">            z_k : current measurements: vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_408"> 408</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_408"></span><span class="anchor" id="line-408"></span><span class="String">            u_k1: control values from last time step. They caused the current</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_409"> 409</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_409"></span><span class="anchor" id="line-409"></span><span class="String">                  measurements: vector (matrix with shape[1] == 1)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_410"> 410</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_410"></span><span class="anchor" id="line-410"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_411"> 411</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_411"></span><span class="anchor" id="line-411"></span><span class="String">        Return</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_412"> 412</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_412"></span><span class="anchor" id="line-412"></span><span class="String">            (x_hat, P)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_413"> 413</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_413"></span><span class="anchor" id="line-413"></span><span class="String">            x_hat: new estimated state of linear system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_414"> 414</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_414"></span><span class="anchor" id="line-414"></span><span class="String">            P: new estimation error covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_415"> 415</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_415"></span><span class="anchor" id="line-415"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_416"> 416</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_416"></span><span class="anchor" id="line-416"></span>        <span class="Comment">#constants that describe linear system - save a little typing</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_417"> 417</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_417"></span><span class="anchor" id="line-417"></span>        <span class="ID">A</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">A</span>; <span class="ID">B</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">B</span>; <span class="ID">H</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">H</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_418"> 418</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_418"></span><span class="anchor" id="line-418"></span>        <span class="ID">Q</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">Q</span>; <span class="ID">R</span> = <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">R</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_419"> 419</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_419"></span><span class="anchor" id="line-419"></span>        <span class="Comment">#create identity matrix for error covariance computation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_420"> 420</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_420"></span><span class="anchor" id="line-420"></span>        <span class="ID">I</span> = <span class="ID">mat</span>(<span class="ID">N</span>.<span class="ID">identity</span>(<span class="ResWord">self</span>.<span class="ID">x_hat</span>.<span class="ID">shape</span>[<span class="Number">0</span>]))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_421"> 421</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_421"></span><span class="anchor" id="line-421"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_422"> 422</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_422"></span><span class="anchor" id="line-422"></span>        <span class="Comment">#the current estimated values are the old values from now on</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_423"> 423</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_423"></span><span class="anchor" id="line-423"></span>        <span class="ID">x_old</span> = <span class="ResWord">self</span>.<span class="ID">x_hat</span> <span class="Comment">#estimated system state</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_424"> 424</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_424"></span><span class="anchor" id="line-424"></span>        <span class="ID">P_old</span> = <span class="ResWord">self</span>.<span class="ID">P</span> <span class="Comment">#error covariance of estimated system state</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_425"> 425</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_425"></span><span class="anchor" id="line-425"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_426"> 426</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_426"></span><span class="anchor" id="line-426"></span>        <span class="Comment">#TODO: how do I integrate the size of the time step into the covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_427"> 427</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_427"></span><span class="anchor" id="line-427"></span>        <span class="Comment">#      computation?</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_428"> 428</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_428"></span><span class="anchor" id="line-428"></span>        <span class="Comment">#Time update - does not use new measurements (but control values)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_429"> 429</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_429"></span><span class="anchor" id="line-429"></span>        <span class="Comment">#compute a priori states</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_430"> 430</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_430"></span><span class="anchor" id="line-430"></span>        <span class="ID">x_pri</span> = <span class="ID">A</span> * <span class="ID">x_old</span>  +  <span class="ID">B</span> * <span class="ID">u_k1</span> <span class="Comment">#system states - simulate one time step</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_431"> 431</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_431"></span><span class="anchor" id="line-431"></span>        <span class="ID">P_pri</span> = <span class="ID">A</span> * <span class="ID">P_old</span> * <span class="ID">A</span>.<span class="ID">T</span>  +  <span class="ID">Q</span> <span class="Comment">#error covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_432"> 432</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_432"></span><span class="anchor" id="line-432"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_433"> 433</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_433"></span><span class="anchor" id="line-433"></span>        <span class="Comment">#Measurement update - incorporate new measurement information</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_434"> 434</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_434"></span><span class="anchor" id="line-434"></span>        <span class="Comment">#compute a posteriori states</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_435"> 435</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_435"></span><span class="anchor" id="line-435"></span>        <span class="ID">K</span> = <span class="ID">P_pri</span> * <span class="ID">H</span>.<span class="ID">T</span> * <span class="ID">inv</span>(<span class="ID">H</span> * <span class="ID">P_pri</span> * <span class="ID">H</span>.<span class="ID">T</span>  +  <span class="ID">R</span>) <span class="Comment"># gain</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_436"> 436</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_436"></span><span class="anchor" id="line-436"></span>        <span class="ID">x_hat</span> = <span class="ID">x_pri</span>  +  <span class="ID">K</span>*(<span class="ID">z_k</span> - <span class="ID">H</span>*<span class="ID">x_pri</span>) <span class="Comment"># system states</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_437"> 437</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_437"></span><span class="anchor" id="line-437"></span>        <span class="ID">P</span> = (<span class="ID">I</span> - <span class="ID">K</span>*<span class="ID">H</span>) * <span class="ID">P_pri</span>               <span class="Comment"># error covariance</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_438"> 438</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_438"></span><span class="anchor" id="line-438"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_439"> 439</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_439"></span><span class="anchor" id="line-439"></span>        <span class="Comment">#store filter states as member attributes</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_440"> 440</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_440"></span><span class="anchor" id="line-440"></span>        <span class="ResWord">self</span>.<span class="ID">x_hat</span> = <span class="ID">x_hat</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_441"> 441</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_441"></span><span class="anchor" id="line-441"></span>        <span class="ResWord">self</span>.<span class="ID">P</span> = <span class="ID">P</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_442"> 442</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_442"></span><span class="anchor" id="line-442"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_443"> 443</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_443"></span><span class="anchor" id="line-443"></span>        <span class="ResWord">return</span> <span class="ID">x_hat</span>, <span class="ID">P</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_444"> 444</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_444"></span><span class="anchor" id="line-444"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_445"> 445</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_445"></span><span class="anchor" id="line-445"></span>    <span class="ResWord">def</span> <span class="ID">estimate</span>(<span class="ResWord">self</span>, <span class="ID">Z</span>, <span class="ID">U</span>, <span class="ID">x_hat_0</span>=<span class="ResWord">None</span>, <span class="ID">P_0</span>=<span class="ResWord">None</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_446"> 446</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_446"></span><span class="anchor" id="line-446"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_447"> 447</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_447"></span><span class="anchor" id="line-447"></span><span class="String">        Estimate multiple time steps. The algorithm is run until the</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_448"> 448</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_448"></span><span class="anchor" id="line-448"></span><span class="String">        measurements (Z) and control inputs (U) are exhausted.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_449"> 449</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_449"></span><span class="anchor" id="line-449"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_450"> 450</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_450"></span><span class="anchor" id="line-450"></span><span class="String">        Dimensions of input and outputs:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_451"> 451</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_451"></span><span class="anchor" id="line-451"></span><span class="String">        The second dimension is the step number; so U[:, 2] is the control</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_452"> 452</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_452"></span><span class="anchor" id="line-452"></span><span class="String">        input for step two.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_453"> 453</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_453"></span><span class="anchor" id="line-453"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_454"> 454</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_454"></span><span class="anchor" id="line-454"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_455"> 455</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_455"></span><span class="anchor" id="line-455"></span><span class="String">            Z:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_456"> 456</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_456"></span><span class="anchor" id="line-456"></span><span class="String">                Measured values: 2D Array. 2nd dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_457"> 457</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_457"></span><span class="anchor" id="line-457"></span><span class="String">            U:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_458"> 458</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_458"></span><span class="anchor" id="line-458"></span><span class="String">                Control inputs to the linear system: 2D Array.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_459"> 459</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_459"></span><span class="anchor" id="line-459"></span><span class="String">                2nd dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_460"> 460</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_460"></span><span class="anchor" id="line-460"></span><span class="String">            x_hat_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_461"> 461</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_461"></span><span class="anchor" id="line-461"></span><span class="String">                Start value for estimated system states.(If None: algorithm</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_462"> 462</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_462"></span><span class="anchor" id="line-462"></span><span class="String">                will guess this value).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_463"> 463</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_463"></span><span class="anchor" id="line-463"></span><span class="String">            P_0:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_464"> 464</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_464"></span><span class="anchor" id="line-464"></span><span class="String">                Start value for estimation error covariance matrix (If None:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_465"> 465</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_465"></span><span class="anchor" id="line-465"></span><span class="String">                algorithm will guess this value).</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_466"> 466</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_466"></span><span class="anchor" id="line-466"></span><span class="String">        Return:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_467"> 467</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_467"></span><span class="anchor" id="line-467"></span><span class="String">            X_hat:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_468"> 468</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_468"></span><span class="anchor" id="line-468"></span><span class="String">                Estimated state variables of the linear system.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_469"> 469</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_469"></span><span class="anchor" id="line-469"></span><span class="String">                2D Array. First dimension is step number.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_470"> 470</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_470"></span><span class="anchor" id="line-470"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_471"> 471</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_471"></span><span class="anchor" id="line-471"></span>        <span class="Comment">#prepare inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_472"> 472</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_472"></span><span class="anchor" id="line-472"></span>        <span class="ID">Z</span> = <span class="ID">mat</span>(<span class="ID">Z</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_473"> 473</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_473"></span><span class="anchor" id="line-473"></span>        <span class="ResWord">assert</span> <span class="ID">Z</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">0</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_474"> 474</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_474"></span><span class="anchor" id="line-474"></span>               <span class="String">'</span><span class="String">Parameter Z: 2nd dimension must be </span><span class="String">%d</span><span class="String">'</span> % <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">H</span>.<span class="ID">shape</span>[<span class="Number">0</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_475"> 475</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_475"></span><span class="anchor" id="line-475"></span>        <span class="ID">U</span> = <span class="ID">mat</span>(<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_476"> 476</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_476"></span><span class="anchor" id="line-476"></span>        <span class="ResWord">assert</span> <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">B</span>.<span class="ID">shape</span>[<span class="Number">1</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_477"> 477</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_477"></span><span class="anchor" id="line-477"></span>               <span class="String">'</span><span class="String">Parameter U: 2nd dimension must be </span><span class="String">%d</span><span class="String">'</span> % <span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">B</span>.<span class="ID">shape</span>[<span class="Number">1</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_478"> 478</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_478"></span><span class="anchor" id="line-478"></span>        <span class="ResWord">assert</span> <span class="ID">Z</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="ID">U</span>.<span class="ID">shape</span>[<span class="Number">1</span>], \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_479"> 479</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_479"></span><span class="anchor" id="line-479"></span>               <span class="String">'</span><span class="String">Parameters Z, U: Arrays must contain data for same number of steps.</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_480"> 480</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_480"></span><span class="anchor" id="line-480"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_481"> 481</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_481"></span><span class="anchor" id="line-481"></span>        <span class="Comment">#create output array</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_482"> 482</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_482"></span><span class="anchor" id="line-482"></span>        <span class="ID">X_hat</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>((<span class="ResWord">self</span>.<span class="ID">sys</span>.<span class="ID">A</span>.<span class="ID">shape</span>[<span class="Number">0</span>], <span class="ID">Z</span>.<span class="ID">shape</span>[<span class="Number">1</span>])))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_483"> 483</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_483"></span><span class="anchor" id="line-483"></span>        <span class="Comment">#estimate</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_484"> 484</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_484"></span><span class="anchor" id="line-484"></span>        <span class="ID">X_hat</span>[:, <span class="Number">0</span>], <span class="ID">dummy</span> = <span class="ResWord">self</span>.<span class="ID">startEstimation</span>(<span class="ID">x_hat_0</span>=<span class="ID">x_hat_0</span>, <span class="ID">P_0</span>=<span class="ID">P_0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_485"> 485</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_485"></span><span class="anchor" id="line-485"></span>        <span class="ResWord">for</span> <span class="ID">k</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="Number">1</span>, <span class="ID">Z</span>.<span class="ID">shape</span>[<span class="Number">1</span>]):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_486"> 486</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_486"></span><span class="anchor" id="line-486"></span>            <span class="Comment">#causality: an input from the past U[:,k-1] caused the current</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_487"> 487</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_487"></span><span class="anchor" id="line-487"></span>            <span class="Comment">#measured value Z[:,k]</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_488"> 488</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_488"></span><span class="anchor" id="line-488"></span>            <span class="ID">x_hat_k</span>, <span class="ID">P_k</span> = <span class="ResWord">self</span>.<span class="ID">estimateStep</span>(<span class="ID">Z</span>[:,<span class="ID">k</span>], <span class="ID">U</span>[:,<span class="ID">k</span>-<span class="Number">1</span>])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_489"> 489</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_489"></span><span class="anchor" id="line-489"></span>            <span class="ID">X_hat</span>[:, <span class="ID">k</span>] = <span class="ID">x_hat_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_490"> 490</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_490"></span><span class="anchor" id="line-490"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_491"> 491</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_491"></span><span class="anchor" id="line-491"></span>        <span class="Comment">#TODO: return also P_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_492"> 492</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_492"></span><span class="anchor" id="line-492"></span>        <span class="ResWord">return</span> <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">X_hat</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_493"> 493</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_493"></span><span class="anchor" id="line-493"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_494"> 494</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_494"></span><span class="anchor" id="line-494"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_495"> 495</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_495"></span><span class="anchor" id="line-495"></span><span class="ResWord">class</span> <span class="ID">PidController</span>(<span class="ResWord">object</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_496"> 496</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_496"></span><span class="anchor" id="line-496"></span>    <span class="String">&quot;&quot;&quot;Simple PID controller&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_497"> 497</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_497"></span><span class="anchor" id="line-497"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">kp</span>, <span class="ID">ki</span>, <span class="ID">kd</span>, <span class="ID">ts</span>=<span class="Number">1.</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_498"> 498</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_498"></span><span class="anchor" id="line-498"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_499"> 499</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_499"></span><span class="anchor" id="line-499"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_500"> 500</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_500"></span><span class="anchor" id="line-500"></span><span class="String">            kp:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_501"> 501</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_501"></span><span class="anchor" id="line-501"></span><span class="String">                Proportional Gain</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_502"> 502</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_502"></span><span class="anchor" id="line-502"></span><span class="String">            ki:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_503"> 503</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_503"></span><span class="anchor" id="line-503"></span><span class="String">                Integral Gain</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_504"> 504</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_504"></span><span class="anchor" id="line-504"></span><span class="String">            kd:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_505"> 505</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_505"></span><span class="anchor" id="line-505"></span><span class="String">                Derivative Gain</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_506"> 506</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_506"></span><span class="anchor" id="line-506"></span><span class="String">            ts:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_507"> 507</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_507"></span><span class="anchor" id="line-507"></span><span class="String">                Time step; default = 1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_508"> 508</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_508"></span><span class="anchor" id="line-508"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_509"> 509</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_509"></span><span class="anchor" id="line-509"></span>        <span class="ResWord">self</span>.<span class="ID">kp</span> = <span class="ResWord">float</span>(<span class="ID">kp</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_510"> 510</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_510"></span><span class="anchor" id="line-510"></span>        <span class="ResWord">self</span>.<span class="ID">ki</span> = <span class="ResWord">float</span>(<span class="ID">ki</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_511"> 511</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_511"></span><span class="anchor" id="line-511"></span>        <span class="ResWord">self</span>.<span class="ID">kd</span> = <span class="ResWord">float</span>(<span class="ID">kd</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_512"> 512</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_512"></span><span class="anchor" id="line-512"></span>        <span class="ResWord">self</span>.<span class="ID">ts</span> = <span class="ResWord">float</span>(<span class="ID">ts</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_513"> 513</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_513"></span><span class="anchor" id="line-513"></span>        <span class="ResWord">self</span>.<span class="ID">errInt</span> = <span class="Number">0.</span>  <span class="Comment">#integrated error</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_514"> 514</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_514"></span><span class="anchor" id="line-514"></span>        <span class="ResWord">self</span>.<span class="ID">errOld</span> = <span class="Number">0.</span>  <span class="Comment">#error value from last time step</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_515"> 515</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_515"></span><span class="anchor" id="line-515"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_516"> 516</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_516"></span><span class="anchor" id="line-516"></span>    <span class="ResWord">def</span> <span class="ID">computeStep</span>(<span class="ResWord">self</span>, <span class="ID">error</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_517"> 517</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_517"></span><span class="anchor" id="line-517"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_518"> 518</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_518"></span><span class="anchor" id="line-518"></span><span class="String">        Compute one new control value.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_519"> 519</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_519"></span><span class="anchor" id="line-519"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_520"> 520</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_520"></span><span class="anchor" id="line-520"></span><span class="String">        - Parameter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_521"> 521</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_521"></span><span class="anchor" id="line-521"></span><span class="String">            error:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_522"> 522</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_522"></span><span class="anchor" id="line-522"></span><span class="String">                Current error: float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_523"> 523</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_523"></span><span class="anchor" id="line-523"></span><span class="String">        - Return</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_524"> 524</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_524"></span><span class="anchor" id="line-524"></span><span class="String">            New control value: float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_525"> 525</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_525"></span><span class="anchor" id="line-525"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_526"> 526</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_526"></span><span class="anchor" id="line-526"></span>        <span class="Comment">#integrate error</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_527"> 527</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_527"></span><span class="anchor" id="line-527"></span>        <span class="ResWord">self</span>.<span class="ID">errInt</span> += <span class="ResWord">self</span>.<span class="ID">ts</span> * <span class="ID">error</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_528"> 528</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_528"></span><span class="anchor" id="line-528"></span>        <span class="Comment">#differentiate error</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_529"> 529</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_529"></span><span class="anchor" id="line-529"></span>        <span class="ID">dErr</span> = (<span class="ID">error</span> - <span class="ResWord">self</span>.<span class="ID">errOld</span>)/<span class="ResWord">self</span>.<span class="ID">ts</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_530"> 530</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_530"></span><span class="anchor" id="line-530"></span>        <span class="ResWord">self</span>.<span class="ID">errOld</span> = <span class="ID">error</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_531"> 531</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_531"></span><span class="anchor" id="line-531"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_532"> 532</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_532"></span><span class="anchor" id="line-532"></span>        <span class="ResWord">return</span> <span class="ResWord">self</span>.<span class="ID">kp</span> * <span class="ID">error</span>  +  <span class="ResWord">self</span>.<span class="ID">ki</span> * <span class="ResWord">self</span>.<span class="ID">errInt</span>  +  <span class="ResWord">self</span>.<span class="ID">kd</span> * <span class="ID">dErr</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_533"> 533</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_533"></span><span class="anchor" id="line-533"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_534"> 534</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_534"></span><span class="anchor" id="line-534"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_535"> 535</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_535"></span><span class="anchor" id="line-535"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_536"> 536</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_536"></span><span class="anchor" id="line-536"></span><span class="Comment">#  Some example systems to experiment with the Kalman filter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_537"> 537</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_537"></span><span class="anchor" id="line-537"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_538"> 538</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_538"></span><span class="anchor" id="line-538"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_539"> 539</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_539"></span><span class="anchor" id="line-539"></span><span class="ResWord">class</span> <span class="ID">SysConstVal</span>(<span class="ID">LinSys</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_540"> 540</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_540"></span><span class="anchor" id="line-540"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_541"> 541</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_541"></span><span class="anchor" id="line-541"></span><span class="String">    Very simple system where the state values remain constant.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_542"> 542</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_542"></span><span class="anchor" id="line-542"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_543"> 543</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_543"></span><span class="anchor" id="line-543"></span><span class="String">    The control inputs are ignored but they must be given.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_544"> 544</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_544"></span><span class="anchor" id="line-544"></span><span class="String">    u_k.shape == (1,1); or U.shape == (1,number_of_steps)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_545"> 545</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_545"></span><span class="anchor" id="line-545"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_546"> 546</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_546"></span><span class="anchor" id="line-546"></span><span class="String">    The constant values (that the Kalman filter should guess later) are</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_547"> 547</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_547"></span><span class="anchor" id="line-547"></span><span class="String">    specified as start values (x_0) for the state vector. The methods</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_548"> 548</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_548"></span><span class="anchor" id="line-548"></span><span class="String">    startSimulation(...) and simulate(...) both take start values.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_549"> 549</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_549"></span><span class="anchor" id="line-549"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_550"> 550</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_550"></span><span class="anchor" id="line-550"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_551"> 551</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_551"></span><span class="anchor" id="line-551"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">n</span>=<span class="Number">2</span>, <span class="ID">R</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">0.1, 0; 0, 0.1</span><span class="String">'</span>)):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_552"> 552</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_552"></span><span class="anchor" id="line-552"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_553"> 553</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_553"></span><span class="anchor" id="line-553"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_554"> 554</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_554"></span><span class="anchor" id="line-554"></span><span class="String">            n:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_555"> 555</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_555"></span><span class="anchor" id="line-555"></span><span class="String">                Number of constant values</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_556"> 556</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_556"></span><span class="anchor" id="line-556"></span><span class="String">            R:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_557"> 557</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_557"></span><span class="anchor" id="line-557"></span><span class="String">                Covariance matrix of measurement noise. Must have shape (n,n)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_558"> 558</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_558"></span><span class="anchor" id="line-558"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_559"> 559</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_559"></span><span class="anchor" id="line-559"></span>        <span class="ResWord">assert</span> <span class="ID">R</span>.<span class="ID">shape</span>[<span class="Number">0</span>] == <span class="ID">n</span> <span class="ResWord">and</span> <span class="ID">R</span>.<span class="ID">shape</span>[<span class="Number">1</span>] == <span class="ID">n</span>, \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_560"> 560</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_560"></span><span class="anchor" id="line-560"></span>               <span class="String">'</span><span class="String">R must be square and must have shape (</span><span class="String">%d</span><span class="String">,</span><span class="String">%d</span><span class="String">)</span><span class="String">'</span> % (<span class="ID">n</span>,<span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_561"> 561</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_561"></span><span class="anchor" id="line-561"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_562"> 562</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_562"></span><span class="anchor" id="line-562"></span>        <span class="ID">A</span> = <span class="ID">N</span>.<span class="ID">identity</span>(<span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_563"> 563</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_563"></span><span class="anchor" id="line-563"></span>        <span class="ID">B</span> = <span class="ID">ones</span>((<span class="ID">n</span>,<span class="Number">1</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_564"> 564</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_564"></span><span class="anchor" id="line-564"></span>        <span class="ID">H</span> = <span class="ID">N</span>.<span class="ID">identity</span>(<span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_565"> 565</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_565"></span><span class="anchor" id="line-565"></span>        <span class="ID">Q</span> = <span class="ID">zeros</span>((<span class="ID">n</span>,<span class="ID">n</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_566"> 566</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_566"></span><span class="anchor" id="line-566"></span>        <span class="ID">LinSys</span>.<span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">A</span>, <span class="ID">B</span>, <span class="ID">H</span>, <span class="ID">Q</span>, <span class="ID">R</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_567"> 567</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_567"></span><span class="anchor" id="line-567"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_568"> 568</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_568"></span><span class="anchor" id="line-568"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_569"> 569</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_569"></span><span class="anchor" id="line-569"></span><span class="ResWord">class</span> <span class="ID">SysTank</span>(<span class="ID">LinSys</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_570"> 570</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_570"></span><span class="anchor" id="line-570"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_571"> 571</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_571"></span><span class="anchor" id="line-571"></span><span class="String">    Tank with inlet valve and outlet valve.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_572"> 572</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_572"></span><span class="anchor" id="line-572"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_573"> 573</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_573"></span><span class="anchor" id="line-573"></span><span class="String">    u[0] is inlet, u[1] is outlet</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_574"> 574</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_574"></span><span class="anchor" id="line-574"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_575"> 575</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_575"></span><span class="anchor" id="line-575"></span><span class="String">    Sketch::</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_576"> 576</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_576"></span><span class="anchor" id="line-576"></span><span class="String">              -----</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_577"> 577</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_577"></span><span class="anchor" id="line-577"></span><span class="String">     u[0] --&gt; ~~~~~~.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_578"> 578</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_578"></span><span class="anchor" id="line-578"></span><span class="String">              ----- ~</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_579"> 579</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_579"></span><span class="anchor" id="line-579"></span><span class="String">                ||  ~     ||</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_580"> 580</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_580"></span><span class="anchor" id="line-580"></span><span class="String">                ||~~~~~~~~||......................</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_581"> 581</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_581"></span><span class="anchor" id="line-581"></span><span class="String">                ||~~~~~~~~||                  ^</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_582"> 582</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_582"></span><span class="anchor" id="line-582"></span><span class="String">                ||~~~~~~~~||----              | x</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_583"> 583</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_583"></span><span class="anchor" id="line-583"></span><span class="String">                ||~~~~~~~~~~~~~~ --&gt; u[1]     v</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_584"> 584</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_584"></span><span class="anchor" id="line-584"></span><span class="String">                ||=========-----..................</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_585"> 585</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_585"></span><span class="anchor" id="line-585"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_586"> 586</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_586"></span><span class="anchor" id="line-586"></span><span class="String">    Difference Equation:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_587"> 587</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_587"></span><span class="anchor" id="line-587"></span><span class="String">        x_k = x_{k-1} + ts * u[0] - ts * u[1] + w_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_588"> 588</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_588"></span><span class="anchor" id="line-588"></span><span class="String">    Noisy measurement:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_589"> 589</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_589"></span><span class="anchor" id="line-589"></span><span class="String">        z_k = x_k + v_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_590"> 590</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_590"></span><span class="anchor" id="line-590"></span><span class="String">     with:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_591"> 591</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_591"></span><span class="anchor" id="line-591"></span><span class="String">        ts : temporal step size</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_592"> 592</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_592"></span><span class="anchor" id="line-592"></span><span class="String">        w_k, v_k : noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_593"> 593</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_593"></span><span class="anchor" id="line-593"></span><span class="String">   &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_594"> 594</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_594"></span><span class="anchor" id="line-594"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_595"> 595</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_595"></span><span class="anchor" id="line-595"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">ts</span>=<span class="Number">1.</span>, <span class="ID">q</span>=<span class="Number">0.001</span>, <span class="ID">r</span>=<span class="Number">0.5</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_596"> 596</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_596"></span><span class="anchor" id="line-596"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_597"> 597</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_597"></span><span class="anchor" id="line-597"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_598"> 598</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_598"></span><span class="anchor" id="line-598"></span><span class="String">            ts:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_599"> 599</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_599"></span><span class="anchor" id="line-599"></span><span class="String">                Time between steps.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_600"> 600</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_600"></span><span class="anchor" id="line-600"></span><span class="String">            q:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_601"> 601</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_601"></span><span class="anchor" id="line-601"></span><span class="String">                Variance of process noise: float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_602"> 602</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_602"></span><span class="anchor" id="line-602"></span><span class="String">            r:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_603"> 603</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_603"></span><span class="anchor" id="line-603"></span><span class="String">                Variance of measurement noise: float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_604"> 604</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_604"></span><span class="anchor" id="line-604"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_605"> 605</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_605"></span><span class="anchor" id="line-605"></span>        <span class="ID">A</span> = <span class="ID">mat</span>(<span class="String">'</span><span class="String">1.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_606"> 606</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_606"></span><span class="anchor" id="line-606"></span>        <span class="ID">B</span> = <span class="ID">mat</span>([[<span class="ID">ts</span>, -<span class="ID">ts</span>]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_607"> 607</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_607"></span><span class="anchor" id="line-607"></span>        <span class="ID">H</span> = <span class="ID">mat</span>(<span class="String">'</span><span class="String">1.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_608"> 608</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_608"></span><span class="anchor" id="line-608"></span>        <span class="ID">Q</span> = <span class="ID">mat</span>(<span class="ResWord">float</span>(<span class="ID">q</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_609"> 609</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_609"></span><span class="anchor" id="line-609"></span>        <span class="ID">R</span> = <span class="ID">mat</span>(<span class="ResWord">float</span>(<span class="ID">r</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_610"> 610</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_610"></span><span class="anchor" id="line-610"></span>        <span class="ID">LinSys</span>.<span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">A</span>, <span class="ID">B</span>, <span class="ID">H</span>, <span class="ID">Q</span>, <span class="ID">R</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_611"> 611</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_611"></span><span class="anchor" id="line-611"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_612"> 612</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_612"></span><span class="anchor" id="line-612"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_613"> 613</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_613"></span><span class="anchor" id="line-613"></span><span class="ResWord">class</span> <span class="ID">SysSpringPendulum</span>(<span class="ID">LinSys</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_614"> 614</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_614"></span><span class="anchor" id="line-614"></span>    <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_615"> 615</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_615"></span><span class="anchor" id="line-615"></span><span class="String">    One dimensional spring pendulum with damper.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_616"> 616</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_616"></span><span class="anchor" id="line-616"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_617"> 617</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_617"></span><span class="anchor" id="line-617"></span><span class="String">    Sketch::</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_618"> 618</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_618"></span><span class="anchor" id="line-618"></span><span class="String">                            x, v, a</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_619"> 619</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_619"></span><span class="anchor" id="line-619"></span><span class="String">                          :---------&gt;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_620"> 620</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_620"></span><span class="anchor" id="line-620"></span><span class="String">               ||         :</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_621"> 621</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_621"></span><span class="anchor" id="line-621"></span><span class="String">               ||   c1    +------+</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_622"> 622</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_622"></span><span class="anchor" id="line-622"></span><span class="String">               ||/\/\/\/\/|      |</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_623"> 623</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_623"></span><span class="anchor" id="line-623"></span><span class="String">               ||   d1    |      |</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_624"> 624</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_624"></span><span class="anchor" id="line-624"></span><span class="String">               || |-----  |   m  |  vibrating mass</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_625"> 625</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_625"></span><span class="anchor" id="line-625"></span><span class="String">               ||=|   ]===|      |</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_626"> 626</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_626"></span><span class="anchor" id="line-626"></span><span class="String">               || |-----  |      |---&gt; F_i  forces</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_627"> 627</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_627"></span><span class="anchor" id="line-627"></span><span class="String">               ||         +------+</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_628"> 628</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_628"></span><span class="anchor" id="line-628"></span><span class="String">               ||</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_629"> 629</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_629"></span><span class="anchor" id="line-629"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_630"> 630</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_630"></span><span class="anchor" id="line-630"></span><span class="String">    Differential equations:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_631"> 631</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_631"></span><span class="anchor" id="line-631"></span><span class="String">        sum(F_i) = m*a = -c1 * x - d1 * v + F_load + F_control</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_632"> 632</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_632"></span><span class="anchor" id="line-632"></span><span class="String">        a = diff(v,t)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_633"> 633</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_633"></span><span class="anchor" id="line-633"></span><span class="String">        v = diff(x, t)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_634"> 634</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_634"></span><span class="anchor" id="line-634"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_635"> 635</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_635"></span><span class="anchor" id="line-635"></span><span class="String">    Difference equations:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_636"> 636</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_636"></span><span class="anchor" id="line-636"></span><span class="String">        v_k = v_{k-1}  -  c1*ts/m * x_k  -  d1*ts/m * v_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_637"> 637</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_637"></span><span class="anchor" id="line-637"></span><span class="String">             +  ts/m * F_load  +  ts/m * F_control  +  noiseP1_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_638"> 638</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_638"></span><span class="anchor" id="line-638"></span><span class="String">        x_k = x_{k-1}  +  ts * v_k  +  noiseP2_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_639"> 639</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_639"></span><span class="anchor" id="line-639"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_640"> 640</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_640"></span><span class="anchor" id="line-640"></span><span class="String">        with:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_641"> 641</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_641"></span><span class="anchor" id="line-641"></span><span class="String">            ts : time step size (delta t)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_642"> 642</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_642"></span><span class="anchor" id="line-642"></span><span class="String">            noiseP1_k, noiseP2_k : process noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_643"> 643</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_643"></span><span class="anchor" id="line-643"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_644"> 644</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_644"></span><span class="anchor" id="line-644"></span><span class="String">     Measurement model:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_645"> 645</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_645"></span><span class="anchor" id="line-645"></span><span class="String">        z1_k = x_k + noiseM2_k  -  you can only measure the position</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_646"> 646</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_646"></span><span class="anchor" id="line-646"></span><span class="String"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_647"> 647</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_647"></span><span class="anchor" id="line-647"></span><span class="String">    state vector:           x = mat([[v_k], [x_k]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_648"> 648</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_648"></span><span class="anchor" id="line-648"></span><span class="String">    (control) input vector: u = mat([[F_load], [F_control]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_649"> 649</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_649"></span><span class="anchor" id="line-649"></span><span class="String">    &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_650"> 650</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_650"></span><span class="anchor" id="line-650"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_651"> 651</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_651"></span><span class="anchor" id="line-651"></span>    <span class="ResWord">def</span> <span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">m</span>=<span class="Number">1.</span>, <span class="ID">c1</span>=<span class="Number">0.04</span>, <span class="ID">d1</span>=<span class="Number">0.1</span>, <span class="ID">ts</span>=<span class="Number">1.</span>, <span class="ID">q</span>=<span class="Number">0.001</span>, <span class="ID">r</span>=<span class="Number">0.1</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_652"> 652</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_652"></span><span class="anchor" id="line-652"></span>        <span class="String">&quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_653"> 653</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_653"></span><span class="anchor" id="line-653"></span><span class="String">        Parameter:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_654"> 654</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_654"></span><span class="anchor" id="line-654"></span><span class="String">            m:  Mass                           : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_655"> 655</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_655"></span><span class="anchor" id="line-655"></span><span class="String">            c1: Spring constant                : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_656"> 656</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_656"></span><span class="anchor" id="line-656"></span><span class="String">            d1: Damping constant               : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_657"> 657</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_657"></span><span class="anchor" id="line-657"></span><span class="String">            ts: Time between steps.            : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_658"> 658</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_658"></span><span class="anchor" id="line-658"></span><span class="String">            q:  Variance of process noise.     : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_659"> 659</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_659"></span><span class="anchor" id="line-659"></span><span class="String">            r:  Variance of measurement noise. : float</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_660"> 660</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_660"></span><span class="anchor" id="line-660"></span><span class="String">        &quot;&quot;&quot;</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_661"> 661</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_661"></span><span class="anchor" id="line-661"></span>        <span class="Comment">#compute characteristic properties</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_662"> 662</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_662"></span><span class="anchor" id="line-662"></span>        <span class="ID">omega</span> = <span class="ID">N</span>.<span class="ID">sqrt</span>(<span class="ID">c1</span>/<span class="ID">m</span>)      <span class="Comment"># circular frequency</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_663"> 663</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_663"></span><span class="anchor" id="line-663"></span>        <span class="ID">period</span> = <span class="Number">2</span> * <span class="ID">N</span>.<span class="ID">pi</span> / <span class="ID">omega</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_664"> 664</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_664"></span><span class="anchor" id="line-664"></span>        <span class="ID">damping</span> = <span class="ID">d1</span>/<span class="ID">N</span>.<span class="ID">sqrt</span>(<span class="ID">c1</span>*<span class="ID">m</span>) <span class="Comment"># if damping&gt;1 then: damping is strong</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_665"> 665</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_665"></span><span class="anchor" id="line-665"></span>        <span class="ID">dStrong</span> = <span class="String">'</span><span class="String">yes</span><span class="String">'</span> <span class="ResWord">if</span> <span class="ID">damping</span> &gt; <span class="Number">1</span> <span class="ResWord">else</span> <span class="String">'</span><span class="String">no</span><span class="String">'</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_666"> 666</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_666"></span><span class="anchor" id="line-666"></span>        <span class="ResWord">print</span> <span class="String">'</span><span class="String">Period (T): </span><span class="String">%g</span><span class="String">. Circular frequency: </span><span class="String">%g</span><span class="String">.</span><span class="String">'</span> % (<span class="ID">period</span>, <span class="ID">omega</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_667"> 667</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_667"></span><span class="anchor" id="line-667"></span>        <span class="ResWord">print</span> <span class="String">'</span><span class="String">Damping: </span><span class="String">%g</span><span class="String">; strong damping? </span><span class="String">%s</span><span class="String">'</span> % (<span class="ID">damping</span>, <span class="ID">dStrong</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_668"> 668</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_668"></span><span class="anchor" id="line-668"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_669"> 669</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_669"></span><span class="anchor" id="line-669"></span>        <span class="ID">A</span> = <span class="ID">mat</span>([[<span class="Number">1.</span>-<span class="ID">d1</span>*<span class="ID">ts</span>/<span class="ID">m</span>,  -<span class="ID">c1</span>*<span class="ID">ts</span>/<span class="ID">m</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_670"> 670</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_670"></span><span class="anchor" id="line-670"></span>                 [<span class="ID">ts</span>,          <span class="Number">1.</span>     ]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_671"> 671</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_671"></span><span class="anchor" id="line-671"></span>        <span class="ID">B</span> = <span class="ID">mat</span>([[<span class="ID">ts</span>/<span class="ID">m</span>,  <span class="ID">ts</span>/<span class="ID">m</span>],</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_672"> 672</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_672"></span><span class="anchor" id="line-672"></span>                 [<span class="Number">0.</span>,    <span class="Number">0.</span>  ]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_673"> 673</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_673"></span><span class="anchor" id="line-673"></span>        <span class="ID">H</span> = <span class="ID">mat</span>([[<span class="Number">0.</span>, <span class="Number">1.</span>]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_674"> 674</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_674"></span><span class="anchor" id="line-674"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_675"> 675</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_675"></span><span class="anchor" id="line-675"></span>        <span class="ID">Q</span> = <span class="ID">mat</span>([[<span class="ID">q</span>,  <span class="Number">0.</span>   ],  <span class="Comment"># process noise consists mainly of forces</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_676"> 676</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_676"></span><span class="anchor" id="line-676"></span>                 [<span class="Number">0.</span>, <span class="ID">q</span>/<span class="Number">100</span>]]) <span class="Comment"># only very few noise is added to the position</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_677"> 677</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_677"></span><span class="anchor" id="line-677"></span>        <span class="ID">R</span> = <span class="ID">mat</span>([[<span class="ID">r</span>]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_678"> 678</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_678"></span><span class="anchor" id="line-678"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_679"> 679</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_679"></span><span class="anchor" id="line-679"></span>        <span class="ID">LinSys</span>.<span class="ID">__init__</span>(<span class="ResWord">self</span>, <span class="ID">A</span>, <span class="ID">B</span>, <span class="ID">H</span>, <span class="ID">Q</span>, <span class="ID">R</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_680"> 680</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_680"></span><span class="anchor" id="line-680"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_681"> 681</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_681"></span><span class="anchor" id="line-681"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_682"> 682</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_682"></span><span class="anchor" id="line-682"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_683"> 683</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_683"></span><span class="anchor" id="line-683"></span><span class="Comment">#  Do some experiments</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_684"> 684</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_684"></span><span class="anchor" id="line-684"></span><span class="Comment">#------------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_685"> 685</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_685"></span><span class="anchor" id="line-685"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_686"> 686</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_686"></span><span class="anchor" id="line-686"></span><span class="ResWord">if</span> <span class="ID">__name__</span> == <span class="String">'</span><span class="String">__main__</span><span class="String">'</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_687"> 687</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_687"></span><span class="anchor" id="line-687"></span>    <span class="Comment"># Estimate two constant values from noisy data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_688"> 688</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_688"></span><span class="anchor" id="line-688"></span>    <span class="Comment">#--------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_689"> 689</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_689"></span><span class="anchor" id="line-689"></span>    <span class="ResWord">def</span> <span class="ID">experiment_ConstantValue</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_690"> 690</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_690"></span><span class="anchor" id="line-690"></span>        <span class="Comment"># 'simulate' the system - results in two constants + Gaussian noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_691"> 691</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_691"></span><span class="anchor" id="line-691"></span>        <span class="Comment">#     Creating a constant with noise could be done much more easy:</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_692"> 692</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_692"></span><span class="anchor" id="line-692"></span>        <span class="Comment">#     Z0 = N.random.normal(loc=2.5, scale=2., size=(100,))</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_693"> 693</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_693"></span><span class="anchor" id="line-693"></span>        <span class="ID">constSys</span> = <span class="ID">SysConstVal</span>(<span class="ID">n</span>=<span class="Number">2</span>, <span class="ID">R</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">2., 0; 0, 0.02</span><span class="String">'</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_694"> 694</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_694"></span><span class="anchor" id="line-694"></span>        <span class="ID">U</span>=<span class="ID">N</span>.<span class="ID">zeros</span>((<span class="Number">1</span>, <span class="Number">100</span>)) <span class="Comment">#control input (will be ignored)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_695"> 695</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_695"></span><span class="anchor" id="line-695"></span>        <span class="ID">X</span>, <span class="ID">Z</span> = <span class="ID">constSys</span>.<span class="ID">simulate</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">2.5; -1.2</span><span class="String">'</span>), <span class="ID">U</span>=<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_696"> 696</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_696"></span><span class="anchor" id="line-696"></span>        <span class="Comment">#estimate the value from the noisy data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_697"> 697</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_697"></span><span class="anchor" id="line-697"></span>        <span class="Comment">#constSys.Q = mat(N.identity(2)) * 1e-2 #pretend that there is process noise</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_698"> 698</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_698"></span><span class="anchor" id="line-698"></span>        <span class="ID">kFilt</span> = <span class="ID">KalmanFilter</span>(<span class="ID">constSys</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_699"> 699</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_699"></span><span class="anchor" id="line-699"></span>        <span class="ID">X_hat</span> = <span class="ID">kFilt</span>.<span class="ID">estimate</span>(<span class="ID">Z</span>, <span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_700"> 700</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_700"></span><span class="anchor" id="line-700"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_701"> 701</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_701"></span><span class="anchor" id="line-701"></span>        <span class="Comment">#create plot</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_702"> 702</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_702"></span><span class="anchor" id="line-702"></span>        <span class="ID">pylab</span>.<span class="ID">figure</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_703"> 703</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_703"></span><span class="anchor" id="line-703"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_704"> 704</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_704"></span><span class="anchor" id="line-704"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 0, true</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_705"> 705</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_705"></span><span class="anchor" id="line-705"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">Z</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b:x</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 0, noisy</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_706"> 706</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_706"></span><span class="anchor" id="line-706"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X_hat</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 0, estimated</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_707"> 707</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_707"></span><span class="anchor" id="line-707"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_708"> 708</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_708"></span><span class="anchor" id="line-708"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X</span>[<span class="Number">1</span>], <span class="String">'</span><span class="String">g-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 1, true</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_709"> 709</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_709"></span><span class="anchor" id="line-709"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">Z</span>[<span class="Number">1</span>], <span class="String">'</span><span class="String">g:x</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 1, noisy</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_710"> 710</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_710"></span><span class="anchor" id="line-710"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X_hat</span>[<span class="Number">1</span>], <span class="String">'</span><span class="String">g-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">val 1, estimated</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_711"> 711</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_711"></span><span class="anchor" id="line-711"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_712"> 712</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_712"></span><span class="anchor" id="line-712"></span>        <span class="ID">pylab</span>.<span class="ID">xlabel</span>(<span class="String">'</span><span class="String">step</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_713"> 713</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_713"></span><span class="anchor" id="line-713"></span>        <span class="ID">pylab</span>.<span class="ID">legend</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_714"> 714</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_714"></span><span class="anchor" id="line-714"></span>        <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_constantValue.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_715"> 715</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_715"></span><span class="anchor" id="line-715"></span>    <span class="ID">experiment_ConstantValue</span>() <span class="Comment">#enable/disable here</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_716"> 716</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_716"></span><span class="anchor" id="line-716"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_717"> 717</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_717"></span><span class="anchor" id="line-717"></span>    <span class="Comment"># Simulate simple tank and estimate amount in tank</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_718"> 718</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_718"></span><span class="anchor" id="line-718"></span>    <span class="Comment">#--------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_719"> 719</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_719"></span><span class="anchor" id="line-719"></span>    <span class="ResWord">def</span> <span class="ID">experiment_tank</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_720"> 720</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_720"></span><span class="anchor" id="line-720"></span>        <span class="Comment"># create the (control) inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_721"> 721</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_721"></span><span class="anchor" id="line-721"></span>        <span class="ID">valveIn</span>  =    <span class="ID">ones</span>(<span class="Number">100</span>)*<span class="Number">0.1</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_722"> 722</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_722"></span><span class="anchor" id="line-722"></span>        <span class="ID">valveOut</span> = <span class="ID">r_</span>[<span class="ID">zeros</span>(<span class="Number">50</span>), <span class="ID">ones</span>(<span class="Number">10</span>)*<span class="Number">0.3</span>, <span class="ID">ones</span>(<span class="Number">40</span>)*<span class="Number">0.08</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_723"> 723</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_723"></span><span class="anchor" id="line-723"></span>        <span class="ID">U</span> = <span class="ID">vstack</span>((<span class="ID">valveIn</span>, <span class="ID">valveOut</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_724"> 724</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_724"></span><span class="anchor" id="line-724"></span>        <span class="Comment"># simulate the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_725"> 725</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_725"></span><span class="anchor" id="line-725"></span>        <span class="ID">tank</span> = <span class="ID">SysTank</span>(<span class="ID">q</span>=<span class="Number">0.002</span>, <span class="ID">r</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_726"> 726</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_726"></span><span class="anchor" id="line-726"></span>        <span class="ID">X</span>, <span class="ID">Z</span> = <span class="ID">tank</span>.<span class="ID">simulate</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">2.</span><span class="String">'</span>), <span class="ID">U</span>=<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_727"> 727</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_727"></span><span class="anchor" id="line-727"></span>        <span class="Comment"># estimate tank level from noisy data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_728"> 728</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_728"></span><span class="anchor" id="line-728"></span>        <span class="ID">kFilt</span> = <span class="ID">KalmanFilter</span>(<span class="ID">tank</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_729"> 729</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_729"></span><span class="anchor" id="line-729"></span>        <span class="ID">X_hat</span> = <span class="ID">kFilt</span>.<span class="ID">estimate</span>(<span class="ID">Z</span>, <span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_730"> 730</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_730"></span><span class="anchor" id="line-730"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_731"> 731</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_731"></span><span class="anchor" id="line-731"></span>        <span class="Comment">#try if smoothing is better or worse</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_732"> 732</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_732"></span><span class="anchor" id="line-732"></span>        <span class="ID">kernelSize</span> = <span class="Number">15</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_733"> 733</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_733"></span><span class="anchor" id="line-733"></span>        <span class="ID">kernel</span> = <span class="ID">ones</span>(<span class="ID">kernelSize</span>) / <span class="ID">kernelSize</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_734"> 734</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_734"></span><span class="anchor" id="line-734"></span>        <span class="ID">Z_smooth</span> = <span class="ID">N</span>.<span class="ID">zeros_like</span>(<span class="ID">Z</span>.<span class="ID">ravel</span>())</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_735"> 735</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_735"></span><span class="anchor" id="line-735"></span>        <span class="ID">Z_smooth</span>[<span class="ID">kernelSize</span>-<span class="Number">1</span>:] = <span class="ID">N</span>.<span class="ID">correlate</span>(<span class="ID">Z</span>.<span class="ID">ravel</span>(), <span class="ID">kernel</span>, <span class="String">'</span><span class="String">valid</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_736"> 736</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_736"></span><span class="anchor" id="line-736"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_737"> 737</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_737"></span><span class="anchor" id="line-737"></span>        <span class="Comment">#create plot</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_738"> 738</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_738"></span><span class="anchor" id="line-738"></span>        <span class="ID">pylab</span>.<span class="ID">figure</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_739"> 739</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_739"></span><span class="anchor" id="line-739"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">true states</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_740"> 740</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_740"></span><span class="anchor" id="line-740"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">Z</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b:x</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">noisy measurements</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_741"> 741</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_741"></span><span class="anchor" id="line-741"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X_hat</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">b-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">estimated states</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_742"> 742</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_742"></span><span class="anchor" id="line-742"></span>        <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">Z_smooth</span>, <span class="String">'</span><span class="String">g-</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">smoothed measurements</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_743"> 743</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_743"></span><span class="anchor" id="line-743"></span>        <span class="ID">pylab</span>.<span class="ID">xlabel</span>(<span class="String">'</span><span class="String">step</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_744"> 744</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_744"></span><span class="anchor" id="line-744"></span>        <span class="ID">pylab</span>.<span class="ID">legend</span>(<span class="ID">loc</span>=<span class="String">'</span><span class="String">lower right</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_745"> 745</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_745"></span><span class="anchor" id="line-745"></span>        <span class="ID">pylab</span>.<span class="ID">title</span>(<span class="String">'</span><span class="String">Tank</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_746"> 746</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_746"></span><span class="anchor" id="line-746"></span>        <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_tank.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_747"> 747</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_747"></span><span class="anchor" id="line-747"></span>    <span class="ID">experiment_tank</span>() <span class="Comment">#enable/disable here</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_748"> 748</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_748"></span><span class="anchor" id="line-748"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_749"> 749</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_749"></span><span class="anchor" id="line-749"></span>    <span class="Comment"># Simulate spring pendulum and estimate position</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_750"> 750</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_750"></span><span class="anchor" id="line-750"></span>    <span class="Comment">#--------------------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_751"> 751</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_751"></span><span class="anchor" id="line-751"></span>    <span class="ResWord">def</span> <span class="ID">experiment_SpringPendulum</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_752"> 752</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_752"></span><span class="anchor" id="line-752"></span>        <span class="Comment">#diagram used in all sub-experiments</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_753"> 753</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_753"></span><span class="anchor" id="line-753"></span>        <span class="ResWord">def</span> <span class="ID">plotFigure</span>(<span class="ID">X</span>, <span class="ID">X_hat</span>, <span class="ID">Z</span>, <span class="ID">U</span>, <span class="ID">SetPoint</span>=<span class="ResWord">None</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_754"> 754</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_754"></span><span class="anchor" id="line-754"></span>                       <span class="ID">title</span>=<span class="String">'</span><span class="String">Spring Pendulum</span><span class="String">'</span>, <span class="ID">legendLoc</span>=<span class="String">'</span><span class="String">upper left</span><span class="String">'</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_755"> 755</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_755"></span><span class="anchor" id="line-755"></span>            <span class="ID">X</span> = <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">X</span>); <span class="ID">X_hat</span> = <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">X_hat</span>); <span class="ID">Z</span> = <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">Z</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_756"> 756</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_756"></span><span class="anchor" id="line-756"></span>            <span class="ID">U</span> = <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">U</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_757"> 757</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_757"></span><span class="anchor" id="line-757"></span>            <span class="ID">pylab</span>.<span class="ID">figure</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_758"> 758</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_758"></span><span class="anchor" id="line-758"></span>            <span class="ResWord">if</span> <span class="ID">SetPoint</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ResWord">None</span>:</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_759"> 759</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_759"></span><span class="anchor" id="line-759"></span>                <span class="ID">SetPoint</span> = <span class="ID">N</span>.<span class="ID">asarray</span>(<span class="ID">SetPoint</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_760"> 760</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_760"></span><span class="anchor" id="line-760"></span>                <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">SetPoint</span>[<span class="Number">0</span>],<span class="String">'</span><span class="String">y-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">set-point</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_761"> 761</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_761"></span><span class="anchor" id="line-761"></span>            <span class="Comment"># input vector:     u = mat([[F_load], [F_control]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_762"> 762</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_762"></span><span class="anchor" id="line-762"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">U</span>[<span class="Number">0</span>],     <span class="String">'</span><span class="String">r-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">F load</span><span class="String">'</span>,      <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_763"> 763</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_763"></span><span class="anchor" id="line-763"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">U</span>[<span class="Number">1</span>],     <span class="String">'</span><span class="String">m-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">F control</span><span class="String">'</span>,   <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_764"> 764</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_764"></span><span class="anchor" id="line-764"></span>            <span class="Comment"># state vector:    x = mat([[v_k], [x_k]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_765"> 765</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_765"></span><span class="anchor" id="line-765"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X</span>[<span class="Number">0</span>],     <span class="String">'</span><span class="String">g-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">v true</span><span class="String">'</span>,      <span class="ID">linewidth</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_766"> 766</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_766"></span><span class="anchor" id="line-766"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X_hat</span>[<span class="Number">0</span>], <span class="String">'</span><span class="String">g-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">v estimated</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_767"> 767</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_767"></span><span class="anchor" id="line-767"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X</span>[<span class="Number">1</span>],     <span class="String">'</span><span class="String">b-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">x true</span><span class="String">'</span>,      <span class="ID">linewidth</span>=<span class="Number">2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_768"> 768</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_768"></span><span class="anchor" id="line-768"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">Z</span>[<span class="Number">0</span>],     <span class="String">'</span><span class="String">b:x</span><span class="String">'</span>, <span class="ID">label</span>=<span class="String">'</span><span class="String">x measured</span><span class="String">'</span>,  <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_769"> 769</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_769"></span><span class="anchor" id="line-769"></span>            <span class="ID">pylab</span>.<span class="ID">plot</span>(<span class="ID">X_hat</span>[<span class="Number">1</span>], <span class="String">'</span><span class="String">b-</span><span class="String">'</span>,  <span class="ID">label</span>=<span class="String">'</span><span class="String">x estimated</span><span class="String">'</span>, <span class="ID">linewidth</span>=<span class="Number">1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_770"> 770</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_770"></span><span class="anchor" id="line-770"></span>            <span class="ID">pylab</span>.<span class="ID">xlabel</span>(<span class="String">'</span><span class="String">step</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_771"> 771</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_771"></span><span class="anchor" id="line-771"></span>            <span class="ID">pylab</span>.<span class="ID">legend</span>(<span class="ID">loc</span>=<span class="ID">legendLoc</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_772"> 772</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_772"></span><span class="anchor" id="line-772"></span>            <span class="ID">pylab</span>.<span class="ID">title</span>(<span class="ID">title</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_773"> 773</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_773"></span><span class="anchor" id="line-773"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_774"> 774</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_774"></span><span class="anchor" id="line-774"></span>        <span class="ID">ts</span> = <span class="Number">0.5</span>     <span class="Comment">#step time - shorten for better estimation results</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_775"> 775</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_775"></span><span class="anchor" id="line-775"></span>        <span class="ID">nSteps</span> = <span class="Number">200</span> <span class="Comment">#duration of simulation</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_776"> 776</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_776"></span><span class="anchor" id="line-776"></span>        <span class="Comment">#Create system and filter - same for all experiments.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_777"> 777</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_777"></span><span class="anchor" id="line-777"></span>        <span class="Comment">#</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_778"> 778</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_778"></span><span class="anchor" id="line-778"></span>        <span class="Comment"># The spring pendulum is only weakly damped.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_779"> 779</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_779"></span><span class="anchor" id="line-779"></span>        <span class="Comment"># Noise is mainly added to the velocity; this means random *forces* act</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_780"> 780</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_780"></span><span class="anchor" id="line-780"></span>        <span class="Comment"># on the pendulum. Very little noise is added to the position.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_781"> 781</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_781"></span><span class="anchor" id="line-781"></span>        <span class="Comment"># The random forces let the pendulum oscillate strongly.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_782"> 782</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_782"></span><span class="anchor" id="line-782"></span>        <span class="Comment"># Even though the Kalman filter can only see the position, it can</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_783"> 783</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_783"></span><span class="anchor" id="line-783"></span>        <span class="Comment"># estimate the speed fairly well.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_784"> 784</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_784"></span><span class="anchor" id="line-784"></span>        <span class="ID">pendu</span> = <span class="ID">SysSpringPendulum</span>(<span class="ID">m</span>=<span class="Number">1.</span>, <span class="ID">c1</span>=<span class="Number">0.04</span>, <span class="ID">d1</span>=<span class="Number">0.1</span>, <span class="ID">ts</span>=<span class="ID">ts</span>, <span class="ID">q</span>=<span class="Number">0.004</span>, <span class="ID">r</span>=<span class="Number">2.</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_785"> 785</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_785"></span><span class="anchor" id="line-785"></span>        <span class="ID">kFilt</span> = <span class="ID">KalmanFilter</span>(<span class="ID">pendu</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_786"> 786</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_786"></span><span class="anchor" id="line-786"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_787"> 787</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_787"></span><span class="anchor" id="line-787"></span>        <span class="Comment"># See how much the pendulum oscillates only because of noise.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_788"> 788</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_788"></span><span class="anchor" id="line-788"></span>        <span class="ResWord">def</span> <span class="ID">onlyNoise</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_789"> 789</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_789"></span><span class="anchor" id="line-789"></span>            <span class="Comment"># create the inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_790"> 790</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_790"></span><span class="anchor" id="line-790"></span>            <span class="ID">U</span> = <span class="ID">zeros</span>((<span class="Number">2</span>, <span class="ID">nSteps</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_791"> 791</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_791"></span><span class="anchor" id="line-791"></span>            <span class="Comment"># simulate the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_792"> 792</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_792"></span><span class="anchor" id="line-792"></span>            <span class="ID">X</span>, <span class="ID">Z</span> = <span class="ID">pendu</span>.<span class="ID">simulate</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">0.; 0.</span><span class="String">'</span>), <span class="ID">U</span>=<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_793"> 793</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_793"></span><span class="anchor" id="line-793"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_794"> 794</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_794"></span><span class="anchor" id="line-794"></span>            <span class="Comment"># estimate pendulum position and speed</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_795"> 795</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_795"></span><span class="anchor" id="line-795"></span>            <span class="ID">X_hat</span> = <span class="ID">kFilt</span>.<span class="ID">estimate</span>(<span class="ID">Z</span>, <span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_796"> 796</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_796"></span><span class="anchor" id="line-796"></span>            <span class="ID">plotFigure</span>(<span class="ID">X</span>, <span class="ID">X_hat</span>, <span class="ID">Z</span>, <span class="ID">U</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_797"> 797</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_797"></span><span class="anchor" id="line-797"></span>                       <span class="ID">title</span>=<span class="String">'</span><span class="String">Spring Pendulum - Only Noise</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_798"> 798</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_798"></span><span class="anchor" id="line-798"></span>            <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_springPendulum_onlyNoise.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_799"> 799</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_799"></span><span class="anchor" id="line-799"></span>        <span class="Comment">#onlyNoise()</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_800"> 800</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_800"></span><span class="anchor" id="line-800"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_801"> 801</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_801"></span><span class="anchor" id="line-801"></span>        <span class="Comment"># Excite the spring pendulum with an impulse</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_802"> 802</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_802"></span><span class="anchor" id="line-802"></span>        <span class="ResWord">def</span> <span class="ID">impulseExcitation</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_803"> 803</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_803"></span><span class="anchor" id="line-803"></span>            <span class="Comment"># create the inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_804"> 804</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_804"></span><span class="anchor" id="line-804"></span>            <span class="Comment"># input vector:     u = mat([[F_load], [F_control]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_805"> 805</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_805"></span><span class="anchor" id="line-805"></span>            <span class="ID">U</span> = <span class="ID">zeros</span>((<span class="Number">2</span>, <span class="ID">nSteps</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_806"> 806</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_806"></span><span class="anchor" id="line-806"></span>            <span class="ID">U</span>[<span class="Number">0</span>, <span class="ResWord">int</span>(<span class="ID">nSteps</span>/<span class="Number">2</span>)] = <span class="Number">2.5</span>/<span class="ID">ts</span> <span class="Comment">#impulse of load force in middle</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_807"> 807</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_807"></span><span class="anchor" id="line-807"></span>            <span class="Comment"># simulate the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_808"> 808</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_808"></span><span class="anchor" id="line-808"></span>            <span class="ID">X</span>, <span class="ID">Z</span> = <span class="ID">pendu</span>.<span class="ID">simulate</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">0.; 0.</span><span class="String">'</span>), <span class="ID">U</span>=<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_809"> 809</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_809"></span><span class="anchor" id="line-809"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_810"> 810</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_810"></span><span class="anchor" id="line-810"></span>            <span class="Comment"># estimate pendulum position and speed</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_811"> 811</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_811"></span><span class="anchor" id="line-811"></span>            <span class="ID">X_hat</span> = <span class="ID">kFilt</span>.<span class="ID">estimate</span>(<span class="ID">Z</span>, <span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_812"> 812</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_812"></span><span class="anchor" id="line-812"></span>            <span class="ID">plotFigure</span>(<span class="ID">X</span>, <span class="ID">X_hat</span>, <span class="ID">Z</span>, <span class="ID">U</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_813"> 813</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_813"></span><span class="anchor" id="line-813"></span>                       <span class="ID">title</span>=<span class="String">'</span><span class="String">Spring Pendulum - Impulse Excitation</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_814"> 814</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_814"></span><span class="anchor" id="line-814"></span>            <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_springPendulum_impulseExcitation.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_815"> 815</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_815"></span><span class="anchor" id="line-815"></span>        <span class="ID">impulseExcitation</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_816"> 816</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_816"></span><span class="anchor" id="line-816"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_817"> 817</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_817"></span><span class="anchor" id="line-817"></span>        <span class="Comment"># Excite the spring pendulum with an impulse; but Kalman filter can not</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_818"> 818</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_818"></span><span class="anchor" id="line-818"></span>        <span class="Comment"># see force.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_819"> 819</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_819"></span><span class="anchor" id="line-819"></span>        <span class="ResWord">def</span> <span class="ID">impulseExcitation_KalmanNotSeeForce</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_820"> 820</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_820"></span><span class="anchor" id="line-820"></span>            <span class="Comment"># create the inputs</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_821"> 821</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_821"></span><span class="anchor" id="line-821"></span>            <span class="Comment"># input vector:     u = mat([[F_load], [F_control]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_822"> 822</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_822"></span><span class="anchor" id="line-822"></span>            <span class="ID">U</span> = <span class="ID">zeros</span>((<span class="Number">2</span>, <span class="ID">nSteps</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_823"> 823</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_823"></span><span class="anchor" id="line-823"></span>            <span class="ID">U</span>[<span class="Number">0</span>, <span class="ResWord">int</span>(<span class="ID">nSteps</span>/<span class="Number">2</span>)] = <span class="Number">2.5</span>/<span class="ID">ts</span> <span class="Comment">#impulse of load force in middle</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_824"> 824</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_824"></span><span class="anchor" id="line-824"></span>            <span class="Comment"># simulate the system</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_825"> 825</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_825"></span><span class="anchor" id="line-825"></span>            <span class="ID">X</span>, <span class="ID">Z</span> = <span class="ID">pendu</span>.<span class="ID">simulate</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">0.; 0.</span><span class="String">'</span>), <span class="ID">U</span>=<span class="ID">U</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_826"> 826</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_826"></span><span class="anchor" id="line-826"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_827"> 827</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_827"></span><span class="anchor" id="line-827"></span>            <span class="Comment">#estimate pendulum position and speed, but Kalman filter can not</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_828"> 828</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_828"></span><span class="anchor" id="line-828"></span>            <span class="Comment">#see F_load (exciting force)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_829"> 829</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_829"></span><span class="anchor" id="line-829"></span>            <span class="ID">Uzero</span> = <span class="ID">N</span>.<span class="ID">zeros_like</span>(<span class="ID">U</span>) <span class="Comment">#Pretend F_load is always 0</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_830"> 830</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_830"></span><span class="anchor" id="line-830"></span>            <span class="ID">X_hat</span> = <span class="ID">kFilt</span>.<span class="ID">estimate</span>(<span class="ID">Z</span>, <span class="ID">Uzero</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_831"> 831</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_831"></span><span class="anchor" id="line-831"></span>            <span class="ID">plotFigure</span>(<span class="ID">X</span>, <span class="ID">X_hat</span>, <span class="ID">Z</span>, <span class="ID">U</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_832"> 832</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_832"></span><span class="anchor" id="line-832"></span>                   <span class="ID">title</span>=<span class="String">'</span><span class="String">Spring Pendulum - Kalman filter can not see force</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_833"> 833</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_833"></span><span class="anchor" id="line-833"></span>            <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_springPendulum_KalmanNotSeeForce.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_834"> 834</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_834"></span><span class="anchor" id="line-834"></span>        <span class="ID">impulseExcitation_KalmanNotSeeForce</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_835"> 835</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_835"></span><span class="anchor" id="line-835"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_836"> 836</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_836"></span><span class="anchor" id="line-836"></span>        <span class="Comment"># Controller for spring pendulum; use Kalman filter to get position</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_837"> 837</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_837"></span><span class="anchor" id="line-837"></span>        <span class="ResWord">def</span> <span class="ID">springPendulumController</span>():</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_838"> 838</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_838"></span><span class="anchor" id="line-838"></span>            <span class="Comment"># set-point for position controller</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_839"> 839</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_839"></span><span class="anchor" id="line-839"></span>            <span class="ID">SetPoint</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>(<span class="ID">nSteps</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_840"> 840</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_840"></span><span class="anchor" id="line-840"></span>            <span class="ID">SetPoint</span>[<span class="Number">0</span>, <span class="ResWord">int</span>(<span class="ID">nSteps</span>/<span class="Number">2</span>):] = <span class="Number">8.</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_841"> 841</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_841"></span><span class="anchor" id="line-841"></span>            <span class="Comment">#controller for position (as usual)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_842"> 842</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_842"></span><span class="anchor" id="line-842"></span>            <span class="ID">controllerPos</span> = <span class="ID">PidController</span>(<span class="ID">kp</span>=<span class="Number">0.3</span>, <span class="ID">ki</span>=<span class="Number">0.01</span>, <span class="ID">kd</span>=<span class="Number">0.0</span>, <span class="ID">ts</span>=<span class="ID">ts</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_843"> 843</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_843"></span><span class="anchor" id="line-843"></span>            <span class="Comment">#controller to add damping, sees -speed, drives speed low</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_844"> 844</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_844"></span><span class="anchor" id="line-844"></span>            <span class="ID">controllerDamp</span> = <span class="ID">PidController</span>(<span class="ID">kp</span>=<span class="Number">1.0</span>, <span class="ID">ki</span>=<span class="Number">0.0</span>, <span class="ID">kd</span>=<span class="Number">0.1</span>, <span class="ID">ts</span>=<span class="ID">ts</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_845"> 845</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_845"></span><span class="anchor" id="line-845"></span>            <span class="Comment">#create arrays for computation results</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_846"> 846</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_846"></span><span class="anchor" id="line-846"></span>            <span class="ID">X</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>((<span class="Number">2</span>,<span class="ID">nSteps</span>)))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_847"> 847</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_847"></span><span class="anchor" id="line-847"></span>            <span class="ID">X_hat</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>((<span class="Number">2</span>,<span class="ID">nSteps</span>)))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_848"> 848</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_848"></span><span class="anchor" id="line-848"></span>            <span class="ID">Z</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>((<span class="Number">1</span>,<span class="ID">nSteps</span>)))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_849"> 849</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_849"></span><span class="anchor" id="line-849"></span>            <span class="ID">U</span> = <span class="ID">mat</span>(<span class="ID">zeros</span>((<span class="Number">2</span>,<span class="ID">nSteps</span>)))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_850"> 850</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_850"></span><span class="anchor" id="line-850"></span>            <span class="Comment">#start simulation and filter (iteration 0)</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_851"> 851</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_851"></span><span class="anchor" id="line-851"></span>            <span class="ID">x_k</span>, <span class="ID">z_k</span> = <span class="ID">pendu</span>.<span class="ID">startSimulation</span>(<span class="ID">x_0</span>=<span class="ID">mat</span>(<span class="String">'</span><span class="String">0.; 0.</span><span class="String">'</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_852"> 852</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_852"></span><span class="anchor" id="line-852"></span>            <span class="ID">x_hat_k</span>, <span class="ID">P</span> = <span class="ID">kFilt</span>.<span class="ID">startEstimation</span>()</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_853"> 853</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_853"></span><span class="anchor" id="line-853"></span>            <span class="ID">u_k</span> = <span class="ID">mat</span>(<span class="String">'</span><span class="String">0.; 0.</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_854"> 854</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_854"></span><span class="anchor" id="line-854"></span>            <span class="Comment"># main loop</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_855"> 855</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_855"></span><span class="anchor" id="line-855"></span>            <span class="ResWord">for</span> <span class="ID">k</span> <span class="ResWord">in</span> <span class="ResWord">range</span>(<span class="Number">0</span>, <span class="ID">nSteps</span>):</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_856"> 856</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_856"></span><span class="anchor" id="line-856"></span>                <span class="ID">X</span>[:, <span class="ID">k</span>] = <span class="ID">x_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_857"> 857</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_857"></span><span class="anchor" id="line-857"></span>                <span class="ID">Z</span>[:, <span class="ID">k</span>] = <span class="ID">z_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_858"> 858</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_858"></span><span class="anchor" id="line-858"></span>                <span class="ID">X_hat</span>[:, <span class="ID">k</span>] = <span class="ID">x_hat_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_859"> 859</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_859"></span><span class="anchor" id="line-859"></span>                <span class="ID">U</span>[:, <span class="ID">k</span>] = <span class="ID">u_k</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_860"> 860</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_860"></span><span class="anchor" id="line-860"></span>                <span class="Comment">#compute control values</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_861"> 861</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_861"></span><span class="anchor" id="line-861"></span>                <span class="Comment"># state vector:    x = mat([[v_k], [x_k]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_862"> 862</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_862"></span><span class="anchor" id="line-862"></span>                <span class="Comment">#pos, speed = X[1, k],     X[0, k] #controller sees true data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_863"> 863</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_863"></span><span class="anchor" id="line-863"></span>                <span class="ID">pos</span>, <span class="ID">speed</span> = <span class="ID">X_hat</span>[<span class="Number">1</span>, <span class="ID">k</span>], <span class="ID">X_hat</span>[<span class="Number">0</span>, <span class="ID">k</span>] <span class="Comment">#control with estimated data</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_864"> 864</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_864"></span><span class="anchor" id="line-864"></span>                <span class="ID">sp</span> = <span class="ID">SetPoint</span>[<span class="Number">0</span>, <span class="ID">k</span>]</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_865"> 865</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_865"></span><span class="anchor" id="line-865"></span>                <span class="ID">f_control_k</span> = <span class="ID">controllerPos</span>.<span class="ID">computeStep</span>(<span class="ID">sp</span>-<span class="ID">pos</span>) + \</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_866"> 866</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_866"></span><span class="anchor" id="line-866"></span>                              <span class="ID">controllerDamp</span>.<span class="ID">computeStep</span>(-<span class="ID">speed</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_867"> 867</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_867"></span><span class="anchor" id="line-867"></span>                <span class="Comment"># input vector:    u = mat([[F_load], [F_control]])</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_868"> 868</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_868"></span><span class="anchor" id="line-868"></span>                <span class="ID">u_k</span> = <span class="ID">mat</span>([[<span class="Number">0.</span>], [<span class="ID">f_control_k</span>]])</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_869"> 869</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_869"></span><span class="anchor" id="line-869"></span>                <span class="Comment">#-- simulate and estimate new values --</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_870"> 870</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_870"></span><span class="anchor" id="line-870"></span>                <span class="ID">x_k</span>, <span class="ID">z_k</span> = <span class="ID">pendu</span>.<span class="ID">simulateStep</span>(<span class="ID">u_k</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_871"> 871</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_871"></span><span class="anchor" id="line-871"></span>                <span class="ID">x_hat_k</span>, <span class="ID">P</span> = <span class="ID">kFilt</span>.<span class="ID">estimateStep</span>(<span class="ID">z_k</span>, <span class="ID">u_k</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_872"> 872</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_872"></span><span class="anchor" id="line-872"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_873"> 873</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_873"></span><span class="anchor" id="line-873"></span>            <span class="ID">plotFigure</span>(<span class="ID">X</span>, <span class="ID">X_hat</span>, <span class="ID">Z</span>, <span class="ID">U</span>, <span class="ID">SetPoint</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_874"> 874</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_874"></span><span class="anchor" id="line-874"></span>                <span class="ID">title</span>=<span class="String">'</span><span class="String">Spring Pendulum - Controller for position and damping</span><span class="String">'</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_875"> 875</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_875"></span><span class="anchor" id="line-875"></span>            <span class="ID">pylab</span>.<span class="ID">savefig</span>(<span class="String">'</span><span class="String">kalman_filter_springPendulum_springPendulumController.png</span><span class="String">'</span>, <span class="ID">dpi</span>=<span class="Number">75</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_876"> 876</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_876"></span><span class="anchor" id="line-876"></span>        <span class="ID">springPendulumController</span>() <span class="Comment">#enable/disable here</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_877"> 877</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_877"></span><span class="anchor" id="line-877"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_878"> 878</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_878"></span><span class="anchor" id="line-878"></span>    <span class="ID">experiment_SpringPendulum</span>()  <span class="Comment">#enable/disable here</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_879"> 879</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_879"></span><span class="anchor" id="line-879"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_880"> 880</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_880"></span><span class="anchor" id="line-880"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_881"> 881</a> </span><span class="LineAnchor" id="CA-8e833d7b7c90ddd088c1a78120b290d18ce5c5ec_881"></span><span class="anchor" id="line-881"></span>    <span class="ID">pylab</span>.<span class="ID">show</span>()</span>
</pre></div></div><h2>New Attachment</h2>
<form action="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed" method="POST" enctype="multipart/form-data">
<dl>
<dt>File to upload</dt>
<dd><input type="file" name="file" size="50"></dd>
<dt>Rename to</dt>
<dd><input type="text" name="target" size="50" value="kalman.py"></dd>
<dt>Overwrite existing attachment of same name</dt>
<dd><input type="checkbox" name="overwrite" value="1" ></dd>
</dl>

<p>
<input type="hidden" name="action" value="AttachFile">
<input type="hidden" name="do" value="upload">
<input type="hidden" name="ticket" value="00563280ff.d5f51b22c18ed8ead309aeadfc6f5edd3b237b18">
<input type="submit" value="Upload">
</p>
</form>
<h2>Attached Files</h2>To refer to attachments on a page, use <strong><tt>attachment:filename</tt></strong>,  as shown below in the list of files.  Do <strong>NOT</strong> use the URL of the <tt>[get]</tt> link,  since this is subject to change and can break easily.<ul><li>[<a href="kalmanc517.py?action=AttachFile&amp;do=get&amp;target=kalman.py">get</a>&nbsp;| <a href="KalmanFilterLinearDetailed9af8.html?action=AttachFile&amp;do=view&amp;target=kalman.py">view</a>] (2007-12-05 01:31:05, 33.7 KB) [[attachment:kalman.py]]</li><li>[<a href="kalman_filter_constantValuea72c.png?action=AttachFile&amp;do=get&amp;target=kalman_filter_constantValue.png">get</a>&nbsp;| <a href="KalmanFilterLinearDetailed393b.html?action=AttachFile&amp;do=view&amp;target=kalman_filter_constantValue.png">view</a>] (2007-12-11 00:25:35, 51.4 KB) [[attachment:kalman_filter_constantValue.png]]</li><li>[<a href="kalman_filter_tank72e9.png?action=AttachFile&amp;do=get&amp;target=kalman_filter_tank.png">get</a>&nbsp;| <a href="KalmanFilterLinearDetailed8445.html?action=AttachFile&amp;do=view&amp;target=kalman_filter_tank.png">view</a>] (2007-12-11 01:49:12, 43.3 KB) [[attachment:kalman_filter_tank.png]]</li></ul><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="KalmanFilterLinearDetailed37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/KalmanFilterLinearDetailed">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/KalmanFilterLinearDetailed?action=AttachFile&do=view&target=kalman.py by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 21:48:24 GMT -->
</html>

