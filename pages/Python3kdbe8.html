<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<!-- Mirrored from localhost:8080/Python3k?action=recoverpass by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="edit_on_doubleclick" content="/">
<meta name="robots" content="noindex,nofollow">

<title>Python3k - SciPy wiki dump</title>
<script type="text/javascript" src="moin_static197/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="moin_static197/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="moin_static197/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="moin_static197/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="moin_static197/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static197/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="SciPy: Python3k" href="../external.html?link=http://localhost:8080/Python3k?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=Python3k&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="AllPages.html">
<link rel="Alternate" title="Wiki Markup" href="../external.html?link=http://localhost:8080/Python3k?action=raw">
<link rel="Alternate" media="print" title="Print View" href="../external.html?link=http://localhost:8080/Python3k?action=print">
<link rel="Search" href="FindPage.html">
<link rel="Index" href="TitleIndex.html">
<link rel="Glossary" href="WordIndex.html">
<link rel="Help" href="HelpOnFormatting.html">
</head>

<body  lang="en" dir="ltr"><div style="background: white; padding:2em;">This is an archival dump of old wiki content --- see <a href="http://scipy.org/">scipy.org</a> for current material</div>

<div id="header">


<form id="searchform" method="get" action="../external.html?link=http://localhost:8080/Python3k">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="Python3k456e.html?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="AllPages.html" rel="nofollow">SciPy</a></span></div>

<ul id="pagelocation">
<li><a class="backlink" href="AllPagesbf95.html?action=fullsearch&amp;context=180&amp;value=linkto%3A%22Python3k%22" rel="nofollow" title="Click to do a full-text search for this title">Python3k</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="RecentChanges.html">RecentChanges</a></li><li class="wikilink"><a class="nonexistent" href="FindPage.html">FindPage</a></li><li class="wikilink"><a class="nonexistent" href="HelpContents.html">HelpContents</a></li><li class="current"><a href="Python3k.html">Python3k</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>
<div id="message">
<p><div class="warning">This wiki is not enabled for mail processing.
Contact the owner of the wiki, who can enable email.</div></p><a class="clear-link" href="Python3k.html">Clear message</a>
</div>

<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Python3k37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/Python3k">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line874">This page will (for now) hold information and discussion about transitioning to Python 3k such as C API changes in Python/C API and how to deal with them. <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-4"></span>Note that some effort in documenting the migration is currently happening upstream: <span class="anchor" id="line-5"></span><ul><li><p class="line891"><a class="http" href="../external.html?link=http://svn.python.org/view/python/trunk/Doc/howto/cporting.rst?rev=66629&amp;view=log">Official C-API howto porting guide</a> <span class="anchor" id="line-6"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://wiki.python.org/moin/Py3kExtensionModules">Py3kExtensionModules</a> <span class="anchor" id="line-7"></span></li><li><p class="line891"><a class="http" href="../external.html?link=http://wiki.python.org/moin/PortingExtensionModulesToPy3k">PortingExtensionModulesToPy3k</a> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></li></ul><p class="line874">of some interest, too: <span class="anchor" id="line-10"></span><ul><li><p class="line891"><a class="http" href="../external.html?link=http://pythonology.blogspot.com/2009/02/making-code-run-on-python-20-through-30.html">Making code run on Python 2.0 through 3.0</a> <span class="anchor" id="line-11"></span></li></ul><p class="line867"><hr /><p class="line874"> <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line874">Link to some documents which describe changes in Python 3 : <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">1. <a class="http" href="../external.html?link=http://docs.python.org/dev/3.0/whatsnew/3.0.html">http://docs.python.org/dev/3.0/whatsnew/3.0.html</a>  <span class="anchor" id="line-16"></span>Mostly describes language and standard library changes. Has a very tiny paragraph on API changes. <span class="anchor" id="line-17"></span>A change to the buffer is potentially very important? <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line874">Findings : <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line862">After forcefully trying to compile <a class="nonexistent" href="NumPy.html">NumPy</a> 1.1.1 against Python 3k headers, immediately lots of errors pop up. Those seem to be related to the following issues: <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><p class="line874">1.String has disappeared. I think it has split into Bytes and Unicode type. Robert Kern said that possibly occurences of String will need to be replaced with Bytes. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">2. <a class="nonexistent" href="PyInt.html">PyInt</a>_Type has disappeared. Only <a class="nonexistent" href="PyLong.html">PyLong</a>_Type exists now. As for API functions such as <a class="nonexistent" href="PyInt.html">PyInt</a>_something or pyLong_something, they seem to have been aliased to refer to the same thing. This aliasing will be removed in Python 3.1 <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><p class="line862">3. <a class="nonexistent" href="PyNumberMethods.html">PyNumberMethods</a> has less fields now. For example, hex,  oct, divide and nonzero seem to be removed.  <span class="anchor" id="line-28"></span>There appears to be some autogenerated code using these methods so need to remove some of these names  <span class="anchor" id="line-29"></span>from autogeneration.  <span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line874">4. Buffer interface has changed. This is the biggest change. <span class="anchor" id="line-32"></span><ul><li style="list-style-type:none"><p class="line862">In python 2.5 and earlier, the <a class="http" href="../external.html?link=http://docs.python.org/api/abstract-buffer.html">PyBufferProcs</a> structure had 4 members (in fact, pointer to functions): <span class="anchor" id="line-33"></span></li></ul><p class="line867"><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><pre><span class="anchor" id="line-1"></span>typedef Py_ssize_t (*readbufferproc)(PyObject *, Py_ssize_t, void **);
<span class="anchor" id="line-2"></span>typedef Py_ssize_t (*writebufferproc)(PyObject *, Py_ssize_t, void **);
<span class="anchor" id="line-3"></span>typedef Py_ssize_t (*segcountproc)(PyObject *, Py_ssize_t *);
<span class="anchor" id="line-4"></span>typedef Py_ssize_t (*charbufferproc)(PyObject *, Py_ssize_t, char **);
<span class="anchor" id="line-5"></span>
<span class="anchor" id="line-6"></span>typedef struct {
<span class="anchor" id="line-7"></span>        readbufferproc bf_getreadbuffer;
<span class="anchor" id="line-8"></span>        writebufferproc bf_getwritebuffer;
<span class="anchor" id="line-9"></span>        segcountproc bf_getsegcount;
<span class="anchor" id="line-10"></span>        charbufferproc bf_getcharbuffer;
<span class="anchor" id="line-11"></span>} PyBufferProcs;</pre><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line874">These functions would then be somehow used under the hood by the following C-API functions: <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><pre><span class="anchor" id="line-1-1"></span> int PyObject_AsCharBuffer (PyObject *obj,
<span class="anchor" id="line-2-1"></span>                            const char **buffer,
<span class="anchor" id="line-3-1"></span>                            Py_ssize_t *buffer_len);
<span class="anchor" id="line-4-1"></span>
<span class="anchor" id="line-5-1"></span> int PyObject_CheckReadBuffer (PyObject *obj);
<span class="anchor" id="line-6-1"></span>
<span class="anchor" id="line-7-1"></span> int PyObject_AsReadBuffer (PyObject *obj,
<span class="anchor" id="line-8-1"></span>                            const void **buffer,
<span class="anchor" id="line-9-1"></span>                            Py_ssize_t *buffer_len);
<span class="anchor" id="line-10-1"></span>
<span class="anchor" id="line-11-1"></span>
<span class="anchor" id="line-12"></span> int PyObject_AsWriteBuffer (PyObject *obj,
<span class="anchor" id="line-13"></span>                             void **buffer,
<span class="anchor" id="line-14"></span>                             Py_ssize_t *buffer_len);</pre><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><p class="line874">In py3k, the above 4 functions have been deprecated (deprecated but still usable, although, as the mechanism to lock buffers isn't in python (yet?), some problems will pop up if you use these functions in new code: don't do that) in favor of the following 2: <span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><p class="line867"><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><pre><span class="anchor" id="line-1-2"></span> bool PyObject_CheckBuffer (PyObject* obj);       /* really a macro */
<span class="anchor" id="line-2-2"></span>
<span class="anchor" id="line-3-2"></span> int PyObject_GetBuffer (PyObject *obj, 
<span class="anchor" id="line-4-2"></span>                         Py_buffer *view, 
<span class="anchor" id="line-5-2"></span>                         int flags);</pre><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line874">The protocol, on the other hand, is now defined by: <span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><pre><span class="anchor" id="line-1-3"></span>typedef int (*getbufferproc)(PyObject *, Py_buffer *, int);
<span class="anchor" id="line-2-3"></span>typedef void (*releasebufferproc)(PyObject *, Py_buffer *);
<span class="anchor" id="line-3-3"></span>
<span class="anchor" id="line-4-3"></span>typedef struct {
<span class="anchor" id="line-5-3"></span>     getbufferproc bf_getbuffer;
<span class="anchor" id="line-6-2"></span>     releasebufferproc bf_releasebuffer;
<span class="anchor" id="line-7-2"></span>} PyBufferProcs;</pre><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line862">5. <a class="nonexistent" href="PyObject.html">PyObject</a>_VAR_HEAD has changed. However this doesnt seem like a change that requires much thought. We can probably blindly replacing stuff like obj-&gt;obj_size with obj-&gt;obj_base.obj_size.  <span class="anchor" id="line-87"></span><span class="anchor" id="bottom"></span></div>
<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbattachments" href="Python3k37dc.html?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="../external.html?link=http://localhost:8080/Python3k">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="../external.html?link=http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="../external.html?link=http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="../external.html?link=http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="../external.html?link=http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>

<!-- Mirrored from localhost:8080/Python3k?action=recoverpass by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Oct 2015 23:19:47 GMT -->
</html>

